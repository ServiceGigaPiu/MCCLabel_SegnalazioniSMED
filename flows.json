[
    {
        "id": "bdc10eb0bfc2c224",
        "type": "tab",
        "label": "main",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "4c238ae3c4c60cc5",
        "type": "tab",
        "label": "global config",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "c1d4418a6f1f1693",
        "type": "tab",
        "label": "Query PLC",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "687893cfe8ebd28b",
        "type": "tab",
        "label": "Query Db",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "76b05f87a5290cf6",
        "type": "tab",
        "label": "UIB req/resp",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "f325c0384ffbb0ed",
        "type": "tab",
        "label": "Dev tools",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "b9377575097a37a3",
        "type": "tab",
        "label": "Query S7",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "520bb4ac551bd04e",
        "type": "tab",
        "label": "config page",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "8fee1699ebf4915d",
        "type": "tab",
        "label": "Flow 1",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "14adf9cd8d883348",
        "type": "tab",
        "label": "Reboot and Restore",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "5f741e9d0e05f1e2",
        "type": "group",
        "z": "c1d4418a6f1f1693",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "e788bf33f7250b4e",
            "042d220310f4d201",
            "a4ea3b73128da3ca",
            "f31346e5c189cc0d",
            "f8f56d1dd1270dfc",
            "e3c72d4f0636519a",
            "db5d63224303cb8e",
            "cba181767f3c556b",
            "d8e171d74cfb3f15",
            "fae481120ae1669e",
            "829cb3bdb9fa3035",
            "586a6d5aedbb7697",
            "8d2faa48c7f2974b",
            "70f0e9dd596f13dd",
            "e448cf338d7ce60a",
            "3d7f018e03cb4a74",
            "8738217e5c0cf07c",
            "ceacba052417233a",
            "b375a71d547e53ec",
            "761d54a566d15f19",
            "b7e4f98ef65e21b7",
            "e548c0432c3393fb",
            "d0d9b9c907a6dfeb",
            "bacfab2b6aa8f62e",
            "94ccb2ba33d6be90",
            "76e60fd08eb6f131",
            "bfbeb3f69de7db05",
            "c854307142509346",
            "5f94d8c13f129154",
            "734a6280c896ee84",
            "b8bf2e09ac2a846d",
            "a0979b83808254d4",
            "4e37b237f31db062"
        ],
        "x": 74,
        "y": 229
    },
    {
        "id": "31f4b8716c51f385",
        "type": "group",
        "z": "76b05f87a5290cf6",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "d83b9961b3c5fb9e",
            "2c415eda999050f1",
            "e90fd6ebd8e9a846",
            "63cb5672c06fad4e",
            "a2e783d72e228d3a",
            "f25308f6b79bce5d"
        ],
        "x": 89,
        "y": 1759
    },
    {
        "id": "042f83e60bf4b2b4",
        "type": "group",
        "z": "f325c0384ffbb0ed",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "e02b6f382a6c8813",
            "9056d3c89eaf484d",
            "d4e564eac59f8117"
        ],
        "x": 68,
        "y": 64,
        "w": 1124,
        "h": 603
    },
    {
        "id": "9bcec7222119e8a3",
        "type": "group",
        "z": "f325c0384ffbb0ed",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "3cf1218795abc823",
            "f6905ffb8eab6a25",
            "2b0d893e266ba428"
        ],
        "x": 819,
        "y": 1654,
        "w": 307,
        "h": 82
    },
    {
        "id": "59b9575558a87ab8",
        "type": "group",
        "z": "f325c0384ffbb0ed",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "a5c6292ed1672889",
            "83ea5f07872402eb",
            "732e9e9a5be95374",
            "06e8b2a3bf45c64b",
            "e16f5eb91fb5c4b4"
        ],
        "x": 854,
        "y": 1489,
        "w": 477,
        "h": 127
    },
    {
        "id": "ffe7d6539591cabf",
        "type": "group",
        "z": "f325c0384ffbb0ed",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "4589e135e62180d5",
            "78d83f5060d67324",
            "f60ed334182c339f",
            "3a58a38948ea94e8",
            "5f7d9434ee851d46",
            "89ec3e26ebc5ea38",
            "f7946e855cb7af23",
            "77190d99789c8205",
            "751f5980939d113e",
            "3c0c7d2ea6d76d9f",
            "912b13320bc74a21",
            "f49802da0ea96466",
            "a2d84d711435defe",
            "a387a9d3ceb733c8",
            "eb4ab9c687c85a83",
            "8394e156f1e2488e",
            "830ffb7ad83476f7",
            "aa246ddee430ee27",
            "35e1d011498c72cd",
            "7e5e3a6761c37063",
            "140b055fd622ecf2"
        ],
        "x": 109,
        "y": 1729,
        "w": 1367,
        "h": 382
    },
    {
        "id": "6f1ada98f5867046",
        "type": "group",
        "z": "b9377575097a37a3",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "454cf93fb55a37e1",
            "bbc0b268ea1e4b05",
            "ac0360013a3bc782",
            "d559e44b39c59c2e",
            "c9aaf418d77c2d5e"
        ],
        "x": 619,
        "y": 1139
    },
    {
        "id": "a02047ec82263155",
        "type": "group",
        "z": "b9377575097a37a3",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b5204d64c998cc1f",
            "21fbf510e4cbe1d4",
            "4debd21357a01bc6",
            "f3f7f42487fb6981",
            "3cfd59900276e4c7",
            "69a6569de8f183d7",
            "b1111e1050653ac6"
        ],
        "x": 119,
        "y": 54
    },
    {
        "id": "fc6c8637d9b4aad0",
        "type": "group",
        "z": "b9377575097a37a3",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "351ad075abbac370",
            "552b1632304bcb80",
            "e9c08298ab7f350b",
            "f37a0518b44c5219",
            "fa46f22c945d1162",
            "65e1635fb1a50f25",
            "8c85da46fbc8e587",
            "1d39b0493c890778",
            "81d3b5c8c04e7de4",
            "25a8041d1656d36e",
            "b779e74b5a16fa1b",
            "b524fe2e5e6aad80",
            "b5ac12a94b58dff0",
            "82fd1d1191fd6dc3",
            "ec556ce00fbd23ad",
            "7a404f64ad01274d",
            "1caf9f4b81091c0d",
            "f04944e0439ccc47",
            "7e77562f0cc30659",
            "9cabc5e7732aff01",
            "37ea04af9df3d34f"
        ],
        "x": 1189,
        "y": 744
    },
    {
        "id": "6468e314d57e838e",
        "type": "group",
        "z": "b9377575097a37a3",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "df9088f254e94c5e",
            "19899f2d110fd419",
            "716d4b0a2eeac322",
            "f9ab78df7bf3b33e",
            "d0d35188ca977ce0"
        ],
        "x": 88,
        "y": 1279
    },
    {
        "id": "3d77674313c033de",
        "type": "group",
        "z": "b9377575097a37a3",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "c46b98a862a1ab60",
            "c7e08d3cbb0142be",
            "41df5591bfa012dd",
            "c82c903f9464cdcc",
            "ffe8c4b38dc5356f",
            "cbee46675b660f6a",
            "bf7e73d0cd5dbe88",
            "49087488e8ed7662"
        ],
        "x": 99,
        "y": 739
    },
    {
        "id": "22fa3a13397fe4f2",
        "type": "group",
        "z": "b9377575097a37a3",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "bd6109d96baea39b",
            "c995137d4d361008",
            "9111dea45f892157",
            "45d520a6fb72eee7",
            "33c2c24b51f576c7",
            "2b00129f3f91c856",
            "a83660b5da3a1451",
            "68103b2c84b029a5",
            "ef2a49517ea8e8ce",
            "fa52f4b698761fb6",
            "21e833d404c37992",
            "47a51a5c770177f1",
            "f8197dfe83065776",
            "d0e35598fdc88529",
            "22bd8688afb73c9f",
            "17746ac1098a88b0",
            "f428ef7f0a8a8a80",
            "e085918b8aa8e446",
            "c5ed6815fba11d03",
            "870da2506eac28bc",
            "24b155b8ecaf80fd"
        ],
        "x": 279,
        "y": 319
    },
    {
        "id": "7a4a549b398c4c30",
        "type": "group",
        "z": "687893cfe8ebd28b",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "d2907618278aa1be",
            "109d34b4b47bf77a",
            "b7a798bcb386fd7b",
            "7120c3da33d92ab6",
            "44e7dfbb15aa708f",
            "8d6a9abd8282b7df",
            "4f448098a8371714",
            "c05cbc581f087383",
            "d07dfb333aed56ce",
            "d2cc8a993cf033bf",
            "05085880d56d9d9b"
        ],
        "x": 494,
        "y": 63
    },
    {
        "id": "2bbbe4dc6cfeb097",
        "type": "group",
        "z": "687893cfe8ebd28b",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "4e88477a10e3c17e",
            "50feeadd8d078ab3",
            "1eb170112f76f377",
            "445fed90cc9ae04b",
            "aa40c2fd63e42b3c"
        ],
        "x": 34,
        "y": 49
    },
    {
        "id": "015cd5895c17da64",
        "type": "group",
        "z": "687893cfe8ebd28b",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "c2be07fdd0c16931",
            "9a225e0d13c1f834",
            "a5b60ba381f9b108",
            "15852055c342f46e",
            "56e0b0f75ee7ed61",
            "71950aee80a23402",
            "a9a1170dafd3f770",
            "9099955c40e2fc51",
            "e4476e1da8adfa98",
            "b2df6d219fc4e5d5",
            "40c718410b4aa9ae",
            "263134e42e86e47b",
            "c6691944eaed7410"
        ],
        "x": 34,
        "y": 529
    },
    {
        "id": "3c0c9289bca3df95",
        "type": "group",
        "z": "c1d4418a6f1f1693",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "6b7b42e7a9a2ca07",
            "2f740e6f90340d55",
            "ba9eb7bdda03ba32"
        ],
        "x": 79,
        "y": 64
    },
    {
        "id": "48f133c168356962",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "89652258fd3f8763",
            "994d31722a926cc7",
            "ba0eab6a3ebe51cb",
            "0e67b07cc99383b3",
            "641132022a6be334",
            "24b71bc281409a22",
            "da3e31cb0af2a871",
            "ca63d0b06d78808e",
            "dd8a56d146a3a7c8",
            "a041ea7c845b2791",
            "158e57843e4b74a5",
            "db0b9650aad24229"
        ],
        "x": 79,
        "y": 574,
        "w": 1027,
        "h": 292
    },
    {
        "id": "3f7bd448f06d6712",
        "type": "group",
        "z": "f325c0384ffbb0ed",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "15d1712c48b60144",
            "ae29b121eba5b701",
            "ac81c47e04b26af5",
            "252a1e640d0f1c0b",
            "4cdb3c3bf46563d8",
            "3a219ed0af97dddf",
            "f17b02b8bcb19efd",
            "c28bf5814e72a1da",
            "9ee36af3597985b4",
            "dfe4876ea0615980",
            "cca09e5584ef886c",
            "41547953e1174a36",
            "7d815369a4f9dec4",
            "c8ee96d3de3d3f40",
            "71b7faf956909c17",
            "649bb151d51e764d",
            "13ab8d445c1e80e2",
            "55e7b1fcf215488e",
            "95b41296cee79ea1",
            "cc320cbf4edf1426",
            "edd6249a2176f48f",
            "63c531914f3e675f"
        ],
        "x": 169,
        "y": 2229,
        "w": 772,
        "h": 613
    },
    {
        "id": "67911c84f8ca5874",
        "type": "group",
        "z": "76b05f87a5290cf6",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "ae4ad803.98aa88",
            "47aeb5cb.97f31c",
            "43f62f54.e076c",
            "a330534f.2e678",
            "122cefe6.c39a7",
            "4c2899fb.1cd318",
            "a22357f8.abfa88",
            "7ec2ab22.136164",
            "9d09f684.33be68",
            "6dc4ac8d.557764",
            "243438af.12e268",
            "75c87fd8.f149a",
            "27c93453.13df8c",
            "8c23b9bc.b992b8",
            "1da30b125f7694b3"
        ],
        "x": 99,
        "y": 2119
    },
    {
        "id": "478c85d69cf2eb8c",
        "type": "group",
        "z": "76b05f87a5290cf6",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "31fdeb42eef422ce",
            "bf1620a75f8ef903",
            "02c02a2e46d2ce33",
            "1f9aecc2debca193",
            "110b6c5412ed8d34",
            "40e50c217d6a10b3",
            "3cd18ab46873b7ab",
            "5e3e280c0613ac32"
        ],
        "x": 79,
        "y": 109
    },
    {
        "id": "abf36b9570f058cc",
        "type": "group",
        "z": "76b05f87a5290cf6",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "42b44a1c5d242838",
            "4997d19a44b639d3",
            "d1418df470ae9fa4",
            "5b4db35eee901db4",
            "d5841a439d384844",
            "eb0d22efa4a344c0"
        ],
        "x": 79,
        "y": 874
    },
    {
        "id": "bdb77fbf338dd270",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "d66367b49a88fb46",
            "592ab95d2bbeaf0b",
            "a6da843d5aa39ebd",
            "a01834730a28a300",
            "888789f46e6b2b20",
            "dcb046f1fdd6f091",
            "a2fc9d155cc2e412",
            "6f8c1f95e51d8102",
            "39bf5adb6f116565",
            "fb50ab3261295b54",
            "371dd92c3642e0ba",
            "efc7f5e59321c025",
            "230aaa874077cfdc",
            "0346beccf473c1e3",
            "7bfe34e4ff0695f7",
            "6d5dd2c43db0ac78",
            "33659be59b6e8244",
            "f752c42fe1293f98",
            "481bde1a0ce6c86d"
        ],
        "x": 74,
        "y": 64,
        "w": 702,
        "h": 397
    },
    {
        "id": "55a9133a1c5a95d1",
        "type": "group",
        "z": "4c238ae3c4c60cc5",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "bd208da1fabb3bcf",
            "64bc50015a2673c3",
            "b6da99b42391a973",
            "d610c787b889e968",
            "b5b49efa8368a832"
        ],
        "x": 104,
        "y": 64
    },
    {
        "id": "ae9407dc27fc42e6",
        "type": "group",
        "z": "4c238ae3c4c60cc5",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "159695dad087f948",
            "e9ae13ce1d12693b",
            "c2697928034ac49b",
            "d6097ab674846cb2",
            "9abae7b56bbf3c14",
            "c5a7c59c71f4ce52",
            "4b5d16595763d803",
            "e499962fb97d984c",
            "574b8aca29d477bf",
            "3c116b7c2cb7cb16",
            "003ef9d46ea05d16",
            "fe9dc02efe4d771c",
            "084c89cc35050dec",
            "0658a3831dc5d007",
            "4e7faa3f31e7391f",
            "d0677c4a55777811",
            "b99d3df5ef07d131",
            "b42e082536c528eb",
            "3562e00f4ed04fb9",
            "51320eb4ac48f6d8",
            "360f32459e430863"
        ],
        "x": 74,
        "y": 304
    },
    {
        "id": "9bc629dadf51c057",
        "type": "group",
        "z": "c1d4418a6f1f1693",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "2e62157a23a3dba7",
            "8d3151282c3b5a98",
            "bf07cc975fc88621",
            "63fbdeb3eb8f7b82",
            "e5edd225e7282d10",
            "00d75f9902683848",
            "ed53a521c0d2270b",
            "f0211d0fec93e958",
            "0e156e36f11dde97",
            "31ee6cad6339930a",
            "0b4cd2463cf47651",
            "4b19f38c86bf496d",
            "bd5703e182cbe354",
            "f72df8165a1fd7ff",
            "af601a2b8087c87b",
            "c88815753d244368",
            "8aa45b3643dc2319",
            "3dd90cf5059463c7",
            "bcdeab4ef71035e1",
            "862ed2bebe79f0fd",
            "4ca372ee82cf5954",
            "f7ccb9ed0ae9dfba",
            "d5b2497e77e92a57",
            "a992a86832b34964",
            "f983b4df40165306",
            "daa1b1d2d3d49cfa",
            "fe3fd3e20b792f35",
            "4768db5c30b208a2",
            "b3037e275cf5fc43",
            "0d4b9b456c6abe1a",
            "15bb6197c2b1fb58"
        ],
        "x": 64,
        "y": 724
    },
    {
        "id": "6bbed1acc7ad0f13",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "bf3dfc1317546dfe",
            "ec19ad21051125fc",
            "850adb4a2c8b2b3f"
        ],
        "x": 54,
        "y": 934,
        "w": 1678,
        "h": 678
    },
    {
        "id": "34b9888e09adea38",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "4bd7236cd1df5691",
            "6d7d2735b6b0a030",
            "93c23451c602fbeb",
            "daf05c945ad24c81",
            "66848166715e3f45",
            "480c07eb7000581f",
            "f319a8245cc52c95",
            "e0693091fbc2ade5",
            "2adc99b74387df87",
            "3345276a11da0361",
            "555a3c206a075575",
            "673352e50b72aacf",
            "32a9a6570629a3b5",
            "ab54e887033a3563",
            "c11db00ddad03312",
            "451ff0cef17fea29",
            "260dd1e40d995979",
            "d7111ce4cb4d8b16",
            "0135921482d41bc7"
        ],
        "x": 99,
        "y": 1714,
        "w": 1552,
        "h": 277
    },
    {
        "id": "6a9007c1c483ee16",
        "type": "group",
        "z": "76b05f87a5290cf6",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "779b95f2b60630ab",
            "71250fbd9b3d549c",
            "4a186aab7466a7ac",
            "943d994766b764b4",
            "95d394ea8e7e8ad3",
            "446f1af64d58d0d6",
            "74bd2959d62a29c6"
        ],
        "x": 1459,
        "y": 499
    },
    {
        "id": "6aa375e2e3177ccc",
        "type": "group",
        "z": "76b05f87a5290cf6",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "71bdf71b7ab73ed4",
            "29da4c340c1c0f16",
            "c9da44f4b5572f7d",
            "0c33f8d537e42c41",
            "6b19a1a58b2b90d0",
            "16c03e6dc270a0a8",
            "64690dd246039799",
            "3e1fc30868d42f0c",
            "d23c81a0325ee4c4",
            "cb6ba335d3d82d44",
            "5952d8e029f830cd",
            "c41737c1cb63ff35",
            "08e2ef931b839c70",
            "138d917ae417b855",
            "201682b5f3dc37e9",
            "983aa906652d8e1a",
            "f2e91f6f34f953ec",
            "67de8630acac041e",
            "75ef4d5b0e672f1e"
        ],
        "x": 59,
        "y": 364
    },
    {
        "id": "389c4cac40ddf2e2",
        "type": "group",
        "z": "76b05f87a5290cf6",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "90c9fbd734739d25",
            "32bb7ae2d8f0c7dc",
            "46843f4e8d02205b",
            "36bcc822962c6405",
            "f67411720250268f",
            "4331798865b98569",
            "28275fe1c717f466",
            "7378a8a161a1b05c",
            "71a72d1959f91e06",
            "dbc968e9c4b6798b",
            "22f3a9e34e5ab24e"
        ],
        "x": 684,
        "y": 1609
    },
    {
        "id": "f36f49dc5a6fb0d2",
        "type": "group",
        "z": "c1d4418a6f1f1693",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "373eabc42a374888",
            "7a6e45d09f2d06fd",
            "be14c153c3dbc45b",
            "0ce5e37237e0feac",
            "43bb0021e53007d6",
            "f3ab7ffd9e6e8fc2",
            "a78e59d02fd0d490",
            "182defca8c0e3554",
            "1504136a4d0bb201",
            "3320f38a9a46c264",
            "490c2ef0e4a8f524",
            "894e8b7998890f01",
            "25ad03e0aafb40bc",
            "3686ed2f16381d14",
            "433ab3e813861fba",
            "164b085390efe789",
            "383509768f174b51",
            "f17ef08625471675",
            "bdd1d0aa5c23b884",
            "5c1ba7695a881562"
        ],
        "x": 74,
        "y": 1234
    },
    {
        "id": "7ae1a45298357558",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "1ad399f53064accc",
            "e45e9fe2c6284d6e",
            "dff151503d492736"
        ],
        "x": 209,
        "y": 484,
        "w": 632,
        "h": 82
    },
    {
        "id": "ad093da59d9d5318",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "14e10dda97a99317",
            "a1c95db8ecc8bdb8",
            "302bf84244b6f8d2",
            "284c36d91133673e",
            "9aea7b3072c9948e",
            "c91f4336229ff317"
        ],
        "x": 1894,
        "y": 2044,
        "w": 802,
        "h": 112
    },
    {
        "id": "8524118b94fccc6e",
        "type": "group",
        "z": "520bb4ac551bd04e",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "fe5e0d82ffdf8e58",
            "5b77be932011ed23",
            "71d5f34651b7c5eb",
            "5721a9c783e591cb",
            "645df9d428b62902",
            "7a80dc2a3270a4cf",
            "5aaa2dbcd2f24179",
            "45ca194a4ccc5aad",
            "8f9d1ffce061a6c7",
            "8467d9fc419beace",
            "4b559763e70b7ce3",
            "6cf3234f0cbe8f74",
            "6325de802baa5590",
            "0199eec1de4ea718",
            "1f3055ef91b8a652"
        ],
        "x": 154,
        "y": 214,
        "w": 1057,
        "h": 262
    },
    {
        "id": "2548f65a8c8c4380",
        "type": "group",
        "z": "520bb4ac551bd04e",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "ecf107bcb4f16434",
            "8e8abcae2367a41c",
            "be226db0e7901b38",
            "785397b9bb7857ab",
            "940bc3f210721740",
            "13641a24d2ff950e",
            "5b597e5028501ec6",
            "5a1b811d74476de7"
        ],
        "x": 169,
        "y": 514,
        "w": 872,
        "h": 202
    },
    {
        "id": "c7aff72d1a698bfc",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "5442487d3efbd896",
            "1dd11d91909620da",
            "6b77363af9b6dc90",
            "6704700843f92d65",
            "5810fab39fed4fd8",
            "474d4da6f7366e31",
            "1aca12531673be7d",
            "562716c144a89cd7",
            "b4da2ffda24c082f",
            "74dd883b5669e797"
        ],
        "x": 1188,
        "y": 574,
        "w": 673,
        "h": 303
    },
    {
        "id": "c7616b5427bae67d",
        "type": "group",
        "z": "520bb4ac551bd04e",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "8f152f42ef80e8b4",
            "26625a61145b40b8",
            "87510c9be7e5dd07",
            "ecaa8e3dcd816b3f",
            "9ae691f66676141f",
            "cbe4ebb5a8cce38a",
            "3990e756b202cfc7",
            "64d721ee62196532",
            "e012d8f374dea000"
        ],
        "x": 1363,
        "y": 184,
        "w": 688,
        "h": 303
    },
    {
        "id": "901f019e3dcdc3eb",
        "type": "group",
        "z": "c1d4418a6f1f1693",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "92bab0627eba301d",
            "2e70c7d55b0e6c9f",
            "eceeeb3fae3bc7ac",
            "9737cb6bd0dadd1f",
            "b22ed93ba030479d"
        ],
        "x": 1413,
        "y": 244
    },
    {
        "id": "5cd91f9fc303d894",
        "type": "group",
        "z": "c1d4418a6f1f1693",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "5e8714bebf300e22",
            "57f0a4be30f7d1d3",
            "4799a2c9df16f17e",
            "570ec02d134a5173",
            "273ce494f7a66fa8",
            "af118073e63d8f78",
            "7e18728de3dfd8df"
        ],
        "x": 1423,
        "y": 833
    },
    {
        "id": "dfa4c68c2cc9b002",
        "type": "group",
        "z": "c1d4418a6f1f1693",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "3f28a0a7d3f10e1e",
            "303394b2bfa17df9",
            "ecb1f7d4b95bd34f",
            "451ca07396c03dc6",
            "1a96357a55bd59e2",
            "711a9efc9122161a"
        ],
        "x": 1423,
        "y": 1343
    },
    {
        "id": "b310ba5dbaa8b7a7",
        "type": "group",
        "z": "f325c0384ffbb0ed",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b1846aee57adefcb",
            "52760ee932971069",
            "2357e7ce45030cc8"
        ],
        "x": 93,
        "y": 754,
        "w": 849,
        "h": 513
    },
    {
        "id": "764d2a7a7aa94a50",
        "type": "group",
        "z": "520bb4ac551bd04e",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "2bf8d431d6727776",
            "7ee8fe5bcbda8762",
            "de0c1e967b1fae44"
        ],
        "x": 2193,
        "y": 154,
        "w": 849,
        "h": 558
    },
    {
        "id": "5545cf74d423db46",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "c691ca4233289aa8",
            "5e5a226a865dbeb3",
            "0156636ac6d0af9f",
            "c4b799251a797bc8",
            "f06c34e4173eece5",
            "c3ab5aa407657c85",
            "e545a8723c6c28aa"
        ],
        "x": 1174,
        "y": 229,
        "w": 437,
        "h": 202
    },
    {
        "id": "549f9deeccc44498",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "df92ee35c74f4455",
            "5df722be84205e46",
            "14eeda19a6a7072a",
            "fe28fb7cb365d682",
            "0459e2a074258c5a",
            "8dfc8129d51e5740",
            "2642979013b379fa"
        ],
        "x": 67,
        "y": 2033,
        "w": 1770,
        "h": 1214
    },
    {
        "id": "4a012d8714c195b5",
        "type": "group",
        "z": "520bb4ac551bd04e",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "7c6b28299a6f4f68",
            "f3354f86e5974962",
            "2d2258b768d5a037"
        ],
        "x": 159,
        "y": 79,
        "w": 742,
        "h": 82
    },
    {
        "id": "ad0b41692806c8d7",
        "type": "group",
        "z": "520bb4ac551bd04e",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "dc253322fa781f08",
            "6b0691c7c184f39b"
        ],
        "x": 154,
        "y": 754,
        "w": 447,
        "h": 82
    },
    {
        "id": "af76f16f74c94f86",
        "type": "group",
        "z": "520bb4ac551bd04e",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "e1fbcf1696a8841f",
            "29af8acde7daaa6e",
            "8a415c23ba7ae283",
            "3502536b287b497d",
            "b0c67c61c93053a0",
            "64ab2f95b6ada28f",
            "65c3acbda3f09214"
        ],
        "x": 139,
        "y": 1624,
        "w": 942,
        "h": 187
    },
    {
        "id": "929f10db0d38dc07",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "c8354dbe8b89dacf",
            "1fcb3ff8b8483aea",
            "f710d7d95bac14ff"
        ],
        "x": 894,
        "y": 461.5,
        "w": 952,
        "h": 97
    },
    {
        "id": "14eeda19a6a7072a",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "g": "549f9deeccc44498",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "fb1f9c7dd8ad7a3e",
            "c4016914ed4edfaf",
            "eed9d3aa846e26f9",
            "03890e35a75d43ef",
            "258441120833deb5",
            "34c8f3a9767f8cad"
        ],
        "x": 819,
        "y": 2164,
        "w": 802,
        "h": 112
    },
    {
        "id": "fe28fb7cb365d682",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "g": "549f9deeccc44498",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "d4afd683f2270862",
            "afee83b9c6a3f479",
            "ba60486beccc9f83"
        ],
        "x": 839,
        "y": 2059,
        "w": 322,
        "h": 82
    },
    {
        "id": "0459e2a074258c5a",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "g": "549f9deeccc44498",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b7f354ce82204d9c",
            "f0c22b02c475661f",
            "fb95b4d0741d8db8",
            "dd20009116ca100b",
            "185fc4dc4d7ebafc",
            "4d56894252d94c10"
        ],
        "x": 124,
        "y": 2149,
        "w": 637,
        "h": 127
    },
    {
        "id": "8dfc8129d51e5740",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "g": "549f9deeccc44498",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "cb87a1179601d7b8",
            "2f1fbbf63057cd82",
            "84eb44d8938c031b",
            "cfbba0824276973c",
            "21a7e4d7b331c67e",
            "544b15cb3575e299",
            "8535fcf6403fa45e",
            "41b676d5ef990a3e",
            "06c77a7347c932b1",
            "9467330a7dcfcb9f",
            "f36ff7fcef01055e",
            "ab8ca08ba9111f30",
            "c4f475eadc34f078",
            "c9050cb334d984e8",
            "0ab9b611389e52b7",
            "079b24bde6bc7913",
            "10f77208037dab67",
            "a0da01db3cddd017",
            "dfa8cdb9bed3539c",
            "ea5a84d58454a07e",
            "6d4bfaadae660075",
            "f416b5ea2464b4c0",
            "534b0771447b37e9",
            "d700156b08ed999b",
            "2473f05cfebcb6eb",
            "6a9506e901b63554",
            "2c9f603eb53ec7c7",
            "6b16add2d6b04682",
            "d1f763dae798b9a3",
            "646a32288f144f73",
            "51a3daed646e5627",
            "d18f0a4219d2313a",
            "111059d7a7373219",
            "422c0e4e8c964482",
            "c3df1f96c4ccd8d6",
            "e53706c8bd9aadf5",
            "b12c9185cc37664b",
            "1b879dfc02869b3a",
            "5a06c1baf2210989",
            "4a15af8df8c577ea",
            "9a51ee5d15da287d",
            "c091b1c1e75df617",
            "223dfe7f51e5c702",
            "4bf699bb76b64d11",
            "51ccbb885d329fc3",
            "7f3892b70e89d932",
            "9002b5da933a2cf0",
            "e07363a0c58b13e0",
            "a984ae5f89c982aa",
            "be30f8352908de40",
            "9b8b41e6232af923",
            "6c7b45a7a15ce7ca",
            "19df9e22435f0986",
            "647f4fe681027b71",
            "7e254c27479ac8aa",
            "eba758ecf77571c1",
            "d7a2c75afa019028",
            "9250c631a78ab33a",
            "ba11515a04cebd32",
            "6f13a43d49cbb006",
            "590b85c6d709bc3a",
            "76bd5f8638bf1573",
            "0e0aa465724c5b30",
            "bd11511613590ced",
            "7e325d321fc3cadb",
            "47b607147dd37f73",
            "de15a8e34e10e6de",
            "e61d6852cebd5731",
            "2c3cc994eb8f94aa",
            "84f861f523724022",
            "cc301d51052bf1ea",
            "71050fa128ba0470",
            "0c672d18a9ee0d9d",
            "b936e4a9ee71f492",
            "3d4f9e766470653e",
            "23db80ed422b9759",
            "24c8d29178389a35",
            "69720d01f23fd641",
            "8a1acf9dd291745a",
            "fbec45079c82c4f6",
            "f4db294021a89fbf",
            "c41f4b62a37e0c5a",
            "1531adcffdaf7a6b",
            "f838580e2844b4dd",
            "a7135869c6f11da0",
            "b8a75ac233598814",
            "a740b5ba0ed51bd3"
        ],
        "x": 93,
        "y": 2314,
        "w": 1718,
        "h": 907
    },
    {
        "id": "74dd883b5669e797",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "g": "c7aff72d1a698bfc",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "4018f9117b219836",
            "175cc861d4fdc430",
            "3b7aeec4f66ea82e",
            "e0acafe1e64fb69d",
            "7f3f720f5ffa9ec8"
        ],
        "x": 1214,
        "y": 679,
        "w": 247,
        "h": 172
    },
    {
        "id": "2642979013b379fa",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "g": "549f9deeccc44498",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "d8cf100b99ed701b",
            "cf1dc930817e9a5d",
            "6ab3f61c2bde1e09"
        ],
        "x": 119,
        "y": 3064,
        "w": 432,
        "h": 82
    },
    {
        "id": "5c1ba7695a881562",
        "type": "group",
        "z": "c1d4418a6f1f1693",
        "g": "f36f49dc5a6fb0d2",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "425ba106b1db7004",
            "8aba5c7204608b4a"
        ],
        "x": 1114,
        "y": 1474
    },
    {
        "id": "d1418df470ae9fa4",
        "type": "group",
        "z": "76b05f87a5290cf6",
        "g": "abf36b9570f058cc",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "7103451c8f1ce3d3",
            "d6a1db03463f5561",
            "8c87150121a07852",
            "9eae3823833d4d69",
            "3f92af885fe4a9d4",
            "fa5fe09d4f7a35d0",
            "d0045f77b9afb1af",
            "84ae7b1a0d4f5b64",
            "fd99e9a78ed45308",
            "c7a39dea36551f43"
        ],
        "x": 109,
        "y": 979
    },
    {
        "id": "e02b6f382a6c8813",
        "type": "group",
        "z": "f325c0384ffbb0ed",
        "g": "042f83e60bf4b2b4",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "6e11ca5816678aff",
            "eaa055ba0bfe8209",
            "92f9ab29a8b8f215",
            "f7aa3a5ee94581d8",
            "465a56cb5ae37a7b",
            "4b32101b94305fad",
            "eca3f783e09f6088",
            "7eec56878e74f81d",
            "0fed6df359c670f3",
            "8a7581d12692fcfa",
            "6abeeffb9f17c15c",
            "1464ee495f119867",
            "79cb428099fa1515",
            "fd596e236db59b07"
        ],
        "x": 94,
        "y": 409,
        "w": 1072,
        "h": 232
    },
    {
        "id": "d4e564eac59f8117",
        "type": "group",
        "z": "f325c0384ffbb0ed",
        "g": "042f83e60bf4b2b4",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b757185d480921ba",
            "66fc5d7cfed02395",
            "a7c280bcddb31c7e",
            "e0e7d487cb6155da",
            "40aa2bf78c7edcb3",
            "5f6c10280d9d54a1",
            "131215b1356c2711",
            "0a569519a6946703",
            "e0da6226ebca68e1",
            "3d6b849bfb2b2f51",
            "2835c333a07183bd",
            "fd379269ea194a8c",
            "decb29c9608e58af",
            "d654a92c108d7cf7",
            "3812bcc095cbdfe5",
            "6bd020121fe4161b"
        ],
        "x": 94,
        "y": 169,
        "w": 1057,
        "h": 202
    },
    {
        "id": "7e5e3a6761c37063",
        "type": "group",
        "z": "f325c0384ffbb0ed",
        "g": "ffe7d6539591cabf",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b116d599b6b0916d",
            "f1ac1cecd9de5f7a",
            "4c4668d1d8f3b4a4"
        ],
        "x": 584,
        "y": 1939,
        "w": 298,
        "h": 82
    },
    {
        "id": "140b055fd622ecf2",
        "type": "group",
        "z": "f325c0384ffbb0ed",
        "g": "ffe7d6539591cabf",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "c5220d97a1ee9a7d",
            "7905b0dc5437c385",
            "1df35f685bbae5dc"
        ],
        "x": 1074,
        "y": 1864,
        "w": 292,
        "h": 82
    },
    {
        "id": "df9088f254e94c5e",
        "type": "group",
        "z": "b9377575097a37a3",
        "g": "6468e314d57e838e",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "72b60ffb9a9036c8",
            "b90197333a8243e5",
            "720243a5e49de53d",
            "e521c584e11bfcc4",
            "8c79e600376c46de",
            "4d725a406e8b7475",
            "647159f3ed671018"
        ],
        "x": 134,
        "y": 1774
    },
    {
        "id": "19899f2d110fd419",
        "type": "group",
        "z": "b9377575097a37a3",
        "g": "6468e314d57e838e",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "f0334309524bc22b",
            "9347d860a9df1cea",
            "6dd800ca3a398c60",
            "85bbcfb635da5688",
            "a39c33d989cf670b",
            "2bb00c70116db4b3",
            "f2784c01e5c99dc6",
            "fbeadcead2a7ca1c",
            "3c4bfe32b15bc405",
            "cdaf25d739c9fe5d",
            "81fd06535c53fa28",
            "e31ca3afb2ea7f0b",
            "b2bee83e7260211a",
            "80e89aead4ab3d75",
            "5b485b54db9fe1f2",
            "23871617ee198621"
        ],
        "x": 114,
        "y": 2339
    },
    {
        "id": "716d4b0a2eeac322",
        "type": "group",
        "z": "b9377575097a37a3",
        "g": "6468e314d57e838e",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "35d354408fae7539",
            "6a62873b4e46bbd8",
            "9f86718937d29bba",
            "89acac1fd8a887f1",
            "12771038e847a88a",
            "e33aa7e7cbd97b4e",
            "b1ce79e818307751",
            "1c7d69ab9f66b8ca",
            "178cc6bf43de6aad",
            "d331c13fa0d9ea1e",
            "c1a586c2ed4a2cee",
            "2c5766100f1b6b0b",
            "17feef43ab700877"
        ],
        "x": 124,
        "y": 1969
    },
    {
        "id": "f9ab78df7bf3b33e",
        "type": "group",
        "z": "b9377575097a37a3",
        "g": "6468e314d57e838e",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "3f570b4b27989310",
            "85fe0215925f055b",
            "5571157ca53f72d7",
            "2f9978300a1d1790",
            "c574f48718a26b27",
            "d884204c818a7421",
            "b1d2f477e488dda8",
            "0da23baee9865b59",
            "412e396b6f49d506",
            "e9f7760b211c033c",
            "b45436d6c32aec5b",
            "ec925f9cc97d2a35",
            "7275e36794ea0351",
            "14e38cde273d26cc",
            "8e8d43ea58023819",
            "b09126e2defac7b3",
            "08d4c169c375e425",
            "a50d774300049060",
            "bc3b85c3a5989a53",
            "8036e0640623c816",
            "c472dcc87f5170c8",
            "2180a1fb7230451e"
        ],
        "x": 129,
        "y": 1354
    },
    {
        "id": "c05cbc581f087383",
        "type": "group",
        "z": "687893cfe8ebd28b",
        "g": "7a4a549b398c4c30",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "de4853ea3edf7e99",
            "aa835b5d1cc02d9b",
            "1e4b67881e90dc1c",
            "fed8c45c180c3512",
            "60ad0ab445a162eb",
            "d577904798f15058"
        ],
        "x": 524,
        "y": 364
    },
    {
        "id": "d07dfb333aed56ce",
        "type": "group",
        "z": "687893cfe8ebd28b",
        "g": "7a4a549b398c4c30",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "ea8b50b73c73f985",
            "afac37083de7623f",
            "43fdf2a5a134b272",
            "dbe405c3c9e4b6f5",
            "4e11b2f45a32813c"
        ],
        "x": 884,
        "y": 89
    },
    {
        "id": "c6691944eaed7410",
        "type": "group",
        "z": "687893cfe8ebd28b",
        "g": "015cd5895c17da64",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "74f782b5c9918cb1",
            "778d922066b06dc9",
            "1324ee68fb02e80c",
            "64cf467ff1198d60",
            "a30b7f56e3861d49",
            "76167b51b59bab4d",
            "aaacd9c0df2207bc",
            "e60338ef13bfc039"
        ],
        "x": 254,
        "y": 729
    },
    {
        "id": "da3e31cb0af2a871",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "g": "48f133c168356962",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "173a4792e388dff6",
            "cbdd81ecdc3c11d6",
            "7a23d2c9ebd1ccb8",
            "c1f38be4152e1b73"
        ],
        "x": 119,
        "y": 649,
        "w": 247,
        "h": 142
    },
    {
        "id": "63c531914f3e675f",
        "type": "group",
        "z": "f325c0384ffbb0ed",
        "g": "3f7bd448f06d6712",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "2a2dbc09b59f3bd3",
            "521ac89e09289988",
            "d7dfa5623ecde158",
            "ad88853ecde7c005"
        ],
        "x": 214,
        "y": 2689,
        "w": 417,
        "h": 127
    },
    {
        "id": "5b4db35eee901db4",
        "type": "group",
        "z": "76b05f87a5290cf6",
        "g": "abf36b9570f058cc",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "744fac38edb40465",
            "7d42b16fe52425fd"
        ],
        "x": 318,
        "y": 1174
    },
    {
        "id": "b99d3df5ef07d131",
        "type": "group",
        "z": "4c238ae3c4c60cc5",
        "g": "ae9407dc27fc42e6",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "15c00fddf6febcfb",
            "254ee6a725ad9a5f",
            "b960a6e10feb99a7",
            "4bc01b77c9d3bacb",
            "cec5e4982ce4afa1",
            "409cf881f68b9752",
            "ad42f06dcb4eb1eb",
            "40a177edf60c7589",
            "cac1485e416830bb",
            "7ffa0b30b6b91318",
            "e097328f3afd162a",
            "be6cdfc7a6f5fa2c"
        ],
        "x": 139,
        "y": 709
    },
    {
        "id": "b42e082536c528eb",
        "type": "group",
        "z": "4c238ae3c4c60cc5",
        "g": "ae9407dc27fc42e6",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "cc89ce1d1a0c4b1d",
            "a74a33a3ec7c7366",
            "58a55157342e41e1",
            "99496b3705baccc9",
            "bb6a645aae24c4e7",
            "3521621c801627ab",
            "27a6d7dd43730e07",
            "ea8a17ead36a0d69"
        ],
        "x": 639,
        "y": 484
    },
    {
        "id": "3562e00f4ed04fb9",
        "type": "group",
        "z": "4c238ae3c4c60cc5",
        "g": "ae9407dc27fc42e6",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "ed66d4d907d05f90",
            "89dbbf6b0d6980b0",
            "804a3b4edd45745d",
            "9521d980da995953",
            "a62e3a70e91d913b"
        ],
        "x": 849,
        "y": 334
    },
    {
        "id": "51320eb4ac48f6d8",
        "type": "group",
        "z": "4c238ae3c4c60cc5",
        "g": "ae9407dc27fc42e6",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "6cadbc88a52f084e",
            "7ca2acff2636e9cb",
            "3f3da9a9e6dfd77d",
            "e0a688609374d846",
            "1e1402bb46babf61"
        ],
        "x": 1219,
        "y": 364
    },
    {
        "id": "ec19ad21051125fc",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "g": "6bbed1acc7ad0f13",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "1255172cf854afec",
            "c4073df7edfaef3f",
            "5bff6168e9472a61",
            "e3d7e8461568f1ea",
            "9b15c0fff22138f8",
            "7571ab79f4e90947",
            "87adc43de870c9df",
            "f5cfa0e2f908948c",
            "59550c61bf94ee85",
            "309b3f04cd19fbeb"
        ],
        "x": 88,
        "y": 1309,
        "w": 1618,
        "h": 277
    },
    {
        "id": "850adb4a2c8b2b3f",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "g": "6bbed1acc7ad0f13",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "5c0e00a893bdf288",
            "83f45ea66444d520",
            "46d363153b6d8510",
            "4ded8b12586d3b31",
            "a6c649bfeb643683",
            "151bd4bef68fb344",
            "24e2c705e5d0bfae",
            "bb2cd2bb28981c9f",
            "1fa3691ff9f12038",
            "dc8955434a4b3150",
            "e9116e554f7d574d",
            "0739446a5011eb4d",
            "7cd6e0abf52051ff",
            "c50916d0843fee5f",
            "ecc8fa86b61f20b9",
            "9feae499c20cf1f4",
            "0bc5c4867bcc4cfc",
            "fd541a45a97d5863",
            "e7383c98105037f7",
            "d729db698e92eca4"
        ],
        "x": 88,
        "y": 1009,
        "w": 1613,
        "h": 277
    },
    {
        "id": "9737cb6bd0dadd1f",
        "type": "group",
        "z": "c1d4418a6f1f1693",
        "g": "901f019e3dcdc3eb",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "1b2801bdd5521603",
            "a94d27d4fc33b1c2",
            "d1ff55d5deb88f00",
            "c26fead50e79fbbb",
            "e26b945327fe0a7e"
        ],
        "x": 1439,
        "y": 274
    },
    {
        "id": "64d721ee62196532",
        "type": "group",
        "z": "520bb4ac551bd04e",
        "g": "c7616b5427bae67d",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b929fa404b98a047",
            "5c6623b95c8dc130",
            "662ca3515b0917ae",
            "be385d1a42c1bcc6",
            "b1b26324a134cc2d"
        ],
        "x": 1389,
        "y": 289,
        "w": 247,
        "h": 172
    },
    {
        "id": "b22ed93ba030479d",
        "type": "group",
        "z": "c1d4418a6f1f1693",
        "g": "901f019e3dcdc3eb",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "a92d24b78c5d4a6a",
            "e2ea6a04f86a1d13",
            "1db2445822e94e9a",
            "81e052072ae8f43d",
            "a40512ebc39f24e5",
            "307370bd3db41497"
        ],
        "x": 1448,
        "y": 473
    },
    {
        "id": "7e18728de3dfd8df",
        "type": "group",
        "z": "c1d4418a6f1f1693",
        "g": "5cd91f9fc303d894",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "9589b17bdcd9c9f5",
            "6b3f31881f3a8527",
            "16abbba19c82f5ca",
            "c607bf35e3292560"
        ],
        "x": 1449,
        "y": 859
    },
    {
        "id": "711a9efc9122161a",
        "type": "group",
        "z": "c1d4418a6f1f1693",
        "g": "dfa4c68c2cc9b002",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "9dfcda59798ee7a7",
            "7848c11f6274eeee",
            "c1ae3edd9cafb13b",
            "c4aefeb3271ffd19"
        ],
        "x": 1449,
        "y": 1369
    },
    {
        "id": "b1846aee57adefcb",
        "type": "group",
        "z": "f325c0384ffbb0ed",
        "g": "b310ba5dbaa8b7a7",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b72cdc2106ab24c8",
            "1774f12bc0e04bf2",
            "9401e5aa92399513",
            "cf7306491d278f10",
            "e4069ee38fc45f35",
            "6df483292baa967e",
            "02587a76b180f455",
            "bebcfbb59d1aeebd",
            "cfef045ea8c2bef2",
            "2763037f1d2d0e8e"
        ],
        "x": 119,
        "y": 814,
        "w": 797,
        "h": 187
    },
    {
        "id": "52760ee932971069",
        "type": "group",
        "z": "f325c0384ffbb0ed",
        "g": "b310ba5dbaa8b7a7",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "c0335db4c10270a1",
            "f0ba4a0f67585376",
            "d9297083114d9385",
            "ab8c5b4600986d16",
            "821b38a12b26c86f",
            "0c2f549ad9fd6eab",
            "ba5a4764161809b3",
            "3b3ba4a887224a24",
            "59b869627df47d52",
            "cb6a26d3fa6e6d43"
        ],
        "x": 124,
        "y": 1024,
        "w": 752,
        "h": 217
    },
    {
        "id": "2bf8d431d6727776",
        "type": "group",
        "z": "520bb4ac551bd04e",
        "g": "764d2a7a7aa94a50",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "0df67feb574967df",
            "96f487a9ab18cd70",
            "2006eef56d24502d",
            "627eefb16b1624c6",
            "2488dfa47387ae95",
            "fc9805174409a339",
            "805909fc9060a1ab",
            "98b496bcef4f63f1",
            "49dde63fc06e1a4b",
            "64deca04685863c4"
        ],
        "x": 2219,
        "y": 214,
        "w": 797,
        "h": 187
    },
    {
        "id": "7ee8fe5bcbda8762",
        "type": "group",
        "z": "520bb4ac551bd04e",
        "g": "764d2a7a7aa94a50",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "3f10cbfdf20a1794",
            "e0358db3d825c603",
            "11460a48fab974a6",
            "2d7c01583d6fa255",
            "f255e9588901cefe",
            "db625e06350958ff",
            "9471b762753d187e",
            "c46761a1734e3b5f",
            "c938d4304b7bd5b8",
            "ba615c1170139b4e",
            "d8f19dc79fd1dc53",
            "1e44c0a3a8a381bb"
        ],
        "x": 2224,
        "y": 424,
        "w": 752,
        "h": 262
    },
    {
        "id": "a740b5ba0ed51bd3",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b40b58043c479a0a",
            "36f1d48b74bad8dc"
        ],
        "x": 119,
        "y": 2959,
        "w": 427,
        "h": 82
    },
    {
        "id": "0739446a5011eb4d",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "g": "850adb4a2c8b2b3f",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "3d27e37c3ed9e7f4",
            "5815cad38a040cc3",
            "86716780529bf336",
            "d1e3a540b0a3ee0d",
            "3a53827df7fd9d3e"
        ],
        "x": 114,
        "y": 1084,
        "w": 282,
        "h": 172
    },
    {
        "id": "7cd6e0abf52051ff",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "g": "850adb4a2c8b2b3f",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "10958d37e53c1234",
            "68644d6d8e8ebaf8"
        ],
        "x": 669,
        "y": 1114,
        "w": 372,
        "h": 112
    },
    {
        "id": "9eae3823833d4d69",
        "type": "group",
        "z": "76b05f87a5290cf6",
        "g": "d1418df470ae9fa4",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "5d4e2536bd217ebb",
            "8592536a56dff0ec"
        ],
        "x": 484,
        "y": 1039
    },
    {
        "id": "7d42b16fe52425fd",
        "type": "group",
        "z": "76b05f87a5290cf6",
        "g": "5b4db35eee901db4",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "8a8226dfe4a11ffa",
            "ff3fd54c134b19bf",
            "f67d481098362b2f",
            "936181bc744d6f4f",
            "7b854e8aa4029bbe",
            "533fe7d0158198e3"
        ],
        "x": 344,
        "y": 1249
    },
    {
        "id": "c4073df7edfaef3f",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "g": "ec19ad21051125fc",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "cabac255e0eba1ed",
            "918e9e4d95437fe6",
            "eef65e8f494a1fdd",
            "0bd89aed5e41568c",
            "93d9ed47f60be558"
        ],
        "x": 114,
        "y": 1384,
        "w": 282,
        "h": 172
    },
    {
        "id": "5bff6168e9472a61",
        "type": "group",
        "z": "bdc10eb0bfc2c224",
        "g": "ec19ad21051125fc",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "d88e1b5db6941c84",
            "32847fc57a5ed7c0"
        ],
        "x": 669,
        "y": 1414,
        "w": 392,
        "h": 112
    },
    {
        "id": "a92d24b78c5d4a6a",
        "type": "group",
        "z": "c1d4418a6f1f1693",
        "g": "b22ed93ba030479d",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "adecb2a0d654f57c",
            "e103bac2f33b4750",
            "8a75fb67abc47146",
            "ff4d8fe7b4d510fc"
        ],
        "x": 1474,
        "y": 499
    },
    {
        "id": "6eb58abc9359afb4",
        "type": "group",
        "z": "14adf9cd8d883348",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "1a14f59430b6423f",
            "d6ee8d661e15b8b0",
            "e966eb84efa69b90",
            "aabf6291a4464fe1",
            "9217c8ece8c8d37f"
        ],
        "x": 59,
        "y": 64,
        "w": 1017,
        "h": 134.5
    },
    {
        "id": "35aa637688559ad2",
        "type": "group",
        "z": "14adf9cd8d883348",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "91867d3820fefb81",
            "f43d077dd828410a",
            "4b2c4976236c2e80",
            "85984f62b53a753e",
            "61643a1c4c517885",
            "a6d4cf300708d97e",
            "41052036e4260285",
            "a7babccaa58fb5cf",
            "5784a0cac60a9c02",
            "2dcd2df82068fcce",
            "0e17b1f0443d5737",
            "ed79aaef36d18df1",
            "6e97b2f0a581d55b",
            "0c5f5aeabcfbd0d1",
            "2a6a1d0cbfeb5f83",
            "043971672406f236",
            "7911378bf44fca6b",
            "93abcb4edbd0a1ac"
        ],
        "x": 64,
        "y": 424,
        "w": 1422,
        "h": 352
    },
    {
        "id": "bfb4b00f09dfccfd",
        "type": "group",
        "z": "14adf9cd8d883348",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "fd4f3ebd7f37cd17",
            "158bed02f04013ce",
            "070daa6a6ef78f3d",
            "1e42ac697672b6b4",
            "bcd7df405295570f",
            "dc2fd44ea538fda7",
            "fce2ffd7d2b35d6e",
            "cb49098a37b92f18",
            "e14bd5a48fcb543b",
            "a656f280adc14246",
            "493cfc79a184c67c",
            "ee4f4e0ee6527625"
        ],
        "x": 59,
        "y": 904,
        "w": 827,
        "h": 232
    },
    {
        "id": "0d23a37596efc707",
        "type": "group",
        "z": "14adf9cd8d883348",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "497ec0fb4b7392b8",
            "1efc46b49a6a59e7",
            "ea04186b2067f593",
            "ca300241ca443067",
            "67b02575612b3226",
            "08a61faf703ec6cf",
            "935b5fa38d92f20d",
            "ed1c3d5de195c0e1",
            "b9469859fc2ce5d8",
            "87d179b8dd6b59f4",
            "b949c18f7f5d8c39",
            "5e14728c6936fe53",
            "1bbe4a9a6badfd24",
            "d8a6e6c6bc116cfc",
            "1f7757569a33e748",
            "029f2d3620fbb110",
            "5730340fa9556086",
            "d6ab8a21caf8dd3b",
            "3f93fc19eb97a392",
            "99d74bbcf54ceafd",
            "5b6d9c4bb7c7210e",
            "203b1837125c2217",
            "d1753d386dc75712"
        ],
        "x": 1124,
        "y": 64,
        "w": 1377,
        "h": 329.5
    },
    {
        "id": "700856f51ec39824",
        "type": "group",
        "z": "14adf9cd8d883348",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "e637604a3c43424e",
            "2545eae96edd254a",
            "587068d6a5159aed",
            "69dc5f6d92a33152",
            "b2c5db789d45f171",
            "122b2c1cb1ecdcf0"
        ],
        "x": 64,
        "y": 229,
        "w": 652,
        "h": 172
    },
    {
        "id": "f9afb515793290aa",
        "type": "MySQLdatabase",
        "name": "",
        "host": "127.0.0.1",
        "port": "3306",
        "db": "_prod@YetToSetup",
        "tz": "",
        "charset": "UTF8"
    },
    {
        "id": "069aa519f61e8808",
        "type": "MySQLdatabase",
        "name": "",
        "host": "127.0.0.1",
        "port": "3306",
        "db": "fonderiaboccacci_recuperocalore",
        "tz": "",
        "charset": "UTF8"
    },
    {
        "id": "63a4af044d8334e0",
        "type": "modbus-client",
        "name": "PLC Torri",
        "clienttype": "tcp",
        "bufferCommands": false,
        "stateLogEnabled": false,
        "queueLogEnabled": false,
        "failureLogEnabled": true,
        "tcpHost": "192.168.19.101",
        "tcpPort": "502",
        "tcpType": "DEFAULT",
        "serialPort": "/dev/ttyUSB",
        "serialType": "RTU-BUFFERD",
        "serialBaudrate": "9600",
        "serialDatabits": "8",
        "serialStopbits": "1",
        "serialParity": "none",
        "serialConnectionDelay": "100",
        "serialAsciiResponseStartDelimiter": "0x3A",
        "unit_id": "1",
        "commandDelay": "10",
        "clientTimeout": "2000",
        "reconnectOnTimeout": false,
        "reconnectTimeout": "3000",
        "parallelUnitIdsAllowed": false
    },
    {
        "id": "f9e57efbb0809783",
        "type": "modbus-client",
        "name": "Zelio Pulsantiere ZBRN1-23KF2",
        "clienttype": "tcp",
        "bufferCommands": true,
        "stateLogEnabled": false,
        "queueLogEnabled": false,
        "failureLogEnabled": true,
        "tcpHost": "192.168.19.121",
        "tcpPort": "502",
        "tcpType": "DEFAULT",
        "serialPort": "/dev/ttyUSB",
        "serialType": "RTU-BUFFERD",
        "serialBaudrate": "9600",
        "serialDatabits": "8",
        "serialStopbits": "1",
        "serialParity": "none",
        "serialConnectionDelay": "100",
        "serialAsciiResponseStartDelimiter": "0x3A",
        "unit_id": "248",
        "commandDelay": "100",
        "clientTimeout": "2000",
        "reconnectOnTimeout": true,
        "reconnectTimeout": "15000",
        "parallelUnitIdsAllowed": true
    },
    {
        "id": "be3a0c41501390ea",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#0094CE",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#0094CE",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#1bbfff",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#0094ce",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "Node-RED Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "717deab8c83fa07b",
        "type": "modbus-client",
        "name": "Zelio Pulsantiere ZBRN1-23KF1",
        "clienttype": "tcp",
        "bufferCommands": true,
        "stateLogEnabled": false,
        "queueLogEnabled": false,
        "failureLogEnabled": true,
        "tcpHost": "192.168.19.120",
        "tcpPort": "502",
        "tcpType": "DEFAULT",
        "serialPort": "/dev/ttyUSB",
        "serialType": "RTU-BUFFERD",
        "serialBaudrate": "9600",
        "serialDatabits": "8",
        "serialStopbits": "1",
        "serialParity": "none",
        "serialConnectionDelay": "100",
        "serialAsciiResponseStartDelimiter": "0x3A",
        "unit_id": "248",
        "commandDelay": "1",
        "clientTimeout": "1000",
        "reconnectOnTimeout": true,
        "reconnectTimeout": "2000",
        "parallelUnitIdsAllowed": true
    },
    {
        "id": "0e782a15597a520f",
        "type": "ui_tab",
        "name": "dbg",
        "icon": "fa-bug",
        "order": 3,
        "disabled": false,
        "hidden": true
    },
    {
        "id": "ebd54b01335cee21",
        "type": "ui_group",
        "name": "Pulsantiere 23KF1",
        "tab": "0e782a15597a520f",
        "order": 2,
        "disp": true,
        "width": "8",
        "collapse": false,
        "className": ""
    },
    {
        "id": "929f87df773632c9",
        "type": "ui_group",
        "name": "pulsantiere #2 23KF2",
        "tab": "0e782a15597a520f",
        "order": 3,
        "disp": true,
        "width": 9,
        "collapse": false,
        "className": ""
    },
    {
        "id": "ff22d246a1b65b24",
        "type": "ui_group",
        "name": "Torri ZBRCETH",
        "tab": "0e782a15597a520f",
        "order": 4,
        "disp": true,
        "width": 11,
        "collapse": true,
        "className": ""
    },
    {
        "id": "c0415c1b71c98381",
        "type": "ui_tab",
        "name": "unauth",
        "icon": "dashboard",
        "order": 2,
        "disabled": false,
        "hidden": true
    },
    {
        "id": "5f2d3184c0c690e6",
        "type": "ui_group",
        "name": "unauthPopup",
        "tab": "c0415c1b71c98381",
        "order": 1,
        "disp": false,
        "width": "6",
        "collapse": false,
        "className": "unauth-group"
    },
    {
        "id": "e3f9e887b40aa126",
        "type": "ui_spacer",
        "z": "520bb4ac551bd04e",
        "name": "spacer",
        "group": "5f2d3184c0c690e6",
        "order": 1,
        "width": 1,
        "height": 1
    },
    {
        "id": "dbb3523ff083bed9",
        "type": "ui_tab",
        "name": "Impostazioni",
        "icon": "dashboard",
        "order": 1,
        "disabled": false,
        "hidden": true
    },
    {
        "id": "a3ba2e57b1953e7d",
        "type": "ui_group",
        "name": "Template Macchina",
        "tab": "dbb3523ff083bed9",
        "order": 1,
        "disp": true,
        "width": 7,
        "collapse": true,
        "className": ""
    },
    {
        "id": "2977648413bef241",
        "type": "ui_group",
        "name": "uiAbs",
        "tab": "0e782a15597a520f",
        "order": 4,
        "disp": true,
        "width": "11",
        "collapse": true,
        "className": ""
    },
    {
        "id": "0824968cb29bbcd0",
        "type": "ui_group",
        "name": "Hidden",
        "tab": "dbb3523ff083bed9",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "da3892f6ff9a2f65",
        "type": "ui_spacer",
        "z": "520bb4ac551bd04e",
        "name": "spacer",
        "group": "a3ba2e57b1953e7d",
        "order": 8,
        "width": 2,
        "height": 1
    },
    {
        "id": "cbb179d2e72c309a",
        "type": "ui_spacer",
        "z": "520bb4ac551bd04e",
        "name": "spacer",
        "group": "a3ba2e57b1953e7d",
        "order": 11,
        "width": 1,
        "height": 1
    },
    {
        "id": "c428f53d1c4df6c2",
        "type": "ui_spacer",
        "z": "520bb4ac551bd04e",
        "name": "spacer",
        "group": "0824968cb29bbcd0",
        "order": 3,
        "width": 1,
        "height": 1
    },
    {
        "id": "c9d4bfee2ab4602e",
        "type": "ui_spacer",
        "z": "520bb4ac551bd04e",
        "name": "spacer",
        "group": "0824968cb29bbcd0",
        "order": 5,
        "width": 1,
        "height": 1
    },
    {
        "id": "882f045f55256095",
        "type": "ui_spacer",
        "z": "520bb4ac551bd04e",
        "name": "spacer",
        "group": "0824968cb29bbcd0",
        "order": 12,
        "width": 1,
        "height": 1
    },
    {
        "id": "78ad391720e76a0f",
        "type": "ui_spacer",
        "z": "520bb4ac551bd04e",
        "name": "spacer",
        "group": "0824968cb29bbcd0",
        "order": 13,
        "width": 1,
        "height": 1
    },
    {
        "id": "336df75f8739aa7e",
        "type": "ui_spacer",
        "z": "520bb4ac551bd04e",
        "name": "spacer",
        "group": "0824968cb29bbcd0",
        "order": 14,
        "width": 1,
        "height": 1
    },
    {
        "id": "d66367b49a88fb46",
        "type": "catch",
        "z": "bdc10eb0bfc2c224",
        "g": "bdb77fbf338dd270",
        "name": "catchAll",
        "scope": null,
        "uncaught": true,
        "x": 305,
        "y": 105,
        "wires": [
            [
                "a6da843d5aa39ebd"
            ]
        ]
    },
    {
        "id": "592ab95d2bbeaf0b",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "bdb77fbf338dd270",
        "name": "set global utils",
        "func": "//look into start tab",
        "outputs": 1,
        "noerr": 0,
        "initialize": "\nlet def = {\n    \"errorBlink\": function (node, last = 1500, text = \"\") {\n        node.status({ fill: \"red\", text: text });\n        setTimeout(() => {\n            node.status({ fill: \"\", text: text });\n        }, 250);\n        setTimeout(() => {\n            node.status({ fill: \"yellow\", text: text });\n        }, 350);\n        setTimeout(() => {\n            node.status({ fill: \"\", text: text });\n        }, last)\n    },\n\n    \"##litEndian2int\": function (a, b){\n        return a<<16 | b;\n    }, //msg.payload[0] << 16) | msg.payload[1]\n    \n    \"isObject\"(v) {\n        return (typeof (v) == \"object\" && !Array.isArray(v) && v !== null)\n    },\n    /**\n     * converts a binary array to a single number\n     */\n    \"bitArrayToInt\"(arr) {\n        var res = 0;\n        for (let i = 0,minLen=Math.min(arr.length, 8*8); i < minLen; i++) {\n            if (arr[i])\n                res += Math.pow(2, i);\n        }\n        return res;\n    },\n\n    /** @summary capitalize the first character of a given string\n        * @param {string} word \n        * @return {string} new processed string\n        */\n    \"firstCharUp\"(word){\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    /**\n    * @summary recursively merge two Objects\n        * @desc overlay sec onto main. keeps properties of both. undefined properties of main are directly assigned from sec.\n        * - ex: main : {a, b:b1} sec:{b:b2, c} -> res:{a , b:b2, c} where:\n        * - -res.a===main.a\n        * - -res.c===sec.c\n        * - -res.b!==sec.b2\n        * @param {Object} main \n        * @param {Object} sec \n        */\n    \"mergeRec\":function thisFun(main, sec){\n        for(let p in sec) {\n            //if(main[p]===undefined) //commented bcs implicitly included in the next if condition //(typeof(undefVar) <=> \"undefined\")\n            //if(deepCopy && typeof(main[p]) ==\"object\") //too big an hustle\n            //main[p] = sec[p];\n            if (sec[p].constructor == Object && typeof (main[p]) == \"object\")\n                thisFun(main[p], sec[p]);\n            else\n                main[p] = sec[p];\n        }\n        return main;\n    }.bind(this),\n\n    /** @summary repeatedly tries to fetch all globalNames with global.get(). \n        * @param {function} cb called once ALL globalName are defined\n        * @param {Object} opts object holding optional function params. can be omitted passing the first globalName instead.\n        * @param {number} opts.timeout ms delay after which stop trying and either call opts.errorCb() or log an error. defaults to 15000\n        * @param {number} opts.retryDelay ms between each attempt. defaults to 100\n        * @param {function} opts.errorCb function to call after timeout. defaults to falsy, logging a warning\n        * @param  {...any} globalNames series of strings\n        */\n    \"callWhenDef\":function callWhenDef(cb, opts, ...globalNames){\n        if(typeof(opts) == \"string\")\n            globalNames.push(opts);\n        let {timeout:timeout=3000, retryDelay:retryDelay=100, errorCb:errorCb=null} = (typeof(opts) == \"string\" ? opts : {});\n        var tout,intv;\n        //set timeout unless false or not specified\n        if (timeout) {\n            tout = setTimeout(() => {\n                clearInterval(intv);\n                errorCb ? errorCb() : node.warn({ err: \"callWhenDef_Timeout\", arg: arguments })\n            }, timeout);\n        }\n        //set global-chacking interval\n        intv = setInterval(() => {\n            for (let name of globalNames)\n                if (global.get(name) === undefined || global.get(name) === null)\n                    return\n            clearTimeout(tout);\n            clearInterval(intv);\n            cb();\n        }, retryDelay)\n    },\n    /** pseudo random string generator\n     */\n    \"randomHexString4\":function(){\n        return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1); //1.X * 2^16 toString(radix) clipFirst //== 4 characters hex\n    },\n    /** returns an iterator-maker that uses the keys in orderedKeys to access its parent's properties\n         * @param {string[]} orderedKeys\n         * @returns {function} f() -> iterator object.\n         */\n    \"makeKeyIterator\":function (orderedKeys) {\n        return function () {\n            //console.log(\"2# this\",this); this === parent object\n            let keys = orderedKeys, idx = 0;\n            return {\n                next:()=>{\n                    //console.log(this, idx, orderedKeys);\n                    return (idx < keys.length ? { value: this[keys[idx++]], done: false } : { done: true });\n                }\n            }\n        }\n    },\n    /** attach a general iterator going through all the enumerable obj's key.\n        * -Not very memory-performant as a redundant key[] array is stored\n        * @param {object} the object to which attach the iterator\n        * @returns {function} the attached iterator\n        */\n    \"generateIteratorFor\": function (obj) {\n        obj[Symbol.iterator] = this.makeKeyIterator(Object.keys(obj));\n        return obj[Symbol.iterator];\n    },\n    \"errorLog\"(...param){ return this.logError(...param);},\n    \"logError\": function thisFun(nodeRef, err){\n        if(arguments.length != thisFun.length) throw new SyntaxError(`expected ${thisFun.length} arguments, got ${arguments.length}`);\n        var error = (typeof (err) == \"string\" ? {err:err} : err);\n        nodeRef.error(error);\n    },\n\n    /** the first time the property is accessed the value is calculated calling valueGetter() in obj, and the result is stored in propName_cache.\n        * - Subsequent calls will return propName_cache's value.\n        */\n    \"defineCachedProp\": function defineCachedProp(obj, propName, valueGetter){\n        if (arguments.length != 3) throw new SyntaxError(\"defineCachedGetter() arguments mismatch\");\n        const propName_cache = propName + \"_cache\";\n\n        Object.defineProperty(obj, propName_cache, {value:undefined, writable:true, configurable:true}); //not enumerable\n        Object.defineProperty(obj, propName, {  \n            get() {\n                return this[propName_cache] ?? (this[propName_cache] = valueGetter.call(this,this))\n            },\n            set(v) { this[propName_cache] = v },\n            enumerable: true,\n            configurable: true\n        },)\n    },\n    \"removeIdx\": (arr, i) => (i == arr.length - 1) ? arr.pop() : arr[i] = arr.pop(),\n    \"removeAllOccurrences\": function (arr, val){\n        for(let i=0; i<arr.length; i++)\n            if(arr[i] == val)\n                (i == arr.length - 1) ? arr.pop() : arr[i] = arr.pop();\n    },\n\n    \"clone\":(obj) => {\n        return JSON.parse(this.safeStringify(obj));\n    },\n\n    \"safeStringify\": function safeStringify(obj,indent){\n        var cache = [];\n        var cacheKeys = [];\n        return JSON.stringify(obj, (key, value) => {\n            if (typeof value === 'object' && value !== null) { //arrays and null are also \"objects\" //functions are too, but typeof returns \"function\" instead\n                //Duplicate reference found -> discard key / store\n                const idx = cache.indexOf(value)\n                //if duplicate found\n                //return twin's key instead\n                if(idx != -1) //-1 means not present\n                return \"dupOf_\"+(cacheKeys[idx].toString() ?? \"root\");\n                //else store it\n                else{\n                cache.push(value);\n                cacheKeys.push(key);\n                }\n            }\n            return value;\n        }, indent);\n    }\n\n};\n\n\nglobal.set(\"utils\", def);\nnode.send(def);\nnode.status({ fill: \"green\", text: Object.keys(def).join(' & ') });\n\n\nfunction safeStringify(obj) {\n    var cache = [];\n    var cacheKeys = [];\n    return JSON.stringify(obj, (key, value) => {\n        if (typeof value === 'object' && value !== null) { //arrays and null are also \"objects\" //functions are too, but typeof returns \"function\" instead\n            //Duplicate reference found -> discard key / store\n            const idx = cache.indexOf(value)\n            //if duplicate found\n            //return twin's key instead\n            if (idx != -1) //-1 means not present\n                return \"dupOf_\" + (cacheKeys[idx].toString() ?? \"root\");\n            //else store it\n            else {\n                cache.push(value);\n                cacheKeys.push(key);\n            }\n        }\n        return value;\n    });\n}\n",
        "finalize": "",
        "libs": [],
        "x": 185,
        "y": 180,
        "wires": [
            [
                "888789f46e6b2b20",
                "6f8c1f95e51d8102"
            ]
        ]
    },
    {
        "id": "a6da843d5aa39ebd",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "bdb77fbf338dd270",
        "name": "catchAll",
        "func": "if(msg.error){\n    node.error({\"err\":msg.error.message,\"src\":msg.error.source.id,\"n\":msg.error.source.name,\"full\":msg});\n    \n}\nelse{\n    node.error(msg);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nnode.status({ fill: \"gray\", shape: \"ring\", text: \"\" });\ncontext.set(\"outCc\", 0);\ncontext.set(\"errorCc\", 0);",
        "finalize": "",
        "libs": [],
        "x": 455,
        "y": 105,
        "wires": [
            []
        ]
    },
    {
        "id": "a01834730a28a300",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "bdb77fbf338dd270",
        "name": "GLOBALI",
        "info": "",
        "x": 160,
        "y": 105,
        "wires": []
    },
    {
        "id": "888789f46e6b2b20",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "bdb77fbf338dd270",
        "name": "set global List & utils.list",
        "func": "let utils = msg;\nvar isObject = utils.isObject;\nclass List {\n    head;\n    //#lastPrev;\n    //get last(){ return (this.#lastPrev ? this.#lastPrev.next : this.head) }\n    last;\n\n    constructor() {\n        this.head = null;\n        this.last = this.head;\n    }\n\n    static isListNode(val){\n        return (isObject(val) && Object.hasOwnProperty(\"next\"))\n    }\n    static isTwoWayListNode(val){\n        return (List.isListNode(val) && Object.hasOwnProperty(\"prev\"));\n    }\n\n    peekFirst() {\n        return (this.head ? this.head.value : null);\n    }\n\n    popFirst() {\n        let res = this.peekFirst();\n        //remove\n        if (this.head && this.head.next)\n            this.head = this.head.next;\n        return res;\n    }\n\n    peekLast() {\n        return (this.last ? this.last.value : null);\n    }\n\n    popLast() {\n        if (!this.head)\n            return null;\n\n        let res = this.peekLast();\n\n        let n = this.head,\n            n2last = null; //'next-to-last' <=> 'penultimate'\n        while (n.next) {\n            n2last = n;\n            n = n.next;\n        }\n        n2last.next = null;\n        this.last = n2last;\n\n        return res;\n    }\n\n    /** creates a one-way list node with value=val */\n    static newNode(val) {\n        return { value: val, next: null }\n    }\n    /** creates a two-way list node with value=val and empty prev */\n    static newTwoWayNode(val) {\n        return { value: val, prev: null, next: null }\n    }\n    /** creates a two-way list node with value=val and empty prev */\n    static _append(el, listHead){\n        if (listHead) {\n            let node = listHead;\n            while (node.next) {\n                node = node.next;\n            }\n            node.next = (List.isListNode(el) ? el : List.newNode(el))\n            return node.next;\n        }\n        else {\n            return (List.isListNode(el) ? el : List.newNode(el));\n        }\n    }\n    append(el) { List._append(el, this.head) }\n\n    static _appendTwoWay(el, listHead) {\n        if (List.isTwoWayListNode(el))\n            List._append(el, listHead)\n        else\n            List._append(List.newTwoWayNode(el), listHead);\n    }\n\n\n    static _prepend(el, listHead){\n        let newHead  = (List.isListNode(el) ? el : List.newNode(el))\n        newHead.next = listHead;\n        return newHead;\n    }\n    prepend(el) {\n        this.head = List._prepend(el, this.head)\n    }\n\n    static _prependTwoWay(el,listHead){\n        let newHead = List._prepend(el, listHead);\n        if(listHead)\n            listHead.prev = newHead;\n        return newHead;\n    }\n\n    static iterator(listHead) {\n        return {\n            last: listHead,\n            next() {\n                if (this.last === null)\n                    return { done: true }\n                else {\n                    let ret = { value: this.last.value, done: false }\n                    this.last = this.last.next;\n                }\n            },\n            return(){} //optional, do cleanup routine (close db connection and such)\n        }\n    }\n\n    *[Symbol.iterator](){\n        return List.iterator(this.head);\n    }\n\n    toArray(){\n        var ret = [];\n        for(let val of this.head)\n            ret.push(val)\n        return ret;\n    }\n\n    toString(){\n        return this.toArray.toString();\n    }\n\n    values(){\n        return this.toArray();\n    }\n\n}\n\nconst twoWayListClass = class TwoWayList extends List {\n    //head\n    //last\n    constructor(){\n        super();\n    }\n\n    popLast(){\n        if(!this.head)\n            return null;\n        //pop\n        let ret = this.last ? this.last.value : null;\n        this.last = this.last.prev;\n        //pop() on \"lenght == 1\" => last===head===null -> skip\n        if(this.last)\n            this.last.next=null;\n        return ret;\n    }\n\n    static _prepend(...args){List._prependTwoWay.apply(null,args)};\n    prepend(el){\n       this.head = List._prependTwoWay(el);\n    }\n\n    static iterator(listHead){\n        let oneWay = List.iterator(listHead);\n        oneWay.prev = (function () {\n            if (this.last === null)\n                return { done: true }\n            else {\n                // @ts-ignore\n                let ret = { value: this.last.prev.value, done: false }\n                // @ts-ignore\n                this.last = this.last.prev;\n            }\n        }).bind(oneWay)\n        return oneWay;\n    }\n\n    inverseIterator(){\n        let it = TwoWayList.iterator(this.last);\n        [it.next, it.prev] = [it.prev, it.next];\n        return it;\n    }\n\n\n    \n}\n\n\nglobal.set(\"List\", List.prototype);\nglobal.set(\"TwoWayList\", twoWayListClass);\n\nutils.List = List; global.set(\"utils\", utils);\n\n\n/* TypeError    \nnode.status({\n    fill: \"green\",\n    text: Object.keys(\n        utils.mergeRec(\n            new List(),\n            new twoWayListClass()\n        )\n    ).join(' & ')\n});\n/**/\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 225,
        "wires": [
            []
        ]
    },
    {
        "id": "dcb046f1fdd6f091",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "bdb77fbf338dd270",
        "name": "set globals towersControl & towersBitArray",
        "func": "",
        "outputs": 1,
        "noerr": 0,
        "initialize": "/* interfaccia per la lettura ed il controllo delle colonnine \n    esempio:    towCtrl.FA423.greenLight = truthy/falsy;    //will get/set the correspondig bit in towersBitArray\n                towCtrl.FA423.hasDevice(\"greenLight\") <=> towCtrl.macHasDevice(\"FA423\",\"greenLight\")  //true if dev has a correspondig bit in posOf[]\n    \n    errori:     towCtrl.FA423.unregDev = 5 -> setter does nothing, getter evaluates to null, both log warning  //unregDev === present in dictionary.devKeys but missing in posOf[thatMacKey]\n                towCtrl.unknwMac -> Exception    \n                towCtrl.FA423.unknDev -> Exception\n\n    template finale:\n    {\n        \"dictionary\":{\n            \"macKeys\" : macKey[]    //{string[]} <=> enum\n            \"devices\" : device[]    //{string[]} <=> enum\n        },\n\n        \"posOf\":{\n            {macKey}:{  //all dictionary.macKeys are defined and objects\n                {device}:0 < number < 2^n | null //bit index //all dictionary.devices are defined\n            }\n        },\n\n        \"sharedBits\":{\n                {bit}:{ //only the shared ones are defined\n                    'devKey': <devKey> //associated device. //it presumes all machines sharing the bit use the same device\n                    'output'\n                }\n           }\n\n        \"towersBitArray\":Array(NBITS).fill(0),\n\n        \"macHasDevice\": function (macKey, devKey) { return this.posOf[macKey][devKey] !== null }\n\n        /** all dictionary.macKeys are defined. //dictionary.devices are reference to towersBitArray or non-enumerable errorLogging getters/setters * /\n        {macKey}:{  //all dictionary's macKeys are defined. \n            'hasDevice'(...): this.macHasDevice.bind(def, <macKey>, ...)    //alias with one less parameter //not enum\n            {linkedDeviceKey}: truthy|falsy,     //only posOf[<macKey>]'s devKeys are defined. //dictionary's devKeys missing in posOf[<macKey>] are instead not-enumerable warning-loggers\n            {linkedDeviceKey}: truthy|falsy,\n            ..\n        },\n        * / \n    }\n*/\ncallWhenDef( ()=>{\n    const utils = global.get(\"utils\");\n\n    /** error logging function */\n    function onUnconfigKeySet(key, macKey) {\n        node.warn({\n            err: \"[towersControl] trying to set() an unconfigured bit.\",\n            key: key,\n            macKey: macKey\n        });\n    }\n    function onUnconfigKeyGet(key, macKey) {\n        node.warn({\n            err: \"[towersControl] trying to get() an unconfigured bit.\",\n            key: key,\n            macKey: macKey\n        });\n    }\n    //also used for initial validation\n    const dictionary = {\n        /** {String[]} macKeys \"machine keys\". match the ones used in uibuilder's app. */\n        macKeys: [\"FA419\", \"FA420\", \"FA421\", \"FA422\", \"FA423\", \"MO41\", \"MO42\", \"OMET\"],\n        /**  {String[]} devices devices that may be associated with each towersBitArray bit*/\n        devices: [\"redLight\", \"greenLight\", \"horn\"],\n    };\n    /** index of various devices on towersBitArray.\n     * NOT ALL ARE NECESSARILY PRESENT! use macHasDevice() and def[macKey][device]=val instead\n     * setting ===null is the same as leaving it undefined, but will throw a warning */\n    const posOf = {\n        \"FA423\": {\n            \"redLight\": 0,\n            \"greenLight\": 1,\n            \"horn\": 2\n        },\n        \"FA420\": {\n            \"redLight\": 3,\n            \"greenLight\": 4,\n            \"horn\": 5\n        },\n        \"FA421\": {\n            \"redLight\": 6,\n            \"greenLight\": 7,\n            //set \"horn\"(val) { onUnconfigKey(\"horn\",\"FA419\") }\n            \"horn\": 5, //same as undefined\n        },\n        \"FA419\": {\n            \"redLight\": 8,\n            \"greenLight\": 9,\n            \"horn\": 5\n        },\n        \"OMET\": {\n            \"redLight\": 10,\n            \"greenLight\": 11,\n            \"horn\": 2,\n        },\n        \"FA422\": {\n            \"redLight\": 12,\n            \"greenLight\": 13,\n            \"horn\": 2,\n        },\n        \"MO41\": {\n        },\n        \"MO42\": {\n        }\n    };\n    const NBITS = 16; //length of towersBitArray\n    //complete posOf with iterators\n    posOf[Symbol.iterator] = utils.makeKeyIterator(dictionary.macKeys);\n    // posOf[Symbol.iterator] = utils.makeKeyIterator(Object.keys(posOf));\n    // posOf.forEach(mac => utils.generateIteratorFor(mac) )\n    // const sharedDevs = (()=>{ var arr=new Array(NBITS);  posOf.forEach((v,i) => arr[]) return arr;})()\n\n    //validate and guaratee posOf syntax\n        //posOf keys are macKeys\n        //posOf[macKey] keys are devices\n        //posOf[macKey][devKey] are positive integers < NBITS\n    for (let macKey in posOf) {\n        if (!dictionary.macKeys.includes(macKey))\n            node.warn(\"[towersControl] Syntax Validation Error: unknown macKey \" + macKey + \" in posOf{}. typo?\");\n        for (let linkedDeviceKey in posOf[macKey]) {\n            if (!dictionary.devices.includes(linkedDeviceKey))\n                node.warn(\"[towersControl] Syntax Validation Error: unknown linkedDeviceKey \" + linkedDeviceKey + \" in posOf[\"+macKey+\"]{}. typo?\");\n            if (posOf[macKey]<0 || posOf[macKey]>=NBITS)\n                node.warn(\"[towersControl] Syntax Validation Error: invalid bit number. must be >= 0 && < \" + NBITS + \". in posOf[\" + macKey + \"][\"+linkedDeviceKey+\"]. typo?\");\n        }\n    }   //all macKeys have an EXPLICIT posOf[macKey][device] set (!== undefined), set to null and warn otherwise\n    //all dictionary macKeys are defined\n    for (let macKey of dictionary.macKeys)\n        if (posOf[macKey] == undefined || typeof (posOf[macKey]) != \"object\")\n            node.warn(\"[towersControl] Syntax Validation Error: missing macKey in posOf :\" + macKey);\n    //all present devices are null || number \n    if (!Object.keys(posOf).every(macKey => dictionary.devices.every(device => posOf[macKey][device] !== undefined))) {\n        node.warn(\"[towersControl]: Syntax validation Warning: implicit null devices in posOf\");\n        for (let macKey of dictionary.macKeys)\n            for (let device of dictionary.devices)\n                posOf[macKey][device] = posOf[macKey][device] ?? null;\n    }\n\n   \n    {   //generate sharedBits\n\n        const inversePosOf = (() => {\n            var arr = new Array(NBITS);\n            for(let macKey in posOf)\n                for(let devKey in posOf[macKey]){\n                    let bit = posOf[macKey][devKey];\n                    if(bit === null) continue;\n                    arr[bit] ?? (arr[bit] = []);\n                    arr[bit].push({ \"macKey\": macKey, \"devKey\": devKey });\n                }\n            return arr;\n        })()\n        //node.warn({\"inversePosOf\":inversePosOf});\n        \n        var sharedBits = {};\n        //define how bits are combined toghether when they're read as one\n        let atLeastOneTrue = function(){\n            for(let macKey in this.values)\n                if(this.values[macKey])\n                    return true;\n            return false\n        }\n        //create sharedBits only copying the values with more than one associated machine\n        for(let bit in inversePosOf){\n            if(inversePosOf[bit].length > 1){\n                //check that all machine have the same device on this bit, log a warning if they don't //use the first device anyway\n                if(!inversePosOf[bit].every((pair,i,arr) => i==arr.length-1 || pair.devKey== arr[i+1].devKey ))    node.warn({err:\"[towerControl|sharedBits{}]: different devices appear to share the same bit. \", bit:bit, revPosOf:inversePosOf[bit]});\n                inversePosOf[bit].forEach( pair => {\n                    sharedBits[bit] ?? (sharedBits[bit] = { devKey: pair.devKey, values: {}, output: atLeastOneTrue })\n                    sharedBits[bit].values[pair.macKey] = false;\n                })\n            }\n        }\n        //add iterators\n            //for sharedBits\n            //for all sharedBits[].values\n        let valKeys;\n        utils.generateIteratorFor(sharedBits);\n        // @ts-ignore\n        for(let item of sharedBits){\n            valKeys = []; for (let mk in item.values) valKeys.push(mk);\n            item.values[Symbol.iterator] = utils.makeKeyIterator(valKeys);\n        }\n    }\n    //node.warn({\"sharedBits\":sharedBits });\n    // sharedBits.forEach( bitItem => bitItem.values.fill(true) );\n    // @ts-ignore\n    //for(let bitItem of sharedBits) for(let mk in bitItem.values) bitItem.values[mk] = true;\n\n\n\n    //towersControl\n    var def = {\n        /** holds allowed keys as <string>[] //also used for validation purposes on towersControl definition\n             * - {String[]} macKeys \"machine keys\". match the ones used in uibuilder's app.\n             * - {String[]} devices devices that may be associated with each towersBitArray bit */\n        \"dictionary\": dictionary,\n        \n        /** pairs devices with the corresponding bit index to use in the modbus  queries\n            example: posOf[macKey][device]:number    //undefined macKey -> exception like 'undefined reading undefined' //undefined device -> exception like 'undefined reading <device>'\n            exposed but not expected to be used.\n            \"posOf\":{\n                {macKey}:{  //all dictionary.macKeys are defined and objects\n                    {device}:0 < number < 2^n | errorLoggingGetter() //bit index //all dictionary.devices are defined or errorLogging\n                }\n            },*/\n        \"posOf\": posOf,\n\n        /** \n          \n          \"sharedBits\":{\n                {bit}:{ //only the shared ones are defined\n                    'devKey': <devKey> //associated device. //it presumes all machines sharing the bit use the same device\n                    'output'\n                }\n           }*/\n        \"sharedBits\": sharedBits,\n\n        /** array of bits, represented by Numbers that are either 0 or 1\n             * - values should be set through towersControl[\"FA22\"].redLight = truthy|falsy\n             * - has a lenght of NBITS */\n        \"towersBitArray\": new Array(16).fill(0),\n        \n        /** @returns Bool\n         * @throws TypeError if macKey or devKey are not in dictionary */\n        \"macHasDevice\": function thisFun(macKey, devKey) {\n            if (arguments.length != thisFun.length) throw new SyntaxError(`[towersControl:macHasDevice()] expected ${thisFun.length} arguments, got ${arguments.length}`);\n            if (!posOf[macKey] || posOf[macKey][devKey] === undefined) throw new TypeError(\"[towersControl:macHasDevice()] uregistered macKey or devKey:\" + macKey + \", \" + devKey);\n            \n            return this.posOf[macKey] && typeof (this.posOf[macKey][devKey]) == \"number\"\n            //return this[macKey] && this[macKey].propertyIsEnumerable(devKey)\n        },\n        /*  \n        {macKey}:{  //all dictionary's macKeys are defined. \n            'hasDevice'(...): this.macHasDevice.bind(def, <macKey>, ...)    //alias with one less parameter //not enum\n            {linkedDeviceKey}: truthy|falsy,     //only posOf[<macKey>]'s devKeys are defined. //dictionary's devKeys missing in posOf[<macKey>] are instead not-enumerable warning-loggers\n            {linkedDeviceKey}: truthy|falsy,\n            ..\n        },\n        ..\n        */\n        [Symbol.iterator]: utils.makeKeyIterator(dictionary.macKeys)\n    }\n    \n\n\n    //complete towersControl\n        //adds a setter and getter for EACH macKey and linkedDeviceKey, even if they are not registered in posOf\n        //they will modify the corresponding towersBitArray's pos instead of themselves.\n        //setters convert the value to either 0 or 1. //not true/false for easier math and conversions\n        //setters&getters paired with unconfigured devices (posOf[][]===null) will be NOT ENUMERABLE and log a warning\n        //adds a NOT ENUMERABLE hasDevice() function, which aliases macHasDevice(macKey,...)\n    {\n        const devIsRegistered = function (macKey, linkedDeviceKey) {\n            return posOf[macKey][linkedDeviceKey] !== null && posOf[macKey][linkedDeviceKey] !== undefined\n        }\n        const devIsShared = function (macKey, linkedDeviceKey){\n            return devIsRegistered(macKey,linkedDeviceKey) && sharedBits[posOf[macKey][linkedDeviceKey]]\n        }\n        for (let macKey of dictionary.macKeys) {\n            def[macKey] = {};\n            Object.defineProperty(def[macKey], \"hasDevice\", {\n                value: def.macHasDevice.bind(def, macKey)\n            });\n            for (let linkedDeviceKey of dictionary.devices) {\n                //node.warn(\"setting \"+macKey+ \" \"+linkedDeviceKey)\n                //if device is not configured add an error-logging getter/setter\n                if (true || devIsRegistered) {\n                    Object.defineProperty(def[macKey], linkedDeviceKey, {\n                        //if bit is registered aka (typeof posof[][] == \"number\") <=> !== null && >=0\n                        set(val) {\n                            let idx = def.posOf[macKey][linkedDeviceKey];\n                            if (devIsRegistered(macKey, linkedDeviceKey)){\n                                //if bit/device is shared by multiple machines\n                                if(sharedBits[idx]){\n                                    sharedBits[idx].values[macKey] = (val ? true : false) //store the state for that machine\n                                    def.towersBitArray[idx] = sharedBits[idx].output(); //set using the output function defined for that device.\n                                }\n                                else\n                                    def.towersBitArray[idx] = (val ? 1 : 0);\n                            }\n                            else\n                                onUnconfigKeySet(macKey, linkedDeviceKey);\n                        },\n                        get() {\n                            let idx = def.posOf[macKey][linkedDeviceKey];\n                            if (idx !== null && idx !== undefined)\n                                return def.towersBitArray[def.posOf[macKey][linkedDeviceKey]]\n                            else {\n                                onUnconfigKeyGet(macKey, linkedDeviceKey);\n                                return undefined;\n                            }\n                        },\n                        enumerable: def.macHasDevice(macKey, linkedDeviceKey)\n                    })\n                }\n                else {\n                    Object.defineProperty(def[macKey], linkedDeviceKey, {\n                        set(val) {\n                            onUnconfigKeySet(macKey, linkedDeviceKey);\n                        },\n                        get() {\n                            onUnconfigKeyGet(macKey, linkedDeviceKey);\n                            return undefined;\n                        },\n                        enumerable: false\n                    })\n                }\n            }\n        }\n    }\n\n    //validate towersBitArray syntax\n\n    /*\n    //complete posOf\n        //attach to each null key an error-logging function\n        //--EDIT--allow for posOf calls on missing one\n    for (let macKey in posOf) {\n        for (let linkedDeviceKey in posOf[macKey]) {\n            if (posOf[macKey][linkedDeviceKey] === null) {\n                Object.defineProperty(posOf[macKey], linkedDeviceKey, {\n                    set(val) {\n                        onUnconfigKeySet(linkedDeviceKey, macKey)\n                    },\n                    get() {\n                        onUnconfigKeyGet(linkedDeviceKey, macKey);\n                        return null;\n                    }\n                });\n            }\n        }\n    }\n    */\n\n    global.set(\"towersControl\", def);\n    global.set(\"towersBitArray\", global.get(\"towersControl\").towersBitArray)\n    node.send(def);\n    node.status({ fill: \"green\", text: Object.keys(def).join(' & ') });\n\n//#######################################################################################################################\n/*** TESTS *** * /\nnode.warn(\"BEGIN TOWERSCONTROL TESTING\");\n\nconst signal = def;\nconst sleep = ms => new Promise(r => setTimeout(r, ms));\nfunction bitArrToString(arr){\n    var str=\"\";\n    for(let i=0; i<arr.length; i++){\n        if(i%4==0)\n            str+=\"|\"\n        str+=parseInt(arr[i])+\",\";\n    }\n    return str;\n}\n\nnode.warn(\"testing bits\")\n//raise 1 bit at a time, try to raise unset devices\n    //mkList is set so you should see bits raising consecutively\n{const mkList = [\"FA423\", \"FA420\", \"FA421\", \"FA419\", \"OMET\", \"FA422\"]\nlet sBA = signal.towersBitArray\nfor (let mKey of mkList) {\n    node.warn(\"over \" + mKey)\n    signal[mKey].redLight = 1;\n    node.warn(bitArrToString(sBA));\n    signal[mKey].redLight = 0;\n\n    signal[mKey].greenLight = 1;\n    node.warn(bitArrToString(sBA));\n    signal[mKey].greenLight = 0;\n\n    //this should sometime throw warnings\n    signal[mKey].horn = 1;\n    node.warn(bitArrToString(sBA));\n    signal[mKey].horn = 0;\n\n}}\n\n//try macHasDevice on all\n    //res: {\n        //{macKey}:{\n            //{device}:true|false\n        //notDefinedList: {string[]}\nnode.warn(\"testing macHasDevice\")\n{ let res={}; res.notDefinedList=[];\nfor(let macKey of def.dictionary.macKeys){\n    res[macKey] = {};\n    for(let device of def.dictionary.devices){\n        res[macKey][device] = def.macHasDevice(macKey, device);\n        if(!res[macKey][device])\n            res.notDefinedList.push(`${macKey} has not ${device}`)\n    }\n}\nnode.warn({\"all_macHasDevice:\":res})\n}\n\nnode.warn(\"TEST END\");\n/**/\n\n},\"utils\")\n\nfunction callWhenDef(cb, opts, ...globalNames) {\n    if (typeof (opts) == \"string\")\n        globalNames.push(opts);\n    let { timeout: timeout = 3000, retryDelay: retryDelay = 100, errorCb: errorCb = null } = (typeof (opts) == \"string\" ? opts : {});\n    var tout, intv;\n    //set timeout unless false or not specified\n    if (timeout) {\n        tout = setTimeout(() => {\n            clearInterval(intv);\n            errorCb ? errorCb() : node.warn({ err: \"callWhenDef_Timeout\", arg: arguments })\n        }, timeout);\n    }\n    //set global-chacking interval\n    intv = setInterval(() => {\n        for (let name of globalNames)\n            if (global.get(name) === undefined || global.get(name) === null)\n                return\n        clearTimeout(tout);\n        clearInterval(intv);\n        cb();\n    }, retryDelay)\n}\n",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 300,
        "wires": [
            [
                "d383c7d09f8f6a9e"
            ]
        ]
    },
    {
        "id": "89652258fd3f8763",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "48f133c168356962",
        "name": "SCRITTURA CONTINUA sul PLC dei segnali di towerBitArray",
        "info": "che controlla le colonnine",
        "x": 325,
        "y": 615,
        "wires": []
    },
    {
        "id": "173a4792e388dff6",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "da3e31cb0af2a871",
        "name": "#dbg toggle",
        "info": "",
        "x": 215,
        "y": 690,
        "wires": []
    },
    {
        "id": "cbdd81ecdc3c11d6",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "da3e31cb0af2a871",
        "name": "toggle",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "control",
        "payload": "toggle",
        "payloadType": "str",
        "x": 235,
        "y": 720,
        "wires": [
            [
                "7a23d2c9ebd1ccb8"
            ]
        ]
    },
    {
        "id": "7a23d2c9ebd1ccb8",
        "type": "gate",
        "z": "bdc10eb0bfc2c224",
        "g": "da3e31cb0af2a871",
        "name": "",
        "controlTopic": "control",
        "defaultState": "open",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 325,
        "y": 750,
        "wires": [
            [
                "994d31722a926cc7"
            ]
        ],
        "l": false
    },
    {
        "id": "c1f38be4152e1b73",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "da3e31cb0af2a871",
        "name": "poll 1s",
        "props": [],
        "repeat": "1",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "x": 225,
        "y": 750,
        "wires": [
            [
                "7a23d2c9ebd1ccb8"
            ]
        ]
    },
    {
        "id": "994d31722a926cc7",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "48f133c168356962",
        "name": "trigger writetowersBitArray out",
        "mode": "link",
        "links": [
            "0e67b07cc99383b3"
        ],
        "x": 515,
        "y": 735,
        "wires": [],
        "l": true
    },
    {
        "id": "ba0eab6a3ebe51cb",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "48f133c168356962",
        "name": "write towersBitArray",
        "func": "/*  flow.query:\n    \"from\": function (address = 0, quantity = 2)\n    \"between\": function (from, to, sequenceName = \"\")\n    \"writeReg\": fucntion (address, value )\n    \"writeCoil\": fucntion (address, value )\n*/\n\n/*\nfunction bitArrayToInt(arr) {\n    var res = 0;\n    for (let i = 0; i < arr.length; i++) {\n        if (arr[i])\n            res += Math.pow(2, i);\n    }\n    return res;\n}\n*/\nconst bitArrayToInt = global.get(\"utils\").bitArrayToInt\n\n\nlet towersBitArray = global.get(\"towersBitArray\");\nif (!towersBitArray) {\n    node.warn(\"towersBitArray still undefined\");\n    return;\n}\n\nlet mwAddress = 16; //correspond to 40000 + 16 on this PLC\nlet query=global.get(\"query\");\nnode.send(  query.writeReg(   mwAddress, bitArrayToInt(towersBitArray)  )   );",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 780,
        "wires": [
            [
                "24b71bc281409a22"
            ]
        ]
    },
    {
        "id": "0e67b07cc99383b3",
        "type": "link in",
        "z": "bdc10eb0bfc2c224",
        "g": "48f133c168356962",
        "name": "trigger writetowersBitArray in",
        "links": [
            "641132022a6be334",
            "994d31722a926cc7",
            "544b15cb3575e299",
            "f36ff7fcef01055e",
            "88e7771fbcd1e4ce",
            "646a32288f144f73",
            "158e57843e4b74a5",
            "dff151503d492736"
        ],
        "x": 525,
        "y": 780,
        "wires": [
            [
                "ba0eab6a3ebe51cb",
                "ca63d0b06d78808e",
                "db0b9650aad24229"
            ]
        ],
        "l": true
    },
    {
        "id": "641132022a6be334",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "48f133c168356962",
        "name": "trigger writetowersBitArray out",
        "mode": "link",
        "links": [
            "0e67b07cc99383b3"
        ],
        "x": 520,
        "y": 825,
        "wires": [],
        "l": true
    },
    {
        "id": "24b71bc281409a22",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "48f133c168356962",
        "name": "PLC Torri Write out",
        "mode": "link",
        "links": [
            "43bb0021e53007d6"
        ],
        "x": 990,
        "y": 780,
        "wires": [],
        "l": true
    },
    {
        "id": "3d27e37c3ed9e7f4",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "0739446a5011eb4d",
        "name": "#dbg toggle",
        "info": "",
        "x": 230,
        "y": 1125,
        "wires": []
    },
    {
        "id": "5815cad38a040cc3",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "0739446a5011eb4d",
        "name": "toggle",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "control",
        "payload": "toggle",
        "payloadType": "str",
        "x": 250,
        "y": 1155,
        "wires": [
            [
                "86716780529bf336"
            ]
        ]
    },
    {
        "id": "86716780529bf336",
        "type": "gate",
        "z": "bdc10eb0bfc2c224",
        "g": "0739446a5011eb4d",
        "name": "",
        "controlTopic": "control",
        "defaultState": "open",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 355,
        "y": 1185,
        "wires": [
            [
                "5c0e00a893bdf288"
            ]
        ],
        "l": false
    },
    {
        "id": "d1e3a540b0a3ee0d",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "0739446a5011eb4d",
        "name": "poll 0.35s",
        "props": [],
        "repeat": "0.35",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "x": 230,
        "y": 1185,
        "wires": [
            [
                "86716780529bf336"
            ]
        ]
    },
    {
        "id": "68644d6d8e8ebaf8",
        "type": "link call",
        "z": "bdc10eb0bfc2c224",
        "g": "7cd6e0abf52051ff",
        "name": "",
        "links": [
            "3d7f018e03cb4a74"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 855,
        "y": 1185,
        "wires": [
            [
                "46d363153b6d8510",
                "ecc8fa86b61f20b9"
            ]
        ]
    },
    {
        "id": "10958d37e53c1234",
        "type": "catch",
        "z": "bdc10eb0bfc2c224",
        "g": "7cd6e0abf52051ff",
        "name": "mutePLCQueryTimeout",
        "scope": [
            "68644d6d8e8ebaf8"
        ],
        "uncaught": false,
        "x": 795,
        "y": 1155,
        "wires": [
            []
        ]
    },
    {
        "id": "5c0e00a893bdf288",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "850adb4a2c8b2b3f",
        "name": "sendQuery 40000:4x8",
        "func": "/*  global.plc:\n    \"from\": function (address = 0, quantity = 2) -> msg -> number[quant] & Buffer[2*quant == nByte]\n    \"between\": function (from, to, sequenceName = \"\") -> msg -> number[quant] & Buffer[2*quant == nByte]\n    \"readCoil\": function (address, nByte ) -> msg -> Boolean[8*nByte] & Buffer[nByte]\n    \"writeReg\": fucntion (address, value )\n    \"writeCoil\": fucntion (address, value )\n*/\nlet plc = global.get(\"plc\");\n\nreturn plc.readCoil(0, 4);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 545,
        "y": 1185,
        "wires": [
            [
                "68644d6d8e8ebaf8"
            ]
        ]
    },
    {
        "id": "83f45ea66444d520",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "850adb4a2c8b2b3f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 890,
        "y": 1095,
        "wires": [
            [
                "a6c649bfeb643683",
                "ecc8fa86b61f20b9"
            ]
        ]
    },
    {
        "id": "a2fc9d155cc2e412",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "bdb77fbf338dd270",
        "name": "callWhenDef",
        "func": "//look in onStart",
        "outputs": 1,
        "noerr": 0,
        "initialize": "\n/** alternative to using link-nodes on libraries (which requires a ton of overhead and structures)\n * \n*/\n/** repeatedly tries to fetch all globalNames with global.get(). \n    * @param {function} cb called once ALL globalName are defined\n    * @param {Object} opts object holding optional function params. can be omitted passing the first globalName instead.\n    * @param {number} opts.timeout ms delay after which stop trying and either call opts.errorCb() or log an error. defaults to 15000\n    * @param {number} opts.retryDelay ms between each attempt. defaults to 100\n    * @param {function} opts.errorCb function to call after timeout. defaults to falsy, logging a warning\n    * @param  {...any} globalNames series of strings\n    */\nfunction callWhenDef(cb, opts, ...globalNames){\n    if(typeof(opts) == \"string\")\n        globalNames.push(opts);\n    let {timeout:timeout=3000, retryDelay:retryDelay=100, errorCb:errorCb=null} = (typeof(opts) == \"string\" ? opts : {});\n    var tout,intv;\n    //set timeout unless false or not specified\n    if (timeout) {\n        tout = setTimeout(() => {\n            clearInterval(intv);\n            errorCb ? errorCb() : node.warn({ err: \"callWhenDef_Timeout\", arg: arguments })\n        }, timeout);\n    }\n    //set global-chacking interval\n    intv = setInterval(() => {\n        for (let name of globalNames)\n            if (global.get(name) === undefined || global.get(name) === null)\n                return\n        clearTimeout(tout);\n        clearInterval(intv);\n        cb();\n    }, retryDelay)\n}\n\ncallWhenDef(function(){\n    /*\n        const obj = { .. }\n        global.set(\"..\",obj)\n        node.\n     */\n    const obj={};\n    node.status({ fill: \"green\", text: Object.keys(obj).join(' & ') });\n},\"utils\")\n\n",
        "finalize": "",
        "libs": [],
        "x": 185,
        "y": 255,
        "wires": [
            []
        ]
    },
    {
        "id": "6f8c1f95e51d8102",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "bdb77fbf338dd270",
        "name": "utils isDefinedEvent",
        "mode": "link",
        "links": [
            "3502536b287b497d"
        ],
        "x": 445,
        "y": 180,
        "wires": [],
        "l": true
    },
    {
        "id": "39bf5adb6f116565",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "bdb77fbf338dd270",
        "name": "set global signalCells",
        "func": "\n//look in on start",
        "outputs": 1,
        "noerr": 0,
        "initialize": "function callWhenDef(cb, ...globalNames) {\n    for (let name of globalNames)\n        if (global.get(name) === undefined || global.get(name) === null) {\n            setTimeout(callWhenDef, 100, cb, ...globalNames)\n            return\n        }\n    cb();\n}\n\nclass toutItem {\n    #startTime\n    #endTime\n    //remainingMs\n    #cb\n    #ref\n\n    constructor(cb,delay){\n        this.#startTime = Date.now();\n        this.#endTime = this.startTime + delay;\n        this.#cb = cb;\n        this.#ref = setTimeout(cb,delay);\n    }\n\n    get remainingMs(){ return this.#startTime - this.#endTime }\n    get startTime() { return this.#startTime }\n    get endTime() { return this.#startTime }\n    get cb(){ return this.#cb }\n    get ref(){ return this.#ref }\n}\n\nclass SignalCell {\n    signalKey;\n    programmedStateChanges;\n    timerStart;\n    timerEnd;\n\n    constructor(cfg={}){\n        this.signalKey = \"noop\"\n        this.programmedStateChanges = [];\n        this.timerEnd=0;\n        this.timerStart=0;\n        \n        this.config = cfg;\n        this.cfg = this.config;\n    }\n\n    programStateChange(toKey, delay, nodeRef){\n        this.programmedStateChanges.push({\n            toSignalKey:toKey,\n            tout:new toutItem(()=>{\n                this.signalKey = toKey;\n                \n            },delay)\n        })\n    }\n\n    setTout( toKey, delay){\n        if(this.programmedStateChanges[toKey])\n            this.programmedStateChanges[toKey].push(setTimeout(()=>{}))\n    }\n\n}\n\n//signalCells.OMET.setTout(\"A2\",cb, 3000)\n//signalCells.OMET.clearTouts()\n//signalCells.OMET.clearTout(\"A2\")\n\nconst cb=function(){\n    const towersControl = global.get(\"towersControl\");\n    const config = global.get(\"config\");\n    const def={\n        dictionary:{\n            macKeys:towersControl.dictionary.macKeys,\n            signalKeys:[\"A1\",\"A2\",\"A3\",\"A4\",\"B\",\"C1\",\"C2\",\"D\",\"E\",\"F\"],\n            signalNames:[\"chiamata\",\"presa in carico\",\"avvio\",\"ritardo d'avvio\",\"run\",\"downtime\",\"manutenzione\",\"scarto\",\"carrelli in corsia\"]\n        },\n        /*\n        [macKey] = <SignalCell>\n        */\n\n    }\n\n    //init cells\n    for(let macKey of towersControl.dictionary.macKeys){\n        def[macKey] = new SignalCell(config.machines[macKey])\n    }\n\n    //check syntax\n        //signalNames len == signalKeys len\n    if(def.dictionary.signalNames.length != def.dictionary.signalKeys.length){\n        node.warn(\"signalCells: signalNames's lenght doesn't match signalKeys's. \" + def.dictionary.signalNames.length + \" vs \" + def.dictionary.signalKeys.length);\n        for(let i=def.dictionary.signalNames.length; i<def.dictionary.signalKeys.length; i++)\n            def.dictionary.signalNames.push(\"missingName\");\n    }\n\n    global.set(\"signalCells\", def);\n    node.send(def);\n    node.status({ fill: \"green\", text: Object.keys(def).join(' & ') });\n\n}\n\ncallWhenDef(cb,\"utils\",\"towersControl\",\"config\");",
        "finalize": "",
        "libs": [],
        "x": 215,
        "y": 360,
        "wires": [
            [
                "6d5dd2c43db0ac78"
            ]
        ]
    },
    {
        "id": "fb50ab3261295b54",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "bdb77fbf338dd270",
        "name": "lettura e scrittura colonnine",
        "info": "",
        "x": 580,
        "y": 300,
        "wires": []
    },
    {
        "id": "371dd92c3642e0ba",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "bdb77fbf338dd270",
        "name": "UI celle",
        "info": "",
        "x": 425,
        "y": 360,
        "wires": []
    },
    {
        "id": "fbec45079c82c4f6",
        "type": "switch",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "action",
        "property": "action",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "setA1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "setA2",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "setA3",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "setA4",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "setB",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "setC1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "setC2",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "setD",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "setE",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 10,
        "x": 490,
        "y": 2580,
        "wires": [
            [
                "cb87a1179601d7b8"
            ],
            [
                "06c77a7347c932b1"
            ],
            [
                "0ab9b611389e52b7"
            ],
            [
                "ea5a84d58454a07e"
            ],
            [
                "534b0771447b37e9"
            ],
            [
                "6a9506e901b63554"
            ],
            [
                "2c9f603eb53ec7c7"
            ],
            [
                "6b16add2d6b04682"
            ],
            [
                "d1f763dae798b9a3"
            ],
            [
                "111059d7a7373219",
                "66848166715e3f45"
            ]
        ]
    },
    {
        "id": "cb87a1179601d7b8",
        "type": "switch",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "setA1",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 905,
        "y": 2355,
        "wires": [
            [
                "2f1fbbf63057cd82",
                "21a7e4d7b331c67e",
                "8535fcf6403fa45e",
                "d7a2c75afa019028",
                "47b607147dd37f73",
                "c4f475eadc34f078"
            ]
        ]
    },
    {
        "id": "2f1fbbf63057cd82",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "send setA4 [120m|dynamic]",
        "func": "const signalCells = global.get(\"signalCells\")\nlet mKey = msg.topic;\nlet cfg = global.get(\"config\").machines[mKey];\n\nnode.send({reset:true,action:\"setA4\",topic:msg.topic});\nmsg.action = \"setA4\";\nmsg.delay = cfg.toA3Timeout + cfg.toA4Timeout;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1140,
        "y": 2385,
        "wires": [
            [
                "84eb44d8938c031b"
            ]
        ]
    },
    {
        "id": "efc7f5e59321c025",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "bdb77fbf338dd270",
        "name": "allMain isDefinedEvent",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "\n\n/** alternative to using link-nodes on libraries (which requires a ton of overhead and structures)\n * \n*/\nfunction callWhenDef(cb, ...globalNames) {\n    for (let name of globalNames)\n        if (global.get(name) === undefined || global.get(name) === null) {\n            setTimeout(callWhenDef, 300, cb, ...globalNames)\n            return\n        }\n    cb();\n}\n\nconst tout = setTimeout(()=>{\n    node.error(node.name+\" timeout. check node \"+node.id+\" for typos\")\n}, 10000)\ncallWhenDef(function () {\n   node.send({topic:\"isDefinedEvent\", payload:\"allMain\"})\n   clearTimeout(tout);\n}, \"utils\",\"towersControl\",\"towersBitArray\",\"signalCells\")",
        "finalize": "",
        "libs": [],
        "x": 355,
        "y": 135,
        "wires": [
            [
                "230aaa874077cfdc"
            ]
        ]
    },
    {
        "id": "230aaa874077cfdc",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "bdb77fbf338dd270",
        "name": "allMain isDefinedEvent out",
        "mode": "link",
        "links": [
            "7bfe34e4ff0695f7",
            "cc9d5b0b240172ae",
            "8a7b266f172db654",
            "41052036e4260285"
        ],
        "x": 600,
        "y": 135,
        "wires": [],
        "l": true
    },
    {
        "id": "f4db294021a89fbf",
        "type": "link in",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "buttonActions in",
        "links": [
            "185fc4dc4d7ebafc",
            "299a9401493dc34c",
            "cd8d11132d3664f1",
            "df7b734c7de9fefe",
            "a218e475a04369b9",
            "1255172cf854afec",
            "e9116e554f7d574d",
            "46843f4e8d02205b",
            "f607e3882cb5c331",
            "6ab3f61c2bde1e09"
        ],
        "x": 295,
        "y": 2580,
        "wires": [
            [
                "1531adcffdaf7a6b",
                "f838580e2844b4dd",
                "fbec45079c82c4f6"
            ]
        ],
        "l": true
    },
    {
        "id": "84eb44d8938c031b",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "programmedStateChanges",
        "mode": "link",
        "links": [
            "fb95b4d0741d8db8"
        ],
        "x": 1410,
        "y": 2385,
        "wires": [],
        "l": true
    },
    {
        "id": "dd20009116ca100b",
        "type": "trigger",
        "z": "bdc10eb0bfc2c224",
        "g": "0459e2a074258c5a",
        "name": "programmedStateChanges",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "payl",
        "duration": "1",
        "extend": true,
        "overrideDelay": true,
        "units": "ms",
        "reset": "",
        "bytopic": "topic",
        "topic": "toutId",
        "outputs": 1,
        "x": 530,
        "y": 2235,
        "wires": [
            [
                "185fc4dc4d7ebafc"
            ]
        ]
    },
    {
        "id": "fb95b4d0741d8db8",
        "type": "link in",
        "z": "bdc10eb0bfc2c224",
        "g": "0459e2a074258c5a",
        "name": "programmedStateChange in",
        "links": [
            "84eb44d8938c031b",
            "41b676d5ef990a3e",
            "0d74d8b0c980963a",
            "1c57f74e543c9457",
            "223dfe7f51e5c702",
            "4bf699bb76b64d11",
            "bbfed2b82dfd8ca8",
            "9002b5da933a2cf0",
            "be30f8352908de40",
            "19df9e22435f0986",
            "eba758ecf77571c1",
            "6e97b2f0a581d55b",
            "d8a6e6c6bc116cfc"
        ],
        "x": 180,
        "y": 2235,
        "wires": [
            [
                "f0c22b02c475661f"
            ]
        ]
    },
    {
        "id": "185fc4dc4d7ebafc",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "0459e2a074258c5a",
        "name": "buttonActions",
        "mode": "link",
        "links": [
            "f4db294021a89fbf",
            "4bd7236cd1df5691"
        ],
        "x": 695,
        "y": 2235,
        "wires": []
    },
    {
        "id": "c41f4b62a37e0c5a",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "example input: topic:OMET, action:setA1",
        "info": "",
        "x": 380,
        "y": 2670,
        "wires": []
    },
    {
        "id": "cfbba0824276973c",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "toWebapp",
        "mode": "link",
        "links": [
            "29da4c340c1c0f16"
        ],
        "x": 1575,
        "y": 2415,
        "wires": [],
        "l": true
    },
    {
        "id": "21a7e4d7b331c67e",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "raise playHorn bit",
        "func": "let mKey = msg.topic;\nconst towersControl = global.get(\"towersControl\");\n\nif (towersControl[mKey].hasDevice(\"horn\"))\n    towersControl[mKey].horn = true;\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1110,
        "y": 2445,
        "wires": [
            [
                "544b15cb3575e299"
            ]
        ]
    },
    {
        "id": "544b15cb3575e299",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "trigger writetowersBitArray",
        "mode": "link",
        "links": [
            "0e67b07cc99383b3"
        ],
        "x": 1350,
        "y": 2445,
        "wires": [],
        "l": true
    },
    {
        "id": "8535fcf6403fa45e",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "send setA3 20m",
        "func": "let mKey = msg.topic;\nlet cfg = global.get(\"config\").machines[mKey];\n\n//send programmed State change\nnode.send({ reset: true, action: \"setA3\", topic: msg.topic });\nmsg.action = \"setA3\";\nmsg.delay = cfg.toA3Timeout;\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1100,
        "y": 2355,
        "wires": [
            [
                "41b676d5ef990a3e"
            ]
        ]
    },
    {
        "id": "41b676d5ef990a3e",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "programmedStateChanges",
        "mode": "link",
        "links": [
            "fb95b4d0741d8db8"
        ],
        "x": 1350,
        "y": 2355,
        "wires": [],
        "l": true
    },
    {
        "id": "06c77a7347c932b1",
        "type": "switch",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "setA2",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 910,
        "y": 2490,
        "wires": [
            [
                "9467330a7dcfcb9f",
                "c9050cb334d984e8",
                "71050fa128ba0470",
                "9250c631a78ab33a"
            ]
        ]
    },
    {
        "id": "9467330a7dcfcb9f",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "lower playHorn bit",
        "func": "let mKey = msg.topic;\nconst towersControl = global.get(\"towersControl\");\n\nif (towersControl[mKey].hasDevice(\"horn\"))\n    towersControl[mKey].horn = false;\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1110,
        "y": 2550,
        "wires": [
            [
                "a0da01db3cddd017"
            ]
        ]
    },
    {
        "id": "f36ff7fcef01055e",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "trigger writetowersBitArray",
        "mode": "link",
        "links": [
            "0e67b07cc99383b3"
        ],
        "x": 1380,
        "y": 2610,
        "wires": [],
        "l": true
    },
    {
        "id": "ab8ca08ba9111f30",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "toWebapp",
        "mode": "link",
        "links": [
            "29da4c340c1c0f16"
        ],
        "x": 1305,
        "y": 2520,
        "wires": [],
        "l": true
    },
    {
        "id": "1531adcffdaf7a6b",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "8dfc8129d51e5740",
        "name": "action set<signalKey>",
        "func": "\n\nlet matches = msg.action.match(/set(\\w+)/)[1];\nif(matches)\n    msg.signalKey\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 2460,
        "wires": [
            []
        ]
    },
    {
        "id": "fb1f9c7dd8ad7a3e",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "14eeda19a6a7072a",
        "name": "send setSingleCellState",
        "func": "const uib = global.get(\"uibuilder\")\nlet signalKey = msg.action.match(/set(\\w+)/)[1];\nlet mKey = msg.topic;\n\n//update signalcells state\nlet signalCells = global.get(\"signalCells\");\nlet cell = signalCells[mKey];\nlet cfg = cell.config; //global.get(\"config\")[mKey];\n\ncell.signalKey = signalKey;\n\nuib.prepareMsg_setSingleCellState(msg,mKey,cell);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1215,
        "y": 2205,
        "wires": [
            [
                "03890e35a75d43ef"
            ]
        ]
    },
    {
        "id": "c4016914ed4edfaf",
        "type": "link in",
        "z": "bdc10eb0bfc2c224",
        "g": "14eeda19a6a7072a",
        "name": "send setCellSignal",
        "links": [],
        "x": 860,
        "y": 2205,
        "wires": [
            [
                "258441120833deb5"
            ]
        ]
    },
    {
        "id": "eed9d3aa846e26f9",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "14eeda19a6a7072a",
        "name": "send setCellSignal",
        "mode": "return",
        "links": [],
        "x": 1580,
        "y": 2205,
        "wires": []
    },
    {
        "id": "c4f475eadc34f078",
        "type": "link call",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "send setSingleCellState",
        "links": [
            "c4016914ed4edfaf"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1325,
        "y": 2415,
        "wires": [
            [
                "cfbba0824276973c"
            ]
        ]
    },
    {
        "id": "f838580e2844b4dd",
        "type": "switch",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "8dfc8129d51e5740",
        "name": "action set<signalKey>",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "set(\\w+)",
                "vt": "str",
                "case": false
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 1,
        "x": 440,
        "y": 2490,
        "wires": [
            []
        ]
    },
    {
        "id": "c9050cb334d984e8",
        "type": "link call",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "send setCellSignal",
        "links": [
            "c4016914ed4edfaf"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1110,
        "y": 2520,
        "wires": [
            [
                "ab8ca08ba9111f30"
            ]
        ]
    },
    {
        "id": "0ab9b611389e52b7",
        "type": "switch",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "setA3",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 905,
        "y": 2655,
        "wires": [
            [
                "10f77208037dab67",
                "ba11515a04cebd32"
            ]
        ]
    },
    {
        "id": "079b24bde6bc7913",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "toWebapp",
        "mode": "link",
        "links": [
            "29da4c340c1c0f16"
        ],
        "x": 1295,
        "y": 2655,
        "wires": [],
        "l": true
    },
    {
        "id": "10f77208037dab67",
        "type": "link call",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "send setCellSignal",
        "links": [
            "c4016914ed4edfaf"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1110,
        "y": 2655,
        "wires": [
            [
                "079b24bde6bc7913"
            ]
        ]
    },
    {
        "id": "a0da01db3cddd017",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "raise tower redLight bit",
        "func": "let mKey = msg.topic;\nconst towersControl = global.get(\"towersControl\");\n\nnode.warn(\"raising red\")\nif (towersControl[mKey].hasDevice(\"redLight\"))\n    towersControl[mKey].redLight = true;\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 2580,
        "wires": [
            [
                "dfa8cdb9bed3539c"
            ]
        ]
    },
    {
        "id": "dfa8cdb9bed3539c",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "lower tower greenLight bit",
        "func": "let mKey = msg.topic;\nconst towersControl = global.get(\"towersControl\");\n\n\nnode.warn(\"lowering green\")\nif (towersControl[mKey].hasDevice(\"greenLight\"))\n    towersControl[mKey].greenLight = false;\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 2610,
        "wires": [
            [
                "f36ff7fcef01055e"
            ]
        ]
    },
    {
        "id": "ea5a84d58454a07e",
        "type": "switch",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "setA4",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 905,
        "y": 2700,
        "wires": [
            [
                "f416b5ea2464b4c0",
                "6f13a43d49cbb006"
            ]
        ]
    },
    {
        "id": "6d4bfaadae660075",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "toWebapp",
        "mode": "link",
        "links": [
            "29da4c340c1c0f16"
        ],
        "x": 1295,
        "y": 2700,
        "wires": [],
        "l": true
    },
    {
        "id": "f416b5ea2464b4c0",
        "type": "link call",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "send setCellSignal",
        "links": [
            "c4016914ed4edfaf"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1110,
        "y": 2700,
        "wires": [
            [
                "6d4bfaadae660075"
            ]
        ]
    },
    {
        "id": "534b0771447b37e9",
        "type": "switch",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "setB",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 905,
        "y": 2745,
        "wires": [
            [
                "d700156b08ed999b",
                "e61d6852cebd5731",
                "7e325d321fc3cadb"
            ]
        ]
    },
    {
        "id": "d700156b08ed999b",
        "type": "link call",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "send setCellSignal",
        "links": [
            "c4016914ed4edfaf"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1110,
        "y": 2775,
        "wires": [
            [
                "2473f05cfebcb6eb"
            ]
        ]
    },
    {
        "id": "2473f05cfebcb6eb",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "toWebapp",
        "mode": "link",
        "links": [
            "29da4c340c1c0f16"
        ],
        "x": 1295,
        "y": 2775,
        "wires": [],
        "l": true
    },
    {
        "id": "6a9506e901b63554",
        "type": "switch",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "setC1",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 905,
        "y": 2820,
        "wires": [
            [
                "51ccbb885d329fc3",
                "de15a8e34e10e6de",
                "590b85c6d709bc3a"
            ]
        ]
    },
    {
        "id": "2c9f603eb53ec7c7",
        "type": "switch",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "setC2",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 905,
        "y": 2895,
        "wires": [
            [
                "e07363a0c58b13e0",
                "2c3cc994eb8f94aa",
                "76bd5f8638bf1573"
            ]
        ]
    },
    {
        "id": "6b16add2d6b04682",
        "type": "switch",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "setD",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 905,
        "y": 2970,
        "wires": [
            [
                "9b8b41e6232af923",
                "84f861f523724022",
                "0e0aa465724c5b30"
            ]
        ]
    },
    {
        "id": "d1f763dae798b9a3",
        "type": "switch",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "setE",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 895,
        "y": 3045,
        "wires": [
            [
                "51a3daed646e5627",
                "647f4fe681027b71",
                "cc301d51052bf1ea",
                "bd11511613590ced"
            ]
        ]
    },
    {
        "id": "646a32288f144f73",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "trigger writetowersBitArray",
        "mode": "link",
        "links": [
            "0e67b07cc99383b3"
        ],
        "x": 1380,
        "y": 3135,
        "wires": [],
        "l": true
    },
    {
        "id": "51a3daed646e5627",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "lower tower redLight bit",
        "func": "let mKey = msg.topic;\nconst towersControl = global.get(\"towersControl\");\n\nif (towersControl[mKey].hasDevice(\"redLight\"))\n    towersControl[mKey].redLight = false;\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 3105,
        "wires": [
            [
                "d18f0a4219d2313a"
            ]
        ]
    },
    {
        "id": "d18f0a4219d2313a",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "raise tower greenLight bit",
        "func": "let mKey = msg.topic;\nconst towersControl = global.get(\"towersControl\");\n\nif (towersControl[mKey].hasDevice(\"greenLight\"))\n    towersControl[mKey].greenLight = true;\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1145,
        "y": 3135,
        "wires": [
            [
                "646a32288f144f73"
            ]
        ]
    },
    {
        "id": "111059d7a7373219",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "default: warn",
        "func": "node.warn({\n    txt:\"unknown msg.action in buttonAction\",\n    action:msg.action,\n    fullMsg:msg\n});\nglobal.get(\"utils\").errorBlink(node, 60000);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 3180,
        "wires": [
            []
        ]
    },
    {
        "id": "5df722be84205e46",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "549f9deeccc44498",
        "name": "HANDLE BUTTON ACTIONS",
        "info": "",
        "x": 240,
        "y": 2115,
        "wires": []
    },
    {
        "id": "422c0e4e8c964482",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "RUN",
        "info": "",
        "x": 790,
        "y": 2745,
        "wires": []
    },
    {
        "id": "c3df1f96c4ccd8d6",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "DOWNTIME",
        "info": "",
        "x": 770,
        "y": 2820,
        "wires": []
    },
    {
        "id": "e53706c8bd9aadf5",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "MANUTENZIONE",
        "info": "",
        "x": 760,
        "y": 2895,
        "wires": []
    },
    {
        "id": "b12c9185cc37664b",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "SCARTO",
        "info": "",
        "x": 780,
        "y": 2970,
        "wires": []
    },
    {
        "id": "1b879dfc02869b3a",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "CARR. PRONTI",
        "info": "",
        "x": 750,
        "y": 3045,
        "wires": []
    },
    {
        "id": "5a06c1baf2210989",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "CHIAMATA",
        "info": "",
        "x": 780,
        "y": 2355,
        "wires": []
    },
    {
        "id": "4a15af8df8c577ea",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "PR. IN CARICO",
        "info": "",
        "x": 765,
        "y": 2490,
        "wires": []
    },
    {
        "id": "9a51ee5d15da287d",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "AVVIAMENTO",
        "info": "",
        "x": 770,
        "y": 2655,
        "wires": []
    },
    {
        "id": "c091b1c1e75df617",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "RITARDO AVV.",
        "info": "",
        "x": 760,
        "y": 2700,
        "wires": []
    },
    {
        "id": "223dfe7f51e5c702",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "8dfc8129d51e5740",
        "name": "programmedStateChanges",
        "mode": "link",
        "links": [
            "fb95b4d0741d8db8"
        ],
        "x": 1360,
        "y": 2490,
        "wires": [],
        "l": true
    },
    {
        "id": "4bf699bb76b64d11",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "programmedStateChanges",
        "mode": "link",
        "links": [
            "fb95b4d0741d8db8"
        ],
        "x": 1335,
        "y": 2745,
        "wires": [],
        "l": true
    },
    {
        "id": "51ccbb885d329fc3",
        "type": "link call",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "send setCellSignal",
        "links": [
            "c4016914ed4edfaf"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1110,
        "y": 2850,
        "wires": [
            [
                "7f3892b70e89d932"
            ]
        ]
    },
    {
        "id": "7f3892b70e89d932",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "toWebapp",
        "mode": "link",
        "links": [
            "29da4c340c1c0f16"
        ],
        "x": 1295,
        "y": 2850,
        "wires": [],
        "l": true
    },
    {
        "id": "9002b5da933a2cf0",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "programmedStateChanges",
        "mode": "link",
        "links": [
            "fb95b4d0741d8db8"
        ],
        "x": 1335,
        "y": 2820,
        "wires": [],
        "l": true
    },
    {
        "id": "e07363a0c58b13e0",
        "type": "link call",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "send setCellSignal",
        "links": [
            "c4016914ed4edfaf"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1110,
        "y": 2925,
        "wires": [
            [
                "a984ae5f89c982aa"
            ]
        ]
    },
    {
        "id": "a984ae5f89c982aa",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "toWebapp",
        "mode": "link",
        "links": [
            "29da4c340c1c0f16"
        ],
        "x": 1295,
        "y": 2925,
        "wires": [],
        "l": true
    },
    {
        "id": "be30f8352908de40",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "programmedStateChanges",
        "mode": "link",
        "links": [
            "fb95b4d0741d8db8"
        ],
        "x": 1335,
        "y": 2895,
        "wires": [],
        "l": true
    },
    {
        "id": "9b8b41e6232af923",
        "type": "link call",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "8dfc8129d51e5740",
        "name": "send setCellSignal",
        "links": [
            "c4016914ed4edfaf"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1110,
        "y": 3000,
        "wires": [
            [
                "6c7b45a7a15ce7ca"
            ]
        ]
    },
    {
        "id": "6c7b45a7a15ce7ca",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "8dfc8129d51e5740",
        "name": "toWebapp",
        "mode": "link",
        "links": [
            "29da4c340c1c0f16"
        ],
        "x": 1295,
        "y": 3000,
        "wires": [],
        "l": true
    },
    {
        "id": "19df9e22435f0986",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "8dfc8129d51e5740",
        "name": "programmedStateChanges",
        "mode": "link",
        "links": [
            "fb95b4d0741d8db8"
        ],
        "x": 1335,
        "y": 2970,
        "wires": [],
        "l": true
    },
    {
        "id": "647f4fe681027b71",
        "type": "link call",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "8dfc8129d51e5740",
        "name": "send setCellSignal",
        "links": [
            "c4016914ed4edfaf"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1110,
        "y": 3075,
        "wires": [
            [
                "7e254c27479ac8aa"
            ]
        ]
    },
    {
        "id": "7e254c27479ac8aa",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "8dfc8129d51e5740",
        "name": "toWebapp",
        "mode": "link",
        "links": [
            "29da4c340c1c0f16"
        ],
        "x": 1295,
        "y": 3075,
        "wires": [],
        "l": true
    },
    {
        "id": "eba758ecf77571c1",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "8dfc8129d51e5740",
        "name": "programmedStateChanges",
        "mode": "link",
        "links": [
            "fb95b4d0741d8db8"
        ],
        "x": 1335,
        "y": 3045,
        "wires": [],
        "l": true
    },
    {
        "id": "0346beccf473c1e3",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "bdb77fbf338dd270",
        "name": "towersControl isDefinedEvent",
        "mode": "link",
        "links": [],
        "x": 735,
        "y": 300,
        "wires": []
    },
    {
        "id": "7bfe34e4ff0695f7",
        "type": "link in",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "bdb77fbf338dd270",
        "name": "allMain isDefinedEvent out",
        "links": [
            "230aaa874077cfdc"
        ],
        "x": 705,
        "y": 105,
        "wires": [
            []
        ]
    },
    {
        "id": "6d5dd2c43db0ac78",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "bdb77fbf338dd270",
        "name": "signalCells isDefinedEvent",
        "mode": "link",
        "links": [],
        "x": 525,
        "y": 360,
        "wires": []
    },
    {
        "id": "33659be59b6e8244",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "bdb77fbf338dd270",
        "name": "about:config",
        "info": "//config file validation is independent from the classes architecture,\n    //as it's defined before both classes definition and instantiations\n//upon changing the class attributes contraints it's important to\n    //also update the json schemas responsible for that validation.",
        "x": 670,
        "y": 360,
        "wires": []
    },
    {
        "id": "46d363153b6d8510",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "g": "850adb4a2c8b2b3f",
        "name": "debug 21",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1110,
        "y": 1245,
        "wires": []
    },
    {
        "id": "4ded8b12586d3b31",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "850adb4a2c8b2b3f",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 445,
        "y": 1140,
        "wires": [
            [
                "5c0e00a893bdf288"
            ]
        ],
        "l": false
    },
    {
        "id": "3a53827df7fd9d3e",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "0739446a5011eb4d",
        "name": "poll 2s",
        "props": [],
        "repeat": "2",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "x": 235,
        "y": 1215,
        "wires": [
            []
        ]
    },
    {
        "id": "f752c42fe1293f98",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "bdb77fbf338dd270",
        "name": "set global buttonsControl",
        "func": "",
        "outputs": 1,
        "noerr": 0,
        "initialize": "\ncallWhenDef(()=>{\n    const signalKeys = global.get(\"signalCells\").dictionary.signalKeys;\n\n    const def = {\n        dictionary:{\n            /** {String[]} macKeys \"machine keys\". match the ones used in uibuilder's app. */\n            macKeys: global.get(\"signalCells\").dictionary.macKeys,\n            /**  {String[]} devices devices that may be associated with each towersBitArray bit*/\n            devices: [\"redBtn\", \"greenBtn\", \"whiteBtn\",\"blackBtn\"],\n            actKeys:[...(( )=>{ return signalKeys.map( v => \"set\"+v) })()]\n        },\n\n        actionOf:{\n            \"blackBtn\": \"setA1\", //chiamata\n            \"redBtn\": \"setD\", //scarto\n            \"greenBtn\": \"setB\", //run\n            \"whiteBtn\": \"setC1\", //downtime\n            \"whiteBtnTwice\": \"setC2\", //manut\n        },\n\n        // bitMap:{ //plcKey : {macKey, btnKey}\n        //     \"ZBRN1-23KF1\":[\n        //         {macKey:\"FA420\",btnKey:\"blackBtn\"}\n        //     ]\n        // },\n        // getBitMap(plcKey){\n        //     if(!this.bitMap[plcKey]){ node.error(\"[buttonsControl.getBitMap()]: unknown plcKey: \"+plcKey); return false;}\n        //     return this.bitMap;\n        // },\n\n        prepareActionMsg:function (msg, macKey, btnKey){\n            if(!this.actionOf[btnKey] || !this.dictionary.macKeys.includes(macKey))\n                node.error({ txt: \"unknown macKey or btnKey\", mac: macKey, btn: btnKey, msg: msg});\n            if(typeof msg != \"object\")\n                node.error({txt:\"expecting msg object, got\",v:msg});\n\n            node.warn(\"PRESSED \"+ btnKey + \" of \"+ macKey)\n            msg.topic=macKey;\n            if(btnKey == \"whiteBtn\" && global.get(\"signalCells\")[macKey].signalKey == \"C1\")\n                msg.action=this.actionOf[btnKey+\"Twice\"];\n            else\n                msg.action = this.actionOf[btnKey] ?? node.error(\"UNKNOWN BTNKEY\");\n            return msg;\n        }\n\n    }\n\n\n    global.set(\"buttonsControl\", def);\n    node.status({ fill: \"green\", text: Object.keys(def).join(' & ') });\n},\"utils\",\"signalCells\")\n\n/** @summary repeatedly tries to fetch all globalNames with global.get(). \n        * @param {function} cb called once ALL globalName are defined\n        * @param {Object} opts object holding optional function params. can be omitted passing the first globalName instead.\n        * @param {number} opts.timeout ms delay after which stop trying and either call opts.errorCb() or log an error. defaults to 15000\n        * @param {number} opts.retryDelay ms between each attempt. defaults to 100\n        * @param {function} opts.errorCb function to call after timeout. defaults to falsy, logging a warning\n        * @param  {...any} globalNames series of strings\n        */\nfunction callWhenDef(cb, opts, ...globalNames) {\n    if (typeof (opts) == \"string\")\n        globalNames.push(opts);\n    let { timeout: timeout = 3000, retryDelay: retryDelay = 100, errorCb: errorCb = null } = (typeof (opts) == \"string\" ? opts : {});\n    var tout, intv;\n    //set timeout unless false or not specified\n    if (timeout) {\n        tout = setTimeout(() => {\n            clearInterval(intv);\n            errorCb ? errorCb() : node.warn({ err: \"callWhenDef_Timeout\", arg: arguments })\n        }, timeout);\n    }\n    //set global-chacking interval\n    intv = setInterval(() => {\n        for (let name of globalNames)\n            if (global.get(name) === undefined || global.get(name) === null)\n                return\n        clearTimeout(tout);\n        clearInterval(intv);\n        cb();\n    }, retryDelay)\n}\n\n/*** tests * /\ncallWhenDef(()=>{\n    node.warn(\"[buttonsControl] begin testing\");\n    const utils = global.get(\"utils\");\n    const buttonsControl = global.get(\"buttonsControl\");\n    var results = {};\n\n    //try prepareActionMsg with all dev and macs\n    node.warn(\"[buttonsControl] prepMsgs\");\n    results.prepMsgs = [];\n    for(let dev of buttonsControl.dictionary.devices){\n        for(let mKey of buttonsControl.dictionary.macKeys)\n            results.prepMsgs.push(buttonsControl.prepareActionMsg({},mKey,dev))\n    }\n\n    //try wrong mac and Devs\n    node.warn(\"[buttonsControl] expected fails\");\n    results.fails = [];\n    results.fails.push(buttonsControl.prepareActionMsg({},\"noMac\", buttonsControl.dictionary.devices[0]))\n    results.fails.push(buttonsControl.prepareActionMsg({},buttonsControl.dictionary.macKeys[0],\"noDev\"))\n    node.warn(results);\n\n    \n\n},\"utils\",\"buttonsControl\")\n/**/\n",
        "finalize": "",
        "libs": [],
        "x": 220,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "a6c649bfeb643683",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "850adb4a2c8b2b3f",
        "name": "parse button MWord",
        "func": "//will output { topic:\"buttonClick\", isKeyUp buttonId:\"setC1\", payload:keyUp }\n            //{ topic:, buttonName: \"uib_setA3\"}\n            //{ topic:\"OMET\", action:\"setC1\"}\n\n/* const getActionMsg = (function () {\n    const f = global.get(\"btnControl\").prepareActionMsg.bind(global.get(\"btnControl\"));\n    return function (...args) { return f({},...args) }\n})(); */\n\nfunction prepareActionMsg(...args){\n    return global.get(\"buttonControl\").prepareActionMsg({},...args)\n}\n\nconst bitMap=[\n    ()=>{ node.send(prepareActionMsg(msg,\"OMET\",\"red\")) },\n    ()=>{},\n    ()=>{},\n    ()=>{},\n\n    ()=>{},\n    ()=>{},\n    ()=>{},\n    ()=>{},\n\n    ()=>{},\n    ()=>{},\n    ()=>{},\n    ()=>{},\n\n    ()=>{},\n    ()=>{},\n    ()=>{},\n    ()=>{},\n]\nconst bitArr = intArrToBitArray(msg.payload.buffer);\nbitArr.forEach((bit, i) => { if(bit) bitMap[i]() })\n\n//let buf = msg.buffer;\nlet buf = Buffer.from( new Uint8Array([5,9]) );\n\nfunction bitArrToString(arr) {\n    var str = \"\";\n    for (let i = 0; i < arr.length; i++) {\n        if (i % 4 == 0 && i)\n            str += \"|\"\n        str += parseInt(0+arr[i]) + \",\";\n    }\n    return str;\n}\n\n//buf[15] <=> bit[15]\nfunction bufToBitArray(buf){\n    var octStrs = [],\n        bitArr = [];\n    //buf to array of strings\n    for(let oct of buf )\n        octStrs.push(oct.toString(2).padStart(8,'0'));\n    //arr of strings to array of bits\n    for(let octStr of octStrs)\n        for(let i=0; i<octStr.length; i++)\n            bitArr.push(octStr[i]=='0' ? 0 : 1)\n            \n    node.warn({o:octStrs.toString(),b:bitArr.toString(), \"octStrs\": octStrs, bitArr: bitArr })\n    return bitArr;\n}\n\n\n\nfor(let i=0;i<1;i++)\n    node.warn( intToBitArray(300).toString() )\n\nfunction intArrToBitArray(arr){\n    var ret=[]\n    for(let val of arr)\n        ret.push(intToBitArray(val))\n    return ret;\n}\n\nfunction intToBitArray(val){\n    var bitArr=[];\n\n    if (typeof (val) != \"number\" || val % 1 != 0) throw new TypeError(`[${intToBitArray.name}()]:val must be an integer number`);\n    //trova il primo ottetto != 0\n    /*var minBytes=4-1; //stops 1 too early\n    for(let i=0; i<4 && (val>>(32-8*i))!=0; i++)\n        minBytes--;\n    node.warn({minBytes:minBytes,for:val})\n    */\n   \n    let nByte=0;\n    do{\n        //copia un bit alla volta * 8bit\n        for (let i = 0; i<8; i++)\n            bitArr.push((val >> i) & 0x00000001);\n        nByte++;\n        //node.warn(nByte);node.warn(val >> 8*nByte)\n        if (nByte >= 50) throw new Error(\"triggered infinite loop guard. possible infinite loop at \" + intToBitArray.name);\n    }while(val >> 8*nByte)\n    \n    return bitArr;\n}\n\n/* let arr=[];\nfor(let i=0,s=0xAA.toString(2).padStart(16,'0'); i<s.length;i++)\n    arr.push(parseInt(s[i])) */\n\n\nnode.warn({\n    \"intToBit\": intArrToBitArray(msg.payload.buffer).toString(), \n    \"arrToArr\": bitArrToString(bufToBitArray(msg.payload.buffer))\n})\n\nconst bitArr=intArrToBitArray(msg.payload.buffer)\n\nconst btnActionMsg(action){\n    return {action:action}\n}\n\nconst cbMap=[\n    ()=>{},\n    ()=>{},\n    ()=>{},\n    ()=>{},\n\n    ()=>{},\n    ()=>{},\n    ()=>{},\n    ()=>{},\n\n    ()=>{},\n    ()=>{},\n    ()=>{},\n    ()=>{},\n\n    ()=>{},\n    ()=>{},\n    ()=>{},\n    ()=>{},\n]\n\nbitArr.forEach( (bit,i) => node.send(bitMap[i])) )\n\nfor(let i=0; i<bitArr.length; i++)\n    if(bitArr[i])\n        node.send(cbMap[i]())\n\n//embed switch in this funcion, setting up 1 output per expected bit (16 outputs)\n    //node.send(bitArr.forEach((bit,i) => (bit ? cbMap[i]() : null )))\n\n\n/*node.warn(\"msg received\")\nnode.warn(buf)\nnode.warn(buf.buffer)\nnode.warn(bitArrToString(bufToBitArray([0xAA, 0xAA]))) */",
        "outputs": 1,
        "noerr": 12,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1180,
        "y": 1095,
        "wires": [
            [
                "24e2c705e5d0bfae"
            ]
        ]
    },
    {
        "id": "151bd4bef68fb344",
        "type": "link in",
        "z": "bdc10eb0bfc2c224",
        "g": "850adb4a2c8b2b3f",
        "name": "parse button MWord",
        "links": [],
        "x": 1045,
        "y": 1095,
        "wires": [
            [
                "a6c649bfeb643683",
                "c50916d0843fee5f"
            ]
        ]
    },
    {
        "id": "24e2c705e5d0bfae",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "850adb4a2c8b2b3f",
        "name": "parse button MWord",
        "mode": "return",
        "links": [],
        "x": 1315,
        "y": 1095,
        "wires": []
    },
    {
        "id": "bf3dfc1317546dfe",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "6bbed1acc7ad0f13",
        "name": "INTERCETTA FRONTE SALITA BOTTONI",
        "info": "",
        "x": 240,
        "y": 975,
        "wires": []
    },
    {
        "id": "bb2cd2bb28981c9f",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "850adb4a2c8b2b3f",
        "name": "23KF1",
        "info": "",
        "x": 165,
        "y": 1050,
        "wires": []
    },
    {
        "id": "1fa3691ff9f12038",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "850adb4a2c8b2b3f",
        "name": "4xbtn x 6 machines",
        "info": "",
        "x": 340,
        "y": 1050,
        "wires": []
    },
    {
        "id": "1255172cf854afec",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "ec19ad21051125fc",
        "name": "buttonActions out",
        "mode": "link",
        "links": [
            "f4db294021a89fbf",
            "4bd7236cd1df5691"
        ],
        "x": 1590,
        "y": 1485,
        "wires": [],
        "l": true
    },
    {
        "id": "cabac255e0eba1ed",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "c4073df7edfaef3f",
        "name": "#dbg toggle",
        "info": "",
        "x": 230,
        "y": 1425,
        "wires": []
    },
    {
        "id": "918e9e4d95437fe6",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "c4073df7edfaef3f",
        "name": "toggle",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "control",
        "payload": "toggle",
        "payloadType": "str",
        "x": 250,
        "y": 1455,
        "wires": [
            [
                "eef65e8f494a1fdd"
            ]
        ]
    },
    {
        "id": "eef65e8f494a1fdd",
        "type": "gate",
        "z": "bdc10eb0bfc2c224",
        "g": "c4073df7edfaef3f",
        "name": "",
        "controlTopic": "control",
        "defaultState": "open",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 355,
        "y": 1485,
        "wires": [
            [
                "59550c61bf94ee85"
            ]
        ],
        "l": false
    },
    {
        "id": "0bd89aed5e41568c",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "c4073df7edfaef3f",
        "name": "poll 0.35s",
        "props": [],
        "repeat": "0.35",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "x": 230,
        "y": 1485,
        "wires": [
            [
                "eef65e8f494a1fdd"
            ]
        ]
    },
    {
        "id": "93d9ed47f60be558",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "c4073df7edfaef3f",
        "name": "poll 2s",
        "props": [],
        "repeat": "2",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "x": 235,
        "y": 1515,
        "wires": [
            []
        ]
    },
    {
        "id": "d88e1b5db6941c84",
        "type": "catch",
        "z": "bdc10eb0bfc2c224",
        "g": "5bff6168e9472a61",
        "name": "mutePLCQueryTimeout",
        "scope": [
            "32847fc57a5ed7c0"
        ],
        "uncaught": false,
        "x": 795,
        "y": 1455,
        "wires": [
            []
        ]
    },
    {
        "id": "32847fc57a5ed7c0",
        "type": "link call",
        "z": "bdc10eb0bfc2c224",
        "g": "5bff6168e9472a61",
        "name": "",
        "links": [
            "8aa45b3643dc2319"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 865,
        "y": 1485,
        "wires": [
            [
                "7571ab79f4e90947",
                "309b3f04cd19fbeb"
            ]
        ]
    },
    {
        "id": "e3d7e8461568f1ea",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "g": "ec19ad21051125fc",
        "name": "BUTTON PRESSED #2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1505,
        "y": 1440,
        "wires": []
    },
    {
        "id": "9b15c0fff22138f8",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "ec19ad21051125fc",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 445,
        "y": 1440,
        "wires": [
            [
                "59550c61bf94ee85"
            ]
        ],
        "l": false
    },
    {
        "id": "7571ab79f4e90947",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "g": "ec19ad21051125fc",
        "name": "debug 22",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1045,
        "y": 1545,
        "wires": []
    },
    {
        "id": "87adc43de870c9df",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "ec19ad21051125fc",
        "name": "23KF2",
        "info": "",
        "x": 165,
        "y": 1350,
        "wires": []
    },
    {
        "id": "f5cfa0e2f908948c",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "ec19ad21051125fc",
        "name": "1xbtn x 2 machines",
        "info": "solo neri su M041 m042\n\n(PB7,PB8)x(M041,M042)",
        "x": 340,
        "y": 1350,
        "wires": []
    },
    {
        "id": "dc8955434a4b3150",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "g": "850adb4a2c8b2b3f",
        "name": "BUTTON PRESSED",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1490,
        "y": 1140,
        "wires": []
    },
    {
        "id": "e9116e554f7d574d",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "850adb4a2c8b2b3f",
        "name": "buttonActions out",
        "mode": "link",
        "links": [
            "f4db294021a89fbf",
            "4bd7236cd1df5691"
        ],
        "x": 1585,
        "y": 1185,
        "wires": [],
        "l": true
    },
    {
        "id": "4bd7236cd1df5691",
        "type": "link in",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "34b9888e09adea38",
        "name": "log buttonActions in",
        "links": [
            "1255172cf854afec",
            "185fc4dc4d7ebafc",
            "e9116e554f7d574d"
        ],
        "x": 215,
        "y": 1860,
        "wires": [
            [
                "6d7d2735b6b0a030"
            ]
        ],
        "l": true
    },
    {
        "id": "6d7d2735b6b0a030",
        "type": "switch",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "34b9888e09adea38",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 380,
        "y": 1860,
        "wires": [
            [
                "daf05c945ad24c81"
            ]
        ],
        "l": false
    },
    {
        "id": "93c23451c602fbeb",
        "type": "file",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "34b9888e09adea38",
        "name": "",
        "filename": ".\\buttonUsageLog.log",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 780,
        "y": 1860,
        "wires": [
            [
                "c11db00ddad03312"
            ]
        ]
    },
    {
        "id": "daf05c945ad24c81",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "34b9888e09adea38",
        "name": "prepare log",
        "func": "\nconst dateFns=global.get(\"dateFns\");\n\nfunction safeStringify(obj) {\n    var cache = [];\n    var cacheKeys = [];\n    return JSON.stringify(obj, (key, value) => {\n        if (typeof value === 'object' && value !== null) {\n            //Duplicate reference found -> discard key / store\n            const idx = cache.indexOf(value)\n            //if duplicate found\n            //return twin's key instead\n            if (idx != -1) //-1 means not present\n                return \"dupOf_\" + (cacheKeys[idx].toString() ?? \"root\");\n            //else store it\n            else {\n                cache.push(value);\n                cacheKeys.push(key);\n            }\n        }\n        return value;\n    });\n}\n\ndelete msg._msgid\ndelete msg._event\nlet timeString = dateFns.format(new Date(), \"yyyy-MM-dd HH:mm:ss.SSS\");\n//msg.payload = {time:timeString, ms:Date.now(), msg:safeStringify(msg)};\n\nmsg.payload = `${timeString}   :   ${safeStringify(msg)}`\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 1860,
        "wires": [
            [
                "93c23451c602fbeb"
            ]
        ]
    },
    {
        "id": "66848166715e3f45",
        "type": "change",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "34b9888e09adea38",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "error",
                "pt": "msg",
                "to": "unknAction",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 1920,
        "wires": [
            [
                "6d7d2735b6b0a030"
            ]
        ]
    },
    {
        "id": "480c07eb7000581f",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "34b9888e09adea38",
        "name": "on missing file -> write default one",
        "info": "",
        "x": 570,
        "y": 1755,
        "wires": []
    },
    {
        "id": "f319a8245cc52c95",
        "type": "catch",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "34b9888e09adea38",
        "name": "",
        "scope": [
            "93c23451c602fbeb"
        ],
        "uncaught": false,
        "x": 490,
        "y": 1785,
        "wires": [
            [
                "e0693091fbc2ade5"
            ]
        ]
    },
    {
        "id": "e0693091fbc2ade5",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "34b9888e09adea38",
        "name": "catch buttonUsageLog fileNotFound",
        "func": "\nif(/ENOENT/.test(msg.error.message) && !context.get(\"triedOnce\")){\n    context.set(\"triedOnce\",true);\n    global.get(\"utils\").errorBlink(node, 60000);\n    return msg;\n}\nelse{\n    return [null,msg]\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\ncontext.set(\"triedOnce\",undefined)",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 1785,
        "wires": [
            [
                "3345276a11da0361"
            ],
            [
                "2adc99b74387df87"
            ]
        ]
    },
    {
        "id": "2adc99b74387df87",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "34b9888e09adea38",
        "name": "catch buttonUsageLog all",
        "func": "\n\nif(msg.error){\n    node.error({ \"err\": msg.error.message, \"src\": msg.error.source.id, \"n\": msg.error.source.name, \"full\": msg });\n    //context.set(\"errorCc\", context.get(\"errorCc\")+1);\n    global.get(\"utils\").errorBlink(node, 60000);\n}\nelse{\n    node.error(msg);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\n//node.status({ fill: \"gray\", shape: \"ring\", text: \"\" });\ncontext.set(\"outCc\", 0);\ncontext.set(\"errorCc\", 0);",
        "finalize": "",
        "libs": [],
        "x": 705,
        "y": 1815,
        "wires": [
            []
        ]
    },
    {
        "id": "3345276a11da0361",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "34b9888e09adea38",
        "name": "create default",
        "func": "node.warn(\"buttonUsageLog.log not found: creating new one\")\nreturn {payload:{}}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 1785,
        "wires": [
            [
                "555a3c206a075575"
            ]
        ]
    },
    {
        "id": "555a3c206a075575",
        "type": "json",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "34b9888e09adea38",
        "name": "",
        "property": "payload",
        "action": "str",
        "pretty": true,
        "x": 1120,
        "y": 1785,
        "wires": [
            [
                "673352e50b72aacf"
            ]
        ],
        "l": false
    },
    {
        "id": "673352e50b72aacf",
        "type": "file",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "34b9888e09adea38",
        "name": "",
        "filename": ".\\buttonUsageLog.log",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1235,
        "y": 1785,
        "wires": [
            [
                "451ff0cef17fea29"
            ]
        ]
    },
    {
        "id": "32a9a6570629a3b5",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "34b9888e09adea38",
        "name": "TMP DBG LOGGING",
        "info": "",
        "x": 230,
        "y": 1755,
        "wires": []
    },
    {
        "id": "ab54e887033a3563",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "34b9888e09adea38",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 215,
        "y": 1815,
        "wires": [
            [
                "6d7d2735b6b0a030"
            ]
        ]
    },
    {
        "id": "c11db00ddad03312",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "34b9888e09adea38",
        "name": "WRITTEN BUTTON LOG",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 1860,
        "wires": []
    },
    {
        "id": "451ff0cef17fea29",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "34b9888e09adea38",
        "name": "CREATED NEW BUTTON LOG",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1475,
        "y": 1785,
        "wires": []
    },
    {
        "id": "d7a2c75afa019028",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "BUTTON SET A1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1645,
        "y": 2355,
        "wires": []
    },
    {
        "id": "9250c631a78ab33a",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "BUTTON SET A2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1650,
        "y": 2490,
        "wires": []
    },
    {
        "id": "ba11515a04cebd32",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "BUTTON SET A3",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1650,
        "y": 2655,
        "wires": []
    },
    {
        "id": "6f13a43d49cbb006",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "BUTTON SET A4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1650,
        "y": 2700,
        "wires": []
    },
    {
        "id": "590b85c6d709bc3a",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "BUTTON SET C1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1650,
        "y": 2820,
        "wires": []
    },
    {
        "id": "76bd5f8638bf1573",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "BUTTON SET C2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1650,
        "y": 2895,
        "wires": []
    },
    {
        "id": "0e0aa465724c5b30",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "BUTTON SET D",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1650,
        "y": 2970,
        "wires": []
    },
    {
        "id": "bd11511613590ced",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "BUTTON SET E",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1650,
        "y": 3045,
        "wires": []
    },
    {
        "id": "7e325d321fc3cadb",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "BUTTON SET B",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1645,
        "y": 2745,
        "wires": []
    },
    {
        "id": "481bde1a0ce6c86d",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "bdb77fbf338dd270",
        "name": "interpretazione pulsantiere",
        "info": "",
        "x": 515,
        "y": 420,
        "wires": []
    },
    {
        "id": "c50916d0843fee5f",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "850adb4a2c8b2b3f",
        "name": "parse button MWord and send buttonContolActionMsg",
        "func": "//will output { topic:\"OMET\", action:\"setC1\"}\n\n/** @summary converts a single integer number to its binary array rappresentation\n * @param {number} val integer\n * @return {number[]} array of NUMBERS, only 0 and 1\n * @throws TypeError if val is not an integer\n * @throws Error if detects possible infinite loop\n */\nfunction intToBitArray(val) {\n    var bitArr = [];\n\n    if (typeof (val) != \"number\" || val % 1 != 0) throw new TypeError(`[${intToBitArray.name}()]:val must be an integer number`);\n    //trova il primo ottetto != 0\n    /*var minBytes=4-1; //stops 1 too early\n    for(let i=0; i<4 && (val>>(32-8*i))!=0; i++)\n        minBytes--;\n    node.warn({minBytes:minBytes,for:val})\n    */\n\n    let nByte = 0;\n    do {\n        //copia un bit alla volta * 8bit\n        for (let i = 0; i < 8; i++)\n            bitArr.push((val >> i) & 0x00000001);\n        nByte++;\n        //node.warn(nByte);node.warn(val >> 8*nByte)\n        if (nByte >= 50) throw new Error(\"triggered infinite loop guard. possible infinite loop at \" + intToBitArray.name);\n    } while (val >> 8 * nByte)\n\n    return bitArr;\n}\n\nfunction intArrToBitArray(arr) {\n    var ret = []\n    for (let val of arr)\n        ret.push(intToBitArray(val))\n    return ret;\n}\n\n//---------------------------------------------------------------------------------------------\nlet bitMap = msg.bitMap;\nconst NBITS = bitMap.length;\n\nconst last = context.get(\"bitArray\") ?? (new Array(NBITS)).map( v => 0 );\ntry{\n    var bitArr = intArrToBitArray(msg.payload.buffer);\n    if(!bitArr || bitArr.length < NBITS)\n        throw new Error(\"bitArr parsing failed\");\n}catch(e) { node.error(null, e); return}\n\nbitArr.forEach((bit, i) => {\n    if(bit && bit != last[i])\n        bitMap[i]()\n});\ncontext.set(\"bitArray\",bitArr);\n\n/*\n//let buf = msg.buffer;\nlet buf = Buffer.from( new Uint8Array([5,9]) );\n\nfunction bitArrToString(arr) {\n    var str = \"\";\n    for (let i = 0; i < arr.length; i++) {\n        if (i % 4 == 0 && i)\n            str += \"|\"\n        str += parseInt(0+arr[i]) + \",\";\n    }\n    return str;\n}\n\n//buf[15] <=> bit[15]\nfunction bufToBitArray(buf){\n    var octStrs = [],\n        bitArr = [];\n    //buf to array of strings\n    for(let oct of buf )\n        octStrs.push(oct.toString(2).padStart(8,'0'));\n    //arr of strings to array of bits\n    for(let octStr of octStrs)\n        for(let i=0; i<octStr.length; i++)\n            bitArr.push(octStr[i]=='0' ? 0 : 1)\n            \n    node.warn({o:octStrs.toString(),b:bitArr.toString(), \"octStrs\": octStrs, bitArr: bitArr })\n    return bitArr;\n}\n\n\n\nfor(let i=0;i<1;i++)\n    node.warn( intToBitArray(300).toString() )\n\n\n\n\n/* let arr=[];\nfor(let i=0,s=0xAA.toString(2).padStart(16,'0'); i<s.length;i++)\n    arr.push(parseInt(s[i])) * /\n\n\nnode.warn({\n    \"intToBit\": intArrToBitArray(msg.payload.buffer).toString(), \n    \"arrToArr\": bitArrToString(bufToBitArray(msg.payload.buffer))\n})\n\nconst bitArr=intArrToBitArray(msg.payload.buffer)\n\nconst btnActionMsg(action){\n    return {action:action}\n}\n\nconst cbMap=[\n    ()=>{},\n    ()=>{},\n    ()=>{},\n    ()=>{},\n\n    ()=>{},\n    ()=>{},\n    ()=>{},\n    ()=>{},\n\n    ()=>{},\n    ()=>{},\n    ()=>{},\n    ()=>{},\n\n    ()=>{},\n    ()=>{},\n    ()=>{},\n    ()=>{},\n]\n\nbitArr.forEach( (bit,i) => node.send(bitMap[i])) )\n\nfor(let i=0; i<bitArr.length; i++)\n    if(bitArr[i])\n        node.send(cbMap[i]())\n\n//embed switch in this funcion, setting up 1 output per expected bit (16 outputs)\n    //node.send(bitArr.forEach((bit,i) => (bit ? cbMap[i]() : null )))\n\n\n/*node.warn(\"msg received\")\nnode.warn(buf)\nnode.warn(buf.buffer)\nnode.warn(bitArrToString(bufToBitArray([0xAA, 0xAA]))) */",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1220,
        "y": 1050,
        "wires": [
            [
                "0bc5c4867bcc4cfc"
            ]
        ]
    },
    {
        "id": "ecc8fa86b61f20b9",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "850adb4a2c8b2b3f",
        "name": "parse button MWord and send buttonContolActionMsg",
        "func": "//will output { topic:\"OMET\", action:\"setC1\"}\n\n//should receive a stream of bits at least bitMap.length long\n    //if received.len < bitMap.len -> warn & append zeros to received\n    //if received.len > bitMap.len -> silently use only the first bitMap.len bits \n\n\n\n/* const getActionMsg = (function () {\n    const f = global.get(\"btnControl\").prepareActionMsg.bind(global.get(\"btnControl\"));\n    return function (...args) { return f({},...args) }\n})(); */\n\nfunction prepareActionMsg(...args) {\n    return global.get(\"buttonsControl\").prepareActionMsg(new Object(), ...args)\n}\n\n/** associates a function to each bit retrieved from the ZBRN1.\n * - the f() will send a message like {topic: 'OMET', payload:'setC1'} aka { macKey,  btnActId }\n */\nconst bitMap = [\n    //PB1\n    ()=>{ node.send(prepareActionMsg(\"FA421\", \"redBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA421\", \"greenBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA421\", \"whiteBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA421\", \"blackBtn\")) },\n    //PB2\n    ()=>{ node.send(prepareActionMsg(\"FA420\", \"redBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA420\", \"greenBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA420\", \"whiteBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA420\", \"blackBtn\")) },\n\n\n    //PB3 //8+\n    ()=>{ node.send(prepareActionMsg(\"FA419\", \"redBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA419\", \"greenBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA419\", \"whiteBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA419\", \"blackBtn\")) },\n    //PB4\n    ()=>{ node.send(prepareActionMsg(\"FA422\", \"redBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA422\", \"greenBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA422\", \"whiteBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA422\", \"blackBtn\")) },\n\n\n    //PB5 //16+\n    ()=>{ node.send(prepareActionMsg(\"FA423\", \"redBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA423\", \"greenBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA423\", \"whiteBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA423\", \"blackBtn\")) },\n    //PB6\n    ()=>{ node.send(prepareActionMsg(\"OMET\", \"redBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"OMET\", \"greenBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"OMET\", \"whiteBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"OMET\", \"blackBtn\")) },\n];\nconst NBITS = bitMap.length;\n\n//convert to bit array\ntry{\n    var bitArr = intArrToBitArray(msg.payload.buffer);\n    if(!bitArr || bitArr.length < NBITS){\n        node.warn({ txt: \"INCONSISTENT BITARR-BITMAP LENGTHS appended 0s\", bitArr: bitArr, bitMap:bitMap,buf:msg.payload.buffer,fullMsg:msg})\n        for(let i=bitArr.length;i<bitMap.length;i++)\n            bitArr.push(0);\n    }\n}catch(e) { node.error(e, e); return}\n\n//map to bitMap functions\nconst last = context.get(\"bitArray\") ?? (new Array(NBITS)).fill(0);\n//node.warn({\"bitArr\":bitArr.toString(),\"last\":last.toString()});\n\nfor(let i=0; i<NBITS; i++){\n    if(bitArr[i] && bitArr[i] != last[i]){\n        bitMap[i]()\n    }\n};\ncontext.set(\"bitArray\",bitArr);\n\n\n//------FUNCTIONS-------------------------------------------------------------------------------------------\n\n\n/** @summary converts a single integer number to its binary array rappresentation\n * @param {number} val integer\n * @return {number[]} array of NUMBERS, only 0 and 1\n * @throws TypeError if val is not an integer\n * @throws Error if detects possible infinite loop\n */\nfunction intToBitArray(val) {\n    var bitArr = [];\n\n    if (typeof (val) != \"number\" || val % 1 != 0) throw new TypeError(`[${intToBitArray.name}()]:val must be an integer number`);\n    //trova il primo ottetto != 0\n    /*var minBytes=4-1; //stops 1 too early\n    for(let i=0; i<4 && (val>>(32-8*i))!=0; i++)\n        minBytes--;\n    node.warn({minBytes:minBytes,for:val})\n    */\n\n    let nByte = 0;\n    do {\n        //copia un bit alla volta * 8bit\n        for (let i = 0; i < 8; i++)\n            bitArr.push((val >> i) & 0x00000001);\n        nByte++;\n        //node.warn(nByte);node.warn(val >> 8*nByte)\n        if (nByte >= 50) throw new Error(\"triggered infinite loop guard. possible infinite loop at \" + intToBitArray.name);\n    } while (val >> 8 * nByte)\n\n    return bitArr;\n}\n\nfunction intArrToBitArray(arr) {\n    var ret = []\n    for (let val of arr)\n        intToBitArray(val).forEach(bit => ret.push(bit))\n    return ret;\n}\n\n\n\n\n\n\n/*\n//let buf = msg.buffer;\nlet buf = Buffer.from( new Uint8Array([5,9]) );\n\nfunction bitArrToString(arr) {\n    var str = \"\";\n    for (let i = 0; i < arr.length; i++) {\n        if (i % 4 == 0 && i)\n            str += \"|\"\n        str += parseInt(0+arr[i]) + \",\";\n    }\n    return str;\n}\n\n//buf[15] <=> bit[15]\nfunction bufToBitArray(buf){\n    var octStrs = [],\n        bitArr = [];\n    //buf to array of strings\n    for(let oct of buf )\n        octStrs.push(oct.toString(2).padStart(8,'0'));\n    //arr of strings to array of bits\n    for(let octStr of octStrs)\n        for(let i=0; i<octStr.length; i++)\n            bitArr.push(octStr[i]=='0' ? 0 : 1)\n            \n    node.warn({o:octStrs.toString(),b:bitArr.toString(), \"octStrs\": octStrs, bitArr: bitArr })\n    return bitArr;\n}\n\n\n\nfor(let i=0;i<1;i++)\n    node.warn( intToBitArray(300).toString() )\n\n\n\n\n/* let arr=[];\nfor(let i=0,s=0xAA.toString(2).padStart(16,'0'); i<s.length;i++)\n    arr.push(parseInt(s[i])) * /\n\n\nnode.warn({\n    \"intToBit\": intArrToBitArray(msg.payload.buffer).toString(), \n    \"arrToArr\": bitArrToString(bufToBitArray(msg.payload.buffer))\n})\n\nconst bitArr=intArrToBitArray(msg.payload.buffer)\n\nconst btnActionMsg(action){\n    return {action:action}\n}\n\nconst cbMap=[\n    ()=>{},\n    ()=>{},\n    ()=>{},\n    ()=>{},\n\n    ()=>{},\n    ()=>{},\n    ()=>{},\n    ()=>{},\n\n    ()=>{},\n    ()=>{},\n    ()=>{},\n    ()=>{},\n\n    ()=>{},\n    ()=>{},\n    ()=>{},\n    ()=>{},\n]\n\nbitArr.forEach( (bit,i) => node.send(bitMap[i])) )\n\nfor(let i=0; i<bitArr.length; i++)\n    if(bitArr[i])\n        node.send(cbMap[i]())\n\n//embed switch in this funcion, setting up 1 output per expected bit (16 outputs)\n    //node.send(bitArr.forEach((bit,i) => (bit ? cbMap[i]() : null )))\n\n\n/*node.warn(\"msg received\")\nnode.warn(buf)\nnode.warn(buf.buffer)\nnode.warn(bitArrToString(bufToBitArray([0xAA, 0xAA]))) */",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 1185,
        "wires": [
            [
                "e9116e554f7d574d",
                "dc8955434a4b3150"
            ]
        ]
    },
    {
        "id": "9feae499c20cf1f4",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "850adb4a2c8b2b3f",
        "name": "set bitMap",
        "func": "\n\n/* const getActionMsg = (function () {\n    const f = global.get(\"btnControl\").prepareActionMsg.bind(global.get(\"btnControl\"));\n    return function (...args) { return f({},...args) }\n})(); */\n\nfunction prepareActionMsg(...args) {\n    return global.get(\"buttonControl\").prepareActionMsg(new Object(), ...args)\n}\nmsg.payload = { buffer:[5,16]}\nmsg.bitMap = [\n    ()=>{ node.send(prepareActionMsg(\"FA421\", \"redBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA421\", \"greenBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA421\", \"whiteBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA421\", \"blackBtn\")) },\n\n    ()=>{ node.send(prepareActionMsg(\"FA420\", \"redBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA420\", \"greenBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA420\", \"whiteBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA420\", \"blackBtn\")) },\n\n\n    ()=>{ node.send(prepareActionMsg(\"FA419\", \"redBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA419\", \"greenBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA419\", \"whiteBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA419\", \"blackBtn\")) },\n\n    ()=>{ node.send(prepareActionMsg(\"FA422\", \"redBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA422\", \"greenBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA422\", \"whiteBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA422\", \"blackBtn\")) },\n\n\n    ()=>{ node.send(prepareActionMsg(\"FA423\", \"redBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA423\", \"greenBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA423\", \"whiteBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"FA423\", \"blackBtn\")) },\n\n    ()=>{ node.send(prepareActionMsg(\"OMET\", \"redBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"OMET\", \"greenBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"OMET\", \"whiteBtn\")) },\n    ()=>{ node.send(prepareActionMsg(\"OMET\", \"blackBtn\")) },\n]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 900,
        "y": 1050,
        "wires": [
            [
                "c50916d0843fee5f"
            ]
        ]
    },
    {
        "id": "0bc5c4867bcc4cfc",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "850adb4a2c8b2b3f",
        "name": "BUTTON PRESSED",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1545,
        "y": 1050,
        "wires": []
    },
    {
        "id": "fd541a45a97d5863",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "850adb4a2c8b2b3f",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 755,
        "y": 1050,
        "wires": [
            [
                "9feae499c20cf1f4"
            ]
        ]
    },
    {
        "id": "e7383c98105037f7",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "850adb4a2c8b2b3f",
        "name": "test all bits",
        "func": "\nfor(let i = 0 ; i<8; i++)\n    setTimeout(()=>{node.send({payload:{buffer:[Math.pow(2,i), 0, 0]}}) }, 100*i)\nfor(let i = 0 ; i<8; i++)\n    setTimeout(() => { node.send({ payload: { buffer: [0, Math.pow(2, i), 0] }})}, 800+100*i );\nfor(let i = 0 ; i<8; i++)\n    setTimeout(() => { node.send({ payload: { buffer: [0, 0, Math.pow(2, i)] }})}, 800*2+100*i );\n    \n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 1245,
        "wires": [
            [
                "ecc8fa86b61f20b9"
            ]
        ]
    },
    {
        "id": "d729db698e92eca4",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "850adb4a2c8b2b3f",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 765,
        "y": 1245,
        "wires": [
            [
                "e7383c98105037f7"
            ]
        ],
        "l": false
    },
    {
        "id": "6a8c1e1167beac9f",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "name": "_uib showToast",
        "func": "return {\n    topic:\"dbgData\",\n    payload:msg\n}\n\n\n\n\n\n/* //from http://127.0.0.1:1880/uibuilder/techdocs/#/pre-defined-msgs?id=vuejs-ui-notification-toast-control-message\n{\n    \"_uib\": {  // Required. VueJS Component data    \n        \"componentRef\": \"globalNotification\", // Required.\n        // options object is optional. Options are passed directly to the bootstra-vue `<toast>` component.\n        // These are examples only.\n        \"options\": { // all of the entries are optional.\n            // Creates a title section above the content that is highlighted\n            \"title\": \"This is the <i>title</i>\",\n            // Main message content (appears after any payload). May contain HTML.\n            \"content\": \"This is content <span style=\\\"color:red;\\\">in addition to</span> the payload\",\n            // Default false. If true stops auto-Hide. \n            // Click on the close button (BV) to remove the toast.\n            // For non-BV, click on box to clear it or on background to clear all.\n            \"noAutoHide\": true,\n            // 5000 by default, how long the message stays on-screen. Hover over message to pause countdown.\n            \"autoHideDelay\": 1500,\n            // Optional colour variant. error, warning, info, primary, secondary, success\n            \"variant\": \"info\",\n            // Default display is semi-transparent (BV only), set this to true to make the message solid colour.\n            \"solid\": true,\n\n            // BV Only. New message appears above old by default (false), change to true to add to the bottom instead.\n            \"append\": true,\n            // BV Only. If present, the whole message is turned into a link. Click takes the client to the URL.\n            \"href\": \"https://bbc.co.uk\",\n            // BV Only. Controls where on the page the toast appears. Several standard locations are available.\n            // default is top-right. Custom positions can be set by including a <toaster> element in your HTML.\n            \"toaster\": \"b-toaster-top-center\",\n            // For BV, more options are available. @see https://bootstrap-vue.org/docs/components/toast\n        },\n    },\n\n    // Optional. Will be added to the notification message (content). May be HTML.\n    \"payload\": \"<any>\",\n\n    // Optional. ID of client (from Socket.IO) - msg would only be sent to this client.\n    \"_socketId\": \"/extras#sct0MeMrdeS5lwc0AAAB\",\n}\n*/",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 535,
        "y": 1905,
        "wires": [
            [
                "d7111ce4cb4d8b16",
                "260dd1e40d995979"
            ]
        ]
    },
    {
        "id": "d7111ce4cb4d8b16",
        "type": "uib-sender",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "34b9888e09adea38",
        "url": "webapp",
        "name": "",
        "topic": "",
        "passthrough": false,
        "return": false,
        "outputs": 0,
        "x": 705,
        "y": 1905,
        "wires": []
    },
    {
        "id": "0135921482d41bc7",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "34b9888e09adea38",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 435,
        "y": 1950,
        "wires": [
            [
                "6a8c1e1167beac9f"
            ]
        ]
    },
    {
        "id": "260dd1e40d995979",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "34b9888e09adea38",
        "name": "debug 23",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 735,
        "y": 1935,
        "wires": []
    },
    {
        "id": "03890e35a75d43ef",
        "type": "change",
        "z": "bdc10eb0bfc2c224",
        "g": "14eeda19a6a7072a",
        "name": "_broadcast : true",
        "rules": [
            {
                "t": "set",
                "p": "_broadcast",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1450,
        "y": 2205,
        "wires": [
            [
                "eed9d3aa846e26f9"
            ]
        ]
    },
    {
        "id": "b7f354ce82204d9c",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "g": "0459e2a074258c5a",
        "name": "PROGRAMMED STATE CHANGE",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 575,
        "y": 2190,
        "wires": []
    },
    {
        "id": "f0c22b02c475661f",
        "type": "change",
        "z": "bdc10eb0bfc2c224",
        "g": "0459e2a074258c5a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "toutId",
                "pt": "msg",
                "to": "msg.topic & \"_\" & msg.action",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 305,
        "y": 2235,
        "wires": [
            [
                "dd20009116ca100b",
                "b7f354ce82204d9c"
            ]
        ]
    },
    {
        "id": "df92ee35c74f4455",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "549f9deeccc44498",
        "name": "function 5",
        "func": "const signalCells = global.get(\"signalCells\");\n\nsignalCells.set",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 525,
        "y": 2130,
        "wires": [
            []
        ]
    },
    {
        "id": "47b607147dd37f73",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "8dfc8129d51e5740",
        "name": "update signalCell",
        "func": "\nlet signalKey = msg.action.match(/set(\\w+)/)[1]; if(!signalKey) node.warn({txt:\"error extracting signalKey\",sk:signalKey,fullMsg:msg})\nlet mKey = msg.topic;\n\n//update signalcells state\nlet signalCells = global.get(\"signalCells\");\nlet cell = signalCells[mKey];\n\ncell.signalKey = signalKey;\ncell.timerStart = Date.now();\ncell.timerEnd = Date.now() + global.get(\"config\").machines[mKey].toA3Timeout;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1105,
        "y": 2415,
        "wires": [
            [
                "c4f475eadc34f078"
            ]
        ]
    },
    {
        "id": "d4afd683f2270862",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "fe28fb7cb365d682",
        "name": "send reset all",
        "func": "let macKey = msg.topic;\nlet action = msg.action;\nconst signalKeys = global.get(\"signalCells\").dictionary.signalKeys;\n\nmsg.reset = true;\nfor (let sK of signalKeys){\n    msg.action = \"set\"+sK;\n    node.send(msg,true); //clones the msg each time\n}\n\n\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1005,
        "y": 2100,
        "wires": [
            [
                "ba60486beccc9f83"
            ]
        ]
    },
    {
        "id": "afee83b9c6a3f479",
        "type": "link in",
        "z": "bdc10eb0bfc2c224",
        "g": "fe28fb7cb365d682",
        "name": "send reset all",
        "links": [],
        "x": 880,
        "y": 2100,
        "wires": [
            [
                "d4afd683f2270862"
            ]
        ]
    },
    {
        "id": "ba60486beccc9f83",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "fe28fb7cb365d682",
        "name": "send reset all",
        "mode": "return",
        "links": [],
        "x": 1120,
        "y": 2100,
        "wires": []
    },
    {
        "id": "de15a8e34e10e6de",
        "type": "link call",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "send reset all",
        "links": [
            "afee83b9c6a3f479"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1095,
        "y": 2820,
        "wires": [
            [
                "9002b5da933a2cf0"
            ]
        ]
    },
    {
        "id": "e61d6852cebd5731",
        "type": "link call",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "send reset all",
        "links": [
            "afee83b9c6a3f479"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1090,
        "y": 2745,
        "wires": [
            [
                "4bf699bb76b64d11"
            ]
        ]
    },
    {
        "id": "2c3cc994eb8f94aa",
        "type": "link call",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "send reset all",
        "links": [
            "afee83b9c6a3f479"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1090,
        "y": 2895,
        "wires": [
            [
                "be30f8352908de40"
            ]
        ]
    },
    {
        "id": "84f861f523724022",
        "type": "link call",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "8dfc8129d51e5740",
        "name": "send reset all",
        "links": [
            "afee83b9c6a3f479"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1095,
        "y": 2970,
        "wires": [
            [
                "19df9e22435f0986"
            ]
        ]
    },
    {
        "id": "cc301d51052bf1ea",
        "type": "link call",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "8dfc8129d51e5740",
        "name": "send reset all",
        "links": [
            "afee83b9c6a3f479"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1090,
        "y": 3045,
        "wires": [
            [
                "eba758ecf77571c1"
            ]
        ]
    },
    {
        "id": "71050fa128ba0470",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "8dfc8129d51e5740",
        "name": "send reset for setA3",
        "func": "msg.reset=true;\nmsg.action=\"setA3\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1125,
        "y": 2490,
        "wires": [
            [
                "223dfe7f51e5c702"
            ]
        ]
    },
    {
        "id": "0c672d18a9ee0d9d",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "TODO rinomina setCellSignal -> setSingleCellState",
        "info": "",
        "x": 1595,
        "y": 2550,
        "wires": []
    },
    {
        "id": "b936e4a9ee71f492",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "OMET",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "action",
                "v": "setA3",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "OMET",
        "x": 790,
        "y": 2625,
        "wires": [
            [
                "0ab9b611389e52b7"
            ]
        ]
    },
    {
        "id": "a7135869c6f11da0",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "OMET",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "action",
                "v": "setA4",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "OMET",
        "x": 580,
        "y": 2715,
        "wires": [
            [
                "ea5a84d58454a07e"
            ]
        ]
    },
    {
        "id": "b8a75ac233598814",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "OMET",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "action",
                "v": "setB",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "OMET",
        "x": 580,
        "y": 2760,
        "wires": [
            [
                "534b0771447b37e9"
            ]
        ]
    },
    {
        "id": "3d4f9e766470653e",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "OMET",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "action",
                "v": "setC1",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "OMET",
        "x": 780,
        "y": 2790,
        "wires": [
            [
                "6a9506e901b63554"
            ]
        ]
    },
    {
        "id": "23db80ed422b9759",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "OMET",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "action",
                "v": "setC2",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "OMET",
        "x": 780,
        "y": 2865,
        "wires": [
            [
                "2c9f603eb53ec7c7"
            ]
        ]
    },
    {
        "id": "24c8d29178389a35",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "OMET",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "action",
                "v": "setD",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "OMET",
        "x": 780,
        "y": 2940,
        "wires": [
            [
                "6b16add2d6b04682"
            ]
        ]
    },
    {
        "id": "69720d01f23fd641",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "OMET",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "action",
                "v": "setE",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "OMET",
        "x": 765,
        "y": 3015,
        "wires": [
            [
                "d1f763dae798b9a3"
            ]
        ]
    },
    {
        "id": "4d56894252d94c10",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "0459e2a074258c5a",
        "name": "delay programmed state changes",
        "info": "",
        "x": 280,
        "y": 2190,
        "wires": []
    },
    {
        "id": "ca63d0b06d78808e",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "g": "48f133c168356962",
        "name": "TOWER BIT ARRAY",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "$globalContext(\"towersBitArray\")\t",
        "targetType": "jsonata",
        "statusVal": "TOWER BIT ARRAY",
        "statusType": "auto",
        "x": 810,
        "y": 720,
        "wires": []
    },
    {
        "id": "a041ea7c845b2791",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "48f133c168356962",
        "name": "toggle msg.dev bit",
        "func": "let mKey = msg.topic;\nlet dev = msg.device ?? (() => { throw new Error(\"missing msg.device\") })();\nconst towersControl = global.get(\"towersControl\");\n\nif (towersControl[mKey].hasDevice(dev))\n    towersControl[mKey][dev] = !towersControl[mKey][dev];\nelse\n    node.warn(\"no such device as \"+dev+\" in \"+mKey);\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 660,
        "wires": [
            [
                "158e57843e4b74a5"
            ]
        ]
    },
    {
        "id": "158e57843e4b74a5",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "48f133c168356962",
        "name": "trigger writetowersBitArray",
        "mode": "link",
        "links": [
            "0e67b07cc99383b3"
        ],
        "x": 920,
        "y": 660,
        "wires": [],
        "l": true
    },
    {
        "id": "dd8a56d146a3a7c8",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "48f133c168356962",
        "name": "FA420 : redLight",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "device",
                "v": "redLight",
                "vt": "str"
            },
            {
                "p": "action",
                "v": "setA1",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "FA420",
        "x": 495,
        "y": 660,
        "wires": [
            [
                "a041ea7c845b2791"
            ]
        ]
    },
    {
        "id": "5442487d3efbd896",
        "type": "ui_text",
        "z": "bdc10eb0bfc2c224",
        "g": "c7aff72d1a698bfc",
        "group": "ff22d246a1b65b24",
        "order": 5,
        "width": 0,
        "height": 0,
        "name": "towBitArr",
        "label": "towBitArr",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "className": "",
        "x": 1770,
        "y": 675,
        "wires": []
    },
    {
        "id": "db0b9650aad24229",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "48f133c168356962",
        "name": "towers dbgInterface",
        "mode": "link",
        "links": [
            "e4e3ea0431072ffb"
        ],
        "x": 800,
        "y": 825,
        "wires": [],
        "l": true
    },
    {
        "id": "258441120833deb5",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "14eeda19a6a7072a",
        "name": "update signalCell",
        "func": "\nlet signalKey = msg.action.match(/set(\\w+)/)[1]; if(!signalKey) node.warn({txt:\"error extracting signalKey\",sk:signalKey,fullMsg:msg})\nlet mKey = msg.topic;\n\n//update signalcells state\nlet signalCells = global.get(\"signalCells\");\nlet cell = signalCells[mKey];\n\ncell.signalKey = signalKey;\n//conditionally show cd\nif(signalKey == \"A1\"){\n    cell.timerStart = Date.now();\n    cell.timerEnd = Date.now() + global.get(\"config\").machines[mKey].toA3Timeout;\n}\nelse if(signalKey == \"A3\"){\n    cell.timerStart = Date.now();\n    cell.timerEnd = Date.now() + global.get(\"config\").machines[mKey].toA4Timeout; //+ (cell.timerEnd - cell.timerStart);\n\n}\nelse{\n    if(signalKey != \"A2\"){\n        cell.timerStart = Date.now();\n        cell.timerEnd = cell.timerStart;\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 985,
        "y": 2205,
        "wires": [
            [
                "fb1f9c7dd8ad7a3e"
            ]
        ]
    },
    {
        "id": "34c8f3a9767f8cad",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "14eeda19a6a7072a",
        "name": "CONDITIONALLY SHOW COUNTDOWN TOO",
        "info": "",
        "x": 1090,
        "y": 2235,
        "wires": []
    },
    {
        "id": "8a1acf9dd291745a",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "8dfc8129d51e5740",
        "name": "FA420",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "action",
                "v": "setE",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "FA420",
        "x": 745,
        "y": 3075,
        "wires": [
            [
                "d1f763dae798b9a3"
            ]
        ]
    },
    {
        "id": "d383c7d09f8f6a9e",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "name": "tests",
        "func": "/*** TESTS *** */\nnode.warn(\"BEGIN TOWERSCONTROL TESTING\");\n\nconst signal = global.get(\"towersControl\");\nconst sleep = ms => new Promise(r => setTimeout(r, ms));\nfunction bitArrToString(arr) {\n    var str = \"\";\n    for (let i = 0; i < arr.length; i++) {\n        if (i % 4 == 0)\n            str += \"|\"\n        str += parseInt(arr[i]) + \",\";\n    }\n    return str;\n}\n\nnode.warn(\"testing bits\")\n//raise 1 bit at a time, try to raise unset devices\n//mkList is set so you should see bits raising consecutively\n{\n    const mkList = [\"FA423\", \"FA420\", \"FA421\", \"FA419\", \"OMET\", \"FA422\"]\n    let sBA = signal.towersBitArray\n    for (let mKey of mkList) {\n        node.warn(\"over \" + mKey)\n        signal[mKey].redLight += 1;\n        node.warn(\"red\"+bitArrToString(sBA));\n        //signal[mKey].redLight = 0;\n\n        signal[mKey].greenLight += 1;\n        node.warn(\"green:\"+bitArrToString(sBA));\n        //signal[mKey].greenLight = 0;\n\n        //this should sometime throw warnings\n        signal[mKey].horn += 1;\n        node.warn(\"horn:\"+bitArrToString(sBA));\n        //signal[mKey].horn = 0;\n\n    }\n}\n\n//try macHasDevice on all\n//res: {\n//{macKey}:{\n//{device}:true|false\n//notDefinedList: {string[]}\nconst def = global.get(\"towersControl\");;\nnode.warn(\"testing macHasDevice\")\n{\n    let res = {}; res.notDefinedList = [];\n    for (let macKey of def.dictionary.macKeys) {\n        res[macKey] = {};\n        for (let device of def.dictionary.devices) {\n            res[macKey][device] = def.macHasDevice(macKey, device);\n            if (!res[macKey][device])\n                res.notDefinedList.push(`${macKey} has not ${device}`)\n        }\n    }\n    node.warn({ \"all_macHasDevice:\": res })\n}\n\nnode.warn(\"TEST END\");\n/**/",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 345,
        "wires": [
            []
        ]
    },
    {
        "id": "1dd11d91909620da",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "c7aff72d1a698bfc",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1365,
        "y": 660,
        "wires": [
            [
                "474d4da6f7366e31"
            ]
        ]
    },
    {
        "id": "6b77363af9b6dc90",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "c7aff72d1a698bfc",
        "name": "format",
        "func": "\n\nfunction bitArrToString(arr) {\n    var str = \"\";\n    for (let i = 0; i < arr.length; i++) {\n        if (i % 4 == 0 && i)\n            str += \"|\"\n        str += parseInt(0 + arr[i]) + \",\";\n    }\n    return str;\n}\n\nmsg.payload=bitArrToString(global.get(\"towersBitArray\"))\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1620,
        "y": 675,
        "wires": [
            [
                "5442487d3efbd896"
            ]
        ]
    },
    {
        "id": "b40b58043c479a0a",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "a740b5ba0ed51bd3",
        "name": "sequentially tests buttons",
        "func": "\nlet macKeys = global.get(\"signalCells\").dictionary.macKeys;\nlet signalKeys = [\"A1\"];//global.get(\"signalCells\").dictionary.signalKeys\n\ncontext.set(\"mki\", context.get(\"mki\") ?? 0)\ncontext.set(\"ski\", context.get(\"ski\") ?? -1)\n\nlet mki=context.get(\"mki\");\nif(mki >= macKeys.length) mki = 0;\nlet ski=context.get(\"ski\");\nif (ski >= signalKeys.length) ski = 0;\n\nif(msg.control != \"replay\"){\n    ski++;\n    if(ski >= signalKeys.length){\n        mki++;\n        ski=0;\n    }\n}\nnode.warn(\"testing \"+signalKeys[ski]+\" of \"+macKeys[mki]+ \"with \"+ski+\" \"+mki)\nnode.send({ action: \"set\" + signalKeys[ski], topic: macKeys[mki] });\n    \n\n\n\ncontext.set(\"mki\",mki);\ncontext.set(\"ski\",ski);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 3000,
        "wires": [
            [
                "fbec45079c82c4f6"
            ]
        ]
    },
    {
        "id": "36f1d48b74bad8dc",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "a740b5ba0ed51bd3",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 225,
        "y": 3000,
        "wires": [
            [
                "b40b58043c479a0a"
            ]
        ]
    },
    {
        "id": "6704700843f92d65",
        "type": "ui_text",
        "z": "bdc10eb0bfc2c224",
        "g": "c7aff72d1a698bfc",
        "group": "ff22d246a1b65b24",
        "order": 6,
        "width": 11,
        "height": 4,
        "name": "tow json",
        "label": "towers",
        "format": "<pre>{{msg.payload}}<pre>",
        "layout": "col-center",
        "className": "",
        "x": 1775,
        "y": 750,
        "wires": []
    },
    {
        "id": "5810fab39fed4fd8",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "c7aff72d1a698bfc",
        "name": "format",
        "func": "\nconst tow = global.get(\"towersControl\");\n\nvar macs = {}\nfor(let mk of tow.dictionary.macKeys){\n    macs[mk] = tow[mk];\n}\n\n//msg.payload = JSON.stringify(macs).replaceAll('},','}\\n<br>,')\nmsg.payload = syntaxHighlight(macs) .replaceAll('},','}\\n,');\n//msg.payload = msg.payload.replaceAll('{\"', '{<br>\\n\"');\n\nreturn msg;\n\n\n// return formatted HTML version of JSON object\nfunction syntaxHighlight(json) {\n    json = global.get(\"utils\").safeStringify(json, 0)\n    json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')\n    json = json.replace(/(\"(\\\\u[a-zA-Z0-9]{4}|\\\\[^u]|[^\\\\\"])*\"(\\s*:)?|\\b(true|false|null)\\b|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?)/g, function (match) {\n        var cls = 'number'\n        if ((/^\"/).test(match)) {\n            if ((/:$/).test(match)) {\n                cls = 'key'\n            } else {\n                cls = 'string'\n            }\n        } else if ((/true|false/).test(match)) {\n            cls = 'boolean'\n        } else if ((/null/).test(match)) {\n            cls = 'null'\n        }\n        return '<span class=\"' + cls + '\">' + match + '</span>'\n    })\n    return json\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1634.765625,
        "y": 749.75,
        "wires": [
            [
                "6704700843f92d65"
            ]
        ]
    },
    {
        "id": "4018f9117b219836",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "74dd883b5669e797",
        "name": "#dbg toggle",
        "info": "",
        "x": 1310,
        "y": 720,
        "wires": []
    },
    {
        "id": "175cc861d4fdc430",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "74dd883b5669e797",
        "name": "toggle",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "control",
        "payload": "toggle",
        "payloadType": "str",
        "x": 1330,
        "y": 750,
        "wires": [
            [
                "3b7aeec4f66ea82e"
            ]
        ]
    },
    {
        "id": "3b7aeec4f66ea82e",
        "type": "gate",
        "z": "bdc10eb0bfc2c224",
        "g": "74dd883b5669e797",
        "name": "",
        "controlTopic": "control",
        "defaultState": "open",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 1420,
        "y": 780,
        "wires": [
            [
                "474d4da6f7366e31"
            ]
        ],
        "l": false
    },
    {
        "id": "e0acafe1e64fb69d",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "74dd883b5669e797",
        "name": "poll 1s",
        "props": [],
        "repeat": "1",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "x": 1320,
        "y": 780,
        "wires": [
            [
                "3b7aeec4f66ea82e"
            ]
        ]
    },
    {
        "id": "474d4da6f7366e31",
        "type": "switch",
        "z": "bdc10eb0bfc2c224",
        "g": "c7aff72d1a698bfc",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1515,
        "y": 735,
        "wires": [
            [
                "6b77363af9b6dc90",
                "5810fab39fed4fd8",
                "1aca12531673be7d"
            ]
        ],
        "l": false
    },
    {
        "id": "59550c61bf94ee85",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "ec19ad21051125fc",
        "name": "sendQuery 40000:4x8",
        "func": "/*  global.plc:\n    \"from\": function (address = 0, quantity = 2) -> msg -> number[quant] & Buffer[2*quant == nByte]\n    \"between\": function (from, to, sequenceName = \"\") -> msg -> number[quant] & Buffer[2*quant == nByte]\n    \"readCoil\": function (address, nByte ) -> msg -> Boolean[8*nByte] & Buffer[nByte]\n    \"writeReg\": fucntion (address, value )\n    \"writeCoil\": fucntion (address, value )\n*/\nlet plc = global.get(\"plc\");\n\nreturn plc.readCoil(0, 4);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 1485,
        "wires": [
            [
                "32847fc57a5ed7c0"
            ]
        ]
    },
    {
        "id": "309b3f04cd19fbeb",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "ec19ad21051125fc",
        "name": "parse button MWord and send buttonContolActionMsg",
        "func": "//will output { topic:\"OMET\", action:\"setC1\"}\n\n//should receive a stream of bits at least bitMap.length long\n    //if received.len < bitMap.len -> warn & append zeros to received\n    //if received.len > bitMap.len -> silently use only the first bitMap.len bits \n\n\n\n/* const getActionMsg = (function () {\n    const f = global.get(\"btnControl\").prepareActionMsg.bind(global.get(\"btnControl\"));\n    return function (...args) { return f({},...args) }\n})(); */\n\nfunction prepareActionMsg(...args) {\n    return global.get(\"buttonsControl\").prepareActionMsg(new Object(), ...args)\n}\n\n/** associates a function to each bit retrieved from the ZBRN1.\n * - the f() will send a message like {topic: 'OMET', payload:'setC1'} aka { macKey,  btnActId }\n */\n\nconst bitMap = [\n    //PB7\n    () => { node.send(prepareActionMsg(\"MO41\", \"redBtn\")) },\n    () => { node.send(prepareActionMsg(\"MO41\", \"greenBtn\")) },\n    () => { node.send(prepareActionMsg(\"MO41\", \"whiteBtn\")) },\n    () => { node.send(prepareActionMsg(\"MO41\", \"blackBtn\")) },\n    //PB8\n    () => { node.send(prepareActionMsg(\"MO42\", \"redBtn\")) },\n    () => { node.send(prepareActionMsg(\"MO42\", \"greenBtn\")) },\n    () => { node.send(prepareActionMsg(\"MO42\", \"whiteBtn\")) },\n    () => { node.send(prepareActionMsg(\"MO42\", \"blackBtn\")) },\n];\nconst NBITS = bitMap.length;\n\n//convert to bit array\ntry{\n    var bitArr = intArrToBitArray(msg.payload.buffer);\n    if(!bitArr || bitArr.length < NBITS){\n        node.warn({ txt: \"INCONSISTENT BITARR-BITMAP LENGTHS appended 0s\", bitArr: bitArr, bitMap:bitMap,buf:msg.payload.buffer,fullMsg:msg})\n        for(let i=bitArr.length;i<bitMap.length;i++)\n            bitArr.push(0);\n    }\n}catch(e) { node.error(e, e); return}\n\n//map to bitMap functions\nconst last = context.get(\"bitArray\") ?? (new Array(NBITS)).fill(0);\n//node.warn({\"bitArr\":bitArr.toString(),\"last\":last.toString()});\n\nfor(let i=0; i<NBITS; i++){\n    if(bitArr[i] && bitArr[i] != last[i]){\n        bitMap[i]()\n    }\n};\ncontext.set(\"bitArray\",bitArr);\n\n\n//------FUNCTIONS-------------------------------------------------------------------------------------------\n\n\n/** @summary converts a single integer number to its binary array rappresentation\n * @param {number} val integer\n * @return {number[]} array of NUMBERS, only 0 and 1\n * @throws TypeError if val is not an integer\n * @throws Error if detects possible infinite loop\n */\nfunction intToBitArray(val) {\n    var bitArr = [];\n\n    if (typeof (val) != \"number\" || val % 1 != 0) throw new TypeError(`[${intToBitArray.name}()]:val must be an integer number`);\n    //trova il primo ottetto != 0\n    /*var minBytes=4-1; //stops 1 too early\n    for(let i=0; i<4 && (val>>(32-8*i))!=0; i++)\n        minBytes--;\n    node.warn({minBytes:minBytes,for:val})\n    */\n\n    let nByte = 0;\n    do {\n        //copia un bit alla volta * 8bit\n        for (let i = 0; i < 8; i++)\n            bitArr.push((val >> i) & 0x00000001);\n        nByte++;\n        //node.warn(nByte);node.warn(val >> 8*nByte)\n        if (nByte >= 50) throw new Error(\"triggered infinite loop guard. possible infinite loop at \" + intToBitArray.name);\n    } while (val >> 8 * nByte)\n\n    return bitArr;\n}\n\nfunction intArrToBitArray(arr) {\n    var ret = []\n    for (let val of arr)\n        intToBitArray(val).forEach(bit => ret.push(bit))\n    return ret;\n}\n\n\n\n\n\n\n/*\n//let buf = msg.buffer;\nlet buf = Buffer.from( new Uint8Array([5,9]) );\n\nfunction bitArrToString(arr) {\n    var str = \"\";\n    for (let i = 0; i < arr.length; i++) {\n        if (i % 4 == 0 && i)\n            str += \"|\"\n        str += parseInt(0+arr[i]) + \",\";\n    }\n    return str;\n}\n\n//buf[15] <=> bit[15]\nfunction bufToBitArray(buf){\n    var octStrs = [],\n        bitArr = [];\n    //buf to array of strings\n    for(let oct of buf )\n        octStrs.push(oct.toString(2).padStart(8,'0'));\n    //arr of strings to array of bits\n    for(let octStr of octStrs)\n        for(let i=0; i<octStr.length; i++)\n            bitArr.push(octStr[i]=='0' ? 0 : 1)\n            \n    node.warn({o:octStrs.toString(),b:bitArr.toString(), \"octStrs\": octStrs, bitArr: bitArr })\n    return bitArr;\n}\n\n\n\nfor(let i=0;i<1;i++)\n    node.warn( intToBitArray(300).toString() )\n\n\n\n\n/* let arr=[];\nfor(let i=0,s=0xAA.toString(2).padStart(16,'0'); i<s.length;i++)\n    arr.push(parseInt(s[i])) * /\n\n\nnode.warn({\n    \"intToBit\": intArrToBitArray(msg.payload.buffer).toString(), \n    \"arrToArr\": bitArrToString(bufToBitArray(msg.payload.buffer))\n})\n\nconst bitArr=intArrToBitArray(msg.payload.buffer)\n\nconst btnActionMsg(action){\n    return {action:action}\n}\n\nconst cbMap=[\n    ()=>{},\n    ()=>{},\n    ()=>{},\n    ()=>{},\n\n    ()=>{},\n    ()=>{},\n    ()=>{},\n    ()=>{},\n\n    ()=>{},\n    ()=>{},\n    ()=>{},\n    ()=>{},\n\n    ()=>{},\n    ()=>{},\n    ()=>{},\n    ()=>{},\n]\n\nbitArr.forEach( (bit,i) => node.send(bitMap[i])) )\n\nfor(let i=0; i<bitArr.length; i++)\n    if(bitArr[i])\n        node.send(cbMap[i]())\n\n//embed switch in this funcion, setting up 1 output per expected bit (16 outputs)\n    //node.send(bitArr.forEach((bit,i) => (bit ? cbMap[i]() : null )))\n\n\n/*node.warn(\"msg received\")\nnode.warn(buf)\nnode.warn(buf.buffer)\nnode.warn(bitArrToString(bufToBitArray([0xAA, 0xAA]))) */",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1265,
        "y": 1485,
        "wires": [
            [
                "e3d7e8461568f1ea",
                "1255172cf854afec"
            ]
        ]
    },
    {
        "id": "1ad399f53064accc",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "7ae1a45298357558",
        "name": "bitArray manual reset",
        "func": "\n\nglobal.set(\"towersBitArray\",global.get(\"towersBitArray\").fill(0))\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 525,
        "wires": [
            [
                "dff151503d492736"
            ]
        ]
    },
    {
        "id": "e45e9fe2c6284d6e",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "7ae1a45298357558",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 270,
        "y": 525,
        "wires": [
            [
                "1ad399f53064accc"
            ]
        ],
        "l": false
    },
    {
        "id": "dff151503d492736",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "7ae1a45298357558",
        "name": "trigger writetowersBitArray out",
        "mode": "link",
        "links": [
            "0e67b07cc99383b3"
        ],
        "x": 685,
        "y": 525,
        "wires": [],
        "l": true
    },
    {
        "id": "14e10dda97a99317",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "ad093da59d9d5318",
        "name": "send setSingleCellState",
        "func": "const uib = global.get(\"uibuilder\")\nlet signalKey = msg.action.match(/set(\\w+)/)[1];\nlet mKey = msg.topic;\n\n//update signalcells state\nlet signalCells = global.get(\"signalCells\");\nlet cell = signalCells[mKey];\nlet cfg = cell.config; //global.get(\"config\")[mKey];\n\ncell.signalKey = signalKey;\n\nuib.prepareMsg_setSingleCellState(msg,mKey,cell);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2290,
        "y": 2085,
        "wires": [
            [
                "284c36d91133673e"
            ]
        ]
    },
    {
        "id": "a1c95db8ecc8bdb8",
        "type": "link in",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "ad093da59d9d5318",
        "name": "send setCellSignal",
        "links": [],
        "x": 1935,
        "y": 2085,
        "wires": [
            [
                "9aea7b3072c9948e"
            ]
        ]
    },
    {
        "id": "302bf84244b6f8d2",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "ad093da59d9d5318",
        "name": "send setCellSignal",
        "mode": "return",
        "links": [],
        "x": 2655,
        "y": 2085,
        "wires": []
    },
    {
        "id": "284c36d91133673e",
        "type": "change",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "ad093da59d9d5318",
        "name": "_broadcast : true",
        "rules": [
            {
                "t": "set",
                "p": "_broadcast",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2525,
        "y": 2085,
        "wires": [
            [
                "302bf84244b6f8d2"
            ]
        ]
    },
    {
        "id": "9aea7b3072c9948e",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "ad093da59d9d5318",
        "name": "update signalCell",
        "func": "\nlet signalKey = msg.action.match(/set(\\w+)/)[1]; if(!signalKey) node.warn({txt:\"error extracting signalKey\",sk:signalKey,fullMsg:msg})\nlet mKey = msg.topic;\n\n//update signalcells state\nlet signalCells = global.get(\"signalCells\");\nlet cell = signalCells[mKey];\n\ncell.signalKey = signalKey;\n//conditionally show cd\nif(signalKey == \"A1\"){\n    cell.timerStart = Date.now();\n    cell.timerEnd = Date.now() + global.get(\"config\").machines[mKey].toA3Timeout;\n}\nelse{\n    if(signalKey != \"A2\"){\n        cell.timerStart = Date.now();\n        cell.timerEnd = cell.timerStart;\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2060,
        "y": 2085,
        "wires": [
            [
                "14e10dda97a99317"
            ]
        ]
    },
    {
        "id": "c91f4336229ff317",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "d": true,
        "g": "ad093da59d9d5318",
        "name": "CONDITIONALLY SHOW COUNTDOWN TOO",
        "info": "",
        "x": 2165,
        "y": 2115,
        "wires": []
    },
    {
        "id": "d8cf100b99ed701b",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "2642979013b379fa",
        "name": "set all to A1",
        "func": "let signalKeys = global.get(\"signalCells\");\nfor(let mk of signalKeys.dictionary.macKeys){\n    node.send({topic:mk,action:\"setA1\"})\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 385,
        "y": 3105,
        "wires": [
            [
                "6ab3f61c2bde1e09"
            ]
        ]
    },
    {
        "id": "cf1dc930817e9a5d",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "2642979013b379fa",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 225,
        "y": 3105,
        "wires": [
            [
                "d8cf100b99ed701b"
            ]
        ]
    },
    {
        "id": "6ab3f61c2bde1e09",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "2642979013b379fa",
        "name": "link out 18",
        "mode": "link",
        "links": [
            "f4db294021a89fbf"
        ],
        "x": 510,
        "y": 3105,
        "wires": []
    },
    {
        "id": "cc9d5b0b240172ae",
        "type": "link in",
        "z": "bdc10eb0bfc2c224",
        "name": "allMain isDefinedEvent out",
        "links": [
            "230aaa874077cfdc"
        ],
        "x": 885,
        "y": 135,
        "wires": [
            [
                "f93a5182dc1ea9f3"
            ]
        ]
    },
    {
        "id": "f93a5182dc1ea9f3",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "name": "log \"definitions completed\"",
        "func": "node.log(\"allMain isDefinedEvent\");\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 135,
        "wires": [
            []
        ]
    },
    {
        "id": "1aca12531673be7d",
        "type": "function",
        "z": "bdc10eb0bfc2c224",
        "g": "c7aff72d1a698bfc",
        "name": "format",
        "func": "\nconst tow = global.get(\"towersControl\");\n\n\nlet outJson = {}\nfor(let bit in tow.sharedBits){\n    let bitItem = tow.sharedBits[bit];\n    //format as \"(devK) {mK:val, mk:val, ..} -> output() \"\n    outJson[bit] = `(${bitItem.devKey})` + JSON.stringify(bitItem.values).replaceAll(new RegExp('[\\\\\"]', \"g\"), '') + \"-> \" + bitItem.output().toString();\n}\n\nmsg.payload = JSON.stringify(outJson).replaceAll('\",','\"\\n<br>,');\n//node.warn(msg.payload);\n//msg.payload = msg.payload.replaceAll('{\"', '{<br>\\n\"');\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1630,
        "y": 795,
        "wires": [
            [
                "562716c144a89cd7"
            ]
        ]
    },
    {
        "id": "562716c144a89cd7",
        "type": "ui_text",
        "z": "bdc10eb0bfc2c224",
        "g": "c7aff72d1a698bfc",
        "group": "ff22d246a1b65b24",
        "order": 7,
        "width": 11,
        "height": 2,
        "name": "tow json",
        "label": "sharedBits",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "className": "",
        "x": 1770.234375,
        "y": 795.25,
        "wires": []
    },
    {
        "id": "b4da2ffda24c082f",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "c7aff72d1a698bfc",
        "name": "DBG FOR TOWER CONTROL",
        "info": "",
        "x": 1355,
        "y": 615,
        "wires": []
    },
    {
        "id": "7f3f720f5ffa9ec8",
        "type": "link in",
        "z": "bdc10eb0bfc2c224",
        "g": "74dd883b5669e797",
        "name": "all dbgGates",
        "links": [
            "0156636ac6d0af9f"
        ],
        "x": 1315,
        "y": 810,
        "wires": [
            [
                "3b7aeec4f66ea82e"
            ]
        ],
        "l": true
    },
    {
        "id": "c691ca4233289aa8",
        "type": "comment",
        "z": "bdc10eb0bfc2c224",
        "g": "5545cf74d423db46",
        "name": "OPEN/CLOSE ALL DBG UI GATES",
        "info": "",
        "x": 1340,
        "y": 270,
        "wires": []
    },
    {
        "id": "5e5a226a865dbeb3",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "5545cf74d423db46",
        "name": "open",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1250,
        "y": 315,
        "wires": [
            [
                "f06c34e4173eece5"
            ]
        ],
        "l": false
    },
    {
        "id": "0156636ac6d0af9f",
        "type": "link out",
        "z": "bdc10eb0bfc2c224",
        "g": "5545cf74d423db46",
        "name": "all dbgGates",
        "mode": "link",
        "links": [
            "b1b26324a134cc2d",
            "7f3f720f5ffa9ec8",
            "ff4d8fe7b4d510fc",
            "c607bf35e3292560",
            "c4aefeb3271ffd19"
        ],
        "x": 1515,
        "y": 345,
        "wires": [],
        "l": true
    },
    {
        "id": "c4b799251a797bc8",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "5545cf74d423db46",
        "name": "onStartup 0.1",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1305,
        "y": 390,
        "wires": [
            [
                "e545a8723c6c28aa"
            ]
        ]
    },
    {
        "id": "f06c34e4173eece5",
        "type": "change",
        "z": "bdc10eb0bfc2c224",
        "g": "5545cf74d423db46",
        "name": "close",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "close",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "control",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1350,
        "y": 315,
        "wires": [
            [
                "0156636ac6d0af9f"
            ]
        ]
    },
    {
        "id": "c3ab5aa407657c85",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "5545cf74d423db46",
        "name": "open",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1255,
        "y": 345,
        "wires": [
            [
                "e545a8723c6c28aa"
            ]
        ],
        "l": false
    },
    {
        "id": "e545a8723c6c28aa",
        "type": "change",
        "z": "bdc10eb0bfc2c224",
        "g": "5545cf74d423db46",
        "name": "open",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "open",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "control",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1350,
        "y": 345,
        "wires": [
            [
                "0156636ac6d0af9f"
            ]
        ]
    },
    {
        "id": "f710d7d95bac14ff",
        "type": "inject",
        "z": "bdc10eb0bfc2c224",
        "g": "929f10db0d38dc07",
        "name": "everyday at 23:59",
        "props": [],
        "repeat": "",
        "crontab": "59 23 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1030,
        "y": 510,
        "wires": [
            [
                "1fcb3ff8b8483aea"
            ]
        ]
    },
    {
        "id": "1fcb3ff8b8483aea",
        "type": "exec",
        "z": "bdc10eb0bfc2c224",
        "g": "929f10db0d38dc07",
        "command": "shutdown /r /d p /c \"riavvio giornaliero pianificato da e per server nodered\"",
        "addpay": "",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 1410,
        "y": 510,
        "wires": [
            [],
            [
                "c8354dbe8b89dacf"
            ],
            []
        ]
    },
    {
        "id": "c8354dbe8b89dacf",
        "type": "debug",
        "z": "bdc10eb0bfc2c224",
        "g": "929f10db0d38dc07",
        "name": "exec",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "TOWER BIT ARRAY",
        "statusType": "auto",
        "x": 1750,
        "y": 510,
        "wires": []
    },
    {
        "id": "15c00fddf6febcfb",
        "type": "complete",
        "z": "4c238ae3c4c60cc5",
        "g": "b99d3df5ef07d131",
        "name": "",
        "scope": [],
        "uncaught": false,
        "x": 235,
        "y": 795,
        "wires": [
            [
                "40a177edf60c7589"
            ]
        ]
    },
    {
        "id": "254ee6a725ad9a5f",
        "type": "inject",
        "z": "4c238ae3c4c60cc5",
        "g": "b99d3df5ef07d131",
        "name": "poll 1s global.config",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": true,
        "onceDelay": "2",
        "topic": "",
        "payload": "config",
        "payloadType": "global",
        "x": 310,
        "y": 825,
        "wires": [
            [
                "b960a6e10feb99a7"
            ]
        ]
    },
    {
        "id": "b960a6e10feb99a7",
        "type": "rbe",
        "z": "4c238ae3c4c60cc5",
        "g": "b99d3df5ef07d131",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": false,
        "property": "payload",
        "topi": "topic",
        "x": 450,
        "y": 825,
        "wires": [
            [
                "4bc01b77c9d3bacb",
                "ad42f06dcb4eb1eb"
            ]
        ],
        "l": false
    },
    {
        "id": "4bc01b77c9d3bacb",
        "type": "json",
        "z": "4c238ae3c4c60cc5",
        "g": "b99d3df5ef07d131",
        "name": "",
        "property": "payload",
        "action": "str",
        "pretty": false,
        "x": 540,
        "y": 810,
        "wires": [
            [
                "cec5e4982ce4afa1"
            ]
        ],
        "l": false
    },
    {
        "id": "cec5e4982ce4afa1",
        "type": "file",
        "z": "4c238ae3c4c60cc5",
        "g": "b99d3df5ef07d131",
        "name": "",
        "filename": ".\\commonConfig.json",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 655,
        "y": 810,
        "wires": [
            [
                "409cf881f68b9752"
            ]
        ]
    },
    {
        "id": "159695dad087f948",
        "type": "file in",
        "z": "4c238ae3c4c60cc5",
        "g": "ae9407dc27fc42e6",
        "name": "",
        "filename": ".\\commonConfig.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 440,
        "y": 555,
        "wires": [
            [
                "3c116b7c2cb7cb16",
                "cc89ce1d1a0c4b1d"
            ]
        ]
    },
    {
        "id": "e9ae13ce1d12693b",
        "type": "inject",
        "z": "4c238ae3c4c60cc5",
        "g": "ae9407dc27fc42e6",
        "name": "OnStartup",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0",
        "topic": "",
        "x": 210,
        "y": 555,
        "wires": [
            [
                "159695dad087f948"
            ]
        ]
    },
    {
        "id": "cc89ce1d1a0c4b1d",
        "type": "json",
        "z": "4c238ae3c4c60cc5",
        "g": "b42e082536c528eb",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 750,
        "y": 555,
        "wires": [
            [
                "c2697928034ac49b"
            ]
        ],
        "l": false
    },
    {
        "id": "c2697928034ac49b",
        "type": "change",
        "z": "4c238ae3c4c60cc5",
        "g": "ae9407dc27fc42e6",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "config",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1015,
        "y": 555,
        "wires": [
            [
                "9abae7b56bbf3c14",
                "d6097ab674846cb2",
                "b6da99b42391a973"
            ]
        ]
    },
    {
        "id": "409cf881f68b9752",
        "type": "debug",
        "z": "4c238ae3c4c60cc5",
        "g": "b99d3df5ef07d131",
        "name": "written settings",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 860,
        "y": 810,
        "wires": []
    },
    {
        "id": "d6097ab674846cb2",
        "type": "link out",
        "z": "4c238ae3c4c60cc5",
        "g": "ae9407dc27fc42e6",
        "name": "commonConfig.json read",
        "mode": "link",
        "links": [],
        "x": 1250,
        "y": 555,
        "wires": [],
        "l": true
    },
    {
        "id": "ad42f06dcb4eb1eb",
        "type": "link out",
        "z": "4c238ae3c4c60cc5",
        "g": "b99d3df5ef07d131",
        "name": "OnConfigUpdate_out",
        "mode": "link",
        "links": [
            "019724bd0407040d",
            "7a56c04c308a37eb",
            "0be9e347c272ebc7",
            "382b9ee86b061715",
            "2829a11cc5455212",
            "c7f4104b21b3f0ed",
            "4f4965017bd78144",
            "79329d19f997f71e",
            "dcfdd404535dc654",
            "23fa7a8de9d4b748",
            "71cdad2935eab809",
            "a3c95a133003aada",
            "736f1d79123164d5"
        ],
        "x": 615,
        "y": 855,
        "wires": [],
        "l": true
    },
    {
        "id": "40a177edf60c7589",
        "type": "change",
        "z": "4c238ae3c4c60cc5",
        "g": "b99d3df5ef07d131",
        "name": "get config",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "config",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 395,
        "y": 795,
        "wires": [
            [
                "4bc01b77c9d3bacb",
                "ad42f06dcb4eb1eb"
            ]
        ]
    },
    {
        "id": "cac1485e416830bb",
        "type": "inject",
        "z": "4c238ae3c4c60cc5",
        "g": "b99d3df5ef07d131",
        "name": "send",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "2",
        "topic": "",
        "payload": "config",
        "payloadType": "global",
        "x": 355,
        "y": 855,
        "wires": [
            [
                "ad42f06dcb4eb1eb"
            ]
        ]
    },
    {
        "id": "7ffa0b30b6b91318",
        "type": "complete",
        "z": "4c238ae3c4c60cc5",
        "g": "b99d3df5ef07d131",
        "name": "OnConfigUpdate",
        "scope": [
            "4bc01b77c9d3bacb",
            "c2697928034ac49b"
        ],
        "uncaught": false,
        "x": 405,
        "y": 900,
        "wires": [
            [
                "e097328f3afd162a"
            ]
        ]
    },
    {
        "id": "e097328f3afd162a",
        "type": "link out",
        "z": "4c238ae3c4c60cc5",
        "g": "b99d3df5ef07d131",
        "name": "OnConfigUpdateEvent_out",
        "mode": "link",
        "links": [],
        "x": 635,
        "y": 900,
        "wires": [],
        "l": true
    },
    {
        "id": "9abae7b56bbf3c14",
        "type": "debug",
        "z": "4c238ae3c4c60cc5",
        "g": "ae9407dc27fc42e6",
        "name": "READ SETTINGS",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1230,
        "y": 585,
        "wires": []
    },
    {
        "id": "c5a7c59c71f4ce52",
        "type": "catch",
        "z": "4c238ae3c4c60cc5",
        "g": "ae9407dc27fc42e6",
        "name": "",
        "scope": [
            "159695dad087f948"
        ],
        "uncaught": false,
        "x": 170,
        "y": 435,
        "wires": [
            [
                "4b5d16595763d803"
            ]
        ]
    },
    {
        "id": "4b5d16595763d803",
        "type": "function",
        "z": "4c238ae3c4c60cc5",
        "g": "ae9407dc27fc42e6",
        "name": "catch commonConfig fileNotFound",
        "func": "\nif(/ENOENT/.test(msg.error.message) && !context.get(\"triedOnce\")){\n    context.set(\"triedOnce\",true);\n    global.get(\"utils\").errorBlink(node, 60000);\n    return msg;\n}\nelse{\n    return [null,msg]\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\ncontext.set(\"triedOnce\",undefined)",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 435,
        "wires": [
            [
                "574b8aca29d477bf"
            ],
            [
                "e499962fb97d984c"
            ]
        ]
    },
    {
        "id": "e499962fb97d984c",
        "type": "function",
        "z": "4c238ae3c4c60cc5",
        "g": "ae9407dc27fc42e6",
        "name": "catch commonConfig all",
        "func": "\n\nif(msg.error){\n    node.error({ \"err\": msg.error.message, \"src\": msg.error.source.id, \"n\": msg.error.source.name, \"full\": msg });\n    //context.set(\"errorCc\", context.get(\"errorCc\")+1);\n    global.get(\"utils\").errorBlink(node, 60000);\n}\nelse{\n    node.error(msg);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\n//node.status({ fill: \"gray\", shape: \"ring\", text: \"\" });\ncontext.set(\"outCc\", 0);\ncontext.set(\"errorCc\", 0);",
        "finalize": "",
        "libs": [],
        "x": 375,
        "y": 465,
        "wires": [
            []
        ]
    },
    {
        "id": "9521d980da995953",
        "type": "file",
        "z": "4c238ae3c4c60cc5",
        "g": "3562e00f4ed04fb9",
        "name": "",
        "filename": ".\\commonConfig.json",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1080,
        "y": 435,
        "wires": [
            [
                "7ca2acff2636e9cb",
                "ea8a17ead36a0d69"
            ]
        ]
    },
    {
        "id": "574b8aca29d477bf",
        "type": "function",
        "z": "4c238ae3c4c60cc5",
        "g": "ae9407dc27fc42e6",
        "name": "create default",
        "func": "\n\ncallWhenDef(()=>{\n    node.send({payload:flow.get(\"fallbackConfig\")})\n},\"fallbackConfig\")\n\n/** repeatedly tries to fetch all flowNames with flow.get(). \n    * @param {function} cb called once ALL flowName are defined\n    * @param {Object} opts object holding optional function params. can be omitted passing the first flowName instead.\n    * @param {number} opts.timeout ms delay after which stop trying and either call opts.errorCb() or log an error. defaults to 15000\n    * @param {number} opts.retryDelay ms between each attempt. defaults to 100\n    * @param {function} opts.errorCb function to call after timeout. defaults to falsy, logging a warning\n    * @param  {...any} flowNames series of strings\n    */\nfunction callWhenDef(cb, opts, ...flowNames) {\n    if (typeof (opts) == \"string\")\n        flowNames.push(opts);\n    let { timeout: timeout = 3000, retryDelay: retryDelay = 100, errorCb: errorCb = null } = (typeof (opts) == \"string\" ? opts : {});\n    var tout, intv;\n    //set timeout unless false or not specified\n    if (timeout) {\n        tout = setTimeout(() => {\n            clearInterval(intv);\n            errorCb ? errorCb() : node.warn({ err: \"callWhenDef_Timeout\", arg: arguments })\n        }, timeout);\n    }\n    //set flow-chacking interval\n    intv = setInterval(() => {\n        for (let name of flowNames)\n            if (flow.get(name) === undefined || flow.get(name) === null)\n                return\n        clearTimeout(tout);\n        clearInterval(intv);\n        cb();\n    }, retryDelay)\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 435,
        "wires": [
            [
                "003ef9d46ea05d16",
                "89dbbf6b0d6980b0"
            ]
        ]
    },
    {
        "id": "bd208da1fabb3bcf",
        "type": "function",
        "z": "4c238ae3c4c60cc5",
        "g": "55a9133a1c5a95d1",
        "name": "set flow fallbackConfig",
        "func": "",
        "outputs": 1,
        "noerr": 0,
        "initialize": "\n\n\nconst MACHINE_CFGS = {\n    \"FA419\": { toA4Timeout: 120 * 60 * 1000 },\n    \"FA420\": { toA4Timeout: 120 * 60 * 1000 },\n    \"FA421\": { toA4Timeout: 120 * 60 * 1000 },\n\n    \"FA422\": { toA4Timeout: 150 * 60 * 1000 },\n    \"FA423\": { toA4Timeout: 150 * 60 * 1000 },\n\n    \"OMET\": { toA4Timeout: 210 * 60 * 1000 },\n    \"MO41\": { toA4Timeout: 210 * 60 * 1000 },\n    \"MO42\": { toA4Timeout: 210 * 60 * 1000 }\n}\n\n/** {String[]} \"machine keys\". match the ones used in uibuilder's app. */\nconst macKeys = Object.keys(MACHINE_CFGS);\n/**  {String[]} devices that may be associated with each towersBitArray bit*/\nconst towersDevices = [\"redLight\", \"greenLight\", \"horn\"];\n{\n    let cfg;\n    for (let mKey in MACHINE_CFGS) {\n        cfg = MACHINE_CFGS[mKey];\n        cfg.displayName = mKey;\n        cfg.cellHeaderText = cfg.displayName;\n        cfg.toA3Timeout = 20 * 60 * 1000;\n        cfg.toA4Timeout = cfg.toA4Timeout;\n        cfg.initCellSignalKey = \"noop\";\n\n        cfg.blinkIntvOn = 480;\n        cfg.blinkIntvOff = 270;\n        \n        cfg.initTowerBits = {};\n            towersDevices.forEach(dev => cfg.initTowerBits[dev] = false);\n        \n        \n        \n    }\n}\n\nconst cellsLayout = [ //keys are: unique\n    [\"FA419\", \"FA420\", \"FA421\", \"FA422\"],\n    [\"FA423\", \"OMET\", \"MO41\", \"MO42\"],\n];\nflow.set(\"fallbackConfig\", {\n    machines: MACHINE_CFGS, \n    cellsLayout: cellsLayout,\n    /**  */\n    views:{\n        // \"display\":{ adminEnabled:this.cellsLayout.map( r => r.map(v => 0)) },\n        // \"SMED1\":{ adminEnabled:this.cellsLayout.map( r => r.map( v => r==0 )) }, //admin on row 0\n        // \"SMED2\":{ adminEnabled:this.cellsLayout.map( r => r.map( v => r==1 )) },\n        \"default\": { adminUI: [] }, //adminUI: <macKey>[] : machines to allow to interact with\n        \"display\":\"default\",\n        \"SMED1\":{\n            exactIpList:[\"192.168.19.116\"],\n            //adminUI:cellsLayout[0].map(v => v),\n            adminUI: [\"FA419\", \"FA420\", \"FA421\", \"FA422\",\"FA423\",\"OMET\"]\n        },\n        \"SMED2\":{\n            exactIpList:[\"192.168.19.117\"],\n            //adminUI:cellsLayout[1].map(v => v),\n            adminUI:[\"MO41\",\"MO42\"]\n        },\n        \"supervisione\":{\n            exactIpList: [\"192.168.19.118\",\"192.168.19.120\"],\n            //adminUI:cellsLayout[1].map(v => v),\n            adminUI: macKeys\n        }\n    }\n\n});\n\nnode.send(flow.get(\"fallbackConfig\"))",
        "finalize": "",
        "libs": [],
        "x": 245,
        "y": 150,
        "wires": [
            []
        ]
    },
    {
        "id": "89dbbf6b0d6980b0",
        "type": "json",
        "z": "4c238ae3c4c60cc5",
        "g": "3562e00f4ed04fb9",
        "name": "",
        "property": "payload",
        "action": "str",
        "pretty": true,
        "x": 965,
        "y": 435,
        "wires": [
            [
                "9521d980da995953"
            ]
        ],
        "l": false
    },
    {
        "id": "3c116b7c2cb7cb16",
        "type": "change",
        "z": "4c238ae3c4c60cc5",
        "d": true,
        "g": "ae9407dc27fc42e6",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "schema",
                "pt": "msg",
                "to": "commonConfigSchema",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 525,
        "wires": [
            [
                "cc89ce1d1a0c4b1d"
            ]
        ]
    },
    {
        "id": "64bc50015a2673c3",
        "type": "function",
        "z": "4c238ae3c4c60cc5",
        "d": true,
        "g": "55a9133a1c5a95d1",
        "name": "set flow commonConfigSchema",
        "func": "//look in onStart",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// I didn't find a way to required:{$ref:$def/macKey/enum}\n    //so that editing the enum would edit the required as well\nconst macKeys=[\"FA419\",\"FA420\",\"FA421\",\"FA422\",\"FA423\",\"MO41\",\"MO42\",\"OMET\"];\nconst def = {\n    //\"$schema\":\"http://json-schema.org/draft-07/schema#\",\n    //\"title\":\"commonConfigSchema\",\n    //\"description\":\"global common config for this project\",\n    \"$defs\":{\n        \"javascriptFalsy\":{\n            \"enum\":[false, 0, null, \"\"]\n        },\n        \"macKey\":{\n            \"type\":\"string\",\n            \"enum\":macKeys\n        },\n        \"signalKey\":{\n            \"type\":\"string\",\n            \"enum\":[\"noop\",\"A1\",\"A2\",\"A3\",\"A4\",\"B\",\"C1\",\"C2\",\"D\",\"E\"],\n            \"default\":\"noop\"\n        },\n        \"towerDevice\":{\n            \"type\":\"string\",\n            \"enum\":[\"redLight\",\"greenLight\",\"horn\"]\n        },\n        \"machine\":{\n            \"type\":\"object\",\n            \"properties\":{\n                \"displayName\":{\"type\":\"string\", \"default\":\"this.parent.key\"},\n                \"cellHeaderText\":{\"type\":\"string\", \"default\":\"Linea + this.displayName\"},\n                \"toA3Timeout\":{\"type\":\"integer\", \"minimum\":0, \"default\":20000},\n                \"toA4Timeout\":{\"type\":\"integer\", \"minimum\":0, \"default\":\"120*60*1000\"},\n                \"initCellSignalKey\":{\"$ref\":\"#/$defs/signalKey\", \"default\":\"noop\"},\n                \"initTowerBits\":{\n                    \"type\":\"object\",\n                    \"propertyNames\":{\"$ref\":\"#/$defs/towerDevice\"},\n                    \"patternProperties\":{\".\":{\"enum\":[0, 1, true, false], \"default\":0}}\n                }\n            },\n            \"$comment\":\"exactly all the props are required\",\n            \"additionalProperties\":false,\n            \"required\":[\"displayName\", \"cellHeaderText\", \"toA3Timeout\", \"toA4Timeout\", \"initCellSignalKey\", \"initTowerBits\"]\n        }\n    },\n    \"type\":\"object\",\n    \"properties\":{\n        \"machines\":{\n            \"$description\": \"holding machine-specific configs. Made up of macKey:config pairs\",\n            \"type\":\"object\",\n            \"propertyNames\":{\"$ref\":\"#/$defs/macKey\"},\n            \"patternProperties\":{\".\":{\"$ref\":\"#/$defs/machine\"} },\n            \"additionalProperties\":false,\n            //\"required\":{\"$ref\":\"#/$defs/macKey/enum\"},\n            \"required\": macKeys\n        },\n        \"cellsLayout\":{\n            \"$description\": \"define the UI grid layout. grid will match this matrix\",\n            \"type\":\"array\",\n            \"items\":{\n                \"type\":\"array\",\n                \"items\":{\"anyOf\":[{\"$ref\":\"#/$defs/macKey\"},{\"$ref\":\"#/$defs/javascriptFalsy\"}]},\n                \"minItems\":1\n            },\n            \"minItems\":1,\n            \"default\":[[\"FA419\",\"FA420\",\"FA421\",\"FA422\"], [\"FA423\",\"OMET\",\"MO41\",\"MO42\"]]\n        }\n    },\n    \"required\":[\"cellsLayout\", \"machines\"],\n    \"additionalProperties\":false,\n};\n\n\n\nflow.set(\"commonConfigSchema\", def);\n//node.send(def);\nnode.status({fill: \"green\", text: Object.keys(def).join(' & ') });",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 195,
        "wires": [
            []
        ]
    },
    {
        "id": "b6da99b42391a973",
        "type": "link out",
        "z": "4c238ae3c4c60cc5",
        "g": "55a9133a1c5a95d1",
        "name": "globalConfig isDefinedEvent",
        "mode": "link",
        "links": [],
        "x": 550,
        "y": 195,
        "wires": [],
        "l": true
    },
    {
        "id": "ed66d4d907d05f90",
        "type": "catch",
        "z": "4c238ae3c4c60cc5",
        "g": "3562e00f4ed04fb9",
        "name": "",
        "scope": [
            "89dbbf6b0d6980b0"
        ],
        "uncaught": false,
        "x": 925,
        "y": 405,
        "wires": [
            [
                "804a3b4edd45745d"
            ]
        ]
    },
    {
        "id": "003ef9d46ea05d16",
        "type": "change",
        "z": "4c238ae3c4c60cc5",
        "d": true,
        "g": "ae9407dc27fc42e6",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "schema",
                "pt": "msg",
                "to": "commonConfigSchema",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 850,
        "y": 465,
        "wires": [
            [
                "89dbbf6b0d6980b0"
            ]
        ]
    },
    {
        "id": "804a3b4edd45745d",
        "type": "function",
        "z": "4c238ae3c4c60cc5",
        "g": "3562e00f4ed04fb9",
        "name": "fatal error",
        "func": "node.error(\"INVALID FALLBACK JSON\")\nnode.error({ \"err\": msg.error.message, \"src\": msg.error.source.id, \"n\": msg.error.source.name, \"full\": msg });\nglobal.get(\"utils\").errorBlink(node, 60000);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 405,
        "wires": [
            []
        ]
    },
    {
        "id": "a74a33a3ec7c7366",
        "type": "catch",
        "z": "4c238ae3c4c60cc5",
        "g": "b42e082536c528eb",
        "name": "",
        "scope": [
            "cc89ce1d1a0c4b1d"
        ],
        "uncaught": false,
        "x": 715,
        "y": 585,
        "wires": [
            [
                "99496b3705baccc9",
                "bb6a645aae24c4e7"
            ]
        ]
    },
    {
        "id": "99496b3705baccc9",
        "type": "function",
        "z": "4c238ae3c4c60cc5",
        "g": "b42e082536c528eb",
        "name": "log schema error",
        "func": "if(msg.schemaError){\n    node.error(\"SCHEMA ERROR PARSING CONFIG FILE\")\n}\nif(msg.error){\n    node.error({\"err\":msg.error.message,\"src\":msg.error.source.id,\"n\":msg.error.source.name,\"full\":msg});\n}\nelse{\n    node.error(msg);\n}\nglobal.get(\"utils\").errorBlink(node, 60000);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 585,
        "wires": [
            []
        ]
    },
    {
        "id": "58a55157342e41e1",
        "type": "inject",
        "z": "4c238ae3c4c60cc5",
        "g": "b42e082536c528eb",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 720,
        "y": 615,
        "wires": [
            [
                "bb6a645aae24c4e7"
            ]
        ],
        "l": false
    },
    {
        "id": "bb6a645aae24c4e7",
        "type": "function",
        "z": "4c238ae3c4c60cc5",
        "g": "b42e082536c528eb",
        "name": "_uib showToast",
        "func": "return {\n    \"_uib\": {  // Required. VueJS Component data    \n        \"componentRef\": \"globalNotification\", // Required.\n        // options object is optional. Options are passed directly to the bootstra-vue `<toast>` component.\n        // These are examples only.\n        \"options\": { // all of the entries are optional.\n            // Creates a title section above the content that is highlighted\n            \"title\": \"Schema Parsing Error\",\n            // Main message content (appears after any payload). May contain HTML.\n            \"content\":\n                `An error occurred while retrieving data from ${msg.filename}.\n                <br>fix the errors or delete the file to restore factory defaults.\n                <br>\n                <br>Errors:<pre>${msg.schemaErrors}<pre>`,\n            // Default false. If true stops auto-Hide. \n            // Click on the close button (BV) to remove the toast.\n            // For non-BV, click on box to clear it or on background to clear all.\n            \"noAutoHide\": true,\n            // Optional colour variant. error, warning, info, primary, secondary, success\n            \"variant\": \"danger\",\n            // Default display is semi-transparent (BV only), set this to true to make the message solid colour.\n            \"solid\": true,\n\n            // BV Only. New message appears above old by default (false), change to true to add to the bottom instead.\n            \"append\": true,\n            // BV Only. Controls where on the page the toast appears. Several standard locations are available.\n            // default is top-right. Custom positions can be set by including a <toaster> element in your HTML.\n            \"toaster\": \"b-toaster-top-center\",\n            // For BV, more options are available. @see https://bootstrap-vue.org/docs/components/toast\n        }\n    }\n}\n\n\n\n\n\n/* //from http://127.0.0.1:1880/uibuilder/techdocs/#/pre-defined-msgs?id=vuejs-ui-notification-toast-control-message\n{\n    \"_uib\": {  // Required. VueJS Component data    \n        \"componentRef\": \"globalNotification\", // Required.\n        // options object is optional. Options are passed directly to the bootstra-vue `<toast>` component.\n        // These are examples only.\n        \"options\": { // all of the entries are optional.\n            // Creates a title section above the content that is highlighted\n            \"title\": \"This is the <i>title</i>\",\n            // Main message content (appears after any payload). May contain HTML.\n            \"content\": \"This is content <span style=\\\"color:red;\\\">in addition to</span> the payload\",\n            // Default false. If true stops auto-Hide. \n            // Click on the close button (BV) to remove the toast.\n            // For non-BV, click on box to clear it or on background to clear all.\n            \"noAutoHide\": true,\n            // 5000 by default, how long the message stays on-screen. Hover over message to pause countdown.\n            \"autoHideDelay\": 1500,\n            // Optional colour variant. error, warning, info, primary, secondary, success\n            \"variant\": \"info\",\n            // Default display is semi-transparent (BV only), set this to true to make the message solid colour.\n            \"solid\": true,\n\n            // BV Only. New message appears above old by default (false), change to true to add to the bottom instead.\n            \"append\": true,\n            // BV Only. If present, the whole message is turned into a link. Click takes the client to the URL.\n            \"href\": \"https://bbc.co.uk\",\n            // BV Only. Controls where on the page the toast appears. Several standard locations are available.\n            // default is top-right. Custom positions can be set by including a <toaster> element in your HTML.\n            \"toaster\": \"b-toaster-top-center\",\n            // For BV, more options are available. @see https://bootstrap-vue.org/docs/components/toast\n        },\n    },\n\n    // Optional. Will be added to the notification message (content). May be HTML.\n    \"payload\": \"<any>\",\n\n    // Optional. ID of client (from Socket.IO) - msg would only be sent to this client.\n    \"_socketId\": \"/extras#sct0MeMrdeS5lwc0AAAB\",\n}\n*/",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 615,
        "wires": [
            [
                "3521621c801627ab"
            ]
        ]
    },
    {
        "id": "3521621c801627ab",
        "type": "uib-sender",
        "z": "4c238ae3c4c60cc5",
        "g": "b42e082536c528eb",
        "url": "webapp",
        "name": "",
        "topic": "",
        "passthrough": false,
        "return": false,
        "outputs": 0,
        "x": 1015,
        "y": 615,
        "wires": []
    },
    {
        "id": "1e1402bb46babf61",
        "type": "debug",
        "z": "4c238ae3c4c60cc5",
        "g": "51320eb4ac48f6d8",
        "name": "OVERWRITTEN SETTINGS",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1365,
        "y": 495,
        "wires": []
    },
    {
        "id": "7ca2acff2636e9cb",
        "type": "file in",
        "z": "4c238ae3c4c60cc5",
        "g": "51320eb4ac48f6d8",
        "name": "",
        "filename": ".\\commonConfig.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1345,
        "y": 435,
        "wires": [
            []
        ]
    },
    {
        "id": "6cadbc88a52f084e",
        "type": "catch",
        "z": "4c238ae3c4c60cc5",
        "g": "51320eb4ac48f6d8",
        "name": "",
        "scope": [
            "7ca2acff2636e9cb",
            "9521d980da995953"
        ],
        "uncaught": false,
        "x": 1295,
        "y": 405,
        "wires": [
            [
                "3f3da9a9e6dfd77d"
            ]
        ]
    },
    {
        "id": "3f3da9a9e6dfd77d",
        "type": "function",
        "z": "4c238ae3c4c60cc5",
        "g": "51320eb4ac48f6d8",
        "name": "fatal error",
        "func": "node.error(\"CANNOT READ or WRITE CONFIG FILE. All configs will be lost\")\nnode.error({ \"err\": msg.error.message, \"src\": msg.error.source.id, \"n\": msg.error.source.name, \"full\": msg });\nglobal.get(\"utils\").errorBlink(node, 60000);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1425,
        "y": 405,
        "wires": [
            []
        ]
    },
    {
        "id": "e0a688609374d846",
        "type": "comment",
        "z": "4c238ae3c4c60cc5",
        "g": "51320eb4ac48f6d8",
        "name": "check if file was actually written to",
        "info": "",
        "x": 1385,
        "y": 465,
        "wires": []
    },
    {
        "id": "d610c787b889e968",
        "type": "comment",
        "z": "4c238ae3c4c60cc5",
        "g": "55a9133a1c5a95d1",
        "name": "GLOBALI",
        "info": "",
        "x": 205,
        "y": 105,
        "wires": []
    },
    {
        "id": "fe9dc02efe4d771c",
        "type": "exec",
        "z": "4c238ae3c4c60cc5",
        "d": true,
        "g": "ae9407dc27fc42e6",
        "command": "",
        "addpay": "",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 355,
        "y": 630,
        "wires": [
            [
                "084c89cc35050dec"
            ],
            [
                "084c89cc35050dec"
            ],
            [
                "084c89cc35050dec"
            ]
        ]
    },
    {
        "id": "084c89cc35050dec",
        "type": "debug",
        "z": "4c238ae3c4c60cc5",
        "d": true,
        "g": "ae9407dc27fc42e6",
        "name": "debug 20",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 510,
        "y": 630,
        "wires": []
    },
    {
        "id": "0658a3831dc5d007",
        "type": "inject",
        "z": "4c238ae3c4c60cc5",
        "d": true,
        "g": "ae9407dc27fc42e6",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "2",
        "topic": "",
        "x": 255,
        "y": 630,
        "wires": [
            [
                "fe9dc02efe4d771c"
            ]
        ],
        "l": false
    },
    {
        "id": "4e7faa3f31e7391f",
        "type": "comment",
        "z": "4c238ae3c4c60cc5",
        "g": "ae9407dc27fc42e6",
        "name": "on missing file -> write default one",
        "info": "",
        "x": 250,
        "y": 405,
        "wires": []
    },
    {
        "id": "27a6d7dd43730e07",
        "type": "comment",
        "z": "4c238ae3c4c60cc5",
        "g": "b42e082536c528eb",
        "name": "on validation error -> log",
        "info": "",
        "x": 775,
        "y": 645,
        "wires": []
    },
    {
        "id": "a62e3a70e91d913b",
        "type": "comment",
        "z": "4c238ae3c4c60cc5",
        "g": "3562e00f4ed04fb9",
        "name": "never: default fails validation",
        "info": "",
        "x": 1005,
        "y": 375,
        "wires": []
    },
    {
        "id": "d0677c4a55777811",
        "type": "comment",
        "z": "4c238ae3c4c60cc5",
        "g": "ae9407dc27fc42e6",
        "name": "COMMON CONFIG READ/WRITE",
        "info": "",
        "x": 240,
        "y": 345,
        "wires": []
    },
    {
        "id": "be6cdfc7a6f5fa2c",
        "type": "comment",
        "z": "4c238ae3c4c60cc5",
        "g": "b99d3df5ef07d131",
        "name": "KEEP UPDATED",
        "info": "",
        "x": 245,
        "y": 750,
        "wires": []
    },
    {
        "id": "b5b49efa8368a832",
        "type": "function",
        "z": "4c238ae3c4c60cc5",
        "d": true,
        "g": "55a9133a1c5a95d1",
        "name": "onConfigDefined",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 555,
        "y": 150,
        "wires": [
            []
        ]
    },
    {
        "id": "360f32459e430863",
        "type": "inject",
        "z": "4c238ae3c4c60cc5",
        "g": "ae9407dc27fc42e6",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 585,
        "y": 390,
        "wires": [
            [
                "574b8aca29d477bf"
            ]
        ],
        "l": false
    },
    {
        "id": "ea8a17ead36a0d69",
        "type": "json",
        "z": "4c238ae3c4c60cc5",
        "g": "b42e082536c528eb",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 900,
        "y": 525,
        "wires": [
            [
                "c2697928034ac49b",
                "1e1402bb46babf61"
            ]
        ],
        "l": false
    },
    {
        "id": "5209f75572f61192",
        "type": "function",
        "z": "4c238ae3c4c60cc5",
        "name": "set devHost view",
        "func": "\nlet idx = context.get(\"idx\") ?? 0;\nlet viewKeys = context.get(\"viewKeys\") ?? Object.keys(global.get(\"config\").views)\nlet hostIp = context.get(\"hostIp\"); //cuz it's needed in On start too\n\n//skip view if it's the same as the currently set one\nif(viewKeys[idx] == getViewForIp(hostIp))\n    idx++;\n\nsetViewForIp(viewKeys[idx], hostIp);\nnode.status({text:\"devHost's view set to \"+viewKeys[idx] })\n\n//increment and wrap\ncontext.set(\"idx\", (idx+1 >= viewKeys.length ? 0 : idx+1) )\n\n//########################################################################\n\nfunction getView(viewKey){\n    let config=global.get(\"config\");\n    var vk = viewKey;\n    var loopGuardIdx = 99;\n    do{\n        if(!config.views[vk])\n            throw new TypeError(\"unknown viewKey  \" + vk);\n        if(typeof(config.views[vk]) == \"string\"){\n            vk = config.views[vk];\n        }\n        else\n            return config.views[viewKey];\n    }while(loopGuardIdx--)\n\n    throw new Error(\"[getView()] retrieving view \"+viewKey+\" resulted in an infinite loop.\");\n}\n\nfunction setViewForIp(viewKey, ip){\n    let config = global.get(\"config\");   \n    \n    //remove ip from all views.exactIpList (there should only be one)\n    for(let vk in config.views){\n        let view=config.views[vk];\n        for(let i in view.exactIpList)\n            if(view.exactIpList[i] == ip){\n                view.exactIpList[i] = view.exactIpList[view.exactIpList.length-1];\n                view.exactIpList.length--;\n                node.warn({\"removedFrom\":view,\"ip\":ip})\n            }\n    }\n\n    //add ip to selected view\n    let view = getView(viewKey);\n    if(view.exactIpList)\n        view.exactIpList.push(ip);\n\n}\n\nfunction getViewForIp(ip) {\n    let config = global.get(\"config\");\n    for (let vk in config.views) {\n        let view = config.views[vk];\n        if (view.exactIpList && view.exactIpList.includes(ip))\n            return vk;\n    }\n    return \"default\";\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "let hostIp = \"192.168.52.1\"\ncontext.set(\"hostIp\",hostIp);\n\n\ncallWhenDef(()=>{\n    node.status({ text: \"devHost's view set to \" + getViewForIp(hostIp)})\n},\"config\")\n\n\nfunction getViewForIp(ip){\n    let config = global.get(\"config\");\n    for(let vk in config.views){\n        let view = config.views[vk];\n        if (view.exactIpList && view.exactIpList.includes(ip))\n            return vk;\n    }\n    return \"default\";\n}\n\n\nfunction callWhenDef(cb, opts, ...globalNames) {\n    if (typeof (opts) == \"string\")\n        globalNames.push(opts);\n    let { timeout: timeout = 3000, retryDelay: retryDelay = 100, errorCb: errorCb = null } = (typeof (opts) == \"string\" ? opts : {});\n    var tout, intv;\n    //set timeout unless false or not specified\n    if (timeout) {\n        tout = setTimeout(() => {\n            clearInterval(intv);\n            errorCb ? errorCb() : node.warn({ err: \"callWhenDef_Timeout\", arg: arguments })\n        }, timeout);\n    }\n    //set global-chacking interval\n    intv = setInterval(() => {\n        for (let name of globalNames)\n            if (global.get(name) === undefined || global.get(name) === null)\n                return\n        clearTimeout(tout);\n        clearInterval(intv);\n        cb();\n    }, retryDelay)\n}",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 165,
        "wires": [
            []
        ]
    },
    {
        "id": "140f5963e731eeca",
        "type": "inject",
        "z": "4c238ae3c4c60cc5",
        "name": "cycle",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 875,
        "y": 165,
        "wires": [
            [
                "5209f75572f61192"
            ]
        ]
    },
    {
        "id": "e788bf33f7250b4e",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "trigger",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "query",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 525,
        "wires": [
            [
                "734a6280c896ee84"
            ]
        ]
    },
    {
        "id": "042d220310f4d201",
        "type": "q-gate",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "queue-gate",
        "controlTopic": "queueControl",
        "defaultState": "queueing",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "queueCmd": "queue",
        "defaultCmd": "default",
        "triggerCmd": "trigger",
        "flushCmd": "flush",
        "resetCmd": "reset",
        "peekCmd": "peek",
        "dropCmd": "drop",
        "statusCmd": "status",
        "maxQueueLength": "100",
        "keepNewest": true,
        "qToggle": false,
        "persist": false,
        "storeName": "memory",
        "x": 590,
        "y": 465,
        "wires": [
            [
                "76e60fd08eb6f131",
                "829cb3bdb9fa3035"
            ]
        ]
    },
    {
        "id": "a4ea3b73128da3ca",
        "type": "function",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "queue control",
        "func": "var command = context.get(\"command\");\n  //when channel status changes\nif (flow.get(\"modbusIsReady_23KF1\")){\n  setTimeout(()=>{\n    node.send(command(\"flush\"));\n    node.send(command(\"open\"));\n  },1000); //delay messages to avoid an immediate new crash \n  return;\n}\nelse{\n  return command(\"queue\")\n}\n\n\n\n\n/* queue gate usage info clip:\n\nMessages with the topic Control Topic are control messages,\n which change or display the state of the gate\n  or manage the queue. \nControl messages setting the state are \n**open, close, toggle, queue, and default.\nThose managing the queue are\n**trigger, flush, peek, drop, and reset.\nThe status command refreshes the node status.\nA control message payload may be a string, number, or boolean.\n the payload is converted to a string and then tested against the command definitions.\n If a control message is received but not recognized, there is no output or change of state, and the node issues a warning.\nThe effects of these commands and the status object displayed\n by the node are described on https://github.com/drmibell/node-red-contrib-queue-gate\n */",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\n\ncontext.set(\"command\", function (command){\n    return { 'topic': \"queueControl\", 'payload':command};\n});",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 420,
        "wires": [
            [
                "042d220310f4d201"
            ]
        ]
    },
    {
        "id": "f31346e5c189cc0d",
        "type": "status",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "",
        "scope": [
            "829cb3bdb9fa3035"
        ],
        "x": 160,
        "y": 360,
        "wires": [
            [
                "e548c0432c3393fb",
                "70f0e9dd596f13dd",
                "a4ea3b73128da3ca",
                "94ccb2ba33d6be90"
            ]
        ]
    },
    {
        "id": "f8f56d1dd1270dfc",
        "type": "catch",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "",
        "scope": [
            "829cb3bdb9fa3035"
        ],
        "uncaught": false,
        "x": 170,
        "y": 465,
        "wires": [
            [
                "b375a71d547e53ec"
            ]
        ]
    },
    {
        "id": "e3c72d4f0636519a",
        "type": "function",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "unset error",
        "func": "delete msg.error;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 465,
        "wires": [
            []
        ]
    },
    {
        "id": "db5d63224303cb8e",
        "type": "comment",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "send msg on high and highhigh, throws warning and error too",
        "info": "",
        "x": 970,
        "y": 315,
        "wires": [],
        "l": false
    },
    {
        "id": "cba181767f3c556b",
        "type": "comment",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "when sending fails it flushes the queue appending the error to each processed msg as msg.error",
        "info": "when sending fails it flushes the queue\nappending the error to each processed msg\nas msg.error",
        "x": 775,
        "y": 435,
        "wires": [],
        "l": false
    },
    {
        "id": "d8e171d74cfb3f15",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "queueControl",
        "payload": "queue",
        "payloadType": "str",
        "x": 270,
        "y": 570,
        "wires": [
            [
                "042d220310f4d201"
            ]
        ]
    },
    {
        "id": "fae481120ae1669e",
        "type": "comment",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "holds errors and sends them again once modbus is ready. The actual queue is handled by the modbus config node.",
        "info": "holds errors and sends them again once modbus is ready.\nThe actual queue is handled by the modbus config node.",
        "x": 575,
        "y": 435,
        "wires": [],
        "l": false
    },
    {
        "id": "829cb3bdb9fa3035",
        "type": "modbus-flex-getter",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "5f741e9d0e05f1e2",
        "name": "query Pulsantiere (ZBRN1-23KF1)",
        "showStatusActivities": true,
        "showErrors": true,
        "logIOActivities": false,
        "server": "717deab8c83fa07b",
        "useIOFile": false,
        "ioFile": "",
        "useIOForPayload": false,
        "emptyMsgOnFail": true,
        "keepMsgProperties": true,
        "x": 880,
        "y": 465,
        "wires": [
            [],
            [
                "8738217e5c0cf07c"
            ]
        ]
    },
    {
        "id": "586a6d5aedbb7697",
        "type": "modbus-queue-info",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "5f741e9d0e05f1e2",
        "name": "",
        "topic": "",
        "unitid": "0",
        "queueReadIntervalTime": "100",
        "lowLowLevel": "5",
        "lowLevel": "5",
        "highLevel": "110",
        "highHighLevel": "115",
        "server": "63a4af044d8334e0",
        "errorOnHighLevel": false,
        "showStatusActivities": true,
        "updateOnAllQueueChanges": true,
        "updateOnAllUnitQueues": true,
        "x": 985,
        "y": 345,
        "wires": [
            []
        ]
    },
    {
        "id": "8d2faa48c7f2974b",
        "type": "function",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "log errors #1",
        "func": "node.status({ fill: \"gray\", shape: \"ring\", text: \"\" });\n\nif(msg.error!=undefined){\n    node.error([\"queryFailed\",msg.error]);\n    //context.set(\"errorCc\", context.get(\"errorCc\")+1);\n}\nelse{\n    node.warn(msg)\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nnode.status({ fill: \"gray\", shape: \"ring\", text: \"\" });\ncontext.set(\"outCc\", 0);\ncontext.set(\"errorCc\", 0);",
        "finalize": "",
        "libs": [],
        "x": 1245,
        "y": 435,
        "wires": [
            []
        ]
    },
    {
        "id": "70f0e9dd596f13dd",
        "type": "function",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "shareConnectionStatus",
        "func": "let deviceName = \"_23KF1\"\nflow.set(\"modbusStatusString_23KF1\", (msg.status.text ? msg.status.text : \"none\"));\n//if (msg.status.fill == \"green\" || msg.status.text == \"activated\" || msg.status.text == \"reading done\" || msg.status.text == \"queueing\"){\nif(msg.status.fill == \"green\"){\n    flow.set(\"modbusIsReady_23KF1\", true);\n    node.status({ fill: \"green\", text: \"modbusIsReady_23KF1\" });\n}\nelse{\n    flow.set(\"modbusIsReady_23KF1\", false);\n    node.status({ fill: \"red\", text: (msg.status.text ? msg.status.text : \"none\") });\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nflow.set(\"modbusStatusString\", \"none\");\nflow.set(\"modbusIsReady\", false);",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 375,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "e448cf338d7ce60a",
        "type": "link out",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "PLC Query OUT",
        "mode": "return",
        "links": [],
        "x": 1180,
        "y": 495,
        "wires": []
    },
    {
        "id": "3d7f018e03cb4a74",
        "type": "link in",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "PLC Pulsantiere (ZBRN1-23KF1) Query in",
        "links": [
            "92bab0627eba301d",
            "bfbeb3f69de7db05"
        ],
        "x": 570,
        "y": 605,
        "wires": [
            [
                "042d220310f4d201"
            ]
        ],
        "l": true
    },
    {
        "id": "8738217e5c0cf07c",
        "type": "switch",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": true,
        "outputs": 2,
        "x": 1060,
        "y": 465,
        "wires": [
            [
                "8d2faa48c7f2974b"
            ],
            [
                "e448cf338d7ce60a",
                "bacfab2b6aa8f62e",
                "c854307142509346",
                "b8bf2e09ac2a846d",
                "8a75fb67abc47146"
            ]
        ],
        "l": false
    },
    {
        "id": "ceacba052417233a",
        "type": "comment",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "INTERROGAZIONE MODBUS",
        "info": "",
        "x": 280,
        "y": 270,
        "wires": []
    },
    {
        "id": "b375a71d547e53ec",
        "type": "delay",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 265,
        "y": 465,
        "wires": [
            [
                "e3c72d4f0636519a"
            ]
        ],
        "l": false
    },
    {
        "id": "761d54a566d15f19",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 205,
        "y": 420,
        "wires": [
            [
                "a4ea3b73128da3ca"
            ]
        ],
        "l": false
    },
    {
        "id": "b7e4f98ef65e21b7",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "queueControl:trigger",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "queueControl",
        "payload": "trigger",
        "payloadType": "str",
        "x": 270,
        "y": 600,
        "wires": [
            [
                "042d220310f4d201"
            ]
        ]
    },
    {
        "id": "e548c0432c3393fb",
        "type": "debug",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "PLC STATUS CHANGE",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 380,
        "y": 315,
        "wires": []
    },
    {
        "id": "d0d9b9c907a6dfeb",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "5f741e9d0e05f1e2",
        "name": "onStartup",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 795,
        "y": 345,
        "wires": [
            [
                "586a6d5aedbb7697"
            ]
        ]
    },
    {
        "id": "bacfab2b6aa8f62e",
        "type": "debug",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "PLC OUTPUT",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1205,
        "y": 540,
        "wires": []
    },
    {
        "id": "94ccb2ba33d6be90",
        "type": "link out",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "link out 1",
        "mode": "link",
        "links": [
            "c7efc430b35e5347"
        ],
        "x": 295,
        "y": 345,
        "wires": []
    },
    {
        "id": "bfbeb3f69de7db05",
        "type": "link out",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "5f741e9d0e05f1e2",
        "name": "PLC Pulsantiere (ZBRN1-23KF1) Query out",
        "mode": "link",
        "links": [
            "3d7f018e03cb4a74"
        ],
        "x": 415,
        "y": 645,
        "wires": []
    },
    {
        "id": "76e60fd08eb6f131",
        "type": "debug",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "MODBUS QUERY",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 835,
        "y": 525,
        "wires": []
    },
    {
        "id": "373eabc42a374888",
        "type": "modbus-flex-write",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "f36f49dc5a6fb0d2",
        "name": "write to PLC Torri (ZBRCETH)",
        "showStatusActivities": true,
        "showErrors": true,
        "server": "63a4af044d8334e0",
        "emptyMsgOnFail": true,
        "keepMsgProperties": true,
        "x": 875,
        "y": 1470,
        "wires": [
            [],
            [
                "0ce5e37237e0feac"
            ]
        ]
    },
    {
        "id": "7a6e45d09f2d06fd",
        "type": "function",
        "z": "c1d4418a6f1f1693",
        "g": "f36f49dc5a6fb0d2",
        "name": "log errors #1",
        "func": "node.status({ fill: \"gray\", shape: \"ring\", text: \"\" });\n\nif(msg.error!=undefined){\n    node.error([\"queryFailed\",msg.error]);\n    //context.set(\"errorCc\", context.get(\"errorCc\")+1);\n}\nelse{\n    node.warn(msg)\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nnode.status({ fill: \"gray\", shape: \"ring\", text: \"\" });\ncontext.set(\"outCc\", 0);\ncontext.set(\"errorCc\", 0);",
        "finalize": "",
        "libs": [],
        "x": 1205,
        "y": 1425,
        "wires": [
            []
        ]
    },
    {
        "id": "be14c153c3dbc45b",
        "type": "debug",
        "z": "c1d4418a6f1f1693",
        "g": "f36f49dc5a6fb0d2",
        "name": "OUTPUT TORRI",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 1230,
        "y": 1470,
        "wires": []
    },
    {
        "id": "0ce5e37237e0feac",
        "type": "switch",
        "z": "c1d4418a6f1f1693",
        "g": "f36f49dc5a6fb0d2",
        "name": "",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": true,
        "outputs": 2,
        "x": 1065,
        "y": 1470,
        "wires": [
            [
                "7a6e45d09f2d06fd"
            ],
            [
                "be14c153c3dbc45b",
                "8aba5c7204608b4a",
                "c1ae3edd9cafb13b"
            ]
        ],
        "l": false
    },
    {
        "id": "8aba5c7204608b4a",
        "type": "link out",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "5c1ba7695a881562",
        "name": "PLC write out",
        "mode": "return",
        "links": [],
        "x": 1220,
        "y": 1515,
        "wires": [],
        "l": true
    },
    {
        "id": "6b7b42e7a9a2ca07",
        "type": "function",
        "z": "c1d4418a6f1f1693",
        "g": "3c0c9289bca3df95",
        "name": "define query functions",
        "func": "//look into start tab",
        "outputs": 1,
        "noerr": 0,
        "initialize": "\nlet obj = {\n    \"getDefault\": this.readFrom,\n    /**\n    * returns a query message that will retrieve a Number[] from the modbus slave\n    * @param {number} address number between 0 : 65535. The receiving slave prepends a prefix on its own, varying between implementations\n    * @param {number} nByte nByte to request.\n    * @returns {Object} the query message to send\n    */\n    \"readReg\": function (address = 0, quantity = 2) {\n        return {\n            'payload': {\n                'value': null,\n                'fc': 3, //mode: Holding Register\n                //'unitid': flow.get(\"defaultUnitId\") //overrides default\n                'address': address,\n                'quantity': quantity\n            }\n        };\n    },\n\n    \"readRegBetween\": (function (from, to, sequenceName = \"\") {\n        if (typeof (from) == \"string\")\n            from = parseInt(from);\n        if (typeof (to) == \"string\")\n            to = parseInt(to);\n        let ret = this.from(from, to - from + 1);\n        ret.name = sequenceName;\n        return ret;\n    }).bind(this),\n    \n    /**\n    * returns a query message that will retrieve a Boolean[] from the modbus slave\n    * @param {number} address number between 0 : 65535. The receiving slave prepends a prefix on its own, varying between implementations\n    * @param {number} nByte nByte to request.\n    * @returns {Object} the query message to send\n    */\n    \"readCoil\": function (address, nByte = 2){\n        return {\n            'payload': {\n                'value': null,\n                'fc': 1, //mode: Coil Status\n                //'unitid': flow.get(\"defaultUnitId\") //overrides default\n                'address': address,\n                'quantity': 8*nByte, //when reading coils 'quantity' refers to the number of bits and it's rounded to the closest higher multiple of 8\n            }\n        }\n    },\n    /**\n     * @description //byte order: da 2301 a 3210 //il plc salva le singole coppie di byte in LittleEndian, mentre la coppia di coppie come BigEndian. (originale: 0123 -> 01,23 -> 23,01 :inMemoria)\n     * @param [Buffer] msgPayloadBuffer Array con lunghezza pari (altrimenti l'ultimo el viene ignorato)\n     * @return Void //swap in-place\n     */\n    \"plcMem2LitEnd\": function (msgPayloadBuffer) {\n        for (let i = 0, tmp, buf = msgPayloadBuffer; i < buf.length - 1; i += 2) {\n            tmp = buf[i];\n            buf[i] = buf[i + 1];\n            buf[i + 1] = tmp;\n        }\n    },\n    /**\n     * @param [number] address <= 65535\n     * @param [any] value <= 65535\n     */\n    \"writeReg\": function (address, value) {\n        return {\n            'payload': {\n                'value': (typeof (value) == \"string\" ? parseInt(value) : value),\n                'fc': 6, //mode: single Register\n                //'unitid': flow.get(\"defaultUnitId\") //overrides default\n                'address': address,\n                'quantity': 1\n            }\n        };\n    },\n    \"writeCoil\": function (address, value) {\n        return {\n            'payload': {\n                'value': value,\n                'fc': 5, //mode: single Coil\n                //'unitid': flow.get(\"defaultUnitId\") //overrides default\n                'address': address,\n                'quantity': 1\n            }\n        };\n    },\n\n\n}\nglobal.set(\"query\", obj);\nglobal.set(\"plc\", obj);\n\nnode.status({ fill: \"green\", text: Object.keys(obj).join(' & ') });\n\n/*\nflow.set(\"getDefaultQuery\", function (address = 0, quantity = 2) {\n    return {\n        'payload':{\n            'value': null,\n            'fc': 3, //mode: Holding Register\n            'unitid': 10, //overrides default\n            'address': address,\n            'quantity': quantity\n        }\n    };\n})\n\n//from,to   string|int  hex string like \"ox802\" or int like 2050\nflow.set(\"queryRegistry\", function (from, to,sequenceName=\"\") {\n    if (typeof (from) == \"string\")\n        from = parseInt(from);\n    if (typeof (to) == \"string\")\n        to = parseInt(to);\n    let ret = flow.get(\"getDefaultQuery\")(from, to - from + 1);\n    ret.name=sequenceName;\n    return ret;\n})*/\n",
        "finalize": "",
        "libs": [],
        "x": 205,
        "y": 150,
        "wires": [
            []
        ]
    },
    {
        "id": "2f740e6f90340d55",
        "type": "comment",
        "z": "c1d4418a6f1f1693",
        "g": "3c0c9289bca3df95",
        "name": "most stuff is declared inside the START tab in function nodes",
        "info": "most stuff is declared inside the START tab in function nodes",
        "x": 315,
        "y": 150,
        "wires": [],
        "l": false
    },
    {
        "id": "ba9eb7bdda03ba32",
        "type": "comment",
        "z": "c1d4418a6f1f1693",
        "g": "3c0c9289bca3df95",
        "name": "GLOBALI",
        "info": "",
        "x": 165,
        "y": 105,
        "wires": []
    },
    {
        "id": "425ba106b1db7004",
        "type": "catch",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "5c1ba7695a881562",
        "name": "mute MissingLink",
        "scope": [
            "829cb3bdb9fa3035",
            "8aba5c7204608b4a"
        ],
        "uncaught": false,
        "x": 1320,
        "y": 1515,
        "wires": [
            []
        ],
        "l": false
    },
    {
        "id": "43bb0021e53007d6",
        "type": "link in",
        "z": "c1d4418a6f1f1693",
        "g": "f36f49dc5a6fb0d2",
        "name": "PLC Torri Write in",
        "links": [
            "24b71bc281409a22",
            "f3ab7ffd9e6e8fc2"
        ],
        "x": 410,
        "y": 1515,
        "wires": [
            [
                "164b085390efe789"
            ]
        ],
        "l": true
    },
    {
        "id": "f3ab7ffd9e6e8fc2",
        "type": "link out",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "f36f49dc5a6fb0d2",
        "name": "PLC Torri Write out",
        "mode": "link",
        "links": [
            "43bb0021e53007d6"
        ],
        "x": 355,
        "y": 1545,
        "wires": [],
        "l": true
    },
    {
        "id": "a78e59d02fd0d490",
        "type": "function",
        "z": "c1d4418a6f1f1693",
        "g": "f36f49dc5a6fb0d2",
        "name": "send query",
        "func": "/*  flow.query:\n    \"from\": function (address = 0, quantity = 2)\n    \"between\": function (from, to, sequenceName = \"\")\n    \"writeReg\": fucntion (address, value )\n    \"writeCoil\": fucntion (address, value )\n*/\n\nlet plc=global.get(\"plc\");\n\nnode.send(plc.writeReg(20,0))\n/* for(let i=0;i<0;i++){\n    node.send(plc.readFrom(4400,2));\n} */",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 415,
        "y": 1470,
        "wires": [
            [
                "164b085390efe789"
            ]
        ]
    },
    {
        "id": "182defca8c0e3554",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "g": "f36f49dc5a6fb0d2",
        "name": "trigger",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "query",
        "payload": "",
        "payloadType": "date",
        "x": 260,
        "y": 1470,
        "wires": [
            [
                "a78e59d02fd0d490"
            ]
        ]
    },
    {
        "id": "c854307142509346",
        "type": "debug",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "PLC OUT paylod.value",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload.data[0]",
        "targetType": "jsonata",
        "statusVal": "payload.value",
        "statusType": "auto",
        "x": 1235,
        "y": 570,
        "wires": []
    },
    {
        "id": "2e62157a23a3dba7",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "trigger",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "query",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 1020,
        "wires": [
            [
                "8d3151282c3b5a98"
            ]
        ]
    },
    {
        "id": "8d3151282c3b5a98",
        "type": "function",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "send query",
        "func": "/*  flow.query:\n    \"from\": function (address = 0, quantity = 2) -> msg -> number[quant] & Buffer[2*quant == nByte]\n    \"between\": function (from, to, sequenceName = \"\") -> msg -> number[quant] & Buffer[2*quant == nByte]\n    \"readCoil\": function (address, nByte ) -> msg -> Boolean[8*nByte] & Buffer[nByte]\n    \"writeReg\": fucntion (address, value )\n    \"writeCoil\": fucntion (address, value )\n*/\n\nlet plc=global.get(\"plc\");\n\n//node.send(plc.writeReg(20,0))\n\nnode.send(plc.readFrom(20, 1));\n\n/*for(let i=0;i<0;i++){\n    node.send(plc.readFrom(4400,2));\n} */",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 345,
        "y": 1020,
        "wires": [
            [
                "bf07cc975fc88621"
            ]
        ]
    },
    {
        "id": "bf07cc975fc88621",
        "type": "q-gate",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "queue-gate",
        "controlTopic": "queueControl",
        "defaultState": "queueing",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "queueCmd": "queue",
        "defaultCmd": "default",
        "triggerCmd": "trigger",
        "flushCmd": "flush",
        "resetCmd": "reset",
        "peekCmd": "peek",
        "dropCmd": "drop",
        "statusCmd": "status",
        "maxQueueLength": "100",
        "keepNewest": true,
        "qToggle": false,
        "persist": false,
        "storeName": "memory",
        "x": 580,
        "y": 960,
        "wires": [
            [
                "fe3fd3e20b792f35",
                "4b19f38c86bf496d"
            ]
        ]
    },
    {
        "id": "63fbdeb3eb8f7b82",
        "type": "function",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "queue control",
        "func": "var command = context.get(\"command\");\n  //when channel status changes\nif(flow.get(\"modbusIsReady_23KF2\")){\n  setTimeout(()=>{\n    node.send(command(\"flush\"));\n    node.send(command(\"open\"));\n  },1000); //delay messages to avoid an immediate new crash \n  return;\n}\nelse{\n  return command(\"queue\")\n}\n\n\n\n\n/* queue gate usage info clip:\n\nMessages with the topic Control Topic are control messages,\n which change or display the state of the gate\n  or manage the queue. \nControl messages setting the state are \n**open, close, toggle, queue, and default.\nThose managing the queue are\n**trigger, flush, peek, drop, and reset.\nThe status command refreshes the node status.\nA control message payload may be a string, number, or boolean.\n the payload is converted to a string and then tested against the command definitions.\n If a control message is received but not recognized, there is no output or change of state, and the node issues a warning.\nThe effects of these commands and the status object displayed\n by the node are described on https://github.com/drmibell/node-red-contrib-queue-gate\n */",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\n\ncontext.set(\"command\", function (command){\n    return { 'topic': \"queueControl\", 'payload':command};\n});",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 915,
        "wires": [
            [
                "bf07cc975fc88621"
            ]
        ]
    },
    {
        "id": "e5edd225e7282d10",
        "type": "status",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "",
        "scope": [
            "4b19f38c86bf496d"
        ],
        "x": 150,
        "y": 855,
        "wires": [
            [
                "d5b2497e77e92a57",
                "af601a2b8087c87b",
                "63fbdeb3eb8f7b82",
                "daa1b1d2d3d49cfa"
            ]
        ]
    },
    {
        "id": "00d75f9902683848",
        "type": "catch",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "",
        "scope": [
            "4b19f38c86bf496d"
        ],
        "uncaught": false,
        "x": 160,
        "y": 960,
        "wires": [
            [
                "862ed2bebe79f0fd"
            ]
        ]
    },
    {
        "id": "ed53a521c0d2270b",
        "type": "function",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "unset error",
        "func": "delete msg.error;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 960,
        "wires": [
            []
        ]
    },
    {
        "id": "f0211d0fec93e958",
        "type": "comment",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "send msg on high and highhigh, throws warning and error too",
        "info": "",
        "x": 825,
        "y": 810,
        "wires": [],
        "l": false
    },
    {
        "id": "0e156e36f11dde97",
        "type": "comment",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "when sending fails it flushes the queue appending the error to each processed msg as msg.error",
        "info": "when sending fails it flushes the queue\nappending the error to each processed msg\nas msg.error",
        "x": 765,
        "y": 930,
        "wires": [],
        "l": false
    },
    {
        "id": "31ee6cad6339930a",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "queueControl",
        "payload": "queue",
        "payloadType": "str",
        "x": 260,
        "y": 1065,
        "wires": [
            [
                "bf07cc975fc88621"
            ]
        ]
    },
    {
        "id": "0b4cd2463cf47651",
        "type": "comment",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "holds errors and sends them again once modbus is ready. The actual queue is handled by the modbus config node.",
        "info": "holds errors and sends them again once modbus is ready.\nThe actual queue is handled by the modbus config node.",
        "x": 565,
        "y": 930,
        "wires": [],
        "l": false
    },
    {
        "id": "4b19f38c86bf496d",
        "type": "modbus-flex-getter",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "9bc629dadf51c057",
        "name": "query Pulsantiere #2 (ZBRN1-23KF2)",
        "showStatusActivities": true,
        "showErrors": true,
        "logIOActivities": false,
        "server": "f9e57efbb0809783",
        "useIOFile": false,
        "ioFile": "",
        "useIOForPayload": false,
        "emptyMsgOnFail": true,
        "keepMsgProperties": true,
        "x": 880,
        "y": 960,
        "wires": [
            [],
            [
                "3dd90cf5059463c7"
            ]
        ]
    },
    {
        "id": "bd5703e182cbe354",
        "type": "modbus-queue-info",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "9bc629dadf51c057",
        "name": "",
        "topic": "",
        "unitid": "0",
        "queueReadIntervalTime": "100",
        "lowLowLevel": "5",
        "lowLevel": "5",
        "highLevel": "110",
        "highHighLevel": "115",
        "server": "63a4af044d8334e0",
        "errorOnHighLevel": false,
        "showStatusActivities": true,
        "updateOnAllQueueChanges": true,
        "updateOnAllUnitQueues": true,
        "x": 805,
        "y": 840,
        "wires": [
            []
        ]
    },
    {
        "id": "f72df8165a1fd7ff",
        "type": "function",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "log errors #1",
        "func": "node.status({ fill: \"gray\", shape: \"ring\", text: \"\" });\n\nif(msg.error!=undefined){\n    node.error([\"queryFailed\",msg.error]);\n    //context.set(\"errorCc\", context.get(\"errorCc\")+1);\n}\nelse{\n    node.warn(msg)\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nnode.status({ fill: \"gray\", shape: \"ring\", text: \"\" });\ncontext.set(\"outCc\", 0);\ncontext.set(\"errorCc\", 0);",
        "finalize": "",
        "libs": [],
        "x": 1265,
        "y": 930,
        "wires": [
            []
        ]
    },
    {
        "id": "af601a2b8087c87b",
        "type": "function",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "shareConnectionStatus",
        "func": "flow.set(\"modbusStatusString_23KF2\", (msg.status.text ? msg.status.text : \"none\"));\n//if (msg.status.fill == \"green\" || msg.status.text == \"activated\" || msg.status.text == \"reading done\" || msg.status.text == \"queueing\"){\nif(msg.status.fill == \"green\"){\n    flow.set(\"modbusIsReady_23KF2\", true);\n    node.status({ fill: \"green\", text: \"modbusIsReady_23KF2\" });\n}\nelse{\n    flow.set(\"modbusIsReady_23KF2\", false);\n    node.status({ fill: \"red\", text: (msg.status.text ? msg.status.text : \"none\") });\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nflow.set(\"modbusStatusString\", \"none\");\nflow.set(\"modbusIsReady\", false);",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 870,
        "wires": [
            []
        ]
    },
    {
        "id": "c88815753d244368",
        "type": "link out",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "PLC Query OUT",
        "mode": "return",
        "links": [],
        "x": 1200,
        "y": 990,
        "wires": []
    },
    {
        "id": "8aa45b3643dc2319",
        "type": "link in",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "PLC Pulsantiere #2 (ZBRN1-23KF2) Query in",
        "links": [
            "4768db5c30b208a2"
        ],
        "x": 570,
        "y": 1100,
        "wires": [
            [
                "bf07cc975fc88621"
            ]
        ],
        "l": true
    },
    {
        "id": "3dd90cf5059463c7",
        "type": "switch",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": true,
        "outputs": 2,
        "x": 1080,
        "y": 960,
        "wires": [
            [
                "f72df8165a1fd7ff"
            ],
            [
                "c88815753d244368",
                "f983b4df40165306",
                "b3037e275cf5fc43",
                "0d4b9b456c6abe1a",
                "16abbba19c82f5ca"
            ]
        ],
        "l": false
    },
    {
        "id": "bcdeab4ef71035e1",
        "type": "comment",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "INTERROGAZIONE MODBUS",
        "info": "",
        "x": 270,
        "y": 765,
        "wires": []
    },
    {
        "id": "862ed2bebe79f0fd",
        "type": "delay",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 255,
        "y": 960,
        "wires": [
            [
                "ed53a521c0d2270b"
            ]
        ],
        "l": false
    },
    {
        "id": "4ca372ee82cf5954",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 195,
        "y": 915,
        "wires": [
            [
                "63fbdeb3eb8f7b82"
            ]
        ],
        "l": false
    },
    {
        "id": "f7ccb9ed0ae9dfba",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "queueControl:trigger",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "queueControl",
        "payload": "trigger",
        "payloadType": "str",
        "x": 260,
        "y": 1095,
        "wires": [
            [
                "bf07cc975fc88621"
            ]
        ]
    },
    {
        "id": "d5b2497e77e92a57",
        "type": "debug",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "PLC STATUS CHANGE",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 370,
        "y": 810,
        "wires": []
    },
    {
        "id": "a992a86832b34964",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "9bc629dadf51c057",
        "name": "onStartup",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 615,
        "y": 840,
        "wires": [
            [
                "bd5703e182cbe354"
            ]
        ]
    },
    {
        "id": "f983b4df40165306",
        "type": "debug",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "PLC OUTPUT",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1225,
        "y": 1035,
        "wires": []
    },
    {
        "id": "daa1b1d2d3d49cfa",
        "type": "link out",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "link out 17",
        "mode": "link",
        "links": [
            "c7efc430b35e5347"
        ],
        "x": 285,
        "y": 840,
        "wires": []
    },
    {
        "id": "fe3fd3e20b792f35",
        "type": "debug",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "MODBUS QUERY",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 825,
        "y": 1020,
        "wires": []
    },
    {
        "id": "4768db5c30b208a2",
        "type": "link out",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "9bc629dadf51c057",
        "name": "PLC Pulsantiere Query out",
        "mode": "link",
        "links": [
            "8aa45b3643dc2319",
            "d7e71f6c5df08492"
        ],
        "x": 405,
        "y": 1140,
        "wires": []
    },
    {
        "id": "b3037e275cf5fc43",
        "type": "debug",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "PLC OUT paylod.value",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload.data[0]",
        "targetType": "jsonata",
        "statusVal": "payload.value",
        "statusType": "auto",
        "x": 1255,
        "y": 1065,
        "wires": []
    },
    {
        "id": "0d4b9b456c6abe1a",
        "type": "function",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "9bc629dadf51c057",
        "name": "function 3",
        "func": "\nnode.warn(Math.log2(msg.payload.data[0]))",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1230,
        "y": 1110,
        "wires": [
            []
        ]
    },
    {
        "id": "15bb6197c2b1fb58",
        "type": "comment",
        "z": "c1d4418a6f1f1693",
        "g": "9bc629dadf51c057",
        "name": "PULSANTIERE #2 ZBRN1-23KF2",
        "info": "",
        "x": 545,
        "y": 765,
        "wires": []
    },
    {
        "id": "5f94d8c13f129154",
        "type": "comment",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "PULSANTIERE ZBRN1-23KF1",
        "info": "",
        "x": 550,
        "y": 270,
        "wires": []
    },
    {
        "id": "5e8714bebf300e22",
        "type": "ui_text",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "5cd91f9fc303d894",
        "group": "929f87df773632c9",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "conn status",
        "format": "{{msg.modbusStatusString}}",
        "layout": "row-spread",
        "className": "",
        "x": 1960,
        "y": 915,
        "wires": []
    },
    {
        "id": "57f0a4be30f7d1d3",
        "type": "ui_text",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "5cd91f9fc303d894",
        "group": "929f87df773632c9",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "isConnectedFlag",
        "format": "{{flow.modbusIsReady.toString()}}",
        "layout": "row-spread",
        "className": "",
        "x": 1970,
        "y": 945,
        "wires": []
    },
    {
        "id": "4799a2c9df16f17e",
        "type": "switch",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "5cd91f9fc303d894",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1840,
        "y": 930,
        "wires": [
            [
                "5e8714bebf300e22",
                "57f0a4be30f7d1d3",
                "570ec02d134a5173",
                "273ce494f7a66fa8"
            ]
        ],
        "l": false
    },
    {
        "id": "570ec02d134a5173",
        "type": "ui_text",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "5cd91f9fc303d894",
        "group": "929f87df773632c9",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "lastPayload",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 1960,
        "y": 975,
        "wires": []
    },
    {
        "id": "273ce494f7a66fa8",
        "type": "ui_template",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "5cd91f9fc303d894",
        "group": "929f87df773632c9",
        "name": "full msg",
        "order": 4,
        "width": 0,
        "height": 0,
        "format": "<pre> {{msg}} </pre>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1950,
        "y": 1005,
        "wires": [
            []
        ]
    },
    {
        "id": "e2ea6a04f86a1d13",
        "type": "ui_text",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "b22ed93ba030479d",
        "group": "ebd54b01335cee21",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "conn status",
        "format": "{{flow.modbusStatusString}}",
        "layout": "row-spread",
        "className": "",
        "x": 1930,
        "y": 540,
        "wires": []
    },
    {
        "id": "1db2445822e94e9a",
        "type": "ui_text",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "b22ed93ba030479d",
        "group": "ebd54b01335cee21",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "isConnectedFlag",
        "format": "{{flow.modbusIsReady}}",
        "layout": "row-spread",
        "className": "",
        "x": 1940,
        "y": 570,
        "wires": []
    },
    {
        "id": "81e052072ae8f43d",
        "type": "switch",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "b22ed93ba030479d",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1810,
        "y": 555,
        "wires": [
            [
                "e2ea6a04f86a1d13",
                "1db2445822e94e9a",
                "a40512ebc39f24e5",
                "307370bd3db41497"
            ]
        ],
        "l": false
    },
    {
        "id": "a40512ebc39f24e5",
        "type": "ui_text",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "b22ed93ba030479d",
        "group": "ebd54b01335cee21",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "lastPayload",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 1930,
        "y": 600,
        "wires": []
    },
    {
        "id": "307370bd3db41497",
        "type": "ui_template",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "b22ed93ba030479d",
        "group": "ebd54b01335cee21",
        "name": "full msg",
        "order": 4,
        "width": 0,
        "height": 0,
        "format": "<pre> {{msg}} </pre>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1920,
        "y": 630,
        "wires": [
            []
        ]
    },
    {
        "id": "3f28a0a7d3f10e1e",
        "type": "ui_text",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "dfa4c68c2cc9b002",
        "group": "ff22d246a1b65b24",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "conn status",
        "format": "{{flow.modbusStatusString}}",
        "layout": "row-spread",
        "className": "",
        "x": 1910,
        "y": 1410,
        "wires": []
    },
    {
        "id": "303394b2bfa17df9",
        "type": "ui_text",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "dfa4c68c2cc9b002",
        "group": "ff22d246a1b65b24",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "isConnectedFlag",
        "format": "{{flow.modbusIsReady}}",
        "layout": "row-spread",
        "className": "",
        "x": 1920,
        "y": 1440,
        "wires": []
    },
    {
        "id": "ecb1f7d4b95bd34f",
        "type": "switch",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "dfa4c68c2cc9b002",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1790,
        "y": 1425,
        "wires": [
            [
                "3f28a0a7d3f10e1e",
                "303394b2bfa17df9",
                "451ca07396c03dc6",
                "1a96357a55bd59e2"
            ]
        ],
        "l": false
    },
    {
        "id": "451ca07396c03dc6",
        "type": "ui_text",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "dfa4c68c2cc9b002",
        "group": "ff22d246a1b65b24",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "lastPayload",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 1910,
        "y": 1470,
        "wires": []
    },
    {
        "id": "1a96357a55bd59e2",
        "type": "ui_template",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "dfa4c68c2cc9b002",
        "group": "ff22d246a1b65b24",
        "name": "full msg",
        "order": 4,
        "width": 0,
        "height": 0,
        "format": "<pre> {{msg}} </pre>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 1900,
        "y": 1500,
        "wires": [
            []
        ]
    },
    {
        "id": "af118073e63d8f78",
        "type": "change",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "5cd91f9fc303d894",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "modbusStatusString",
                "pt": "msg",
                "to": "modbusStatusString",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1885,
        "y": 885,
        "wires": [
            [
                "4799a2c9df16f17e"
            ]
        ]
    },
    {
        "id": "92bab0627eba301d",
        "type": "link out",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "901f019e3dcdc3eb",
        "name": "PLC Pulsantiere (ZBRN1-23KF1) Query out",
        "mode": "link",
        "links": [
            "3d7f018e03cb4a74"
        ],
        "x": 2060,
        "y": 375,
        "wires": [],
        "l": true
    },
    {
        "id": "1b2801bdd5521603",
        "type": "comment",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "9737cb6bd0dadd1f",
        "name": "#dbg toggle",
        "info": "",
        "x": 1555,
        "y": 315,
        "wires": []
    },
    {
        "id": "a94d27d4fc33b1c2",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "9737cb6bd0dadd1f",
        "name": "toggle",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "control",
        "payload": "toggle",
        "payloadType": "str",
        "x": 1575,
        "y": 345,
        "wires": [
            [
                "d1ff55d5deb88f00"
            ]
        ]
    },
    {
        "id": "d1ff55d5deb88f00",
        "type": "gate",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "9737cb6bd0dadd1f",
        "name": "",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 1680,
        "y": 375,
        "wires": [
            [
                "2e70c7d55b0e6c9f"
            ]
        ],
        "l": false
    },
    {
        "id": "c26fead50e79fbbb",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "9737cb6bd0dadd1f",
        "name": "poll 0.35s",
        "props": [],
        "repeat": "0.35",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "x": 1555,
        "y": 375,
        "wires": [
            []
        ]
    },
    {
        "id": "e26b945327fe0a7e",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "9737cb6bd0dadd1f",
        "name": "poll 2s",
        "props": [],
        "repeat": "2",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "x": 1560,
        "y": 405,
        "wires": [
            [
                "d1ff55d5deb88f00"
            ]
        ]
    },
    {
        "id": "734a6280c896ee84",
        "type": "function",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "send query",
        "func": "/*  flow.query:\n    \"readReg\": function (address = 0, quantity = 2)\n    \"between\": function (from, to, sequenceName = \"\")\n    \"writeReg\": fucntion (address, value )\n    \"writeCoil\": fucntion (address, value )\n*/\n\nlet plc=global.get(\"plc\");\n\nnode.send(plc.writeReg(20,0))\n/* for(let i=0;i<0;i++){\n    node.send(plc.readFrom(4400,2));\n} */",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 355,
        "y": 525,
        "wires": [
            [
                "042d220310f4d201"
            ]
        ]
    },
    {
        "id": "2e70c7d55b0e6c9f",
        "type": "function",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "901f019e3dcdc3eb",
        "name": "send query",
        "func": "/*  flow.query:\n    \"from\": function (address = 0, quantity = 2)\n    \"between\": function (from, to, sequenceName = \"\")\n    \"writeReg\": fucntion (address, value )\n    \"writeCoil\": fucntion (address, value )\n*/\n\nlet plc=global.get(\"plc\");\n\nnode.send(plc.readFrom(20, 1))\n\n//node.send(plc.writeReg(20,0))\n/* for(let i=0;i<0;i++){\n    node.send(plc.readFrom(4400,2));\n} */",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1805,
        "y": 375,
        "wires": [
            [
                "92bab0627eba301d"
            ]
        ]
    },
    {
        "id": "eceeeb3fae3bc7ac",
        "type": "comment",
        "z": "c1d4418a6f1f1693",
        "g": "901f019e3dcdc3eb",
        "name": "TEST CONNESSIONE MODBUS",
        "info": "",
        "x": 1855,
        "y": 285,
        "wires": []
    },
    {
        "id": "1504136a4d0bb201",
        "type": "comment",
        "z": "c1d4418a6f1f1693",
        "g": "f36f49dc5a6fb0d2",
        "name": "SCRITTURA MODBUS",
        "info": "",
        "x": 200,
        "y": 1275,
        "wires": []
    },
    {
        "id": "3320f38a9a46c264",
        "type": "comment",
        "z": "c1d4418a6f1f1693",
        "g": "f36f49dc5a6fb0d2",
        "name": "Torri ZBRCETH",
        "info": "",
        "x": 405,
        "y": 1275,
        "wires": []
    },
    {
        "id": "b8bf2e09ac2a846d",
        "type": "function",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "5f741e9d0e05f1e2",
        "name": "function 2",
        "func": "\nnode.warn(Math.log2(msg.payload.data[0]))",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1210,
        "y": 615,
        "wires": [
            []
        ]
    },
    {
        "id": "490c2ef0e4a8f524",
        "type": "status",
        "z": "c1d4418a6f1f1693",
        "g": "f36f49dc5a6fb0d2",
        "name": "",
        "scope": [
            "373eabc42a374888"
        ],
        "x": 210,
        "y": 1365,
        "wires": [
            [
                "894e8b7998890f01",
                "25ad03e0aafb40bc",
                "3686ed2f16381d14"
            ]
        ]
    },
    {
        "id": "894e8b7998890f01",
        "type": "debug",
        "z": "c1d4418a6f1f1693",
        "g": "f36f49dc5a6fb0d2",
        "name": "PLC STATUS CHANGE",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 440,
        "y": 1350,
        "wires": []
    },
    {
        "id": "25ad03e0aafb40bc",
        "type": "function",
        "z": "c1d4418a6f1f1693",
        "g": "f36f49dc5a6fb0d2",
        "name": "shareConnectionStatus",
        "func": "flow.set(\"modbusStatusString_ZBRCETH_TORRI\", (msg.status.text ? msg.status.text : \"none\"));\n//if (msg.status.fill == \"green\" || msg.status.text == \"activated\" || msg.status.text == \"reading done\" || msg.status.text == \"queueing\"){\nif(msg.status.fill == \"green\" || msg.status.text == \"writing done\"){\n    flow.set(\"modbusIsReady_ZBRCETH_TORRI\", true);\n    node.status({ fill: \"green\", text: \"modbusIsReady_ZBRCETH_TORRI\" });\n}\nelse{\n    flow.set(\"modbusIsReady_ZBRCETH_TORRI\", false);\n    node.status({ fill: \"red\", text: (msg.status.text ? msg.status.text : \"none\") });\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nflow.set(\"modbusStatusString\", \"none\");\nflow.set(\"modbusIsReady\", false);",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 1380,
        "wires": [
            []
        ]
    },
    {
        "id": "3686ed2f16381d14",
        "type": "function",
        "z": "c1d4418a6f1f1693",
        "g": "f36f49dc5a6fb0d2",
        "name": "queue control",
        "func": "var command = context.get(\"command\");\n  //when channel status changes\nif (flow.get(\"modbusIsReady_ZBRCETH_TORRI\")){\n  setTimeout(()=>{\n    node.send(command(\"flush\"));\n    node.send(command(\"open\"));\n  },1000); //delay messages to avoid an immediate new crash \n  return;\n}\nelse{\n  return command(\"queue\")\n}\n\n\n\n\n/* queue gate usage info clip:\n\nMessages with the topic Control Topic are control messages,\n which change or display the state of the gate\n  or manage the queue. \nControl messages setting the state are \n**open, close, toggle, queue, and default.\nThose managing the queue are\n**trigger, flush, peek, drop, and reset.\nThe status command refreshes the node status.\nA control message payload may be a string, number, or boolean.\n the payload is converted to a string and then tested against the command definitions.\n If a control message is received but not recognized, there is no output or change of state, and the node issues a warning.\nThe effects of these commands and the status object displayed\n by the node are described on https://github.com/drmibell/node-red-contrib-queue-gate\n */",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\n\ncontext.set(\"command\", function (command){\n    return { 'topic': \"queueControl\", 'payload':command};\n});",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 1425,
        "wires": [
            [
                "164b085390efe789"
            ]
        ]
    },
    {
        "id": "433ab3e813861fba",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "g": "f36f49dc5a6fb0d2",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 255,
        "y": 1425,
        "wires": [
            [
                "3686ed2f16381d14"
            ]
        ],
        "l": false
    },
    {
        "id": "164b085390efe789",
        "type": "q-gate",
        "z": "c1d4418a6f1f1693",
        "g": "f36f49dc5a6fb0d2",
        "name": "queue-gate",
        "controlTopic": "queueControl",
        "defaultState": "queueing",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "queueCmd": "queue",
        "defaultCmd": "default",
        "triggerCmd": "trigger",
        "flushCmd": "flush",
        "resetCmd": "reset",
        "peekCmd": "peek",
        "dropCmd": "drop",
        "statusCmd": "status",
        "maxQueueLength": "100",
        "keepNewest": true,
        "qToggle": false,
        "persist": false,
        "storeName": "memory",
        "x": 640,
        "y": 1470,
        "wires": [
            [
                "373eabc42a374888",
                "383509768f174b51"
            ]
        ]
    },
    {
        "id": "383509768f174b51",
        "type": "debug",
        "z": "c1d4418a6f1f1693",
        "g": "f36f49dc5a6fb0d2",
        "name": "MODBUS QUERY",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 829.6666259765625,
        "y": 1519,
        "wires": []
    },
    {
        "id": "f17ef08625471675",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "g": "f36f49dc5a6fb0d2",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "queueControl",
        "payload": "queue",
        "payloadType": "str",
        "x": 390,
        "y": 1590,
        "wires": [
            [
                "164b085390efe789"
            ]
        ]
    },
    {
        "id": "bdd1d0aa5c23b884",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "g": "f36f49dc5a6fb0d2",
        "name": "queueControl:trigger",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "queueControl",
        "payload": "trigger",
        "payloadType": "str",
        "x": 390,
        "y": 1620,
        "wires": [
            [
                "164b085390efe789"
            ]
        ]
    },
    {
        "id": "a0979b83808254d4",
        "type": "link out",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "onModbusConnect",
        "mode": "link",
        "links": [],
        "x": 585,
        "y": 360,
        "wires": []
    },
    {
        "id": "4e37b237f31db062",
        "type": "link out",
        "z": "c1d4418a6f1f1693",
        "g": "5f741e9d0e05f1e2",
        "name": "onModbusDisconnect",
        "mode": "link",
        "links": [],
        "x": 585,
        "y": 390,
        "wires": []
    },
    {
        "id": "ff4d8fe7b4d510fc",
        "type": "link in",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "a92d24b78c5d4a6a",
        "name": "all dbgGates",
        "links": [
            "0156636ac6d0af9f"
        ],
        "x": 1575,
        "y": 615,
        "wires": [
            [
                "8a75fb67abc47146"
            ]
        ],
        "l": true
    },
    {
        "id": "adecb2a0d654f57c",
        "type": "comment",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "a92d24b78c5d4a6a",
        "name": "#dbg toggle",
        "info": "",
        "x": 1570,
        "y": 540,
        "wires": []
    },
    {
        "id": "e103bac2f33b4750",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "a92d24b78c5d4a6a",
        "name": "toggle",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "control",
        "payload": "toggle",
        "payloadType": "str",
        "x": 1590,
        "y": 570,
        "wires": [
            [
                "8a75fb67abc47146"
            ]
        ]
    },
    {
        "id": "8a75fb67abc47146",
        "type": "gate",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "a92d24b78c5d4a6a",
        "name": "",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 1695,
        "y": 600,
        "wires": [
            [
                "81e052072ae8f43d"
            ]
        ],
        "l": false
    },
    {
        "id": "9589b17bdcd9c9f5",
        "type": "comment",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "7e18728de3dfd8df",
        "name": "#dbg toggle",
        "info": "",
        "x": 1545,
        "y": 900,
        "wires": []
    },
    {
        "id": "6b3f31881f3a8527",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "7e18728de3dfd8df",
        "name": "toggle",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "control",
        "payload": "toggle",
        "payloadType": "str",
        "x": 1565,
        "y": 930,
        "wires": [
            [
                "16abbba19c82f5ca"
            ]
        ]
    },
    {
        "id": "16abbba19c82f5ca",
        "type": "gate",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "7e18728de3dfd8df",
        "name": "",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 1670,
        "y": 960,
        "wires": [
            [
                "af118073e63d8f78"
            ]
        ],
        "l": false
    },
    {
        "id": "c607bf35e3292560",
        "type": "link in",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "7e18728de3dfd8df",
        "name": "all dbgGates",
        "links": [
            "0156636ac6d0af9f"
        ],
        "x": 1550,
        "y": 975,
        "wires": [
            [
                "16abbba19c82f5ca"
            ]
        ],
        "l": true
    },
    {
        "id": "9dfcda59798ee7a7",
        "type": "comment",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "711a9efc9122161a",
        "name": "#dbg toggle",
        "info": "",
        "x": 1545,
        "y": 1410,
        "wires": []
    },
    {
        "id": "7848c11f6274eeee",
        "type": "inject",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "711a9efc9122161a",
        "name": "toggle",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "control",
        "payload": "toggle",
        "payloadType": "str",
        "x": 1565,
        "y": 1440,
        "wires": [
            [
                "c1ae3edd9cafb13b"
            ]
        ]
    },
    {
        "id": "c1ae3edd9cafb13b",
        "type": "gate",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "711a9efc9122161a",
        "name": "",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 1670,
        "y": 1470,
        "wires": [
            [
                "ecb1f7d4b95bd34f"
            ]
        ],
        "l": false
    },
    {
        "id": "c4aefeb3271ffd19",
        "type": "link in",
        "z": "c1d4418a6f1f1693",
        "d": true,
        "g": "711a9efc9122161a",
        "name": "all dbgGates",
        "links": [
            "0156636ac6d0af9f"
        ],
        "x": 1550,
        "y": 1485,
        "wires": [
            [
                "c1ae3edd9cafb13b"
            ]
        ],
        "l": true
    },
    {
        "id": "d2907618278aa1be",
        "type": "mysql",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "7a4a549b398c4c30",
        "mydb": "f9afb515793290aa",
        "name": "",
        "x": 800,
        "y": 270,
        "wires": [
            [
                "b7a798bcb386fd7b",
                "4f448098a8371714"
            ]
        ]
    },
    {
        "id": "109d34b4b47bf77a",
        "type": "link in",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "7a4a549b398c4c30",
        "name": "queryDb in",
        "links": [],
        "x": 600,
        "y": 270,
        "wires": [
            [
                "d2907618278aa1be",
                "05085880d56d9d9b"
            ]
        ],
        "l": true
    },
    {
        "id": "b7a798bcb386fd7b",
        "type": "link out",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "7a4a549b398c4c30",
        "name": "queryDb out",
        "mode": "return",
        "links": [],
        "x": 960,
        "y": 270,
        "wires": []
    },
    {
        "id": "7120c3da33d92ab6",
        "type": "catch",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "7a4a549b398c4c30",
        "name": "",
        "scope": [
            "d2907618278aa1be"
        ],
        "uncaught": false,
        "x": 590,
        "y": 210,
        "wires": [
            [
                "b7a798bcb386fd7b",
                "4f448098a8371714",
                "ea8b50b73c73f985",
                "dbe405c3c9e4b6f5"
            ]
        ]
    },
    {
        "id": "44e7dfbb15aa708f",
        "type": "comment",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "7a4a549b398c4c30",
        "name": "QUERY DATABASE",
        "info": "-always returns something\n-log errors to file\n",
        "x": 610,
        "y": 110,
        "wires": []
    },
    {
        "id": "8d6a9abd8282b7df",
        "type": "comment",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "7a4a549b398c4c30",
        "name": "general usage info",
        "info": "\n- this node sets its status to the LAST operation's outcome.\n    Meaning it will stay the same unless another query is sent\n-mysql errors are thrown as exceptions\n-connection state is not shared.",
        "x": 650,
        "y": 150,
        "wires": []
    },
    {
        "id": "4f448098a8371714",
        "type": "debug",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "7a4a549b398c4c30",
        "name": "dbOutput",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1095,
        "y": 270,
        "wires": []
    },
    {
        "id": "de4853ea3edf7e99",
        "type": "file in",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "c05cbc581f087383",
        "name": "dbErrors.log lines",
        "filename": "./dbErrors.log",
        "filenameType": "str",
        "format": "lines",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 780,
        "y": 445,
        "wires": [
            [
                "1e4b67881e90dc1c",
                "fed8c45c180c3512"
            ]
        ]
    },
    {
        "id": "aa835b5d1cc02d9b",
        "type": "inject",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "c05cbc581f087383",
        "name": "24h",
        "props": [],
        "repeat": "86400",
        "crontab": "",
        "once": true,
        "onceDelay": "3",
        "topic": "",
        "x": 620,
        "y": 445,
        "wires": [
            [
                "de4853ea3edf7e99"
            ]
        ]
    },
    {
        "id": "1e4b67881e90dc1c",
        "type": "join",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "c05cbc581f087383",
        "name": "",
        "mode": "custom",
        "build": "array",
        "property": "",
        "propertyType": "full",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1000,
        "y": 445,
        "wires": [
            [
                "60ad0ab445a162eb"
            ]
        ]
    },
    {
        "id": "fed8c45c180c3512",
        "type": "trigger",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "c05cbc581f087383",
        "name": "5s -> msg.complete",
        "op1": "",
        "op2": "{\"complete\":true}",
        "op1type": "nul",
        "op2type": "json",
        "duration": "5",
        "extend": true,
        "overrideDelay": false,
        "units": "s",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 920,
        "y": 405,
        "wires": [
            [
                "1e4b67881e90dc1c"
            ]
        ]
    },
    {
        "id": "60ad0ab445a162eb",
        "type": "function",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "c05cbc581f087383",
        "name": "max 10k leftshift",
        "func": "\nlet newLength = 10000;\nif(msg.payload.length > newLength){\n    let diff = msg.payload.length - newLength;\n    for (let i = 0; i < newLength; i++)\n        msg.payload[i] = msg.payload[i + diff];\n    msg.payload.length = newLength;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1170,
        "y": 445,
        "wires": [
            []
        ]
    },
    {
        "id": "d577904798f15058",
        "type": "comment",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "c05cbc581f087383",
        "name": "limit log size",
        "info": "",
        "x": 620,
        "y": 405,
        "wires": []
    },
    {
        "id": "ea8b50b73c73f985",
        "type": "function",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "d07dfb333aed56ce",
        "name": "prepare log",
        "func": "function safeStringify(obj) {\n    var cache = [];\n    var cacheKeys = [];\n    return JSON.stringify(obj, (key, value) => {\n        if (typeof value === 'object' && value !== null) {\n            //Duplicate reference found -> discard key / store\n            const idx = cache.indexOf(value)\n            //if duplicate found\n            //return twin's key instead\n            if (idx != -1) //-1 means not present\n                return \"dupOf_\" + (cacheKeys[idx].toString() ?? \"root\");\n            //else store it\n            else {\n                cache.push(value);\n                cacheKeys.push(key);\n            }\n        }\n        return value;\n    });\n}\n\ndelete msg._msgid\ndelete msg._event\n \nreturn {\n    payload: { time: new Date().toString(), ms: Date.now(), msg: msg }\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 925,
        "y": 210,
        "wires": [
            [
                "afac37083de7623f"
            ]
        ],
        "l": false
    },
    {
        "id": "afac37083de7623f",
        "type": "file",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "d07dfb333aed56ce",
        "name": "",
        "filename": "dbErrors.log",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 1060,
        "y": 210,
        "wires": [
            []
        ]
    },
    {
        "id": "43fdf2a5a134b272",
        "type": "function",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "d07dfb333aed56ce",
        "name": "all dbErrors",
        "func": "\nif (msg.error) {\n    node.error({ \"err\": msg.error.message, \"n\": msg.error.source.name, \"q\":msg.topic, \"full\": msg });\n}\nelse {\n    node.error(msg);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 170,
        "wires": [
            []
        ]
    },
    {
        "id": "dbe405c3c9e4b6f5",
        "type": "gate",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "d07dfb333aed56ce",
        "name": "",
        "controlTopic": "control",
        "defaultState": "open",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 945,
        "y": 170,
        "wires": [
            [
                "43fdf2a5a134b272"
            ]
        ],
        "l": false
    },
    {
        "id": "4e11b2f45a32813c",
        "type": "inject",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "d07dfb333aed56ce",
        "name": "toggle",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "control",
        "payload": "toggle",
        "payloadType": "str",
        "x": 1010,
        "y": 130,
        "wires": [
            [
                "dbe405c3c9e4b6f5"
            ]
        ]
    },
    {
        "id": "d2cc8a993cf033bf",
        "type": "comment",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "7a4a549b398c4c30",
        "name": "this db recap",
        "info": "",
        "x": 790,
        "y": 110,
        "wires": []
    },
    {
        "id": "05085880d56d9d9b",
        "type": "mysql",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "7a4a549b398c4c30",
        "mydb": "069aa519f61e8808",
        "name": "_dev@root",
        "x": 790,
        "y": 300,
        "wires": [
            [
                "b7a798bcb386fd7b"
            ]
        ]
    },
    {
        "id": "4e88477a10e3c17e",
        "type": "function",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "2bbbe4dc6cfeb097",
        "name": "set global.mysql",
        "func": "//look into onStart tab",
        "outputs": 1,
        "noerr": 0,
        "initialize": "\n\n/* javascript class cheatsheet\n//everything is public.\n    #varname == private\n    *method() == private\n    get varname()/get varname:f() = getter for varname\n//; at each line's end\n*/\nclass mysql {\n    #tableDict;\n    /** @param dbgMode:Bool flag to enable typo checking and such */\n    dbgMode; //unused\n    get tableDict() {\n        return this.#tableDict;\n    }\n\n    constructor() {\n        this.#tableDict = {\n            storico: [\"unixMs\", \"col1\", \"col2\", \"col3\", \"col4\"]\n        };\n        this.dbgMode = false;\n    };\n\n    /**\n     * wait for db to be ready for queries, then send it.<br>\n     * - it's recomended to copy-paste this in the node instead of calling it, as to have error's origin set to the caller\n     * @param {typeof Object.prototype} query - query to send\n     * @param {number} retryDelay - time in ms to pass to setInterval()\n     * @param {number} timeout - time in ms after which stop trying and outputting an error.\n     * @returns {void}\n    */\n    asyncSend(callerNode, query, retryDelay=5000,timeout=120*1000){\n        node.warn({ err: \"STILL USING ASYNC SEND\", source: callerNode.id})\n        if(global.get(\"dbIsOk\")) {\n            callerNode.send(query);\n        }\n        else {\n            let tout;\n            const intv = setInterval(() => {\n                if (global.get(\"dbIsOk\")) {\n                    clearInterval(intv);\n                    tout && clearTimeout(tout);\n                    callerNode.send(query, false)\n                }\n            }, retryDelay)\n            \n            tout = setTimeout(() => {\n                clearInterval(intv);\n                callerNode.error({ err: \"mysql:query timedout\", q: query });\n            }, timeout);\n        }\n    }\n\n    newRow(table, pairsObj, extraSql = \"\") {\n        return `INSERT INTO ${table} SET ${(this.toList(pairsObj))} ${extraSql}`;\n    };\n\n    toList(pairs) {\n        let assignList = \"\";\n        for(const key in pairs) {\n            assignList += `${key}=${pairs[key]}, `;\n        }\n        if(assignList)\n            assignList = assignList.slice(0, -2);\n        return assignList;\n    }\n\n//\n\n    insert(template, pairs) { }\n\n    static insertStorico(vals) {\n        var { POTENZA_ATTIVA, POTENZA_PV1, POTENZA_PV2 } = vals\n    }\n    static query(template, valObj) {\n\n    }\n}\nglobal.set(\"mysql\", new mysql());\n\nnode.status({ fill: \"green\", text:\"new mysql()\" });\n",
        "finalize": "",
        "libs": [],
        "x": 145,
        "y": 135,
        "wires": [
            [
                "50feeadd8d078ab3",
                "1eb170112f76f377"
            ]
        ]
    },
    {
        "id": "50feeadd8d078ab3",
        "type": "change",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "2bbbe4dc6cfeb097",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "mysql",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 135,
        "wires": [
            []
        ]
    },
    {
        "id": "1eb170112f76f377",
        "type": "debug",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "2bbbe4dc6cfeb097",
        "name": "mysql",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 315,
        "y": 180,
        "wires": []
    },
    {
        "id": "445fed90cc9ae04b",
        "type": "function",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "2bbbe4dc6cfeb097",
        "name": "set global.functions",
        "func": "\nnode.global.set(\"utils\",{\n    errorMsg:function (){\n\n    }\n\n});",
        "outputs": 1,
        "noerr": 0,
        "initialize": "\n\n/* javascript class cheatsheet\n//everything is public.\n    #varname == private\n    *method() == private\n    get varname()/get varname:f() = getter for varname\n//; at each line's end\n*/\nclass mysql {\n    #tableDict;\n    /** @param dbgMode:Bool flag to enable typo checking and such */\n    dbgMode; //unused\n    get tableDict() {\n        return this.#tableDict;\n    }\n\n    constructor() {\n        this.#tableDict = {\n            storico: [\"unixMs\", \"col1\", \"col2\", \"col3\", \"col4\"]\n        };\n        this.dbgMode = false;\n    };\n\n    /**\n     * wait for db to be ready for queries, then send it.<br>\n     * - it's recomended to copy-paste this in the node instead of calling it, as to have error's origin set to the caller\n     * @param {typeof Object.prototype} query - query to send\n     * @param {number} retryDelay - time in ms to pass to setInterval()\n     * @param {number} timeout - time in ms after which stop trying and outputting an error.\n     * @returns {void}\n    */\n    asyncSend(callerNode, query, retryDelay=5000,timeout=120*1000){\n        if(global.get(\"dbIsOk\")) {\n            callerNode.send(query);\n        }\n        else {\n            let tout;\n            const intv = setInterval(() => {\n                if (global.get(\"dbIsOk\")) {\n                    clearInterval(intv);\n                    tout && clearTimeout(tout);\n                    callerNode.send(query, false)\n                }\n            }, retryDelay)\n            \n            tout = setTimeout(() => {\n                clearInterval(intv);\n                callerNode.error({ err: \"mysql:query timedout\", q: query });\n            }, timeout);\n        }\n    }\n\n    newRow(table, pairsObj, extraSql = \"\") {\n        return `INSERT INTO ${table} SET ${(this.toList(pairsObj))} ${extraSql}`;\n    };\n\n    toList(pairs) {\n        let assignList = \"\";\n        for(const key in pairs) {\n            assignList += `${key}=${pairs[key]}, `;\n        }\n        if(assignList)\n            assignList = assignList.slice(0, -2);\n        return assignList;\n    }\n\n//\n\n    insert(template, pairs) { }\n\n    static insertStorico(vals) {\n        var { POTENZA_ATTIVA, POTENZA_PV1, POTENZA_PV2 } = vals\n    }\n    static query(template, valObj) {\n\n    }\n}\nglobal.set(\"mysql\", new mysql());\n\nnode.status({fill:\"green\",text:\"defined\"});",
        "finalize": "",
        "libs": [],
        "x": 150,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "c2be07fdd0c16931",
        "type": "switch",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "015cd5895c17da64",
        "name": "flow.dbHadError",
        "property": "dbHadError",
        "propertyType": "flow",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 340,
        "y": 670,
        "wires": [
            [
                "15852055c342f46e"
            ],
            [
                "9a225e0d13c1f834"
            ]
        ]
    },
    {
        "id": "9a225e0d13c1f834",
        "type": "link call",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "015cd5895c17da64",
        "name": "queryDb",
        "links": [
            "109d34b4b47bf77a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 760,
        "y": 670,
        "wires": [
            [
                "a5b60ba381f9b108"
            ]
        ]
    },
    {
        "id": "a5b60ba381f9b108",
        "type": "switch",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "015cd5895c17da64",
        "name": "msg.error",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 900,
        "y": 670,
        "wires": [
            [
                "56e0b0f75ee7ed61",
                "263134e42e86e47b"
            ],
            [
                "71950aee80a23402"
            ]
        ]
    },
    {
        "id": "15852055c342f46e",
        "type": "function",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "015cd5895c17da64",
        "name": "delay 4s->60m",
        "func": "//enqueue msg after increasing delay, stack size is limited\n\n//prepare msg\ndelete msg.error;\nmsg.attempts = (msg.attempts ? msg.attempts+1 : 1);\n\n//enqueue msg after increasing delay\n    //calc delay\nlet a = msg.attempts - 1;\nlet base = 4000; //4, 6, 9, 13 //4, 6.4\nvar delay = (Math.pow(3, a) / Math.pow(2, a)) * base // ( 3^i/2^i )*d <=> di+1 = di + (1/2)di\ndelay = Math.min(delay, 3600000) //max 60m\n    //set timeout\nlet tout = setTimeout(() => {\n    //node.warn({ txt: \"sent after\", d: delay })\n    node.send(msg, false);\n}, delay)\n\n//track timeouts\n    //at max size replace the older one\nvar allTouts = context.get(\"timeoutsRefArray\") ?? [];\nlet newItem = { tout: tout, full: msg };\nif (allTouts.length > 5000) {\n    //find older\n    let maxIdx;\n    for (let i = 0; i < allTouts.length; i++)\n        if (allTouts[i].a > allTouts[maxIdx].a)\n            maxIdx = i;\n    //clear it\n    clearTimeout(allTouts[maxIdx].tout);\n    //log it or whatever\n    node.send([null, msg], false);\n    //replace with new\n    allTouts[maxIdx] = newItem;\n}\nelse\n    allTouts.push(newItem);\n    \ncontext.set(\"timeoutsRefArray\",allTouts);\n\n\n\n\n/*\nif(context.get(\"allTouts\")){\n    let i = context.get(\"maxAttempts\")-1;\n    let base = 4000; //4, 6, 9, 13 //4, 6.4\n    var delay = ( Math.pow(3, i) / Math.pow(2, i) )*base // ( 3^i/2^i )*d <=> di+1 = di + (1/2)di\n    delay = Math.max(delay,1800) //max 30m\n    context.set(\"retryTimeout\",setTimeout(,delay))\n}\n\n\n    return msg;\n    */",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 610,
        "wires": [
            [
                "e4476e1da8adfa98"
            ],
            [
                "aaacd9c0df2207bc"
            ]
        ],
        "outputLabels": [
            "try",
            "dropped"
        ]
    },
    {
        "id": "56e0b0f75ee7ed61",
        "type": "change",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "015cd5895c17da64",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "dbHadError",
                "pt": "flow",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 260,
        "y": 610,
        "wires": [
            [
                "15852055c342f46e"
            ]
        ]
    },
    {
        "id": "71950aee80a23402",
        "type": "change",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "015cd5895c17da64",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "dbHadError",
                "pt": "flow",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1090,
        "y": 670,
        "wires": [
            []
        ]
    },
    {
        "id": "a9a1170dafd3f770",
        "type": "link in",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "015cd5895c17da64",
        "name": "queryDb_queued in",
        "links": [
            "a43a5eb1d2dbd9bd"
        ],
        "x": 150,
        "y": 670,
        "wires": [
            [
                "c2be07fdd0c16931"
            ]
        ],
        "l": true
    },
    {
        "id": "9099955c40e2fc51",
        "type": "comment",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "015cd5895c17da64",
        "name": "on error -> queue and limit rate",
        "info": "\nmsg are queue in parallel, using timeouts.\nrate is also limited, so the actual delay may exceed the timeout by\n    rateTime * queueLength, growing without limits if inputs exceed rate.",
        "x": 490,
        "y": 570,
        "wires": []
    },
    {
        "id": "e4476e1da8adfa98",
        "type": "delay",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "015cd5895c17da64",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "5",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 680,
        "y": 610,
        "wires": [
            [
                "9a225e0d13c1f834"
            ]
        ]
    },
    {
        "id": "b2df6d219fc4e5d5",
        "type": "comment",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "015cd5895c17da64",
        "name": "good for time-independent INSERTs",
        "info": "",
        "x": 780,
        "y": 570,
        "wires": []
    },
    {
        "id": "40c718410b4aa9ae",
        "type": "comment",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "015cd5895c17da64",
        "name": "COMMON RESPONSELESS FLOW",
        "info": "",
        "x": 200,
        "y": 570,
        "wires": []
    },
    {
        "id": "263134e42e86e47b",
        "type": "debug",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "015cd5895c17da64",
        "name": "DB QUEUED WARN",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "topic",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1120,
        "y": 630,
        "wires": []
    },
    {
        "id": "74f782b5c9918cb1",
        "type": "file in",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "c6691944eaed7410",
        "name": "dbErrors.log lines",
        "filename": "./dbErrors.log",
        "filenameType": "str",
        "format": "lines",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 730,
        "y": 810,
        "wires": [
            [
                "1324ee68fb02e80c",
                "64cf467ff1198d60"
            ]
        ]
    },
    {
        "id": "778d922066b06dc9",
        "type": "inject",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "c6691944eaed7410",
        "name": "24h",
        "props": [],
        "repeat": "86400",
        "crontab": "",
        "once": true,
        "onceDelay": "3",
        "topic": "",
        "x": 570,
        "y": 810,
        "wires": [
            [
                "74f782b5c9918cb1"
            ]
        ]
    },
    {
        "id": "1324ee68fb02e80c",
        "type": "join",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "c6691944eaed7410",
        "name": "",
        "mode": "custom",
        "build": "array",
        "property": "",
        "propertyType": "full",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 950,
        "y": 810,
        "wires": [
            [
                "a30b7f56e3861d49"
            ]
        ]
    },
    {
        "id": "64cf467ff1198d60",
        "type": "trigger",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "c6691944eaed7410",
        "name": "5s -> msg.complete",
        "op1": "",
        "op2": "{\"complete\":true}",
        "op1type": "nul",
        "op2type": "json",
        "duration": "5",
        "extend": true,
        "overrideDelay": false,
        "units": "s",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 870,
        "y": 770,
        "wires": [
            [
                "1324ee68fb02e80c"
            ]
        ]
    },
    {
        "id": "a30b7f56e3861d49",
        "type": "function",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "c6691944eaed7410",
        "name": "max 10k leftshift",
        "func": "\nlet newLength = 10000;\nif(msg.payload.length > newLength){\n    let diff = msg.payload.length - newLength;\n    for (let i = 0; i < newLength; i++)\n        msg.payload[i] = msg.payload[i + diff];\n    msg.payload.length = newLength;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 810,
        "wires": [
            []
        ]
    },
    {
        "id": "76167b51b59bab4d",
        "type": "comment",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "c6691944eaed7410",
        "name": "limit log size",
        "info": "",
        "x": 570,
        "y": 770,
        "wires": []
    },
    {
        "id": "aaacd9c0df2207bc",
        "type": "file",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "c6691944eaed7410",
        "name": "",
        "filename": "dbDroppedQueries.log",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 390,
        "y": 810,
        "wires": [
            []
        ]
    },
    {
        "id": "e60338ef13bfc039",
        "type": "comment",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "c6691944eaed7410",
        "name": "log dropped queries",
        "info": "",
        "x": 370,
        "y": 770,
        "wires": []
    },
    {
        "id": "aa40c2fd63e42b3c",
        "type": "comment",
        "z": "687893cfe8ebd28b",
        "d": true,
        "g": "2bbbe4dc6cfeb097",
        "name": "GLOBALI",
        "info": "",
        "x": 125,
        "y": 90,
        "wires": []
    },
    {
        "id": "d83b9961b3c5fb9e",
        "type": "link in",
        "z": "76b05f87a5290cf6",
        "g": "31f4b8716c51f385",
        "name": "uib event out",
        "links": [
            "64690dd246039799"
        ],
        "x": 185,
        "y": 1905,
        "wires": [
            [
                "2c415eda999050f1",
                "f25308f6b79bce5d"
            ]
        ],
        "l": true
    },
    {
        "id": "2c415eda999050f1",
        "type": "switch",
        "z": "76b05f87a5290cf6",
        "g": "31f4b8716c51f385",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "cellButtonClick",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 315,
        "y": 1905,
        "wires": [
            [
                "63cb5672c06fad4e"
            ],
            [
                "e90fd6ebd8e9a846"
            ]
        ],
        "l": false
    },
    {
        "id": "e90fd6ebd8e9a846",
        "type": "function",
        "z": "76b05f87a5290cf6",
        "g": "31f4b8716c51f385",
        "name": "default: warn",
        "func": "node.warn({txt:\"unhandled uibuilder msg.topic \",event:msg.topic,fullMsg:msg});",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 445,
        "y": 1950,
        "wires": [
            []
        ]
    },
    {
        "id": "63cb5672c06fad4e",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "g": "31f4b8716c51f385",
        "name": "uibOn cellButtonClick",
        "mode": "link",
        "links": [
            "32bb7ae2d8f0c7dc"
        ],
        "x": 475,
        "y": 1875,
        "wires": [],
        "l": true
    },
    {
        "id": "a2e783d72e228d3a",
        "type": "comment",
        "z": "76b05f87a5290cf6",
        "g": "31f4b8716c51f385",
        "name": "handle all uib events",
        "info": "",
        "x": 210,
        "y": 1800,
        "wires": []
    },
    {
        "id": "71bdf71b7ab73ed4",
        "type": "uibuilder",
        "z": "76b05f87a5290cf6",
        "g": "6aa375e2e3177ccc",
        "name": "webapp",
        "topic": "none",
        "url": "webapp",
        "fwdInMessages": false,
        "allowScripts": false,
        "allowStyles": false,
        "copyIndex": true,
        "templateFolder": "vue",
        "extTemplate": "",
        "showfolder": false,
        "reload": true,
        "sourceFolder": "src",
        "deployedVersion": "5.1.1",
        "x": 630,
        "y": 495,
        "wires": [
            [
                "0c33f8d537e42c41"
            ],
            [
                "5952d8e029f830cd",
                "201682b5f3dc37e9"
            ]
        ]
    },
    {
        "id": "29da4c340c1c0f16",
        "type": "link in",
        "z": "76b05f87a5290cf6",
        "g": "6aa375e2e3177ccc",
        "name": "toWebapp in",
        "links": [
            "3f92af885fe4a9d4",
            "c9da44f4b5572f7d",
            "0eac813026d73747",
            "5b212e022781a789",
            "cfbba0824276973c",
            "ab8ca08ba9111f30",
            "079b24bde6bc7913",
            "a2edf08098c0b6df",
            "6d4bfaadae660075",
            "2473f05cfebcb6eb",
            "cad4815a5257b1da",
            "e75d7071ecbb680a",
            "7a335b524105f1eb",
            "cab714306ffd93d0",
            "7f3892b70e89d932",
            "a984ae5f89c982aa",
            "6c7b45a7a15ce7ca",
            "7e254c27479ac8aa",
            "16644ec203b99989",
            "446f1af64d58d0d6",
            "966a2e40f7e7e922",
            "2a6a1d0cbfeb5f83",
            "5730340fa9556086"
        ],
        "x": 185,
        "y": 495,
        "wires": [
            [
                "c41737c1cb63ff35",
                "75ef4d5b0e672f1e"
            ]
        ],
        "l": true
    },
    {
        "id": "c9da44f4b5572f7d",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "6aa375e2e3177ccc",
        "name": "toWebapp out",
        "mode": "link",
        "links": [
            "29da4c340c1c0f16",
            "0ec40d54c47c43ad",
            "479573b30e6666e1"
        ],
        "x": 165,
        "y": 450,
        "wires": [],
        "l": true
    },
    {
        "id": "0c33f8d537e42c41",
        "type": "switch",
        "z": "76b05f87a5290cf6",
        "g": "6aa375e2e3177ccc",
        "name": "msg.type",
        "property": "type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "request",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "command",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "event",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 4,
        "x": 840,
        "y": 480,
        "wires": [
            [
                "16c03e6dc270a0a8"
            ],
            [
                "138d917ae417b855"
            ],
            [
                "64690dd246039799"
            ],
            [
                "6b19a1a58b2b90d0"
            ]
        ]
    },
    {
        "id": "6b19a1a58b2b90d0",
        "type": "function",
        "z": "76b05f87a5290cf6",
        "g": "6aa375e2e3177ccc",
        "name": "default: warn",
        "func": "node.warn({txt:\"unhandled uibuilder msg.type\",topic:msg.type,fullMsg:msg});\n\nglobal.get(\"utils\").errorBlink(node,60000);\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1000,
        "y": 525,
        "wires": [
            []
        ]
    },
    {
        "id": "16c03e6dc270a0a8",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "g": "6aa375e2e3177ccc",
        "name": "uib request out",
        "mode": "link",
        "links": [
            "3e1fc30868d42f0c",
            "7103451c8f1ce3d3"
        ],
        "x": 1010,
        "y": 435,
        "wires": [],
        "l": true
    },
    {
        "id": "64690dd246039799",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "g": "6aa375e2e3177ccc",
        "name": "uib event out",
        "mode": "link",
        "links": [
            "d83b9961b3c5fb9e",
            "d23c81a0325ee4c4"
        ],
        "x": 1000,
        "y": 495,
        "wires": [],
        "l": true
    },
    {
        "id": "3e1fc30868d42f0c",
        "type": "link in",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "6aa375e2e3177ccc",
        "name": "uib request out",
        "links": [
            "16c03e6dc270a0a8"
        ],
        "x": 1205,
        "y": 435,
        "wires": [
            []
        ],
        "l": true
    },
    {
        "id": "d23c81a0325ee4c4",
        "type": "link in",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "6aa375e2e3177ccc",
        "name": "uib event out",
        "links": [
            "64690dd246039799"
        ],
        "x": 1195,
        "y": 510,
        "wires": [
            []
        ],
        "l": true
    },
    {
        "id": "42b44a1c5d242838",
        "type": "comment",
        "z": "76b05f87a5290cf6",
        "g": "abf36b9570f058cc",
        "name": "handle all uib requests",
        "info": "requests are queries which expect a single response. like an http request.\n\ndb queries, initializations and such",
        "x": 230,
        "y": 915,
        "wires": []
    },
    {
        "id": "7103451c8f1ce3d3",
        "type": "link in",
        "z": "76b05f87a5290cf6",
        "g": "d1418df470ae9fa4",
        "name": "uib request in",
        "links": [
            "16c03e6dc270a0a8"
        ],
        "x": 205,
        "y": 1080,
        "wires": [
            [
                "d6a1db03463f5561",
                "4997d19a44b639d3"
            ]
        ],
        "l": true
    },
    {
        "id": "d6a1db03463f5561",
        "type": "switch",
        "z": "76b05f87a5290cf6",
        "g": "d1418df470ae9fa4",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "setCellSignal",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 330,
        "y": 1080,
        "wires": [
            [
                "5d4e2536bd217ebb"
            ],
            [
                "8c87150121a07852"
            ]
        ],
        "l": false
    },
    {
        "id": "8c87150121a07852",
        "type": "function",
        "z": "76b05f87a5290cf6",
        "g": "d1418df470ae9fa4",
        "name": "default: warn",
        "func": "\nglobal.get(\"utils\").errorBlink(node, 60000);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 505,
        "y": 1020,
        "wires": [
            []
        ]
    },
    {
        "id": "5d4e2536bd217ebb",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "g": "9eae3823833d4d69",
        "name": "setCellSignal",
        "mode": "link",
        "links": [
            "ca2b9f6d1617d974",
            "8a8226dfe4a11ffa",
            "1783afc82891b9af"
        ],
        "x": 580,
        "y": 1080,
        "wires": [],
        "l": true
    },
    {
        "id": "8592536a56dff0ec",
        "type": "link in",
        "z": "76b05f87a5290cf6",
        "g": "9eae3823833d4d69",
        "name": "setCellSignal in",
        "links": [
            "8a869fbf2653f1a4",
            "7b854e8aa4029bbe",
            "0ddad7d958c8cfec"
        ],
        "x": 670,
        "y": 1080,
        "wires": [
            [
                "84ae7b1a0d4f5b64"
            ]
        ]
    },
    {
        "id": "3f92af885fe4a9d4",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "g": "d1418df470ae9fa4",
        "name": "toWebapp out",
        "mode": "link",
        "links": [
            "29da4c340c1c0f16",
            "0ec40d54c47c43ad",
            "479573b30e6666e1"
        ],
        "x": 1225,
        "y": 1065,
        "wires": [],
        "l": true
    },
    {
        "id": "fa5fe09d4f7a35d0",
        "type": "switch",
        "z": "76b05f87a5290cf6",
        "g": "d1418df470ae9fa4",
        "name": "has _socketId",
        "property": "_socketId",
        "propertyType": "msg",
        "rules": [
            {
                "t": "istype",
                "v": "string",
                "vt": "string"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 1035,
        "y": 1095,
        "wires": [
            [
                "3f92af885fe4a9d4"
            ],
            [
                "d0045f77b9afb1af"
            ]
        ]
    },
    {
        "id": "d0045f77b9afb1af",
        "type": "function",
        "z": "76b05f87a5290cf6",
        "g": "d1418df470ae9fa4",
        "name": "error",
        "func": "node.error({txt:\"missing _socketId\",fullMsg:msg});\n\nglobal.get(\"utils\").errorBlink(node, 60000);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1200,
        "y": 1110,
        "wires": [
            []
        ]
    },
    {
        "id": "cb6ba335d3d82d44",
        "type": "comment",
        "z": "76b05f87a5290cf6",
        "g": "6aa375e2e3177ccc",
        "name": "SPLIT BY TYPE",
        "info": "",
        "x": 920,
        "y": 405,
        "wires": []
    },
    {
        "id": "5952d8e029f830cd",
        "type": "debug",
        "z": "76b05f87a5290cf6",
        "g": "6aa375e2e3177ccc",
        "name": "WEBAPP CTRLMSG",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1095,
        "y": 585,
        "wires": []
    },
    {
        "id": "f25308f6b79bce5d",
        "type": "debug",
        "z": "76b05f87a5290cf6",
        "g": "31f4b8716c51f385",
        "name": "WEBAPP EVENT",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 425,
        "y": 1800,
        "wires": []
    },
    {
        "id": "4997d19a44b639d3",
        "type": "debug",
        "z": "76b05f87a5290cf6",
        "g": "abf36b9570f058cc",
        "name": "WEBAPP REQUEST",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 470,
        "y": 915,
        "wires": []
    },
    {
        "id": "32bb7ae2d8f0c7dc",
        "type": "link in",
        "z": "76b05f87a5290cf6",
        "g": "389c4cac40ddf2e2",
        "name": "uibOn cellButtonClick",
        "links": [
            "63cb5672c06fad4e"
        ],
        "x": 820,
        "y": 1800,
        "wires": [
            [
                "36bcc822962c6405",
                "90c9fbd734739d25"
            ]
        ],
        "l": true
    },
    {
        "id": "36bcc822962c6405",
        "type": "switch",
        "z": "76b05f87a5290cf6",
        "g": "389c4cac40ddf2e2",
        "name": "actionId",
        "property": "payload.actionId",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "goToA3",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "goToA2",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "goToE",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 4,
        "x": 1020,
        "y": 1800,
        "wires": [
            [
                "f67411720250268f"
            ],
            [
                "4331798865b98569"
            ],
            [
                "28275fe1c717f466"
            ],
            [
                "22f3a9e34e5ab24e"
            ]
        ]
    },
    {
        "id": "8a8226dfe4a11ffa",
        "type": "link in",
        "z": "76b05f87a5290cf6",
        "g": "7d42b16fe52425fd",
        "name": "setCellSignal in",
        "links": [
            "5d4e2536bd217ebb"
        ],
        "x": 385,
        "y": 1335,
        "wires": [
            [
                "ff3fd54c134b19bf"
            ]
        ]
    },
    {
        "id": "ff3fd54c134b19bf",
        "type": "function",
        "z": "76b05f87a5290cf6",
        "g": "7d42b16fe52425fd",
        "name": "update servSide state",
        "func": "//sendToServer(\"request\",\"setCellSignal\",\n    //{ toSignalKey:\"A2\", \n    //  machineName:this.$props.machineName})\n\nlet macKey = msg.payload.machineName\nconst signal = global.get(\"towersControl\");\n\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 545,
        "y": 1335,
        "wires": [
            [
                "f67d481098362b2f"
            ]
        ]
    },
    {
        "id": "c41737c1cb63ff35",
        "type": "function",
        "z": "76b05f87a5290cf6",
        "g": "6aa375e2e3177ccc",
        "name": "warn if implicit broadcast",
        "func": "/** detect unwanted broadcasting.\n *  Not strictly needed, but a good practice\n *  as such, msgs are passed through anyway\n */\n\nif(!msg._socketId && !(msg._broadcast || msg.broadcast)){\n    node.warn({txt:\"implicit broadcast to webapp\", fullMsg:msg});\n    global.get(\"utils\").errorBlink(node, 60000, msg.topic??\"\");\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 495,
        "wires": [
            [
                "71bdf71b7ab73ed4"
            ]
        ]
    },
    {
        "id": "31fdeb42eef422ce",
        "type": "comment",
        "z": "76b05f87a5290cf6",
        "g": "478c85d69cf2eb8c",
        "name": "GLOBALS",
        "info": "",
        "x": 165,
        "y": 150,
        "wires": []
    },
    {
        "id": "bf1620a75f8ef903",
        "type": "function",
        "z": "76b05f87a5290cf6",
        "g": "478c85d69cf2eb8c",
        "name": "set global uibuilder",
        "func": "",
        "outputs": 1,
        "noerr": 0,
        "initialize": "\n/** pseudo random string generator */\nfunction randomHexString4() {\n    return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1); //1.X * 2^16 toString(radix) clipFirst //== 4 characters hex\n}\n\nclass Client {\n    state;\n    sockedId;\n    clientId;\n\n    constructor(clientId, socketId, state){\n        this.state = state;\n        this.sockedId = socketId;\n    }\n}\n\nclass Session{\n    sessionId;\n    createdOn;\n    expiresOn;\n    data;\n\n    constructor(id){\n        this.data={};\n    }\n\n    static generateId(){\n        const gen4 = randomHexString4;\n        return gen4()+gen4()+gen4();\n    }\n}\n\nconst clientStates = [\"connected\",\"ready\"]\n\nconst obj = {\n    \"Client\":Client,\n    \"connectedClients\":[],\n    sessions:[],\n\n    addClient(socketId,state=\"conn\"){}\n}\n\nglobal.set(\"uibuilder\", obj);\nnode.status({ fill: \"green\", text: Object.keys(obj).join(' & ') });\nnode.send(obj);\n\n\n//onClientConnect()\n    //add to connectedClients{clientId>Client}\n    //add to sessions{clientId>Session}\n\n//onClientDisconnect()\n    //remove from connectedClients\n\n//onClient\n\n//onSendResponse()\n    //if connected\n        //send\n    //else\n        //queue\n        \n    \n\n\n/*** TESTS ***\n\n\n*/\n",
        "finalize": "",
        "libs": [],
        "x": 195,
        "y": 210,
        "wires": [
            [
                "110b6c5412ed8d34"
            ]
        ]
    },
    {
        "id": "02c02a2e46d2ce33",
        "type": "comment",
        "z": "76b05f87a5290cf6",
        "g": "478c85d69cf2eb8c",
        "name": "",
        "info": "//things not specified in uibuilder node quick-help-documentation\n\n//CTRL MESSAGES\n{\n\t\"uibuilderCtrl\": \"client disconnect\",\n\t\"reason\": \"transport close\",\n\t\"topic\": \"none\",\n\t\"_socketId\": \"LxI6Ic7eoU-SKsalAAAW\",\n\t\"version\": \"5.1.1\",\n\t\"ip\": \"192.168.52.1\",\n\t\"clientId\": \"TeVOIYq-YLqW-Szx3UC3F\", //cookie set by uibuilder\n\t\"connections\": 0,\n\t\"from\": \"server\",\n\t\"_msgid\": \"cc9a6cbb48577e32\"\n}\n\n/** Client ID set by uibuilder */\n    (from uibuilderfe.js) self.clientId = self.cookies['uibuilder-client-id']",
        "x": 315,
        "y": 180,
        "wires": []
    },
    {
        "id": "ae4ad803.98aa88",
        "type": "uibuilder",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "67911c84f8ca5874",
        "name": "",
        "topic": "",
        "url": "cachetest1",
        "fwdInMessages": false,
        "allowScripts": true,
        "allowStyles": true,
        "copyIndex": true,
        "showfolder": false,
        "x": 535,
        "y": 2250,
        "wires": [
            [
                "47aeb5cb.97f31c"
            ],
            [
                "a330534f.2e678",
                "4c2899fb.1cd318"
            ]
        ]
    },
    {
        "id": "47aeb5cb.97f31c",
        "type": "debug",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "67911c84f8ca5874",
        "name": "data from ui",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 715,
        "y": 2250,
        "wires": []
    },
    {
        "id": "43f62f54.e076c",
        "type": "function",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "67911c84f8ca5874",
        "name": "cache by topic",
        "func": "/* jshint asi: true */\n\n// Expects input msgs with topic set\n\n// cache variable name - needs to be unique for each cache\nconst cacheVarName = 'msgCache'\n\n// get saved context\nlet msgCache = context.get(cacheVarName) || {}\n\n// Handle cache control messages\nif (msg.hasOwnProperty('cacheControl')) {\n    // Replay cache if requested\n    if (msg.cacheControl === 'REPLAY') {\n        for (let topic in msgCache) {\n            // Only send to a single client if we can\n            if ( msg.hasOwnProperty('_socketId') ) {\n                node.send({\n                    \"topic\": topic, \n                    \"payload\": msgCache[topic],\n                    \"_socketId\": msg._socketId\n                })\n            } else {\n                node.send({\n                    \"topic\": topic, \n                    \"payload\": msgCache[topic]\n                })\n            }\n        }\n        return null\n    } else if (msg.cacheControl === 'CLEAR') {\n        // Or clear the cach (no msg sent)\n        context.set(cacheVarName, {})\n        return null\n    } else {\n        // or do nothing\n        return null\n    }\n}\n\n\n// ignore other uibuilder control messages\nif ( msg.hasOwnProperty('uibuilderCtrl') ) return null\n\n// Keep the last msg.payload by topic\nmsgCache[msg.topic] = msg.payload\n\n// save context for next time\ncontext.set(cacheVarName, msgCache)\n\n// Show number of cached msgs in status\nnode.status({fill:'green',shape:'ring',text:'Cached: ' + Object.keys(msgCache).length})\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 335,
        "y": 2250,
        "wires": [
            [
                "ae4ad803.98aa88"
            ]
        ]
    },
    {
        "id": "a330534f.2e678",
        "type": "debug",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "67911c84f8ca5874",
        "name": "control msgs from ui",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 745,
        "y": 2290,
        "wires": []
    },
    {
        "id": "122cefe6.c39a7",
        "type": "link in",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "67911c84f8ca5874",
        "name": "home-replay",
        "links": [
            "4c2899fb.1cd318",
            "8c23b9bc.b992b8"
        ],
        "x": 220,
        "y": 2250,
        "wires": [
            [
                "43f62f54.e076c"
            ]
        ]
    },
    {
        "id": "4c2899fb.1cd318",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "67911c84f8ca5874",
        "name": "home-controls",
        "links": [
            "122cefe6.c39a7"
        ],
        "x": 660,
        "y": 2330,
        "wires": []
    },
    {
        "id": "a22357f8.abfa88",
        "type": "comment",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "67911c84f8ca5874",
        "name": "Caching using simple function by msg.topic",
        "info": "See https://github.com/TotallyInformation/node-red-contrib-uibuilder/wiki/Cache-and-Replay-Messages-without-using-node-red-contrib-infocache\nfor details.\n\nThe uibuilder control messages are used to \nreplay or empty the cache.\n\nFeed in your own data to the cache to see how it\nworks.\n\nThe way it is currently written, the last message\nof each topic passing through the function node\nis retained and then replayed as separate messages\nwhen a new client GETs the uibuilder URL (or when\nand existing client reloads the page).\n\n## Configuration\n\nReplace default `index.html` and `index.js` files\nwith those in the 2 comment nodes.\n\nChange the name of the cache variable if copying this function.",
        "x": 705,
        "y": 2210,
        "wires": []
    },
    {
        "id": "7ec2ab22.136164",
        "type": "inject",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "67911c84f8ca5874",
        "name": "Input Trigger",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "RANDOM-TEST",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 2210,
        "wires": [
            [
                "9d09f684.33be68"
            ]
        ],
        "outputLabels": [
            "Trigger"
        ],
        "l": false
    },
    {
        "id": "9d09f684.33be68",
        "type": "change",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "67911c84f8ca5874",
        "name": "Random #",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$random()*10",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 220,
        "y": 2210,
        "wires": [
            [
                "43f62f54.e076c"
            ]
        ],
        "inputLabels": [
            "Trigger"
        ],
        "outputLabels": [
            "Random Number"
        ],
        "l": false
    },
    {
        "id": "6dc4ac8d.557764",
        "type": "comment",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "67911c84f8ca5874",
        "name": "index.html",
        "info": "<!doctype html>\n<html lang=\"en\">\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes\">\n\n    <title>Cache Test : uibuilder</title>\n    <meta name=\"description\" content=\"Node-RED UI Builder Cache Test\">\n\n    <link rel=\"icon\" href=\"./images/node-blue.ico\">\n\n    <link type=\"text/css\" rel=\"stylesheet\" href=\"../uibuilder/vendor/bootstrap/dist/css/bootstrap.min.css\" />\n    <link type=\"text/css\" rel=\"stylesheet\" href=\"../uibuilder/vendor/bootstrap-vue/dist/bootstrap-vue.css\" />\n\n    <link rel=\"stylesheet\" href=\"./index.css\" media=\"all\">\n</head><body>\n    <div id=\"app\">\n        <b-container id=\"app_container\">\n            <h1>\n                UIbuilder Cache Test Example\n            </h1>\n            <p>\n                This is a uibuilder test using a simple function as a cache.\n                Trigger the input a couple of times then load a new window or tab.\n                The value below should almost instantly go from '[Nothing]' to\n                that last sent value. However, the number of received messages should\n                drop back down to 2.\n            </p>\n            <h2>Data from Node-RED</h2>\n            <b-card>\n                Random Number: {{nrRandom}}\n            </b-card>\n\n            <p>\n                Messages: Received={{msgsReceived}}\n            </p>\n\n        </b-container>\n    </div>\n\n    <!-- These MUST be in the right order. Note no leading / -->\n    <!-- REQUIRED: Socket.IO is loaded only once for all instances\n                     Without this, you don't get a websocket connection -->\n    <script src=\"../uibuilder/vendor/socket.io/socket.io.js\"></script>\n\n    <!-- --- Vendor Libraries - Load in the right order --- -->\n    <script src=\"../uibuilder/vendor/vue/dist/vue.js\"></script> <!-- dev version with component compiler -->\n    <!-- <script src=\"../uibuilder/vendor/vue/dist/vue.min.js\"></script>   prod version with component compiler -->\n    <!-- <script src=\"../uibuilder/vendor/vue/dist/vue.runtime.min.js\"></script>   prod version without component compiler -->\n    <!-- <script src=\"https://unpkg.com/babel-polyfill@latest/dist/polyfill.min.js\"></script> for older browsers -->\n    <script src=\"../uibuilder/vendor/bootstrap-vue/dist/bootstrap-vue.js\"></script>\n\n    <!-- REQUIRED: Sets up Socket listeners and the msg object -->\n    <!-- <script src=\"./uibuilderfe.js\"></script>   //dev version -->\n    <script src=\"./uibuilderfe.min.js\"></script> <!--    //prod version -->\n    <!-- OPTIONAL: You probably want this. Put your custom code here -->\n    <script src=\"./index.js\"></script>\n\n</body></html>\n",
        "x": 325,
        "y": 2210,
        "wires": [],
        "icon": "node-red/parser-html.svg"
    },
    {
        "id": "243438af.12e268",
        "type": "comment",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "67911c84f8ca5874",
        "name": "index.js",
        "info": "/* jshint browser: true, esversion: 5, asi: true */\n/* globals document,Vue,window,uibuilder */\n// @ts-nocheck\n/*\n  Copyright (c) 2019 Julian Knight (Totally Information)\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n  http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\n/** @see https://github.com/TotallyInformation/node-red-contrib-uibuilder/wiki/Front-End-Library---available-properties-and-methods */\n\nconst app1 = new Vue({\n    el: '#app',\n    data: {\n        nrRandom    : '[Nothing]',\n        msgsReceived: 0,\n        msgsControl : 0,\n        msgsSent    : 0,\n        msgRecvd    : '[Nothing]',\n        msgSent     : '[Nothing]',\n        msgCtrl     : '[Nothing]',\n    }, // --- End of data --- //\n    computed: {\n    }, // --- End of computed --- //\n    methods: {\n    }, // --- End of methods --- //\n\n    // Available hooks: init,mounted,updated,destroyed\n    mounted: function(){\n\n        /** **REQUIRED** Start uibuilder comms with Node-RED @since v2.0.0-dev3\n         * Pass the namespace and ioPath variables if hosting page is not in the instance root folder\n         * e.g. If you get continual `uibuilderfe:ioSetup: SOCKET CONNECT ERROR` error messages.\n         * e.g. uibuilder.start('/nr/uib', '/nr/uibuilder/vendor/socket.io') // change to use your paths/names\n         */\n        uibuilder.start()\n\n        var vueApp = this\n\n        // If msg changes - msg is updated when a standard msg is received from Node-RED over Socket.IO\n        // Note that you can also listen for 'msgsReceived' as they are updated at the same time\n        // but newVal relates to the attribute being listened to.\n        uibuilder.onChange('msg', function(msg){\n            console.info('[uibuilder.onChange] property msg changed!', msg)\n            vueApp.msgRecvd = msg\n            vueApp.msgsReceived++\n\n            vueApp.nrRandom = msg.payload\n\n        })\n\n    } // --- End of mounted hook --- //\n\n}) // --- End of app1 --- //\n\n// EOF\n",
        "x": 455,
        "y": 2210,
        "wires": [],
        "icon": "font-awesome/fa-code"
    },
    {
        "id": "75c87fd8.f149a",
        "type": "inject",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "67911c84f8ca5874",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 220,
        "y": 2330,
        "wires": [
            [
                "27c93453.13df8c"
            ]
        ],
        "l": false
    },
    {
        "id": "27c93453.13df8c",
        "type": "change",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "67911c84f8ca5874",
        "name": "Clear Cache",
        "rules": [
            {
                "t": "set",
                "p": "cacheControl",
                "pt": "msg",
                "to": "CLEAR",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 315,
        "y": 2330,
        "wires": [
            [
                "8c23b9bc.b992b8"
            ]
        ]
    },
    {
        "id": "8c23b9bc.b992b8",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "67911c84f8ca5874",
        "name": "",
        "links": [
            "122cefe6.c39a7"
        ],
        "x": 420,
        "y": 2330,
        "wires": []
    },
    {
        "id": "1da30b125f7694b3",
        "type": "comment",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "67911c84f8ca5874",
        "name": "CACHE CONTROL",
        "info": "from https://flows.nodered.org/flow/b9c7976357c0b67d04c66fa1e1a9ec0a/in/V8yzonL4DaUi\nuibuilder pre-implementa un sistema per il reinvio on-demand di contenuti.\nbanalmente aggiunge una attributo \"cacheControl\" con valore \"CLEAR\"|\"REPLAY\"|undefined.\nricevere REPLAY significa che il client vuole ricevere una copia di questa cache \n        CLEAR che la cache deve essere eliminata.\n\nnon  finora servito, n prevedo che possa servire.",
        "x": 245,
        "y": 2160,
        "wires": []
    },
    {
        "id": "84ae7b1a0d4f5b64",
        "type": "switch",
        "z": "76b05f87a5290cf6",
        "g": "d1418df470ae9fa4",
        "name": "_broadcast",
        "property": "_broadcast",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 825,
        "y": 1080,
        "wires": [
            [
                "c7a39dea36551f43"
            ],
            [
                "fa5fe09d4f7a35d0"
            ]
        ]
    },
    {
        "id": "f67d481098362b2f",
        "type": "function",
        "z": "76b05f87a5290cf6",
        "g": "7d42b16fe52425fd",
        "name": "send setSingleCellSignal",
        "func": "let macKey = msg.payload.machineName\nconst signal = global.get(\"towersControl\");\n\n\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 795,
        "y": 1335,
        "wires": [
            [
                "7b854e8aa4029bbe"
            ]
        ]
    },
    {
        "id": "936181bc744d6f4f",
        "type": "link in",
        "z": "76b05f87a5290cf6",
        "g": "7d42b16fe52425fd",
        "name": "link in 7",
        "links": [],
        "x": 615,
        "y": 1290,
        "wires": [
            [
                "f67d481098362b2f"
            ]
        ],
        "l": true
    },
    {
        "id": "7b854e8aa4029bbe",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "7d42b16fe52425fd",
        "name": "setCellSignal",
        "mode": "link",
        "links": [
            "8592536a56dff0ec"
        ],
        "x": 965,
        "y": 1335,
        "wires": []
    },
    {
        "id": "fd99e9a78ed45308",
        "type": "comment",
        "z": "76b05f87a5290cf6",
        "g": "d1418df470ae9fa4",
        "name": "WRAPPER",
        "info": "",
        "x": 215,
        "y": 1020,
        "wires": []
    },
    {
        "id": "744fac38edb40465",
        "type": "comment",
        "z": "76b05f87a5290cf6",
        "g": "5b4db35eee901db4",
        "name": "HANDLERS",
        "info": "",
        "x": 420,
        "y": 1215,
        "wires": []
    },
    {
        "id": "533fe7d0158198e3",
        "type": "comment",
        "z": "76b05f87a5290cf6",
        "g": "7d42b16fe52425fd",
        "name": "setCellSignal",
        "info": "",
        "x": 440,
        "y": 1290,
        "wires": []
    },
    {
        "id": "08e2ef931b839c70",
        "type": "comment",
        "z": "76b05f87a5290cf6",
        "g": "6aa375e2e3177ccc",
        "name": "WEBAPP I/O",
        "info": "",
        "x": 175,
        "y": 405,
        "wires": []
    },
    {
        "id": "f67411720250268f",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "389c4cac40ddf2e2",
        "name": "uibOn cellButtonClick goToA2",
        "mode": "link",
        "links": [],
        "x": 1230,
        "y": 1755,
        "wires": [],
        "l": true
    },
    {
        "id": "138d917ae417b855",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "g": "6aa375e2e3177ccc",
        "name": "uib command out",
        "mode": "link",
        "links": [],
        "x": 1020,
        "y": 465,
        "wires": [],
        "l": true
    },
    {
        "id": "1f9aecc2debca193",
        "type": "function",
        "z": "76b05f87a5290cf6",
        "g": "478c85d69cf2eb8c",
        "name": "msg std enforcer",
        "func": "let uib = msg;\nconst signalCells = global.get(\"signalCells\");\n//const dateFns = global.get(\"dateFns\"); node.warn({\"dateFns\":dateFns})\n\nuib.prepareMsg_setCellSignal = (msg, mKey, signalKey) => {\n    msg.macKey = mKey;\n    msg.toSignalKey = signalKey\n    return msg;\n}\n\nuib.prepareMsg_setSingleCellSignal = (msg, mKey, signalKey) => {\n    msg.macKey = mKey;\n    msg.toSignalKey = signalKey\n    return msg;\n}\n\nuib.prepareMsg_setSingleCellState = (msg, macKey, signalCell) => {\n    msg.topic = \"setSingleCellState\";\n    msg.macKey = macKey;\n    msg.fromSignalCellState = {\n        \"signalKey\":signalCell.signalKey,\n        \"timerStart\":signalCell.timerStart,\n        \"timerEnd\":signalCell.timerEnd,\n    }\n    return msg;\n}\n\n\nuib.prepareMsg_appInit = (msg, viewKey) => {\n    const cfg = global.get(\"config\");\n    const signalCells = global.get(\"signalCells\");\n\n    if(!cfg || !signalCells) node.error(\"prepareMsg_appInit(): globals are still undefined\")\n    \n    msg.topic=\"initApp\";\n    msg.cellsLayout = cfg.cellsLayout;\n    msg.config = cfg;\n    msg.signalCellsStates = signalCells;\n    msg.viewKey = viewKey;\n    msg.adminUI = cfg.views[viewKey].adminUI;\n    //msg.signalCellsState = (var ret=[] for(let k in signalCells.dictionary.macKeys) ret[macKey]=)();\n\n    //sync times between client and server comparing the results of parsing the same string\n    msg.timeSync = {\n        now:Date.now()\n        //formatString: '01 Jan 2000 00:00:00',   result:Date.now()-Date.parse('01 Jan 2000 00:00:00')\n    };\n\n    return msg;\n}\n\nuib.validate = (msg, additionalProps=true, _node=node)=>{\n    if(!uib[\"prepareMsg_\"+msg.topic]){\n        _node.error(\"unknown uib message topic '\"+msg.topic+\"'\",{txt:\"unknown uib message topic '\"+msg.topic+\"'\",fullMsg:msg})\n        return false;\n    }\n    let template = uib[\"prepareMsg_\"+msg.topic];\n    for(let p in template){\n        if(!msg[p])\n            return false;\n    }\n\n}\n\nglobal.set(\"uibuilder\",uib)\n\n\n\nlet allKeys = Object.keys(uib);\nlet definedHere = [];\nfor(let k of allKeys)\n    if(k.match(\"prepareMsg\") || k==\"validate\")\n        definedHere.push(k)\n        \nnode.status({ fill: \"green\", text: definedHere.join(' & ') });\nnode.send(msg);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 270,
        "wires": [
            [
                "3cd18ab46873b7ab"
            ]
        ]
    },
    {
        "id": "110b6c5412ed8d34",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "g": "478c85d69cf2eb8c",
        "name": "link out 16",
        "mode": "link",
        "links": [
            "40e50c217d6a10b3"
        ],
        "x": 330,
        "y": 210,
        "wires": []
    },
    {
        "id": "40e50c217d6a10b3",
        "type": "link in",
        "z": "76b05f87a5290cf6",
        "g": "478c85d69cf2eb8c",
        "name": "link in 9",
        "links": [
            "110b6c5412ed8d34"
        ],
        "x": 165,
        "y": 270,
        "wires": [
            [
                "1f9aecc2debca193"
            ]
        ]
    },
    {
        "id": "d5841a439d384844",
        "type": "comment",
        "z": "76b05f87a5290cf6",
        "g": "abf36b9570f058cc",
        "name": "machineName:<macKey>",
        "info": "",
        "x": 215,
        "y": 1275,
        "wires": []
    },
    {
        "id": "eb0d22efa4a344c0",
        "type": "comment",
        "z": "76b05f87a5290cf6",
        "g": "abf36b9570f058cc",
        "name": "signalKey",
        "info": "",
        "x": 240,
        "y": 1305,
        "wires": []
    },
    {
        "id": "0c5efc16c514b239",
        "type": "link in",
        "z": "76b05f87a5290cf6",
        "d": true,
        "name": "setSingleCellSignal",
        "links": [],
        "x": 270,
        "y": 1485,
        "wires": [
            [
                "b1b980c698b44bc8"
            ]
        ],
        "l": true
    },
    {
        "id": "54ab3c8031f9e59c",
        "type": "change",
        "z": "76b05f87a5290cf6",
        "d": true,
        "name": "_broadcast : true",
        "rules": [
            {
                "t": "set",
                "p": "_broadcast",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 795,
        "y": 1485,
        "wires": [
            [
                "16644ec203b99989"
            ]
        ]
    },
    {
        "id": "16644ec203b99989",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "d": true,
        "name": "toWebapp out",
        "mode": "link",
        "links": [
            "29da4c340c1c0f16",
            "0ec40d54c47c43ad",
            "479573b30e6666e1"
        ],
        "x": 1000,
        "y": 1485,
        "wires": [],
        "l": true
    },
    {
        "id": "b1b980c698b44bc8",
        "type": "function",
        "z": "76b05f87a5290cf6",
        "d": true,
        "name": "function 4",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 495,
        "y": 1485,
        "wires": [
            [
                "54ab3c8031f9e59c"
            ]
        ]
    },
    {
        "id": "201682b5f3dc37e9",
        "type": "switch",
        "z": "76b05f87a5290cf6",
        "g": "6aa375e2e3177ccc",
        "name": "uibuilderCtrl",
        "property": "uibuilderCtrl",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "client connect",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "client disconnect",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 850,
        "y": 645,
        "wires": [
            [
                "983aa906652d8e1a"
            ],
            [
                "f2e91f6f34f953ec"
            ],
            []
        ]
    },
    {
        "id": "983aa906652d8e1a",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "g": "6aa375e2e3177ccc",
        "name": "uib onClientConnect",
        "mode": "link",
        "links": [
            "67de8630acac041e",
            "779b95f2b60630ab"
        ],
        "x": 1065,
        "y": 630,
        "wires": [],
        "l": true
    },
    {
        "id": "f2e91f6f34f953ec",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "6aa375e2e3177ccc",
        "name": "uib onClientDisconnect",
        "mode": "link",
        "links": [],
        "x": 1075,
        "y": 660,
        "wires": [],
        "l": true
    },
    {
        "id": "67de8630acac041e",
        "type": "link in",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "6aa375e2e3177ccc",
        "name": "uib onClientConnect",
        "links": [
            "983aa906652d8e1a"
        ],
        "x": 1290,
        "y": 630,
        "wires": [
            []
        ],
        "l": true
    },
    {
        "id": "779b95f2b60630ab",
        "type": "link in",
        "z": "76b05f87a5290cf6",
        "g": "6a9007c1c483ee16",
        "name": "uib onClientConnect",
        "links": [
            "983aa906652d8e1a"
        ],
        "x": 1620,
        "y": 645,
        "wires": [
            [
                "4a186aab7466a7ac"
            ]
        ],
        "l": true
    },
    {
        "id": "71250fbd9b3d549c",
        "type": "function",
        "z": "76b05f87a5290cf6",
        "g": "6a9007c1c483ee16",
        "name": "send appInit based on msg.ip",
        "func": "const getViewKeyFor = context.get(\"getViewKeyFor\"); //(ip, views = global.get(\"config\").views) => viewKey\n\n\nreturn global.get(\"uibuilder\").prepareMsg_appInit({_socketId:msg._socketId}, getViewKeyFor(msg.ip));",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\n\n\ncontext.set(\"getViewKeyFor\", function getViewKeyFor(ip, views = global.get(\"config\").views) {\n    for (let viewKey in views)\n        if (views[viewKey].exactIpList && views[viewKey].exactIpList.includes(ip))\n            return viewKey;\n    node.warn(\"unknown ip \" + ip + \". using default view\");\n    return \"default\";\n});",
        "finalize": "",
        "libs": [],
        "x": 1950,
        "y": 645,
        "wires": [
            [
                "446f1af64d58d0d6"
            ]
        ]
    },
    {
        "id": "4a186aab7466a7ac",
        "type": "q-gate",
        "z": "76b05f87a5290cf6",
        "g": "6a9007c1c483ee16",
        "name": "whenDef:utils",
        "controlTopic": "control",
        "defaultState": "queueing",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "queueCmd": "queue",
        "defaultCmd": "default",
        "triggerCmd": "trigger",
        "flushCmd": "flush",
        "resetCmd": "reset",
        "peekCmd": "peek",
        "dropCmd": "drop",
        "statusCmd": "status",
        "maxQueueLength": "-1",
        "keepNewest": false,
        "qToggle": true,
        "persist": false,
        "storeName": "memory",
        "x": 1770,
        "y": 645,
        "wires": [
            [
                "71250fbd9b3d549c"
            ]
        ],
        "l": false
    },
    {
        "id": "943d994766b764b4",
        "type": "change",
        "z": "76b05f87a5290cf6",
        "g": "6a9007c1c483ee16",
        "name": "open gate",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "control",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "open",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1800,
        "y": 585,
        "wires": [
            [
                "4a186aab7466a7ac"
            ]
        ]
    },
    {
        "id": "c7a39dea36551f43",
        "type": "change",
        "z": "76b05f87a5290cf6",
        "g": "d1418df470ae9fa4",
        "name": "del _socketId",
        "rules": [
            {
                "t": "delete",
                "p": "_socketId",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1015,
        "y": 1065,
        "wires": [
            [
                "3f92af885fe4a9d4"
            ]
        ]
    },
    {
        "id": "3cd18ab46873b7ab",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "g": "478c85d69cf2eb8c",
        "name": "uibuilder isDefinedEvent",
        "mode": "link",
        "links": [
            "5e3e280c0613ac32",
            "95d394ea8e7e8ad3"
        ],
        "x": 545,
        "y": 270,
        "wires": [],
        "l": true
    },
    {
        "id": "5e3e280c0613ac32",
        "type": "link in",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "478c85d69cf2eb8c",
        "name": "uibuilder isDefinedEvent",
        "links": [
            "3cd18ab46873b7ab"
        ],
        "x": 800,
        "y": 270,
        "wires": [
            []
        ],
        "l": true
    },
    {
        "id": "95d394ea8e7e8ad3",
        "type": "link in",
        "z": "76b05f87a5290cf6",
        "g": "6a9007c1c483ee16",
        "name": "uibuilder isDefinedEvent",
        "links": [
            "3cd18ab46873b7ab"
        ],
        "x": 1595,
        "y": 585,
        "wires": [
            [
                "943d994766b764b4"
            ]
        ],
        "l": true
    },
    {
        "id": "446f1af64d58d0d6",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "g": "6a9007c1c483ee16",
        "name": "toWebapp out",
        "mode": "link",
        "links": [
            "29da4c340c1c0f16",
            "0ec40d54c47c43ad",
            "479573b30e6666e1"
        ],
        "x": 2210,
        "y": 645,
        "wires": [],
        "l": true
    },
    {
        "id": "74bd2959d62a29c6",
        "type": "comment",
        "z": "76b05f87a5290cf6",
        "g": "6a9007c1c483ee16",
        "name": "RESET APP STATE ON RECONNECT",
        "info": "",
        "x": 1640,
        "y": 540,
        "wires": []
    },
    {
        "id": "1046031b6653478c",
        "type": "function",
        "z": "76b05f87a5290cf6",
        "name": "setSingleCellState",
        "func": "\nglobal.get(\"uibuilder\").prepareMsg_setSingleCellState(\"FA420\",global.get(\"signalCells\")[\"FA420\"])\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 750,
        "wires": [
            [
                "966a2e40f7e7e922"
            ]
        ]
    },
    {
        "id": "5b2a4a6f12830669",
        "type": "inject",
        "z": "76b05f87a5290cf6",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 390,
        "y": 750,
        "wires": [
            [
                "1046031b6653478c"
            ]
        ],
        "l": false
    },
    {
        "id": "966a2e40f7e7e922",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "name": "toWebapp out",
        "mode": "link",
        "links": [
            "29da4c340c1c0f16",
            "0ec40d54c47c43ad",
            "479573b30e6666e1"
        ],
        "x": 715,
        "y": 750,
        "wires": [],
        "l": true
    },
    {
        "id": "75ef4d5b0e672f1e",
        "type": "debug",
        "z": "76b05f87a5290cf6",
        "g": "6aa375e2e3177ccc",
        "name": "WEBAPP INPUT",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 365,
        "y": 540,
        "wires": []
    },
    {
        "id": "4331798865b98569",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "389c4cac40ddf2e2",
        "name": "uibOn cellButtonClick goToA3",
        "mode": "link",
        "links": [],
        "x": 1235,
        "y": 1800,
        "wires": [],
        "l": true
    },
    {
        "id": "28275fe1c717f466",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "389c4cac40ddf2e2",
        "name": "uibOn cellButtonClick goToE",
        "mode": "link",
        "links": [],
        "x": 1235,
        "y": 1845,
        "wires": [],
        "l": true
    },
    {
        "id": "46843f4e8d02205b",
        "type": "link out",
        "z": "76b05f87a5290cf6",
        "g": "389c4cac40ddf2e2",
        "name": "buttonActions",
        "mode": "link",
        "links": [
            "f4db294021a89fbf"
        ],
        "x": 1295,
        "y": 1695,
        "wires": [],
        "l": true
    },
    {
        "id": "90c9fbd734739d25",
        "type": "function",
        "z": "76b05f87a5290cf6",
        "g": "389c4cac40ddf2e2",
        "name": "parse actionId and send buttonAction",
        "func": "\nlet grid = global.get(\"config\").cellsLayout;\nlet macKey = grid[msg.payload.cellRow][msg.payload.cellCol]\n\nreturn {\n    action:\"set\"+msg.payload.actionId.match(/goTo(\\w+)/)[1],\n    topic:macKey\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1035,
        "y": 1695,
        "wires": [
            [
                "46843f4e8d02205b",
                "dbc968e9c4b6798b"
            ]
        ]
    },
    {
        "id": "7378a8a161a1b05c",
        "type": "comment",
        "z": "76b05f87a5290cf6",
        "g": "389c4cac40ddf2e2",
        "name": "TODO",
        "info": "fast, brute solution.\nset up a proper flow, handling single buttons, not depending on config structure etc",
        "x": 1075,
        "y": 1665,
        "wires": []
    },
    {
        "id": "71a72d1959f91e06",
        "type": "comment",
        "z": "76b05f87a5290cf6",
        "g": "389c4cac40ddf2e2",
        "name": "ADMIN CELL BUTTONS",
        "info": "",
        "x": 820,
        "y": 1650,
        "wires": []
    },
    {
        "id": "dbc968e9c4b6798b",
        "type": "debug",
        "z": "76b05f87a5290cf6",
        "g": "389c4cac40ddf2e2",
        "name": "SENT VIRTUAL BUTTON",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1340,
        "y": 1650,
        "wires": []
    },
    {
        "id": "22f3a9e34e5ab24e",
        "type": "function",
        "z": "76b05f87a5290cf6",
        "d": true,
        "g": "389c4cac40ddf2e2",
        "name": "default: warn",
        "func": "node.warn({txt:\"unhandled uib cellButtonClick actionId\",actId:msg.payload.actionId,fullMsg:msg});",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1190,
        "y": 1890,
        "wires": [
            []
        ]
    },
    {
        "id": "b029fe3fa7485d2e",
        "type": "inject",
        "z": "76b05f87a5290cf6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1665,
        "y": 825,
        "wires": [
            [
                "1579c4111cae40c2"
            ]
        ]
    },
    {
        "id": "1579c4111cae40c2",
        "type": "function",
        "z": "76b05f87a5290cf6",
        "name": "send appInit based on msg.ip",
        "func": "const getViewKeyFor = context.get(\"getViewKeyFor\"); //(ip, views = global.get(\"config\").views) => viewKey\n\n\nreturn global.get(\"uibuilder\").prepareMsg_appInit({_socketId:msg._socketId}, getViewKeyFor(msg.ip));",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\n\n\ncontext.set(\"getViewKeyFor\", function getViewKeyFor(ip, views = global.get(\"config\").views) {\n    for (let viewKey in views)\n        if (views[viewKey].exactIpList && views[viewKey].exactIpList.includes(ip))\n            return viewKey;\n    node.warn(\"unknown ip \" + ip + \". using default view\");\n    return \"default\";\n});",
        "finalize": "",
        "libs": [],
        "x": 1890,
        "y": 825,
        "wires": [
            [
                "2f1bf5a2d3ce57b2"
            ]
        ]
    },
    {
        "id": "2f1bf5a2d3ce57b2",
        "type": "debug",
        "z": "76b05f87a5290cf6",
        "name": "debug 24",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2115,
        "y": 825,
        "wires": []
    },
    {
        "id": "b2479c20f327854c",
        "type": "ui_ui_control",
        "z": "76b05f87a5290cf6",
        "name": "",
        "events": "all",
        "x": 1080,
        "y": 165,
        "wires": [
            [
                "71559356b3488a72"
            ]
        ]
    },
    {
        "id": "71559356b3488a72",
        "type": "debug",
        "z": "76b05f87a5290cf6",
        "name": "DASHBOARD",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 1235,
        "y": 210,
        "wires": []
    },
    {
        "id": "49bbe311b738bad2",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "name": "composeBigEndian",
        "func": "msg.payload=(msg.payload[1]<<16) | msg.payload[0];\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1100,
        "y": 2370,
        "wires": [
            []
        ]
    },
    {
        "id": "19871229e6b3c13c",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "name": "composeLittleEndian",
        "func": "msg.payload=(msg.payload[0]<<16) | msg.payload[1];\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1110,
        "y": 2325,
        "wires": [
            []
        ]
    },
    {
        "id": "15d1712c48b60144",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 275,
        "y": 2370,
        "wires": [
            [
                "ae29b121eba5b701",
                "ac81c47e04b26af5"
            ]
        ]
    },
    {
        "id": "ae29b121eba5b701",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "testsToBeKept",
        "func": "let str=\"a string\";\nlet a=1;\nlet a_plusPlus=context.a++;\nlet b = context.set(\"var\")\nnode.warn({b:b,t:b===undefined});\n\n\nreturn {\n    \"p\":context.p,\n    \"p2\":context.get(\"p2\"),\n    \"p3\": flow.p3,\n    \"p23\": flow.get(\"p23\"),\n    \"p4\": global.p4,\n    \"p24\": global.get(\"p24\"),\n    \"xp\": context.p2,\n    \"xp2\": context.get(\"p\"),\n    \"xp3\": flow.p23,\n    \"xp23\": flow.get(\"p3\"),\n    \"xp4\": global.p24,\n    \"xp24\": global.get(\"p4\"),\n    \"strInJs\":str,\n    \"a_plusPlus\": a_plusPlus,\n    \"a_plusPlusInJs\": a++,\n    \"plusplus_aInJs\": ++a,\n    \"f\": flow.get(\"f\"),\n    \"param\": flow.get(\"f\")(\"a string\",context),\n    \"f msg\":context.msg,\n    \"f set msg\": context.get(\"msg\"),\n    \"f set this msg\": context.get(\"msg3\"),\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\ncontext.p = \"p\";\ncontext.set(\"p2\", \"p2\");\nflow.p3 = \"p3\";\nflow.set(\"p23\", \"p23\");\nglobal.p4 = \"p4\";\nglobal.set(\"p24\", \"p24\");\ncontext.msg = \"\";\n\nflow.set(\"f\",function (param, contx){\n    context.msg = \"f msg\";\n    context.set(\"msg\",\"f msg\");\n    contx.set(\"msg3\",\"f msg3\");\n    \n    //context.displayError(param,25);\n    return param+\" ret\";\n});\n\nfunction badDef(str){\n    return str;\n}",
        "finalize": "",
        "libs": [],
        "x": 455,
        "y": 2370,
        "wires": [
            [
                "252a1e640d0f1c0b"
            ]
        ]
    },
    {
        "id": "ac81c47e04b26af5",
        "type": "change",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$globalContext(\"MWQuery\"){\t\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 455,
        "y": 2330,
        "wires": [
            [
                "4cdb3c3bf46563d8"
            ]
        ]
    },
    {
        "id": "252a1e640d0f1c0b",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "testsToBeKept",
        "func": "let str = \"a string\";\nlet a = 1;\nlet a_plusPlus = context.a++;\n\nreturn {\n    \"p\": context.p,\n    \"p2\": context.get(\"p2\"),\n    \"p3\": flow.p3,\n    \"p23\": flow.get(\"p23\"),\n    \"p4\": global.p4,\n    \"p24\": global.get(\"p24\"),\n    \"xp\": context.p2,\n    \"xp2\": context.get(\"p\"),\n    \"xp3\": flow.p23,\n    \"xp23\": flow.get(\"p3\"),\n    \"xp4\": global.p24,\n    \"xp24\": global.get(\"p4\"),\n    \"strInJs\": str,\n    \"a_plusPlus\": a_plusPlus,\n    \"a_plusPlusInJs\": a++,\n    \"plusplus_aInJs\": ++a,\n    \"f\": flow.get(\"f\"),\n    \"param\": flow.get(\"f\")(\"a string\", context),\n    \"f msg\": context.msg,\n    \"f set msg\": context.get(\"msg\"),\n    \"f set this msg\": context.get(\"msg3\"),\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 655,
        "y": 2370,
        "wires": [
            [
                "3a219ed0af97dddf"
            ]
        ]
    },
    {
        "id": "4cdb3c3bf46563d8",
        "type": "debug",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "debug 6",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 635,
        "y": 2310,
        "wires": []
    },
    {
        "id": "3a219ed0af97dddf",
        "type": "debug",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "debug 7",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 835,
        "y": 2370,
        "wires": []
    },
    {
        "id": "f17b02b8bcb19efd",
        "type": "debug",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "debug 8",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 635,
        "y": 2430,
        "wires": []
    },
    {
        "id": "c28bf5814e72a1da",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 315,
        "y": 2430,
        "wires": [
            [
                "9ee36af3597985b4"
            ]
        ]
    },
    {
        "id": "9ee36af3597985b4",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "testsToBeKept",
        "func": "let str = \"a string\";\nlet a = 1;\nlet a_plusPlus = context.a++;\n\nreturn {\n    \"p\": context.p,\n    \"p2\": context.get(\"p2\"),\n    \"p3\": flow.p3,\n    \"p23\": flow.get(\"p23\"),\n    \"p4\": global.p4,\n    \"p24\": global.get(\"p24\"),\n    \"xp\": context.p2,\n    \"xp2\": context.get(\"p\"),\n    \"xp3\": flow.p23,\n    \"xp23\": flow.get(\"p3\"),\n    \"xp4\": global.p24,\n    \"xp24\": global.get(\"p4\"),\n    \"strInJs\": str,\n    \"a_plusPlus\": a_plusPlus,\n    \"a_plusPlusInJs\": a++,\n    \"plusplus_aInJs\": ++a,\n    \"f\": flow.get(\"f\"),\n    \"param\": flow.get(\"f\")(\"a string\", context),\n    \"f msg\": context.msg,\n    \"f set msg\": context.get(\"msg\"),\n    \"f set this msg\": context.get(\"msg3\"),\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 475,
        "y": 2430,
        "wires": [
            [
                "f17b02b8bcb19efd"
            ]
        ]
    },
    {
        "id": "dfe4876ea0615980",
        "type": "comment",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "TEST FUNZIONALITA'",
        "info": "",
        "x": 315,
        "y": 2270,
        "wires": []
    },
    {
        "id": "cca09e5584ef886c",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "regex",
        "func": "\n\n//  regex per estrarre json da export dei DDT\n//  https://regex101.com/r/3rFhWf/\n//  .*<variables[^\"]+\"([^\"]+)\"[^\"]+\"([^\"]+)\"[^\\/]*(?:<comment>(.*)<\\/comment>)",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 2430,
        "wires": [
            []
        ]
    },
    {
        "id": "41547953e1174a36",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 305,
        "y": 2490,
        "wires": [
            [
                "7d815369a4f9dec4"
            ]
        ]
    },
    {
        "id": "7d815369a4f9dec4",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "asyncAccess",
        "func": "context.set(\"myVar\",\"ok\",(err)=>{if(err)node.error(\"someError A\")});\n\nsetTimeout(() => {\n    context.set(\"a\", \"ok\");\n    context.set(\"myVarA\", \"okA\", (err) => { if (err) node.error(\"someError A\") });\n}, 100);\n\nsetTimeout((c) => {\n    c.set(\"b\", \"ok\")\n    c.set(\"myVarB\", \"okB\", (err) => { if (err) node.error(\"someError B\") });\n}, 100,context);\n\ncontext.set(\"c\", \"ok\",function (err){\n    if(err)\n        node.error(\"see source. case 'c' \");\n    else{\n        node.warn(\"all good\");\n        context.set(\"myVarC\", \"okC\", (err) => { if (err) node.error(\"someError C\") });\n        context.set(\"myVarC2\", \"okC2\");\n        context.set(\"myVarC3\", context.get(\"myVar\"));\n    }\n    setTimeout(() => {\n        context.set(\"d\", \"ok\", function (err) {\n            if (err)\n                node.error(\"see source. case 'd' \");\n            else {\n                context.set(\"myVarD\", \"okD\", (err) => { if (err) node.error(\"someDrror D\") });\n                context.set(\"myVarD2\", \"okD2\");\n                if (context.get(\"myVar\"))\n                    flow.set(\"myVarD3\", \"seen\");\n            }\n        });\n\n        context.set(\"myVarD4\", \"okD4\");\n    }, 100);\n});\n\nsetTimeout(() => {\n    context.set(\"e\", \"ok\", function (err) {\n        if (err)\n            node.error(\"see source. case 'e' \");\n        else {\n            context.set(\"myVarE\", \"okE\", (err) => { if (err) node.error(\"someError E\") });\n            context.set(\"myVarE2\", \"okE2\");\n            if (context.get(\"myVar\"))\n                flow.set(\"myVarE3\", \"seen\");\n        }\n    });\n}, 100);\nlet waitFor = Date.now() + 2000;\nlet start=Date.now();\nlet fake=0;\nwhile(Date.now()<waitFor){\n    fake+=Math.random();\n}\nnode.warn(\"waited for \" + (waitFor-start) +\"ms\");\n\nreturn {\n    direct: context.get(\"a\"),\n    dir_varBuiltSet: context.get(\"myVarA\"),\n\n    throughParam: context.get(\"b\"),\n    param_varBuiltSet: context.get(\"myVarB\"),\n\n    withBuiltIn: context.get(\"c\"),\n    built_VarBuiltSet: context.get(\"myVarC\"),\n    built_VarDirectSet: context.get(\"myVarC2\"),\n    built_VarDirectGet: context.get(\"myVarC3\"),\n\n    withBuiltIn_AsyncSet: context.get(\"d\"),\n    built_VarBuiltAsSet: context.get(\"myVarD\"),\n    built_VarDirectAsSet: context.get(\"myVarD2\"),\n    built_VarDirectAsGet: flow.get(\"myVarD3\"),\n    built_VarDirectAsGet4: flow.get(\"myVarD4\"),\n\n    directOnBuilt: context.get(\"e\"),\n    dirOnBuilt_VarBuiltSet: context.get(\"myVarE\"),\n    dirOnBuilt_VarDirectSet: context.get(\"myVarE2\"),\n    dirOnBuilt_VarDirectGet: flow.get(\"myVarE3\"),\n};\n\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 465,
        "y": 2490,
        "wires": [
            [
                "c8ee96d3de3d3f40"
            ]
        ]
    },
    {
        "id": "c8ee96d3de3d3f40",
        "type": "debug",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "debug 9",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 665,
        "y": 2490,
        "wires": []
    },
    {
        "id": "71b7faf956909c17",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "asyncAccess",
        "func": "//le modifiche a context fatte in async non sono visibili fino al prossimo messaggio.\n\ncontext.set(\"v\",\"okv\",(err)=>{if(err)node.error(\"someError A\")});\n\nsetTimeout(() => {\n    context.set(\"a\", (context.get(\"v\")||\"oka\"));\n    context.set(\"vA\", (context.get(\"v\") ||\"okvA\") , (err) => { if (err) node.error(\"someError A\") });\n}, 100);\n\nsetTimeout((c) => {\n    c.set(\"b\", \"okb\")\n    c.set(\"vB\", \"okvB\", (err) => { if (err) node.error(\"someError B\") });\n}, 100,context);\n\nsetTimeout(() => {\n    context.set(\"a\", (context.get(\"a\")||\"\")+\" edit\");\n    context.set(\"vA\", \"okvA\", (err) => { if (err) node.error(\"someError vA\") });\n}, 100);\n\nlet waitFor = Date.now() + 2000;\nlet start = Date.now();\nlet fake = 0;\nwhile (Date.now() < waitFor) {\n    fake += Math.random();\n}\nnode.warn(\"waited for \" + (waitFor - start) + \"ms\");\n\nlet ret = {\n    tout_direct: context.get(\"a\"),\n    tout_asySet: context.get(\"vA\"),\n    tout_throughParam: context.get(\"b\"),\n    getAsy:[\n        context.get(\"a\", (err) => { if (err) node.error(\"someError gA\") }),\n        context.get(\"vA\", (err) => { if (err) node.error(\"someError gvA\") })\n    ],\n}\nsetTimeout(() => {\n    node.send({tout: \n    {\n        tout_direct: context.get(\"a\"),\n        tout_asySet: context.get(\"vA\"),\n        tout_throughParam: context.get(\"b\"),\n        getAsy: [\n            context.get(\"a\", (err) => { if (err) node.error(\"someError gA\") }),\n            context.get(\"vA\", (err) => { if (err) node.error(\"someError gvA\") })\n        ],\n    }\n    });\n}, 1000);\n\nreturn ret;\n\n/*\ncontext.set(\"c\", \"ok\",function (err){\n    if(err)\n        node.error(\"see source. case 'c' \");\n    else{\n        node.warn(\"all good\");\n        context.set(\"myVarC\", \"okC\", (err) => { if (err) node.error(\"someError C\") });\n        context.set(\"myVarC2\", \"okC2\");\n        context.set(\"myVarC3\", context.get(\"myVar\"));\n    }\n    setTimeout(() => {\n        context.set(\"d\", \"ok\", function (err) {\n            if (err)\n                node.error(\"see source. case 'd' \");\n            else {\n                context.set(\"myVarD\", \"okD\", (err) => { if (err) node.error(\"someDrror D\") });\n                context.set(\"myVarD2\", \"okD2\");\n                if (context.get(\"myVar\"))\n                    flow.set(\"myVarD3\", \"seen\");\n            }\n        });\n\n        context.set(\"myVarD4\", \"okD4\");\n    }, 100);\n});\n\nsetTimeout(() => {\n    context.set(\"e\", \"ok\", function (err) {\n        if (err)\n            node.error(\"see source. case 'e' \");\n        else {\n            context.set(\"myVarE\", \"okE\", (err) => { if (err) node.error(\"someError E\") });\n            context.set(\"myVarE2\", \"okE2\");\n            if (context.get(\"myVar\"))\n                flow.set(\"myVarE3\", \"seen\");\n        }\n    });\n}, 100);\nlet waitFor = Date.now() + 2000;\nlet start=Date.now();\nlet fake=0;\nwhile(Date.now()<waitFor){\n    fake+=Math.random();\n}\nnode.warn(\"waited for \" + (waitFor-start) +\"ms\");\n\nreturn {\n    direct: context.get(\"a\"),\n    dir_varBuiltSet: context.get(\"myVarA\"),\n\n    throughParam: context.get(\"b\"),\n    param_varBuiltSet: context.get(\"myVarB\"),\n\n    withBuiltIn: context.get(\"c\"),\n    built_VarBuiltSet: context.get(\"myVarC\"),\n    built_VarDirectSet: context.get(\"myVarC2\"),\n    built_VarDirectGet: context.get(\"myVarC3\"),\n\n    withBuiltIn_AsyncSet: context.get(\"d\"),\n    built_VarBuiltAsSet: context.get(\"myVarD\"),\n    built_VarDirectAsSet: context.get(\"myVarD2\"),\n    built_VarDirectAsGet: flow.get(\"myVarD3\"),\n    built_VarDirectAsGet4: flow.get(\"myVarD4\"),\n\n    directOnBuilt: context.get(\"e\"),\n    dirOnBuilt_VarBuiltSet: context.get(\"myVarE\"),\n    dirOnBuilt_VarDirectSet: context.get(\"myVarE2\"),\n    dirOnBuilt_VarDirectGet: flow.get(\"myVarE3\"),\n};\n\nreturn;\n*/",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 465,
        "y": 2535,
        "wires": [
            [
                "c8ee96d3de3d3f40"
            ]
        ]
    },
    {
        "id": "649bb151d51e764d",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 305,
        "y": 2535,
        "wires": [
            [
                "71b7faf956909c17"
            ]
        ]
    },
    {
        "id": "13ab8d445c1e80e2",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "asyncTrial",
        "func": "//le modifiche a context fatte in async non sono visibili fino al prossimo messaggio.\ncontext.set(\"cc\",context.get(\"cc\")||0);\n\nvar x = setTimeout(() => {\n    node.warn(\"triggered X\");\n}, 1000);\nclearTimeout(x);\n\n\nlet a = setTimeout(() => {\n    var y = setTimeout(() => {\n        node.warn(\"triggered sub y\");\n    }, 1000);\n\n    context.set(\"y\", y)\n    node.warn(\"triggered Y\");\n}, 1000);\n\nsetTimeout(() => {\n    clearTimeout(context.get(\"y\")??node.warn(\"error\"));\n}, 1400);\n\n\n//clearTimeout(a);\n//clearTimeout(context.get(\"y\"));\n\n\n//works~ //()=>{} share the definer's scope, let defined are still accessible after the function node has finished.\nlet state=false;\nconst intv = setInterval(() => {\n    node.warn({txt:\"called with\",st:state,intv:intv});\n    if(state){\n        node.warn(\"state true, clearing..\");\n        clearInterval(intv)\n    }\n},2000);\n\nsetTimeout(()=>{node.warn(\"setting state to true\");state=true},3000);\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 455,
        "y": 2580,
        "wires": [
            [
                "c8ee96d3de3d3f40"
            ]
        ]
    },
    {
        "id": "55e7b1fcf215488e",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 305,
        "y": 2580,
        "wires": [
            [
                "13ab8d445c1e80e2"
            ]
        ]
    },
    {
        "id": "6e11ca5816678aff",
        "type": "ui_multistate_switch",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "e02b6f382a6c8813",
        "name": "toggle polling mode",
        "group": "0c8027c5cce32f61",
        "order": 4,
        "width": "13",
        "height": "1",
        "label": " secondi",
        "stateField": "payload",
        "enableField": "enable",
        "passthroughField": "passthrough",
        "inputMsgField": "inputmsg",
        "rounded": true,
        "useThemeColors": true,
        "hideSelectedLabel": false,
        "multilineLabel": false,
        "passThrough": "change",
        "inputMsg": "all",
        "userInput": "enabled_show",
        "options": [
            {
                "label": "off",
                "value": "off",
                "valueType": "str",
                "color": "#009933"
            },
            {
                "label": "solo inverter",
                "value": "1",
                "valueType": "num",
                "color": "#999999"
            },
            {
                "label": "solo pm500",
                "value": "2",
                "valueType": "num",
                "color": "#ff6666"
            },
            {
                "label": "solo pm2350",
                "value": "3",
                "valueType": "num",
                "color": "#009999"
            },
            {
                "label": "tutti",
                "value": "all",
                "valueType": "str",
                "color": "#cccc00"
            }
        ],
        "topic": "",
        "x": 450,
        "y": 555,
        "wires": [
            [
                "1464ee495f119867"
            ]
        ]
    },
    {
        "id": "eaa055ba0bfe8209",
        "type": "trigger",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "e02b6f382a6c8813",
        "name": "rs msg.delay",
        "op1": "true",
        "op2": "0",
        "op1type": "bool",
        "op2type": "str",
        "duration": "-1000",
        "extend": false,
        "overrideDelay": true,
        "units": "ms",
        "reset": "off",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 820,
        "y": 525,
        "wires": [
            [
                "7eec56878e74f81d"
            ]
        ]
    },
    {
        "id": "92f9ab29a8b8f215",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "e02b6f382a6c8813",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "delay",
                "v": "1000",
                "vt": "num"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "off",
        "payloadType": "str",
        "x": 640,
        "y": 480,
        "wires": [
            [
                "eaa055ba0bfe8209"
            ]
        ]
    },
    {
        "id": "f7aa3a5ee94581d8",
        "type": "link out",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "e02b6f382a6c8813",
        "name": "link out 2",
        "mode": "link",
        "links": [
            "830ffb7ad83476f7",
            "b387e43f2834f0b5",
            "e4466d0ee4a7c225"
        ],
        "x": 1110,
        "y": 540,
        "wires": []
    },
    {
        "id": "465a56cb5ae37a7b",
        "type": "link out",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "e02b6f382a6c8813",
        "name": "link out 3",
        "mode": "link",
        "links": [
            "830ffb7ad83476f7"
        ],
        "x": 1080,
        "y": 450,
        "wires": []
    },
    {
        "id": "4b32101b94305fad",
        "type": "link out",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "e02b6f382a6c8813",
        "name": "link out 4",
        "mode": "link",
        "links": [
            "b387e43f2834f0b5"
        ],
        "x": 1080,
        "y": 480,
        "wires": []
    },
    {
        "id": "eca3f783e09f6088",
        "type": "link out",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "e02b6f382a6c8813",
        "name": "link out 5",
        "mode": "link",
        "links": [
            "e4466d0ee4a7c225"
        ],
        "x": 1080,
        "y": 510,
        "wires": []
    },
    {
        "id": "7eec56878e74f81d",
        "type": "switch",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "e02b6f382a6c8813",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "3",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "all",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 6,
        "x": 960,
        "y": 525,
        "wires": [
            [],
            [
                "465a56cb5ae37a7b"
            ],
            [
                "4b32101b94305fad"
            ],
            [
                "eca3f783e09f6088"
            ],
            [
                "f7aa3a5ee94581d8"
            ],
            [
                "0fed6df359c670f3"
            ]
        ],
        "l": false
    },
    {
        "id": "0fed6df359c670f3",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "e02b6f382a6c8813",
        "name": "warning",
        "func": "throw new Error(\"unknown switch state\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 585,
        "wires": [
            []
        ]
    },
    {
        "id": "8a7581d12692fcfa",
        "type": "ui_numeric",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "e02b6f382a6c8813",
        "name": "poll interval",
        "label": "ricarica ogni",
        "tooltip": "imposta intervallo di polling",
        "group": "0c8027c5cce32f61",
        "order": 3,
        "width": "5",
        "height": "1",
        "wrap": false,
        "passthru": true,
        "topic": "interval",
        "topicType": "str",
        "format": "{{msg.payload}}",
        "min": "5",
        "max": "60",
        "step": "0.5",
        "className": "",
        "x": 220,
        "y": 495,
        "wires": [
            [
                "1464ee495f119867",
                "79cb428099fa1515"
            ]
        ]
    },
    {
        "id": "6abeeffb9f17c15c",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "e02b6f382a6c8813",
        "name": "OnStartup0.1: 1",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "interval",
        "payload": "5",
        "payloadType": "num",
        "x": 220,
        "y": 450,
        "wires": [
            [
                "8a7581d12692fcfa"
            ]
        ]
    },
    {
        "id": "1464ee495f119867",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "e02b6f382a6c8813",
        "name": "setDelay",
        "func": "if(msg.topic==\"interval\")\n    context.set(\"interval\",msg.payload);\nelse{\n    msg.delay=(context.get(\"interval\") ?? 5) * 1000;\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 525,
        "wires": [
            [
                "eaa055ba0bfe8209"
            ]
        ]
    },
    {
        "id": "79cb428099fa1515",
        "type": "change",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "e02b6f382a6c8813",
        "name": "change Label",
        "rules": [
            {
                "t": "set",
                "p": "label",
                "pt": "msg",
                "to": "\"ricarica ogni arawa secondi\"",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "secs",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "notExistant",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 230,
        "y": 555,
        "wires": [
            [
                "6e11ca5816678aff"
            ]
        ]
    },
    {
        "id": "fd596e236db59b07",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "e02b6f382a6c8813",
        "name": "OnStartup0.1: off",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "off",
        "payloadType": "str",
        "x": 240,
        "y": 600,
        "wires": [
            [
                "6e11ca5816678aff"
            ]
        ]
    },
    {
        "id": "9056d3c89eaf484d",
        "type": "comment",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "042f83e60bf4b2b4",
        "name": "Sticky Menu: modbus trail and refresh polling",
        "info": "",
        "x": 265,
        "y": 105,
        "wires": []
    },
    {
        "id": "b757185d480921ba",
        "type": "change",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "d4e564eac59f8117",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "status.fill",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "reference",
                "pt": "msg",
                "to": "status.text",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 180,
        "y": 225,
        "wires": [
            [
                "fd379269ea194a8c"
            ]
        ],
        "l": false
    },
    {
        "id": "66fc5d7cfed02395",
        "type": "link in",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "d4e564eac59f8117",
        "name": "ModBus trail IN",
        "links": [
            "87cee062cd247351"
        ],
        "x": 135,
        "y": 225,
        "wires": [
            [
                "b757185d480921ba"
            ]
        ]
    },
    {
        "id": "a7c280bcddb31c7e",
        "type": "ui_statetrail",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "d4e564eac59f8117",
        "group": "0c8027c5cce32f61",
        "order": 2,
        "width": "9",
        "height": "2",
        "name": "ModBusTrail short",
        "label": "Modbus Status",
        "states": [
            {
                "state": "green",
                "col": "#009933",
                "t": "str",
                "label": "ready"
            },
            {
                "state": "yellow",
                "col": "#cddb06",
                "t": "str",
                "label": "busy"
            },
            {
                "state": "red",
                "col": "#ff6666",
                "t": "str",
                "label": "error"
            },
            {
                "state": "space",
                "col": "#ffffff",
                "t": "str",
                "label": ""
            }
        ],
        "periodLimit": "30",
        "periodLimitUnit": "1",
        "timeformat": "ss",
        "tickmarks": "12",
        "persist": false,
        "legend": "0",
        "combine": true,
        "blanklabel": "Waiting Data",
        "x": 780,
        "y": 225,
        "wires": [
            [
                "131215b1356c2711",
                "0a569519a6946703"
            ]
        ]
    },
    {
        "id": "e0e7d487cb6155da",
        "type": "ui_statetrail",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "d4e564eac59f8117",
        "group": "0c8027c5cce32f61",
        "order": 1,
        "width": "16",
        "height": "2",
        "name": "ModBusTrail long",
        "label": "Modbus Status",
        "states": [
            {
                "state": "green",
                "col": "#009933",
                "t": "str",
                "label": "ready"
            },
            {
                "state": "yellow",
                "col": "#cddb06",
                "t": "str",
                "label": "busy"
            },
            {
                "state": "red",
                "col": "#ff6666",
                "t": "str",
                "label": "error"
            },
            {
                "state": "space",
                "col": "#ffffff",
                "t": "str",
                "label": ""
            }
        ],
        "periodLimit": "4",
        "periodLimitUnit": "60",
        "timeformat": "mm:ss",
        "tickmarks": "12",
        "persist": false,
        "legend": "2",
        "combine": true,
        "blanklabel": "Waiting Data",
        "x": 780,
        "y": 285,
        "wires": [
            [
                "0a569519a6946703"
            ]
        ]
    },
    {
        "id": "40aa2bf78c7edcb3",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "d4e564eac59f8117",
        "name": "fix scale",
        "func": "let p=5; //period time in minutes\nif ((context.get(\"lastTime\") || 0) + 60 * p >= Date.now) {\n    node.send({ payload: { state: \"space\", timestamp: Date.now() + 100 - p * 60 * 1000 } });\n    context.set(\"lastTime\", Date.now());\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nnode.send({ payload: { state: \"space\", timestamp: Date.now()} });",
        "finalize": "",
        "libs": [],
        "x": 615,
        "y": 285,
        "wires": [
            [
                "e0e7d487cb6155da"
            ]
        ]
    },
    {
        "id": "5f6c10280d9d54a1",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "d4e564eac59f8117",
        "name": "fix scale",
        "func": "let p=0.5; //period time in minutes\nif( (context.get(\"lastTime\")||0) +60*p >= Date.now){\n    node.send({payload:{ state: \"space\", timestamp: Date.now()+100-p*60*1000 }});\n    context.set(\"lastTime\",Date.now());\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 615,
        "y": 225,
        "wires": [
            [
                "a7c280bcddb31c7e"
            ]
        ]
    },
    {
        "id": "131215b1356c2711",
        "type": "debug",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "d4e564eac59f8117",
        "name": "debug 10",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 210,
        "wires": []
    },
    {
        "id": "0a569519a6946703",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "d4e564eac59f8117",
        "name": "function 1",
        "func": "\nlet d=new Date(msg.payload.timestamp);\nlet millis = d.getMilliseconds();\nlet pre=\"\";\nfor(let i=0;i>3;i++)\n    if(millis<10*i)\n        pre+=\"0\";\nmillis = pre+millis;\nmsg.menu=[\n    {\n        text: \"state: \"+(msg.payload.label||\"\"),\n        enabled: true,\n        icon: \"\",\n    },\n    {\n        text: \"time: \" + `${d.getHours()}:${d.getMinutes()}:${d.getSeconds()}.${millis}`,\n        enabled: true,\n        icon: \"\",\n    },\n    {\n        text: \"duration: \" + (msg.payload.duration) + \"ms\",\n        enabled: true,\n        icon: \"\",\n    }\n];\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 945,
        "y": 255,
        "wires": [
            [
                "decb29c9608e58af"
            ]
        ],
        "l": false
    },
    {
        "id": "e0da6226ebca68e1",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "d4e564eac59f8117",
        "name": "delay",
        "func": "if(!context.get(\"firstArrival\"))\n    context.set(\"firstArrival\",Date.now());\n\nif(context.get(\"firstArrival\") < Date.now()-30*1000)\n    return { payload: { state: \"space\", timestamp: Date.now() } }\nelse\n    setTimeout(\"node.send(msg)\",30*1000);\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 415,
        "y": 330,
        "wires": [
            [
                "40aa2bf78c7edcb3"
            ]
        ]
    },
    {
        "id": "3d6b849bfb2b2f51",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "d4e564eac59f8117",
        "name": "space On NoInput",
        "func": "\nfunction sendSpaceAfter_aBitMoreOn1st(firstDelay, then) {\n    return setTimeout(() => {\n        node.send({ payload: { state: \"space\", timestamp: Date.now()-(firstDelay-then) } });\n        context.set(\"timeoutObj\", sendSpaceAfter(then));\n    }, firstDelay);\n}\n\nfunction sendSpaceAfter(delay) {\n    return setTimeout(() => {\n        node.send({ payload: { state: \"space\", timestamp: Date.now() } });\n        context.set(\"timeoutObj\", sendSpaceAfter(delay));\n    }, delay);\n}\n\nclearTimeout(context.get(\"timeoutObj\")??node.warn(\"error\"));\ncontext.set(\"timeoutObj\", sendSpaceAfter_aBitMoreOn1st(1500,1000));\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\n\nfunction sendSpaceAfter_aBitMoreOn1st(firstDelay,then) {\n    return setTimeout(() => {\n        node.send({ payload: { state: \"space\", timestamp: Date.now() } });\n        context.set(\"timeoutObj\", sendSpaceAfter(then));\n    }, firstDelay);\n}\n\nfunction sendSpaceAfter(delay) {\n    return setTimeout(() => {\n        node.send({ payload: { state: \"space\", timestamp: Date.now() } });\n        context.set(\"timeoutObj\",sendSpaceAfter(delay));\n    }, delay);\n}\n\ncontext.set(\"timeoutObj\", sendSpaceAfter_aBitMoreOn1st(1500,1000));",
        "finalize": "",
        "libs": [],
        "x": 435,
        "y": 285,
        "wires": [
            [
                "40aa2bf78c7edcb3",
                "3812bcc095cbdfe5"
            ]
        ]
    },
    {
        "id": "2835c333a07183bd",
        "type": "delay",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "d4e564eac59f8117",
        "name": "",
        "pauseType": "delay",
        "timeout": "30",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 315,
        "y": 285,
        "wires": [
            [
                "3d6b849bfb2b2f51"
            ]
        ],
        "l": false
    },
    {
        "id": "fd379269ea194a8c",
        "type": "trigger",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "d4e564eac59f8117",
        "name": "rs 1000ms",
        "op1": "",
        "op2": "0",
        "op1type": "pay",
        "op2type": "str",
        "duration": "-1000",
        "extend": false,
        "overrideDelay": false,
        "units": "ms",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 325,
        "y": 225,
        "wires": [
            [
                "2835c333a07183bd",
                "5f6c10280d9d54a1"
            ]
        ]
    },
    {
        "id": "decb29c9608e58af",
        "type": "ui_context_menu",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "d4e564eac59f8117",
        "group": "99f2c2efd09d4b82",
        "order": 5,
        "width": 0,
        "height": -1,
        "fontSize": 16,
        "inputPositionXField": "event.clientX",
        "inputPositionXType": "msg",
        "inputPositionYField": "event.clientY",
        "inputPositionYType": "msg",
        "outputField": "payload",
        "inputMenuField": "menu",
        "inputMenuType": "msg",
        "menuItems": [
            {
                "id": "0",
                "icon": "fa-home",
                "label": "someLabel",
                "topic": "aTopic",
                "payload": "thisWasSent",
                "payloadType": "str",
                "visible": true,
                "enabled": true
            },
            {
                "id": "1",
                "icon": "fa-clip",
                "label": "awdawd",
                "topic": "aTopic2",
                "payload": "otherMsg",
                "payloadType": "str",
                "visible": true,
                "enabled": true
            }
        ],
        "colors": "theme",
        "textColor": "#000000",
        "backgroundColor": "#ffffff",
        "borderColor": "#626262",
        "intervalLength": "-1",
        "intervalUnit": "secs",
        "startTimerAtOpen": false,
        "startTimerAtLeave": false,
        "stopTimerAtEnter": false,
        "name": "",
        "x": 1045,
        "y": 255,
        "wires": [
            []
        ]
    },
    {
        "id": "d654a92c108d7cf7",
        "type": "debug",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "d4e564eac59f8117",
        "name": "debug 11",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 780,
        "y": 330,
        "wires": []
    },
    {
        "id": "3812bcc095cbdfe5",
        "type": "change",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "d4e564eac59f8117",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.state",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 605,
        "y": 330,
        "wires": [
            [
                "d654a92c108d7cf7"
            ]
        ]
    },
    {
        "id": "6bd020121fe4161b",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "d4e564eac59f8117",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 225,
        "y": 285,
        "wires": [
            [
                "3d6b849bfb2b2f51"
            ]
        ],
        "l": false
    },
    {
        "id": "3cf1218795abc823",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "9bcec7222119e8a3",
        "name": "map & merge",
        "func": "\n//in payload si trovano nome,tipo e commento di n COPPIE di celle, o %MW.\n//  all' indice i corrisponder la cella 4400+2*i. la variabile potrebbe per essere di un solo byte.\n//in msg.buffer si trova il buffer di byte letto //class:  https://nodejs.org/api/buffer.html\n\n//byte order: da 2301 a 3210 //il plc salva le singole coppie di byte in LittleEndian, mentre la coppia di coppie come BigEndian. (originale: 0123 -> 01,23 -> 23,01 :inMemoria)\nfor (let i = 0, tmp, buf = msg.buffer; i < buf.length - 1; i += 2) {\n    tmp = buf[i];\n    buf[i] = buf[i + 1];\n    buf[i + 1] = tmp;\n}\n//usa la\nvar err;\nfor (let i = 0; msg.payload[i] !== undefined; i++) {\n    \n    msg.payload[i].address = msg.addressOffset + 2 * i;\n    \n\n    if (msg.buffer[2 * i] === undefined || msg.buffer[2 * i + 1] === undefined || msg.buffer[2 * i] === null || msg.buffer[2 * i + 1] === null) {\n        if(!err) err={};\n        if (err.missingDataException === undefined)\n            err.missingDataException = {};\n        err.missingDataException[\"at_idx_\" + i] = msg.buffer;\n        msg.payload.value = \"missing\";\n        msg.payload.rawValue = \"missing\";\n    }\n    else{\n        msg.payload[i].rawValue = \"0x\" + msg.buffer.readUint32LE(4 * i).toString(16);\n        switch (msg.payload[i].type.toUpperCase()) {\n            case \"UINT\": {\n                msg.payload[i].value = msg.buffer.readUint16LE(4*i);\n                break;\n            }\n            case \"UDINT\": {\n                msg.payload[i].value = msg.buffer.readUint32LE(4 * i);\n                break;\n            }\n            case \"INT\": {\n                msg.payload[i].value = msg.buffer.readInt16LE(4 * i);\n                break;\n            }\n            case \"DINT\": {\n                msg.payload[i].value = msg.buffer.readInt32LE(4 * i);\n                break;\n            }\n            case \"REAL\": {\n                msg.payload[i].value = msg.buffer.readFloatLE(4*i).toPrecision(7);\n                break;\n            }\n            default: {\n                if (!err) err = {};\n                if(err.unknownTyperException===undefined)\n                    err.unknownTypeException= {};\n                err.unknownTypeException[\"at_idx_\" + i] = msg.payload[i].type;\n                \n                msg.payload[i].value = \"unkType\";\n            }\n        }\n\n    }\n}\nif(err)\n    node.warn(err);\nreturn msg;\n\n/* msg.payload=msg.payload.map((val,idx,arr)=>{ arr[idx].address=4400+2*idx });\n*/",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 1695,
        "wires": [
            [
                "2b0d893e266ba428"
            ]
        ]
    },
    {
        "id": "f6905ffb8eab6a25",
        "type": "link in",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "9bcec7222119e8a3",
        "name": "DDT table map&merge",
        "links": [],
        "x": 860,
        "y": 1695,
        "wires": [
            [
                "3cf1218795abc823"
            ]
        ]
    },
    {
        "id": "2b0d893e266ba428",
        "type": "link out",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "9bcec7222119e8a3",
        "name": "link out 6",
        "mode": "return",
        "links": [],
        "x": 1085,
        "y": 1695,
        "wires": []
    },
    {
        "id": "a5c6292ed1672889",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "59b9575558a87ab8",
        "name": "warnOnChange",
        "func": "//compara l'ultima lettura da inverter con quella corrente\n//msg.payload: arr of obj {name, comment,value:num, rawvalue:Str, ..} //result of f() map&merge\n\nif(msg.origin === undefined) node.error({err:\"forgot to set msg.origin for \", msg:msg})\nconst lastData = context.get(msg.origin+\"_lastData\") ?? [];\ncontext.set(msg.origin + \"_lastData\", msg.payload);\n\nif (msg.payload.length != lastData.length)\n    node.warn(\"length mismatch between data: \" + msg.payload.length + \"!=\"+ lastData.length);\n\n\nlet changed={length:0};\n\nfor(let i=0; i<msg.payload.length && i<lastData.length; i++){\n    let newD = msg.payload[i];\n    let lastD = lastData[i];\n\n    if( newD.value != lastD.value\n    || newD.rawValue != lastD.rawValue){\n        changed[newD.name]={add:4400,from:newD.value,to:lastD.value,raws:newD.rawValue+\" -> \"+lastD.rawValue}\n        changed.length++;\n    }\n}\n\nif(changed.length){\n    node.warn(changed);\n    return msg;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 1560,
        "wires": [
            [
                "732e9e9a5be95374"
            ]
        ]
    },
    {
        "id": "83ea5f07872402eb",
        "type": "gate",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "59b9575558a87ab8",
        "name": "",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 1035,
        "y": 1560,
        "wires": [
            [
                "a5c6292ed1672889"
            ]
        ],
        "l": false
    },
    {
        "id": "732e9e9a5be95374",
        "type": "link out",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "59b9575558a87ab8",
        "name": "link out 7",
        "mode": "link",
        "links": [
            "1df35f685bbae5dc",
            "e8845b1f1b31012c",
            "d69fdd484799a13d"
        ],
        "x": 1290,
        "y": 1560,
        "wires": []
    },
    {
        "id": "06e8b2a3bf45c64b",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "59b9575558a87ab8",
        "name": "toggle",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "control",
        "payload": "toggle",
        "payloadType": "str",
        "x": 950,
        "y": 1530,
        "wires": [
            [
                "83ea5f07872402eb"
            ]
        ]
    },
    {
        "id": "e16f5eb91fb5c4b4",
        "type": "link in",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "59b9575558a87ab8",
        "name": "warnOnChange",
        "links": [
            "7905b0dc5437c385",
            "d9b73c125a41e985",
            "6cdb9924b36e6d80"
        ],
        "x": 975,
        "y": 1575,
        "wires": [
            [
                "83ea5f07872402eb"
            ]
        ]
    },
    {
        "id": "4589e135e62180d5",
        "type": "ui_button",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "ffe7d6539591cabf",
        "name": "refresh allInverterDDT table",
        "group": "0333a97ebf4d364e",
        "order": 1,
        "width": "1",
        "height": "1",
        "passthru": true,
        "label": "",
        "tooltip": "interroga nuovamente il PLC \\n recuperando tutti i dati",
        "color": "green",
        "bgcolor": "light-blue",
        "className": "button",
        "icon": "autorenew",
        "payload": "true",
        "payloadType": "bool",
        "topic": "",
        "topicType": "str",
        "x": 440,
        "y": 1830,
        "wires": [
            [
                "5f7d9434ee851d46"
            ]
        ]
    },
    {
        "id": "78d83f5060d67324",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "ffe7d6539591cabf",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 290,
        "y": 1830,
        "wires": [
            [
                "4589e135e62180d5"
            ]
        ],
        "l": false
    },
    {
        "id": "f60ed334182c339f",
        "type": "change",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "ffe7d6539591cabf",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "buffer",
                "pt": "msg",
                "to": "payload.buffer",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "addressOffset",
                "pt": "msg",
                "to": "4400",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 945,
        "y": 1905,
        "wires": [
            [
                "b116d599b6b0916d"
            ]
        ]
    },
    {
        "id": "3a58a38948ea94e8",
        "type": "ui_table",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "ffe7d6539591cabf",
        "group": "0333a97ebf4d364e",
        "name": "allInverterDDT Table",
        "order": 7,
        "width": "25",
        "height": "24",
        "columns": [
            {
                "field": "index",
                "title": "#",
                "width": "3em",
                "align": "center",
                "formatter": "rownum",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "address",
                "title": "address",
                "width": "5ch",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "type",
                "title": "type",
                "width": "8em",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "rawValue",
                "title": "raw",
                "width": "12ch",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "name",
                "title": "name",
                "width": "16em",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "value",
                "title": "value",
                "width": "8ch",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "comment",
                "title": "comment",
                "width": "30em",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 1185,
        "y": 1980,
        "wires": [
            []
        ]
    },
    {
        "id": "5f7d9434ee851d46",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "ffe7d6539591cabf",
        "name": "send allInverterDDT query",
        "func": "return global.get(\"query\").between(4400, 4483,\"allInverterDDT\");\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 725,
        "y": 1875,
        "wires": [
            [
                "89ec3e26ebc5ea38"
            ]
        ]
    },
    {
        "id": "89ec3e26ebc5ea38",
        "type": "link call",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "ffe7d6539591cabf",
        "name": "query PLC",
        "links": [
            "064df6995fe637f2"
        ],
        "linkType": "static",
        "timeout": "3",
        "x": 770,
        "y": 1905,
        "wires": [
            [
                "f60ed334182c339f"
            ]
        ]
    },
    {
        "id": "f7946e855cb7af23",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "ffe7d6539591cabf",
        "name": "poll",
        "props": [],
        "repeat": "2",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 370,
        "y": 1980,
        "wires": [
            [
                "77190d99789c8205"
            ]
        ]
    },
    {
        "id": "77190d99789c8205",
        "type": "q-gate",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "ffe7d6539591cabf",
        "name": "gate",
        "controlTopic": "control",
        "defaultState": "open",
        "openCmd": "true",
        "closeCmd": "false",
        "toggleCmd": "toggle",
        "queueCmd": "queue",
        "defaultCmd": "default",
        "triggerCmd": "trigger",
        "flushCmd": "flush",
        "resetCmd": "reset",
        "peekCmd": "peek",
        "dropCmd": "drop",
        "statusCmd": "status",
        "maxQueueLength": "100",
        "keepNewest": false,
        "qToggle": false,
        "persist": true,
        "storeName": "memory",
        "x": 495,
        "y": 1965,
        "wires": [
            [
                "5f7d9434ee851d46"
            ]
        ]
    },
    {
        "id": "751f5980939d113e",
        "type": "ui_switch",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "ffe7d6539591cabf",
        "name": "toggle polling",
        "label": "poll",
        "tooltip": "ricarica la tabella ad intervalli di 1 secondo",
        "group": "0333a97ebf4d364e",
        "order": 5,
        "width": "1",
        "height": "2",
        "passthru": true,
        "decouple": "false",
        "topic": "control",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 350,
        "y": 1935,
        "wires": [
            [
                "77190d99789c8205"
            ]
        ]
    },
    {
        "id": "3c0c7d2ea6d76d9f",
        "type": "change",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "ffe7d6539591cabf",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "allInverterDDTTable",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1260,
        "y": 2070,
        "wires": [
            []
        ]
    },
    {
        "id": "912b13320bc74a21",
        "type": "rbe",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "ffe7d6539591cabf",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": false,
        "property": "payload",
        "topi": "topic",
        "x": 1100,
        "y": 2070,
        "wires": [
            [
                "3c0c7d2ea6d76d9f"
            ]
        ],
        "l": false
    },
    {
        "id": "f49802da0ea96466",
        "type": "debug",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "ffe7d6539591cabf",
        "name": "debug 12",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1160,
        "y": 2010,
        "wires": []
    },
    {
        "id": "a2d84d711435defe",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "ffe7d6539591cabf",
        "name": "onStartup",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.1",
        "topic": "",
        "x": 215,
        "y": 1995,
        "wires": [
            [
                "751f5980939d113e",
                "a387a9d3ceb733c8"
            ]
        ]
    },
    {
        "id": "a387a9d3ceb733c8",
        "type": "ui_multistate_switch",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "ffe7d6539591cabf",
        "name": "",
        "group": "0333a97ebf4d364e",
        "order": 6,
        "width": 0,
        "height": 1,
        "label": "switch",
        "stateField": "payload",
        "enableField": "enable",
        "passthroughField": "passthrough",
        "inputMsgField": "inputmsg",
        "rounded": false,
        "useThemeColors": true,
        "hideSelectedLabel": false,
        "multilineLabel": false,
        "passThrough": "never",
        "inputMsg": "all",
        "userInput": "enabled_show",
        "options": [
            {
                "label": "Option 0",
                "value": "off",
                "valueType": "str",
                "color": "#009933"
            },
            {
                "label": "Option 1",
                "value": "polling",
                "valueType": "str",
                "color": "#999999"
            }
        ],
        "topic": "",
        "x": 355,
        "y": 2040,
        "wires": [
            [
                "77190d99789c8205"
            ]
        ]
    },
    {
        "id": "eb4ab9c687c85a83",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "ffe7d6539591cabf",
        "name": "poll",
        "props": [],
        "repeat": "1",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 570,
        "y": 2070,
        "wires": [
            []
        ]
    },
    {
        "id": "8394e156f1e2488e",
        "type": "debug",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "ffe7d6539591cabf",
        "name": "debug 13",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1370,
        "y": 1980,
        "wires": []
    },
    {
        "id": "830ffb7ad83476f7",
        "type": "link in",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "ffe7d6539591cabf",
        "name": "allInverterDDT table",
        "links": [
            "f7aa3a5ee94581d8",
            "465a56cb5ae37a7b"
        ],
        "x": 425,
        "y": 1890,
        "wires": [
            [
                "5f7d9434ee851d46"
            ]
        ]
    },
    {
        "id": "aa246ddee430ee27",
        "type": "comment",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "ffe7d6539591cabf",
        "name": "Tabella DDT inverter, 25x24",
        "info": "",
        "x": 380,
        "y": 1770,
        "wires": []
    },
    {
        "id": "35e1d011498c72cd",
        "type": "link call",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "ffe7d6539591cabf",
        "name": "map & merge",
        "links": [
            "f6905ffb8eab6a25"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 970,
        "y": 1980,
        "wires": [
            [
                "3a58a38948ea94e8",
                "f49802da0ea96466",
                "c5220d97a1ee9a7d"
            ]
        ]
    },
    {
        "id": "b116d599b6b0916d",
        "type": "file in",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "7e5e3a6761c37063",
        "name": "readAsSingleString",
        "filename": ".\\modello export dati plc inverter.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 730,
        "y": 1980,
        "wires": [
            [
                "f1ac1cecd9de5f7a"
            ]
        ]
    },
    {
        "id": "f1ac1cecd9de5f7a",
        "type": "json",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "7e5e3a6761c37063",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 841,
        "y": 1980,
        "wires": [
            [
                "35e1d011498c72cd"
            ]
        ],
        "l": false
    },
    {
        "id": "4c4668d1d8f3b4a4",
        "type": "comment",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "7e5e3a6761c37063",
        "name": "export integrale tabella DDT plc",
        "info": "",
        "x": 625,
        "y": 1980,
        "wires": [],
        "l": false
    },
    {
        "id": "c5220d97a1ee9a7d",
        "type": "change",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "140b055fd622ecf2",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "origin",
                "pt": "msg",
                "to": "inverter",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1115,
        "y": 1905,
        "wires": [
            [
                "7905b0dc5437c385"
            ]
        ],
        "l": false
    },
    {
        "id": "7905b0dc5437c385",
        "type": "link out",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "140b055fd622ecf2",
        "name": "warnOnChange",
        "mode": "link",
        "links": [
            "e16f5eb91fb5c4b4"
        ],
        "x": 1225,
        "y": 1905,
        "wires": [],
        "l": true
    },
    {
        "id": "1df35f685bbae5dc",
        "type": "link in",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "140b055fd622ecf2",
        "name": "link in 3",
        "links": [
            "732e9e9a5be95374"
        ],
        "x": 1325,
        "y": 1905,
        "wires": [
            []
        ]
    },
    {
        "id": "95b41296cee79ea1",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 305,
        "y": 2625,
        "wires": [
            [
                "cc320cbf4edf1426"
            ]
        ]
    },
    {
        "id": "cc320cbf4edf1426",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "context.get() as reference",
        "func": "//does global.get() return a ref? yes\nglobal.set(\"a\",[1,2,3])\nnode.warn(\"the just set global \"+(global.get(\"a\")[0]==1 ? 'is def' : 'not readable'));\nvar refToA = global.get(\"a\")\nrefToA[1]=\"changed by ref\";\n\n//does global.set() store nested as reference? yes\nconst obj={ nested:[1,2,3]}\nglobal.set(\"obj\",obj);\nglobal.set(\"exposedNested\", global.get(\"obj\").nested );\n    //obj.nested is changed too\nglobal.get(\"exposedNested\")[1]=\"changed in exposedNested\"\n    \nreturn {\n    globalNow: global.get(\"a\"),\n    nesting: {\n        org: global.get(\"obj\"), exposedNested: global.get(\"exposedNested\")\n    }\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 505,
        "y": 2625,
        "wires": [
            [
                "edd6249a2176f48f"
            ]
        ]
    },
    {
        "id": "edd6249a2176f48f",
        "type": "debug",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "3f7bd448f06d6712",
        "name": "debug 10",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 755,
        "y": 2625,
        "wires": []
    },
    {
        "id": "2a2dbc09b59f3bd3",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "63c531914f3e675f",
        "name": "callWhenDefTest",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "\n/** alternative to using link-nodes on libraries (which requires a ton of overhead and structures)\n * \n*/\nfunction callWhenDef(cb, ...globalNames){\n    for(let name of globalNames)\n        if(global.get(name) === undefined || global.get(name) === null){\n            setTimeout(callWhenDef,100, cb , ...globalNames)\n            return\n        }\n    cb();\n}\n\ncallWhenDef( function(){\n    global.get(\"utils\").callWhenDef(function(){\n        node.warn({\"helloThere\":global.get(\"test\")});\n    },\"test\")\n},\"utils\");",
        "finalize": "",
        "libs": [],
        "x": 515,
        "y": 2730,
        "wires": [
            []
        ]
    },
    {
        "id": "521ac89e09289988",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "63c531914f3e675f",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 310,
        "y": 2775,
        "wires": [
            [
                "d7dfa5623ecde158"
            ]
        ]
    },
    {
        "id": "d7dfa5623ecde158",
        "type": "change",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "63c531914f3e675f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "test",
                "pt": "global",
                "to": "{\"gatto\":\"miao\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 490,
        "y": 2775,
        "wires": [
            []
        ]
    },
    {
        "id": "ad88853ecde7c005",
        "type": "comment",
        "z": "f325c0384ffbb0ed",
        "d": true,
        "g": "63c531914f3e675f",
        "name": "callWhenDefTest",
        "info": "",
        "x": 325,
        "y": 2730,
        "wires": []
    },
    {
        "id": "b72cdc2106ab24c8",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "g": "b1846aee57adefcb",
        "name": "superUser",
        "func": "let uiAbs = global.get(\"uiAbs\");\nuiAbs.prepareMsg_setUiToView(msg, uiAbs.views[\"superUser\"]);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 415,
        "y": 960,
        "wires": [
            [
                "cfef045ea8c2bef2"
            ]
        ]
    },
    {
        "id": "1774f12bc0e04bf2",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "g": "b1846aee57adefcb",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 240,
        "y": 960,
        "wires": [
            [
                "b72cdc2106ab24c8"
            ]
        ]
    },
    {
        "id": "9401e5aa92399513",
        "type": "debug",
        "z": "f325c0384ffbb0ed",
        "g": "b1846aee57adefcb",
        "name": "SET DASHBOARD VIEW",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "\"for \"&socketip&\" used \"&dashboardViewKey",
        "statusType": "jsonata",
        "x": 760,
        "y": 945,
        "wires": []
    },
    {
        "id": "cf7306491d278f10",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "g": "b1846aee57adefcb",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 225,
        "y": 930,
        "wires": [
            [
                "e4069ee38fc45f35"
            ]
        ]
    },
    {
        "id": "e4069ee38fc45f35",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "g": "b1846aee57adefcb",
        "name": "user",
        "func": "let uiAbs = global.get(\"uiAbs\");\nuiAbs.prepareMsg_setUiToView(msg, uiAbs.views[\"user\"]);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 930,
        "wires": [
            [
                "cfef045ea8c2bef2"
            ]
        ]
    },
    {
        "id": "6df483292baa967e",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "g": "b1846aee57adefcb",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 225,
        "y": 900,
        "wires": [
            [
                "02587a76b180f455"
            ]
        ]
    },
    {
        "id": "02587a76b180f455",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "g": "b1846aee57adefcb",
        "name": "unauth",
        "func": "let uiAbs = global.get(\"uiAbs\");\nuiAbs.prepareMsg_setUiToView(msg, uiAbs.views[\"unauth\"]);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 900,
        "wires": [
            [
                "cfef045ea8c2bef2"
            ]
        ]
    },
    {
        "id": "bebcfbb59d1aeebd",
        "type": "link out",
        "z": "f325c0384ffbb0ed",
        "g": "b1846aee57adefcb",
        "name": "uiControl input",
        "mode": "link",
        "links": [
            "5b77be932011ed23"
        ],
        "x": 725,
        "y": 915,
        "wires": [],
        "l": true
    },
    {
        "id": "cfef045ea8c2bef2",
        "type": "switch",
        "z": "f325c0384ffbb0ed",
        "g": "b1846aee57adefcb",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 585,
        "y": 930,
        "wires": [
            [
                "9401e5aa92399513",
                "bebcfbb59d1aeebd"
            ]
        ],
        "l": false
    },
    {
        "id": "2763037f1d2d0e8e",
        "type": "comment",
        "z": "f325c0384ffbb0ed",
        "g": "b1846aee57adefcb",
        "name": "send view to uicontrol dashboard",
        "info": "",
        "x": 295,
        "y": 855,
        "wires": []
    },
    {
        "id": "c0335db4c10270a1",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "g": "52760ee932971069",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 230,
        "y": 1110,
        "wires": [
            [
                "f0ba4a0f67585376"
            ]
        ]
    },
    {
        "id": "f0ba4a0f67585376",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "g": "52760ee932971069",
        "name": "0",
        "func": "msg.payload = 0;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 1110,
        "wires": [
            [
                "821b38a12b26c86f"
            ]
        ]
    },
    {
        "id": "d9297083114d9385",
        "type": "link out",
        "z": "f325c0384ffbb0ed",
        "g": "52760ee932971069",
        "name": "uiControl input",
        "mode": "link",
        "links": [
            "5b77be932011ed23"
        ],
        "x": 645,
        "y": 1110,
        "wires": [],
        "l": true
    },
    {
        "id": "ab8c5b4600986d16",
        "type": "debug",
        "z": "f325c0384ffbb0ed",
        "g": "52760ee932971069",
        "name": "SET DASHBOARD VIEW",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "\"for \"&socketip&\" used \"&dashboardViewKey",
        "statusType": "jsonata",
        "x": 720,
        "y": 1155,
        "wires": []
    },
    {
        "id": "821b38a12b26c86f",
        "type": "switch",
        "z": "f325c0384ffbb0ed",
        "g": "52760ee932971069",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 515,
        "y": 1155,
        "wires": [
            [
                "d9297083114d9385",
                "ab8c5b4600986d16"
            ]
        ],
        "l": false
    },
    {
        "id": "0c2f549ad9fd6eab",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "g": "52760ee932971069",
        "name": "1",
        "func": "msg.payload = 1;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 1155,
        "wires": [
            [
                "821b38a12b26c86f"
            ]
        ]
    },
    {
        "id": "ba5a4764161809b3",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "g": "52760ee932971069",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 230,
        "y": 1155,
        "wires": [
            [
                "0c2f549ad9fd6eab"
            ]
        ]
    },
    {
        "id": "3b3ba4a887224a24",
        "type": "function",
        "z": "f325c0384ffbb0ed",
        "g": "52760ee932971069",
        "name": "2",
        "func": "msg.payload = 2;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 1200,
        "wires": [
            [
                "821b38a12b26c86f"
            ]
        ]
    },
    {
        "id": "59b869627df47d52",
        "type": "inject",
        "z": "f325c0384ffbb0ed",
        "g": "52760ee932971069",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 240,
        "y": 1200,
        "wires": [
            [
                "3b3ba4a887224a24"
            ]
        ]
    },
    {
        "id": "cb6a26d3fa6e6d43",
        "type": "comment",
        "z": "f325c0384ffbb0ed",
        "g": "52760ee932971069",
        "name": "switch to tab",
        "info": "",
        "x": 240,
        "y": 1065,
        "wires": []
    },
    {
        "id": "2357e7ce45030cc8",
        "type": "comment",
        "z": "f325c0384ffbb0ed",
        "g": "b310ba5dbaa8b7a7",
        "name": "DASHBOARD MANUAL COMMANDS",
        "info": "",
        "x": 305,
        "y": 795,
        "wires": []
    },
    {
        "id": "d22b28f7a5a9e961",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "name": "emuRead out",
        "mode": "link",
        "links": [
            "19c8462c25c660b7",
            "c9df124372e4a5f9",
            "284d8df6bb648126",
            "3738c04c23c1038b",
            "73055a1222614ac2",
            "b162e6deb85ce2d7",
            "9192eb3f994ea4da",
            "cc450c1afa66feec"
        ],
        "x": 1545,
        "y": 400,
        "wires": [],
        "l": true
    },
    {
        "id": "8e1e7922b86d42b2",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "name": "allStatus emuRead out",
        "mode": "link",
        "links": [
            "46fc2b5540748ef7"
        ],
        "x": 1595,
        "y": 580,
        "wires": [],
        "l": true
    },
    {
        "id": "98dae3f7590e7f11",
        "type": "link in",
        "z": "b9377575097a37a3",
        "d": true,
        "name": "emuWrite in",
        "links": [
            "30474f067da09c85"
        ],
        "x": 195,
        "y": 560,
        "wires": [
            [
                "a83660b5da3a1451"
            ]
        ],
        "l": true
    },
    {
        "id": "ee4223c8a1b99306",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "name": "emuRead out",
        "mode": "link",
        "links": [
            "d80ffbbc4fa48591",
            "c9df124372e4a5f9",
            "284d8df6bb648126",
            "3738c04c23c1038b",
            "73055a1222614ac2",
            "b162e6deb85ce2d7",
            "9192eb3f994ea4da",
            "cc450c1afa66feec"
        ],
        "x": 1585,
        "y": 360,
        "wires": [],
        "l": true
    },
    {
        "id": "0240d02cf78bf36e",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "name": "allStatus emuRead out",
        "mode": "link",
        "links": [
            "78baa1a61204055e"
        ],
        "x": 1635,
        "y": 620,
        "wires": [],
        "l": true
    },
    {
        "id": "8117948127f422da",
        "type": "link in",
        "z": "b9377575097a37a3",
        "d": true,
        "name": "emuWrite in",
        "links": [
            "15b5d9fa5b38b7df",
            "2decd0f9254e0e8c"
        ],
        "x": 195,
        "y": 480,
        "wires": [
            [
                "a83660b5da3a1451"
            ]
        ],
        "l": true
    },
    {
        "id": "65865d131de15381",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "name": "emuRead out",
        "mode": "link",
        "links": [
            "5b58b2a9e2e64a97",
            "c9df124372e4a5f9",
            "284d8df6bb648126",
            "3738c04c23c1038b",
            "73055a1222614ac2",
            "b162e6deb85ce2d7",
            "9192eb3f994ea4da",
            "cc450c1afa66feec"
        ],
        "x": 1625,
        "y": 320,
        "wires": [],
        "l": true
    },
    {
        "id": "9cb4af547e388109",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "name": "allStatus emuRead out",
        "mode": "link",
        "links": [
            "b9822e2ffe31fd72"
        ],
        "x": 1675,
        "y": 660,
        "wires": [],
        "l": true
    },
    {
        "id": "1c1df7025fd07a24",
        "type": "link in",
        "z": "b9377575097a37a3",
        "d": true,
        "name": "emuWrite in",
        "links": [
            "15b5d9fa5b38b7df"
        ],
        "x": 195,
        "y": 600,
        "wires": [
            [
                "a83660b5da3a1451"
            ]
        ],
        "l": true
    },
    {
        "id": "454cf93fb55a37e1",
        "type": "function",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "6f1ada98f5867046",
        "name": "parse status",
        "func": "\nfunction isLost(status) {\n    return status.fill == \"red\";\n}\n\nfunction isWarn(status){\n    return status.fill == \"orange\";\n}\n\nfunction isOk(status) {\n    return status.fill == \"green\"; //!isWarn(status) && !isLost(status);\n}\n\n\nif(msg.origin==\"prodExc\")\n    context.set(\"prodExc\", msg.status)\nelse\n    context.set(\"status\", msg.status)\nvar status = context.get(\"status\");\nvar prodExc= context.get(\"prodExc\");\n//node.warn({pr:prodExc,st:status});\n\nif (isLost(status) || isLost(prodExc)) {\n    msg.payload=false;\n    return msg;\n}\nelse if (isLost(status) || isLost(prodExc)) {\n    msg.payload = \"warn\";\n    return msg;\n}\nelse if(isOk(status) && isOk(prodExc)){\n    msg.payload = true;\n    return msg;\n}\nelse\n    return //do nothing\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 1220,
        "wires": [
            [
                "ac0360013a3bc782"
            ]
        ]
    },
    {
        "id": "bbc0b268ea1e4b05",
        "type": "link in",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "6f1ada98f5867046",
        "name": "parseStatus in",
        "links": [],
        "x": 660,
        "y": 1220,
        "wires": [
            [
                "454cf93fb55a37e1"
            ]
        ]
    },
    {
        "id": "ac0360013a3bc782",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "6f1ada98f5867046",
        "name": "parseStatus out",
        "mode": "return",
        "links": [],
        "x": 960,
        "y": 1220,
        "wires": []
    },
    {
        "id": "d559e44b39c59c2e",
        "type": "catch",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "6f1ada98f5867046",
        "name": "",
        "scope": [
            "e9f7760b211c033c",
            "e9fdc5afa0d6118e",
            "0301b69a68603789",
            "541393527180c858"
        ],
        "uncaught": false,
        "x": 705,
        "y": 1180,
        "wires": [
            [
                "c9aaf418d77c2d5e"
            ]
        ]
    },
    {
        "id": "c9aaf418d77c2d5e",
        "type": "function",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "6f1ada98f5867046",
        "name": "silence timeouts",
        "func": "\n\nif(msg.error){\n    if (msg.error.message !== \"timeout\")\n        node.error({\"err\":msg.error.message,\"full\":msg});\n    //context.set(\"errorCc\", context.get(\"errorCc\")+1);\n}\nelse{\n    node.error(msg);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nnode.status({ fill: \"gray\", shape: \"ring\", text: \"\" });\ncontext.set(\"outCc\", 0);\ncontext.set(\"errorCc\", 0);",
        "finalize": "",
        "libs": [],
        "x": 875,
        "y": 1180,
        "wires": [
            []
        ]
    },
    {
        "id": "b5204d64c998cc1f",
        "type": "catch",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "a02047ec82263155",
        "name": "",
        "scope": null,
        "uncaught": true,
        "x": 225,
        "y": 200,
        "wires": [
            [
                "b1111e1050653ac6"
            ]
        ]
    },
    {
        "id": "21fbf510e4cbe1d4",
        "type": "function",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "a02047ec82263155",
        "name": "catchAll",
        "func": "if(msg.error){\n    node.error({\"err\":msg.error.message,\"src\":msg.error.source.id,\"n\":msg.error.source.name,\"full\":msg});\n    \n}\nelse{\n    node.error(msg);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nnode.status({ fill: \"gray\", shape: \"ring\", text: \"\" });\ncontext.set(\"outCc\", 0);\ncontext.set(\"errorCc\", 0);",
        "finalize": "",
        "libs": [],
        "x": 625,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "4debd21357a01bc6",
        "type": "catch",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "a02047ec82263155",
        "name": "",
        "scope": [
            "72b60ffb9a9036c8",
            "c574f48718a26b27",
            "6a62873b4e46bbd8",
            "fa46f22c945d1162",
            "65e1635fb1a50f25",
            "8c85da46fbc8e587",
            "1d39b0493c890778",
            "bb7391ca11d722fd",
            "7d83617565c017a9",
            "acd875f06792ebdb",
            "fccb30e0df3fc793",
            "2b87988c4803288a",
            "2b22f5507fc948ea",
            "826c568d71f175e9",
            "fb3c93636d9d4498",
            "1d739def3f7e0e95",
            "4c242adc2dec9143",
            "cb4e0f858ada3771",
            "3181becab8101bec"
        ],
        "uncaught": false,
        "x": 205,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "f3f7f42487fb6981",
        "type": "delay",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "a02047ec82263155",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "120",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 575,
        "y": 240,
        "wires": [
            [
                "3cfd59900276e4c7"
            ]
        ]
    },
    {
        "id": "3cfd59900276e4c7",
        "type": "function",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "a02047ec82263155",
        "name": "catchPlc",
        "func": "if(msg.error){\n    node.error({\"err\":msg.error.message,\"src\":msg.error.source.id,\"n\":msg.error.source.name,\"full\":msg});\n    \n}\nelse{\n    node.error(msg);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nnode.status({ fill: \"gray\", shape: \"ring\", text: \"\" });\ncontext.set(\"outCc\", 0);\ncontext.set(\"errorCc\", 0);",
        "finalize": "",
        "libs": [],
        "x": 745,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "69a6569de8f183d7",
        "type": "comment",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "a02047ec82263155",
        "name": "silence s7 endpoints timeouts (conn failed)",
        "info": "",
        "x": 325,
        "y": 95,
        "wires": []
    },
    {
        "id": "b1111e1050653ac6",
        "type": "function",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "a02047ec82263155",
        "name": "switch",
        "func": "\n\nif(msg.error && msg.error.source.type == \"s7 endpoint\" )\n    return [null,msg]   //to (silenced) catchPlc\nelse\n    return [msg,null]; //to catch all",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 395,
        "y": 200,
        "wires": [
            [
                "21fbf510e4cbe1d4"
            ],
            [
                "f3f7f42487fb6981"
            ]
        ]
    },
    {
        "id": "351ad075abbac370",
        "type": "change",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "name": "start cycle",
        "rules": [
            {
                "t": "set",
                "p": "action",
                "pt": "msg",
                "to": "start",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1375,
        "y": 860,
        "wires": [
            [
                "e9c08298ab7f350b"
            ]
        ]
    },
    {
        "id": "552b1632304bcb80",
        "type": "delay",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "name": "",
        "pauseType": "delay",
        "timeout": "10",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1685,
        "y": 815,
        "wires": [
            [
                "351ad075abbac370"
            ]
        ]
    },
    {
        "id": "e9c08298ab7f350b",
        "type": "function",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "name": "emulate plc",
        "func": "var state=context.get(\"state\")\n//node.warn({ input_state: state });\n\n//output template: [readOutput , cycleChanged , prod_writeRequest, status_writeRequest, prod_readRequest, status_readRequest ]\n    //readOutput    same as s7 //{} with var:value pairs\n    //cycleChanged  topic: \"cycleOff\" | \"cycleOn\"  payload:state\n    //prod_writeRequest     sends to plc prodExc s7\n    //status_writeRequest   sends to plc status s7    //only used in OnStart\n    //prod_readRequest      reads from plc prodExc s7\n    //status_readRequest    reads from plc status s7   //only used in OnStart\n\nfunction initData(){\n    return {\n        \"exc_id\":\"leftoverId\",\n        \"exc_status\":\"someStatus\",\n        \"exc_quantToDo\":17,\n        \"exc_quantProd\":3,\n        \"prod_cycleRun\":true,\n        \"prod_cycleNumber\":0,\n        \"prod_id\":\"\",\n        \"prod_quantProd\":0,\n        \"prod_esito\":true\n    }\n}\n\n\nif(!state)\n    state = initData();\n\n//emulate cycle routine state changes\nif(msg.action==\"start\"){\n    if(state.cycleRun)\n        node.error(\"received start when already running\");\n    node.warn(\"cycle began\");\n    //set state\n    state.cycleRun=true;\n    state.prod_cycleNumber++;\n    state.prod_id = state.exc_id;\n    state.exc_quantProd += state.prod_quantProd;\n    //emulate completion routine\n        //msg.eta = completion delay ms\n        //default delay = 5000ms\n    setTimeout((state)=>{\n        state.cycleRun=false;\n        //state.prod_id = \"\";\n        let esito = Math.rand() < 0.8;\n        if(esito){\n            \n        }\n        else{\n            state.exc_quantProd -= state.prod_quantProd;\n        }\n        node.warn({ esito: esito, cycle: state});\n        \n        //create write request for prodExc plc\n        let request={};\n        request.payload = new Array();\n        request.variable = new Array();\n        let keys=Object.keys(state);\n        let i=0;\n        for(let k of keys){\n            request.payload.push(state[k]);\n            request.variable.push(k);\n        }\n        node.send([ null, {topic:\"cycleOff\",payload:state}, request, null, null, null ]);\n    },msg.eta ?? 5000);\n}\n//read all //outputs an obj\nelse if(!msg.action || msg.action==\"readAll\"){\n    node.warn(\"readAll\");\n    node.send([state,null,null]);\n}\n//else write what's in variable\nelse if(msg.action == \"write\"){\n    let oldState=state; //#DBG\n    if (msg.variable.length) {\n        let i = 0;\n        for (let v of msg.variable) {\n            state[v] = msg.payload[i++];\n        }\n    }\n    node.warn({ written: msg, from: oldState, to: state });\n}\nelse{\n    node.warn({err:\"wth\",msg:msg});\n}\n\n\nnode.warn({output_state:state});\ncontext.set(\"state\",state);\n\n//create write request for plc\nlet request = {};\nrequest.payload = new Array();\nrequest.variable = new Array();\nlet keys = Object.keys(state);\nfor (let k of keys) {\n    request.payload.push(state[k]);\n    request.variable.push(k);\n}\nnode.send([null, (msg.action!=\"start\") ? null : { topic: \"cycleOn\", payload: state }, request, null, null, null]);",
        "outputs": 6,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\n\ncontext.set(\"status\", {\n    status_alife: false,\n    status_cycleActive: false,\n    status_emergency: false,\n    status_idraulicCmd: false,\n    status_idPressa: 1234,\n    status_pressPressata: 0,\n    status_tempPianoSup: 0,\n    status_tempPianoInf: 0\n});\n\n\n    //generate status changes\nlet id=setInterval(()=>{\n    let last=context.get(\"status\");\n    if(!last)\n        node.error(\"context undefined\");\n\n    let status = {\n        \"status_alife\": !last.status_alife,\n        \"status_cycleActive\": false,\n        \"status_emergency\": last.status_emergency ? false : Math.random() < 0.2,\n        \"status_idraulicCmd\": last.status_idraulicCmd ? false : Math.random() < 0.5,\n        \"status_idPressa\": 1234,\n        \"status_pressPressata\": Math.random()*350,\n        \"status_tempPianoSup\": 0, //Math.random() * (2*this.status_pressPressata),\n        \"status_tempPianoInf\": 0 //this.status_tempPianoSup - (1 / 3) * this.status_tempPianoInf + Math.random() * (2 / 3) * this.status_tempPianoInf\n    }\n    status.status_tempPianoSup =   Math.random() * (2 * status.status_pressPressata)  ;\n    status.status_tempPianoInf =   status.status_tempPianoSup - (1 / 3) * status.status_tempPianoSup + Math.random() * (2 / 3) * status.status_tempPianoSup  ;\n    \n    \n\n    //create write request for plc \n    let request = {};\n    request.payload = new Array();\n    request.variable = new Array();\n    let keys = Object.keys(status);\n    //node.warn({\"req keys\":keys});\n    for (let k of keys) {\n        //node.warn({s:status,\"k\":k,item:status[k]});\n        request.payload.push(status[k]);\n        request.variable.push(k);\n    }\n    \n    node.send([null, null, null,request,null])\n\n},10000);\n\ncontext.set(\"intervalId\",id); //cleared in \"On stop\"",
        "finalize": "// Code added here will be run when the\n// node is being stopped or re-deployed.\n\nclearTimeout(context.get(\"intervalId\"));\nnode.warn(\"timeout cleared\");",
        "libs": [],
        "x": 1605,
        "y": 905,
        "wires": [
            [],
            [
                "f37a0518b44c5219"
            ],
            [
                "8c85da46fbc8e587",
                "f04944e0439ccc47"
            ],
            [
                "1d39b0493c890778",
                "9cabc5e7732aff01"
            ],
            [
                "b524fe2e5e6aad80",
                "7e77562f0cc30659"
            ],
            [
                "b5ac12a94b58dff0",
                "37ea04af9df3d34f"
            ]
        ],
        "outputLabels": [
            "readOutput",
            "topic:cycleOn/cycleOff",
            "prodExc_writeRequest",
            "status_writeRequest",
            "prodExc_readRequest",
            "status_readRequest"
        ]
    },
    {
        "id": "f37a0518b44c5219",
        "type": "change",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "name": "delete",
        "rules": [
            {
                "t": "delete",
                "p": "topic",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1545,
        "y": 815,
        "wires": [
            [
                "552b1632304bcb80"
            ]
        ]
    },
    {
        "id": "fa46f22c945d1162",
        "type": "s7 control",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "endpoint": "34ec8711cb2e9270",
        "function": "trigger",
        "name": "",
        "x": 2170,
        "y": 965,
        "wires": [
            [
                "82fd1d1191fd6dc3"
            ]
        ]
    },
    {
        "id": "65e1635fb1a50f25",
        "type": "s7 control",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "endpoint": "fa784b598becc58c",
        "function": "trigger",
        "name": "",
        "x": 2190,
        "y": 1010,
        "wires": [
            [
                "ec556ce00fbd23ad"
            ]
        ]
    },
    {
        "id": "8c85da46fbc8e587",
        "type": "s7 out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "endpoint": "34ec8711cb2e9270",
        "variable": "",
        "name": "",
        "x": 1930,
        "y": 860,
        "wires": []
    },
    {
        "id": "1d39b0493c890778",
        "type": "s7 out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "endpoint": "fa784b598becc58c",
        "variable": "",
        "name": "",
        "x": 1935,
        "y": 905,
        "wires": []
    },
    {
        "id": "81d3b5c8c04e7de4",
        "type": "link in",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "name": "link in 4",
        "links": [
            "b524fe2e5e6aad80"
        ],
        "x": 1980,
        "y": 965,
        "wires": [
            [
                "fa46f22c945d1162"
            ]
        ]
    },
    {
        "id": "25a8041d1656d36e",
        "type": "link in",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "name": "link in 5",
        "links": [
            "b5ac12a94b58dff0"
        ],
        "x": 1990,
        "y": 1010,
        "wires": [
            [
                "65e1635fb1a50f25"
            ]
        ]
    },
    {
        "id": "b779e74b5a16fa1b",
        "type": "link in",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "name": "link in 6",
        "links": [
            "82fd1d1191fd6dc3",
            "ec556ce00fbd23ad"
        ],
        "x": 1475,
        "y": 935,
        "wires": [
            [
                "e9c08298ab7f350b"
            ]
        ]
    },
    {
        "id": "b524fe2e5e6aad80",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "name": "link out 8",
        "mode": "link",
        "links": [
            "81d3b5c8c04e7de4"
        ],
        "x": 1730,
        "y": 935,
        "wires": []
    },
    {
        "id": "b5ac12a94b58dff0",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "name": "link out 9",
        "mode": "link",
        "links": [
            "25a8041d1656d36e"
        ],
        "x": 1730,
        "y": 980,
        "wires": []
    },
    {
        "id": "82fd1d1191fd6dc3",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "name": "link out 10",
        "mode": "link",
        "links": [
            "b779e74b5a16fa1b"
        ],
        "x": 2355,
        "y": 965,
        "wires": []
    },
    {
        "id": "ec556ce00fbd23ad",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "name": "link out 11",
        "mode": "link",
        "links": [
            "b779e74b5a16fa1b"
        ],
        "x": 2380,
        "y": 1010,
        "wires": []
    },
    {
        "id": "7a404f64ad01274d",
        "type": "comment",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "name": "utility: emulate plc",
        "info": "",
        "x": 1370,
        "y": 785,
        "wires": []
    },
    {
        "id": "1caf9f4b81091c0d",
        "type": "inject",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1295,
        "y": 920,
        "wires": [
            [
                "351ad075abbac370"
            ]
        ]
    },
    {
        "id": "f04944e0439ccc47",
        "type": "debug",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "name": "debug 14",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2105,
        "y": 860,
        "wires": []
    },
    {
        "id": "7e77562f0cc30659",
        "type": "debug",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "name": "debug 15",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1835,
        "y": 965,
        "wires": []
    },
    {
        "id": "9cabc5e7732aff01",
        "type": "debug",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "name": "debug 16",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2120,
        "y": 905,
        "wires": []
    },
    {
        "id": "37ea04af9df3d34f",
        "type": "debug",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "fc6c8637d9b4aad0",
        "name": "debug 17",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1835,
        "y": 1010,
        "wires": []
    },
    {
        "id": "d0d35188ca977ce0",
        "type": "comment",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "6468e314d57e838e",
        "name": "plc pressa1",
        "info": "",
        "x": 205,
        "y": 1320,
        "wires": []
    },
    {
        "id": "c46b98a862a1ab60",
        "type": "switch",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "3d77674313c033de",
        "name": "sort data by press",
        "property": "press",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "pressa1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pressa2",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pressa3",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pressa4",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 5,
        "x": 515,
        "y": 860,
        "wires": [
            [
                "41df5591bfa012dd"
            ],
            [
                "ffe8c4b38dc5356f"
            ],
            [
                "cbee46675b660f6a"
            ],
            [
                "bf7e73d0cd5dbe88"
            ],
            [
                "c82c903f9464cdcc"
            ]
        ]
    },
    {
        "id": "c7e08d3cbb0142be",
        "type": "link in",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "3d77674313c033de",
        "name": "mixed sendToPressRequests in",
        "links": [
            "abe96bc7d7fbc506",
            "c30ca4565e0d218f",
            "7c8bd303c63bc52d"
        ],
        "x": 255,
        "y": 860,
        "wires": [
            [
                "c46b98a862a1ab60"
            ]
        ],
        "l": true
    },
    {
        "id": "41df5591bfa012dd",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "3d77674313c033de",
        "name": "pressa1 sendToPressRequests out",
        "mode": "link",
        "links": [
            "fbeadcead2a7ca1c"
        ],
        "x": 680,
        "y": 780,
        "wires": []
    },
    {
        "id": "c82c903f9464cdcc",
        "type": "function",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "3d77674313c033de",
        "name": "error",
        "func": "node.error({ err: \"unknown press in mixed sort\", press: msg.press, msg: msg });\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nnode.status({ fill: \"gray\", shape: \"ring\", text: \"\" });\ncontext.set(\"outCc\", 0);\ncontext.set(\"errorCc\", 0);",
        "finalize": "",
        "libs": [],
        "x": 715,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "ffe8c4b38dc5356f",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "3d77674313c033de",
        "name": "pressa2 sendToPressRequests out",
        "mode": "link",
        "links": [
            "e2e60c28672cbced",
            "258c1b1d56e1d332",
            "c623711bf916f14f",
            "7d2abe51be09432b",
            "2f654a500825a6c9",
            "da265b4fe1196f55"
        ],
        "x": 680,
        "y": 820,
        "wires": []
    },
    {
        "id": "cbee46675b660f6a",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "3d77674313c033de",
        "name": "pressa3 sendToPressRequests out",
        "mode": "link",
        "links": [
            "8e812a9c88b84904",
            "258c1b1d56e1d332",
            "c623711bf916f14f",
            "7d2abe51be09432b",
            "2f654a500825a6c9",
            "da265b4fe1196f55"
        ],
        "x": 680,
        "y": 860,
        "wires": []
    },
    {
        "id": "bf7e73d0cd5dbe88",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "3d77674313c033de",
        "name": "pressa4 sendToPressRequests out",
        "mode": "link",
        "links": [
            "e011e9b0ec37153c",
            "258c1b1d56e1d332",
            "c623711bf916f14f",
            "7d2abe51be09432b",
            "2f654a500825a6c9",
            "da265b4fe1196f55"
        ],
        "x": 680,
        "y": 900,
        "wires": []
    },
    {
        "id": "49087488e8ed7662",
        "type": "comment",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "3d77674313c033de",
        "name": "sort press for sendToPressRequests",
        "info": "",
        "x": 285,
        "y": 780,
        "wires": []
    },
    {
        "id": "bd6109d96baea39b",
        "type": "comment",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "utility: emulate plc self-contained, halfworking",
        "info": "",
        "x": 505,
        "y": 360,
        "wires": []
    },
    {
        "id": "c995137d4d361008",
        "type": "function",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "emulate prodExc plc",
        "func": "var state=context.get(\"state\");\n//output template: [readOutput , cycleChanged , selfRequests]\n    //readOutput    same as s7 //{} with var:value pairs\n    //cycleChanged  topic: \"cycleOff\" | \"cycleOn\"  payload:state\n    //selfRequests  sends to this node\n    //readStatusOutput\n\nfunction newData(){\n    return {\n        \"genCtrl\":Math.random(),\n        \"exc_id\":\"pippo\",\n        \"exc_status\":3,\n        \"exc_quantToDo\":17,\n        \"exc_quantProd\":18,\n        \"prod_cycleRun\":false,\n        \"prod_cycleNumber\":0,\n        \"prod_id\":\"\",\n        \"prod_quantProd\":0,\n        \"prod_esito\":false\n    }\n}\n\nfunction statData(last){\n    let status={\n        \"status_alife\": !last ? true : !last.status_alife,\n        \"status_cycleActive\": false,\n        \"status_emergency\": !last ? false : last.status_emergency ? false : Math.random() < 0.2,\n        \"status_idraulicCmd\": !last ? false : last.status_idraulicCmd ? false : Math.random() < 0.5,\n        \"status_idPressa\": 1234,\n        \"status_pressPressata\": Math.random()*240,\n        \"status_tempPianoSup\": 0, //Math.random() * (2*this.status_pressPressata),\n        \"status_tempPianoInf\": 0 //this.status_tempPianoSup - (1 / 3) * this.status_tempPianoInf + Math.random() * (2 / 3) * this.status_tempPianoInf\n    }\n    let percPress = status.pressPressata/240*100;\n    status.status_tempPianoSup =   (200-200/6 + Math.random() * 2*200/6) * percPress;\n    status.status_tempPianoInf =   (200-200/6 + Math.random() * 2*200/6) * percPress;\n    //status.status_tempPianoSup =   Math.random() * (2 * status.status_pressPressata)  ;\n    //status.status_tempPianoInf =   status.status_tempPianoSup - (1 / 3) * status.status_tempPianoSup + Math.random() * (2 / 3) * status.status_tempPianoSup  ;\n    return status;\n}\nfunction newRandData(prod_cycleRun=true){\n    let d=newData();\n}\n\n//one-time init\nif(state === undefined){\n    state = newData();\n    /*\n    let status = statData();\n    for(let k in status)\n        state[k]=status[k];\n\n    */\n}\n\n\nif(msg.action == \"poll\"){\n    /*\n    let allStatusOutput = {payload:{}};\n    let allProdExcOutput = {payload:{}};\n    for(let k in state){\n        if(/^status_/.test(k))\n            allStatusOutput.payload[k]=state[k];\n        else\n            allProdExcOutput.payload[k] = state[k];\n    }\n    node.send([null, null, allProdExcOutput,allStatusOutput])\n    */\n}\n//emulate cycle state changes\nelse if(msg.action==\"start\"){\n    if(state.prod_cycleRun)\n        node.error(\"received start when already running\");\n    //set state\n    state.prod_cycleRun=true;\n    state.prod_cycleNumber++;\n    state.prod_id = state.exc_id;\n    state.exc_status = 2;\n    state.prod_quantProd = 2;\n    state.exc_quantProd += state.prod_quantProd;\n    //emulate completion routine\n        //msg.eta = completion delay ms\n        //default delay = 5000ms\n    setTimeout((state)=>{\n        node.warn(\"cycleOff\");\n        state.prod_cycleRun=false;\n        \n        //state.prod_id = \"\";\n        let esito = Math.random() < 0.8;\n        if(esito){\n            state.exc_status = 4; // 'C'\n        }\n        else{\n            state.exc_status = 3; // 'P'\n            state.exc_quantProd -= state.prod_quantProd;\n        }\n        node.warn(esito);\n        let request={};\n        request.payload = new Array();\n        request.variable = new Array();\n        //create write request for this node //avoid async shenanigans from context.set()\n        for(let k in state){\n            request.payload.push(state[k]);\n            request.variable.push(k);\n        }\n        request.action=\"writeAll\";\n        /*\n        var allProdExc={};\n        for (let k in state) {\n            if (!/^status_/.test(k))\n                allProdExc[k] = state[k];\n        }\n        */\n        node.send([{topic:\"allProdExc\",payload:state},{topic:\"cycleOff\",payload:state},request])\n    },msg.eta ?? 5000,state);\n    /*\n    var allProdExc = {};\n    for (let k in state) {\n        if (!/^status_/.test(k))\n            allProdExc[k] = state[k];\n    }*/\n    node.warn(\"cycleOn\");\n    node.send([{topic:\"allProdExc\",payload:state}, null, null]);\n}\n//read all //outputs an obj\nelse if(!msg.action || msg.action==\"readAll\"){\n    let allStatusOutput = { payload:{} };\n    let allProdExcOutput = { payload: {} };\n\n    /*for(let k in state){\n        if(/^status_/.test(k))\n            allStatusOutput.payload[k]=state[k];\n        else\n            allProdExcOutput.payload[k] = state[k];\n    }*/\n    \n    msg.payload=state;\n    delete msg.action;\n\n    node.warn(\"readAll\");\n    node.send([msg,null,null]);\n}\nelse if (msg.action == \"writeAllStatus\") {\n    let status=context.get(\"status\");\n    if (msg.variable.length) {\n        //node.warn(\"writeAllStatus\");\n        for (let i = 0; i < msg.variable.length; i++) {\n            node.warn({ write: msg.payload[i], to: msg.variable[i] });\n            status[msg.variable[i]] = msg.payload[i];\n        }\n    }\n    context.set(\"status\",status);\n    node.warn({ statusGoneTo: status });\n}\n//else write what's in variable\nelse{\n    \n    if (msg.variable.length) {\n        //node.warn(\"writeAll\");\n        for (let i=0;i<msg.variable.length;i++) {\n            node.warn({write:msg.payload[i],to:msg.variable[i]});\n            state[msg.variable[i]] = msg.payload[i];\n        }\n    }\n    node.warn({stateGoneTo:state});\n}\n\n\ncontext.set(\"state\",state);",
        "outputs": 4,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\n\n\ncontext.set(\"status\", {\n    status_alife: false,\n    status_cycleActive: false,\n    status_emergency: false,\n    status_idraulicCmd: false,\n    status_idPressa: 1234,\n    status_pressPressata: 0,\n    status_tempPianoSup: 0,\n    status_tempPianoInf: 0\n});\n\n\n//generate status changes\nlet id = setInterval(() => {\n    let last = context.get(\"state\") ?? context.get(\"status\");\n    if (!last)\n        node.error(\"context undefined\");\n\n    let status = {\n        \"status_alife\": !last.status_alife,\n        \"status_cycleActive\": false,\n        \"status_emergency\": last.status_emergency ? false : Math.random() < 0.2,\n        \"status_idraulicCmd\": last.status_idraulicCmd ? false : Math.random() < 0.5,\n        \"status_idPressa\": 1234,\n        \"status_pressPressata\": Math.random() * 350,\n        \"status_tempPianoSup\": 0, //Math.random() * (2*this.status_pressPressata),\n        \"status_tempPianoInf\": 0 //this.status_tempPianoSup - (1 / 3) * this.status_tempPianoInf + Math.random() * (2 / 3) * this.status_tempPianoInf\n    }\n    status.status_tempPianoSup = Math.random() * (2 * status.status_pressPressata);\n    status.status_tempPianoInf = status.status_tempPianoSup - (1 / 3) * status.status_tempPianoSup + Math.random() * (2 / 3) * status.status_tempPianoSup;\n\n    //create write request for this node\n    let request = {};\n    request.payload = new Array();\n    request.variable = new Array();\n    let keys = Object.keys(status);\n    //node.warn({\"req keys\":keys});\n    for (let k of keys) {\n        //node.warn({s:status,\"k\":k,item:status[k]});\n        request.payload.push(status[k]);\n        request.variable.push(k);\n    }\n    request.action=\"writeAllStatus\";\n    node.send([null, null, request,{payload:status}])\n\n}, 5000);\n\ncontext.set(\"intervalId\", id); //cleared in \"On stop\"\n\n",
        "finalize": "",
        "libs": [],
        "x": 815,
        "y": 495,
        "wires": [
            [
                "68103b2c84b029a5",
                "ef2a49517ea8e8ce",
                "d22b28f7a5a9e961",
                "ee4223c8a1b99306",
                "65865d131de15381"
            ],
            [
                "fa52f4b698761fb6"
            ],
            [
                "9111dea45f892157"
            ],
            [
                "21e833d404c37992",
                "47a51a5c770177f1",
                "8e1e7922b86d42b2",
                "0240d02cf78bf36e",
                "9cb4af547e388109"
            ]
        ],
        "outputLabels": [
            "readOutput",
            "topic:cycleOn/cycleOff",
            "to self",
            ""
        ]
    },
    {
        "id": "9111dea45f892157",
        "type": "switch",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 795,
        "y": 580,
        "wires": [
            [
                "c995137d4d361008"
            ]
        ],
        "l": false
    },
    {
        "id": "45d520a6fb72eee7",
        "type": "change",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "start cycle",
        "rules": [
            {
                "t": "set",
                "p": "action",
                "pt": "msg",
                "to": "start",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 480,
        "wires": [
            [
                "c995137d4d361008"
            ]
        ]
    },
    {
        "id": "33c2c24b51f576c7",
        "type": "inject",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "action:poll 10s",
        "props": [
            {
                "p": "action",
                "v": "poll",
                "vt": "str"
            }
        ],
        "repeat": "6",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "x": 485,
        "y": 565,
        "wires": [
            [
                "c995137d4d361008"
            ]
        ]
    },
    {
        "id": "2b00129f3f91c856",
        "type": "change",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "action:readAll",
        "rules": [
            {
                "t": "set",
                "p": "action",
                "pt": "msg",
                "to": "readAll",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 575,
        "y": 610,
        "wires": [
            [
                "c995137d4d361008"
            ]
        ]
    },
    {
        "id": "a83660b5da3a1451",
        "type": "change",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "action:writeAll",
        "rules": [
            {
                "t": "set",
                "p": "action",
                "pt": "msg",
                "to": "writeAll",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 525,
        "wires": [
            [
                "c995137d4d361008"
            ]
        ]
    },
    {
        "id": "68103b2c84b029a5",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "emuRead out",
        "mode": "link",
        "links": [
            "b1ce79e818307751",
            "c9df124372e4a5f9",
            "284d8df6bb648126",
            "3738c04c23c1038b",
            "73055a1222614ac2",
            "b162e6deb85ce2d7",
            "9192eb3f994ea4da",
            "cc450c1afa66feec"
        ],
        "x": 1135,
        "y": 450,
        "wires": [],
        "l": true
    },
    {
        "id": "ef2a49517ea8e8ce",
        "type": "debug",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "all prodExc with topic:prodExc",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1205,
        "y": 480,
        "wires": []
    },
    {
        "id": "fa52f4b698761fb6",
        "type": "change",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "topic",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 725,
        "y": 420,
        "wires": [
            [
                "c5ed6815fba11d03"
            ]
        ]
    },
    {
        "id": "21e833d404c37992",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "allStatus emuRead out",
        "mode": "link",
        "links": [
            "647159f3ed671018"
        ],
        "x": 1160,
        "y": 540,
        "wires": [],
        "l": true
    },
    {
        "id": "47a51a5c770177f1",
        "type": "debug",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "debug 18",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1125,
        "y": 570,
        "wires": []
    },
    {
        "id": "f8197dfe83065776",
        "type": "inject",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "start",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 420,
        "y": 480,
        "wires": [
            [
                "45d520a6fb72eee7"
            ]
        ],
        "l": false
    },
    {
        "id": "d0e35598fdc88529",
        "type": "inject",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "OnStartup3",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "3",
        "topic": "",
        "x": 410,
        "y": 420,
        "wires": [
            [
                "45d520a6fb72eee7"
            ]
        ]
    },
    {
        "id": "22bd8688afb73c9f",
        "type": "gate",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 1005,
        "y": 420,
        "wires": [
            [
                "45d520a6fb72eee7"
            ]
        ],
        "l": false
    },
    {
        "id": "17746ac1098a88b0",
        "type": "link in",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "emuReadAll in",
        "links": [],
        "x": 385,
        "y": 610,
        "wires": [
            [
                "2b00129f3f91c856"
            ]
        ],
        "l": true
    },
    {
        "id": "f428ef7f0a8a8a80",
        "type": "inject",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "start",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 450,
        "y": 650,
        "wires": [
            [
                "2b00129f3f91c856"
            ]
        ],
        "l": false
    },
    {
        "id": "e085918b8aa8e446",
        "type": "link in",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "emuWrite in",
        "links": [
            "b2bee83e7260211a",
            "504464c430ba7283",
            "c0a6f5a095ded7d3",
            "69b1ea7a62b8ffde",
            "a467d56466998dc7",
            "264c06f2fdf3b2df",
            "82ede1c062e87eb3",
            "d16297afbe03f8ba",
            "dd535bcb2b06deea",
            "15b5d9fa5b38b7df"
        ],
        "x": 380,
        "y": 525,
        "wires": [
            [
                "a83660b5da3a1451"
            ]
        ],
        "l": true
    },
    {
        "id": "c5ed6815fba11d03",
        "type": "delay",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "",
        "pauseType": "delay",
        "timeout": "10",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 885,
        "y": 420,
        "wires": [
            [
                "22bd8688afb73c9f"
            ]
        ]
    },
    {
        "id": "870da2506eac28bc",
        "type": "change",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "toggle cycle loop",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "control",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "toggle",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 875,
        "y": 375,
        "wires": [
            [
                "22bd8688afb73c9f"
            ]
        ]
    },
    {
        "id": "24b155b8ecaf80fd",
        "type": "inject",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "22fa3a13397fe4f2",
        "name": "start",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 745,
        "y": 375,
        "wires": [
            [
                "870da2506eac28bc"
            ]
        ],
        "l": false
    },
    {
        "id": "72b60ffb9a9036c8",
        "type": "s7 in",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "df9088f254e94c5e",
        "endpoint": "fa784b598becc58c",
        "mode": "all",
        "variable": "exc_id",
        "diff": false,
        "name": "ifDiff -> all status 60s",
        "x": 265,
        "y": 1860,
        "wires": [
            [
                "4d725a406e8b7475"
            ]
        ]
    },
    {
        "id": "b90197333a8243e5",
        "type": "debug",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "df9088f254e94c5e",
        "name": "pressa1 allStatus pressa1 ",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 640,
        "y": 1815,
        "wires": []
    },
    {
        "id": "720243a5e49de53d",
        "type": "function",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "df9088f254e94c5e",
        "name": "split with topic:varName",
        "func": "\nlet keys=Object.keys(msg.payload);\n//node.warn(keys);\n    //from status_alife:true   to {topic:alife, payload:true}\nlet out=[];\nfor(let k of keys){\n    node.send({\n        topic:k.match(/\\w+_(.+)/)[1],\n        payload:msg.payload[k],\n    })\n    //out.push({\n    //     topic: k.match(/\\w+_(.+)/)[1],\n    //    payload: msg.payload[k],\n    //});\n}\n\n//node.warn(out);\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 615,
        "y": 1860,
        "wires": [
            [
                "8c79e600376c46de"
            ]
        ]
    },
    {
        "id": "e521c584e11bfcc4",
        "type": "comment",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "df9088f254e94c5e",
        "name": "poll status pressa1",
        "info": "",
        "x": 250,
        "y": 1815,
        "wires": []
    },
    {
        "id": "8c79e600376c46de",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "df9088f254e94c5e",
        "name": "pressa1_mixedDataIn_out",
        "mode": "link",
        "links": [
            "616b4fb31ab7fe25",
            "9890c53475b90fa6"
        ],
        "x": 880,
        "y": 1860,
        "wires": [],
        "l": true
    },
    {
        "id": "4d725a406e8b7475",
        "type": "switch",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "df9088f254e94c5e",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 1,
        "x": 425,
        "y": 1860,
        "wires": [
            [
                "b90197333a8243e5",
                "720243a5e49de53d"
            ]
        ],
        "l": false
    },
    {
        "id": "647159f3ed671018",
        "type": "link in",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "df9088f254e94c5e",
        "name": "allStatus emuRead in",
        "links": [
            "21e833d404c37992",
            "46c2b8c68937078c",
            "dfb6b94f3d572af5"
        ],
        "x": 265,
        "y": 1905,
        "wires": [
            [
                "4d725a406e8b7475"
            ]
        ],
        "l": true
    },
    {
        "id": "f0334309524bc22b",
        "type": "switch",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "19899f2d110fd419",
        "name": "exc_status",
        "property": "payload.exc_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "3",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 435,
        "y": 2490,
        "wires": [
            [
                "85bbcfb635da5688"
            ],
            [
                "6dd800ca3a398c60"
            ],
            [
                "85bbcfb635da5688"
            ],
            [
                "85bbcfb635da5688"
            ]
        ]
    },
    {
        "id": "9347d860a9df1cea",
        "type": "link in",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "19899f2d110fd419",
        "name": "pressa1 allProdExc in",
        "links": [
            "35d354408fae7539"
        ],
        "x": 240,
        "y": 2490,
        "wires": [
            [
                "f0334309524bc22b"
            ]
        ],
        "l": true
    },
    {
        "id": "6dd800ca3a398c60",
        "type": "change",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "19899f2d110fd419",
        "name": "queue",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "control",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "queue",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 630,
        "y": 2475,
        "wires": [
            [
                "2bb00c70116db4b3"
            ]
        ]
    },
    {
        "id": "85bbcfb635da5688",
        "type": "change",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "19899f2d110fd419",
        "name": "open",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "control",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "open",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 630,
        "y": 2505,
        "wires": [
            [
                "2bb00c70116db4b3"
            ]
        ]
    },
    {
        "id": "a39c33d989cf670b",
        "type": "switch",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "19899f2d110fd419",
        "name": "!= green",
        "property": "status.fill",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "green",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 760,
        "y": 2380,
        "wires": [
            [
                "6dd800ca3a398c60"
            ]
        ]
    },
    {
        "id": "2bb00c70116db4b3",
        "type": "q-gate",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "19899f2d110fd419",
        "name": "keep last",
        "controlTopic": "control",
        "defaultState": "queueing",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "queueCmd": "queue",
        "defaultCmd": "default",
        "triggerCmd": "trigger",
        "flushCmd": "flush",
        "resetCmd": "reset",
        "peekCmd": "peek",
        "dropCmd": "drop",
        "statusCmd": "status",
        "maxQueueLength": "1",
        "keepNewest": true,
        "qToggle": false,
        "persist": false,
        "storeName": "memory",
        "x": 600,
        "y": 2565,
        "wires": [
            [
                "3c4bfe32b15bc405"
            ]
        ]
    },
    {
        "id": "f2784c01e5c99dc6",
        "type": "status",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "19899f2d110fd419",
        "name": "pressa1 connStatus",
        "scope": [
            "6a62873b4e46bbd8"
        ],
        "x": 565,
        "y": 2380,
        "wires": [
            [
                "a39c33d989cf670b"
            ]
        ]
    },
    {
        "id": "fbeadcead2a7ca1c",
        "type": "link in",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "19899f2d110fd419",
        "name": "pressa1 sendToPressRequests in",
        "links": [
            "c90373ea81f269e7",
            "41df5591bfa012dd",
            "297375027392a9b4",
            "6b4639f59bf141a0",
            "2b4384d6ab15617e"
        ],
        "x": 315,
        "y": 2565,
        "wires": [
            [
                "2bb00c70116db4b3"
            ]
        ],
        "l": true
    },
    {
        "id": "3c4bfe32b15bc405",
        "type": "function",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "19899f2d110fd419",
        "name": "sendToPress requests",
        "func": "\n\nvar write;\n\n//load order in plc\nif(msg.action == \"load\"){\n    write = {\n        \"exc_quantProd\":msg.payload.quantProd,\n        \"exc_quantToDo\":msg.payload.quantToDo,\n        \"exc_status\": 0,\n        \"exc_id\":msg.payload.id\n    }\n}\n//clear plc with placeholder values\nelse if(msg.action == \"clear\"){\n    write = {\n        \"exc_quantProd\": 0,\n        \"exc_quantToDo\": 0,\n        \"exc_status\":0,\n        \"exc_id\": \"\"\n    }\n}\nelse if(msg.action == \"nothing\"){\n    return null;\n}\n\n//build s7 request\nlet request = { payload: [], variable: [] };\nfor (let k in write) {\n    request.payload.push(write[k]);\n    request.variable.push(k);\n}\n//send msg as feedback on 2nd channel\nreturn [request, msg];\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 2565,
        "wires": [
            [
                "cdaf25d739c9fe5d",
                "b2bee83e7260211a",
                "80e89aead4ab3d75"
            ],
            [
                "81fd06535c53fa28"
            ]
        ]
    },
    {
        "id": "cdaf25d739c9fe5d",
        "type": "s7 out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "19899f2d110fd419",
        "endpoint": "34ec8711cb2e9270",
        "variable": "",
        "name": "writeTo prodExc",
        "x": 1060,
        "y": 2535,
        "wires": []
    },
    {
        "id": "81fd06535c53fa28",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "19899f2d110fd419",
        "name": "pressa1 sendToPressRequest done out",
        "mode": "link",
        "links": [
            "65322cbc3d91d4f5",
            "a1ac077375ba231d",
            "ee7df6ca341a90cc"
        ],
        "x": 1130,
        "y": 2580,
        "wires": [],
        "l": true
    },
    {
        "id": "e31ca3afb2ea7f0b",
        "type": "comment",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "19899f2d110fd419",
        "name": "sendToPress requests pressa1",
        "info": "",
        "x": 285,
        "y": 2385,
        "wires": []
    },
    {
        "id": "b2bee83e7260211a",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "19899f2d110fd419",
        "name": "emuWrite out",
        "mode": "link",
        "links": [
            "e085918b8aa8e446",
            "7ac6e5493f61d4cd",
            "e0e81e80da5f8816"
        ],
        "x": 1050,
        "y": 2490,
        "wires": [],
        "l": true
    },
    {
        "id": "80e89aead4ab3d75",
        "type": "debug",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "19899f2d110fd419",
        "name": "write to prodExc pressa1 ",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1085,
        "y": 2460,
        "wires": []
    },
    {
        "id": "5b485b54db9fe1f2",
        "type": "link in",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "19899f2d110fd419",
        "name": "pressa1 onConnIsOkChange in",
        "links": [
            "08d4c169c375e425"
        ],
        "x": 305,
        "y": 2425,
        "wires": [
            [
                "23871617ee198621"
            ]
        ],
        "l": true
    },
    {
        "id": "23871617ee198621",
        "type": "switch",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "19899f2d110fd419",
        "name": "== false",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 520,
        "y": 2425,
        "wires": [
            [
                "6dd800ca3a398c60"
            ],
            []
        ]
    },
    {
        "id": "35d354408fae7539",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "716d4b0a2eeac322",
        "name": "pressa1 allProdExc out",
        "mode": "link",
        "links": [
            "9347d860a9df1cea",
            "2ef2e1ec9ad18993"
        ],
        "x": 615,
        "y": 2205,
        "wires": [],
        "l": true
    },
    {
        "id": "6a62873b4e46bbd8",
        "type": "s7 in",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "716d4b0a2eeac322",
        "endpoint": "34ec8711cb2e9270",
        "mode": "all",
        "variable": "exc_id",
        "diff": false,
        "name": "all prodExc 10s",
        "x": 240,
        "y": 2145,
        "wires": [
            [
                "2c5766100f1b6b0b"
            ]
        ]
    },
    {
        "id": "9f86718937d29bba",
        "type": "function",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "716d4b0a2eeac322",
        "name": "trigger once per cycle",
        "func": "\nvar lastCycleIsRunning=context.get(\"lastCycleIsRunning\") ?? false;\nvar lastCycleNumber = context.get(\"lastCycleNumber\") ?? -1;\n\n//if (lastCycleNumber<=0)\n    //lastCycleNumber=flow.get(\"historyTable\")[0].cycleNum || -1; //table not defined outside its flow\n\n//on cycleRunning change\nlet cycleIsRunning = msg.payload.prod_cycleRun;\n//node.warn({lastCyc:lastCycleIsRunning,cyc:cycleIsRunning});\n\nif (lastCycleIsRunning != cycleIsRunning){\n    context.set(\"lastCycleIsRunning\",cycleIsRunning);\n    //on cycle beginning\n    if(cycleIsRunning){\n\n\n        node.send([msg,null]);\n    }\n    //on cycle end\n    else{\n\n\n        node.send([null, msg]);\n    }\n}\n\n\n\n\n\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 2100,
        "wires": [
            [
                "1c7d69ab9f66b8ca"
            ],
            [
                "178cc6bf43de6aad",
                "d331c13fa0d9ea1e"
            ]
        ],
        "outputLabels": [
            "cycleBeginning",
            "cycleEnding"
        ]
    },
    {
        "id": "89acac1fd8a887f1",
        "type": "debug",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "716d4b0a2eeac322",
        "name": "all prodExc pressa1 ",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 605,
        "y": 2160,
        "wires": []
    },
    {
        "id": "12771038e847a88a",
        "type": "change",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "716d4b0a2eeac322",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "pressa1_prodExc",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 615,
        "y": 2250,
        "wires": [
            []
        ]
    },
    {
        "id": "e33aa7e7cbd97b4e",
        "type": "change",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "716d4b0a2eeac322",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "pressa1_exc_status",
                "pt": "flow",
                "to": "payload.exc_status",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 630,
        "y": 2290,
        "wires": [
            []
        ]
    },
    {
        "id": "b1ce79e818307751",
        "type": "link in",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "716d4b0a2eeac322",
        "name": "emuRead in",
        "links": [
            "68103b2c84b029a5",
            "e9413d634bd51052",
            "3f33a48033934063"
        ],
        "x": 245,
        "y": 2190,
        "wires": [
            [
                "2c5766100f1b6b0b"
            ]
        ],
        "l": true
    },
    {
        "id": "1c7d69ab9f66b8ca",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "716d4b0a2eeac322",
        "name": "pressa1 allProdExc onceOnCycleStart out",
        "mode": "link",
        "links": [],
        "x": 930,
        "y": 2085,
        "wires": [],
        "l": true
    },
    {
        "id": "178cc6bf43de6aad",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "716d4b0a2eeac322",
        "name": "pressa1 allProdExc onceOnCycleEnd out",
        "mode": "link",
        "links": [
            "9f767a4b86454460",
            "dc42f7c25233e317",
            "cf605b67dca1fd9a"
        ],
        "x": 930,
        "y": 2130,
        "wires": [],
        "l": true
    },
    {
        "id": "d331c13fa0d9ea1e",
        "type": "debug",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "716d4b0a2eeac322",
        "name": "oncePerCyc end pressa1 ",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 885,
        "y": 2175,
        "wires": []
    },
    {
        "id": "c1a586c2ed4a2cee",
        "type": "comment",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "716d4b0a2eeac322",
        "name": "poll prodExc pressa1",
        "info": "",
        "x": 250,
        "y": 2010,
        "wires": []
    },
    {
        "id": "2c5766100f1b6b0b",
        "type": "switch",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "716d4b0a2eeac322",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 1,
        "x": 370,
        "y": 2145,
        "wires": [
            [
                "35d354408fae7539",
                "9f86718937d29bba",
                "89acac1fd8a887f1",
                "12771038e847a88a",
                "e33aa7e7cbd97b4e",
                "17feef43ab700877"
            ]
        ],
        "l": false
    },
    {
        "id": "17feef43ab700877",
        "type": "change",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "716d4b0a2eeac322",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "pressa1_status",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 860,
        "y": 2250,
        "wires": [
            []
        ]
    },
    {
        "id": "3f570b4b27989310",
        "type": "inject",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "x": 400,
        "y": 1620,
        "wires": [
            [
                "85fe0215925f055b"
            ]
        ]
    },
    {
        "id": "85fe0215925f055b",
        "type": "switch",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "payload true/false",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "jsonata"
            },
            {
                "t": "eq",
                "v": "false",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 620,
        "y": 1695,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "5571157ca53f72d7",
        "type": "inject",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "false",
        "payloadType": "bool",
        "x": 400,
        "y": 1650,
        "wires": [
            [
                "85fe0215925f055b"
            ]
        ]
    },
    {
        "id": "2f9978300a1d1790",
        "type": "switch",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 1,
        "x": 445,
        "y": 1695,
        "wires": [
            [
                "85fe0215925f055b"
            ]
        ],
        "l": false
    },
    {
        "id": "c574f48718a26b27",
        "type": "s7 in",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "endpoint": "34ec8711cb2e9270",
        "mode": "single",
        "variable": "prod_cycleRun",
        "diff": true,
        "name": "ifDifferent -> prod_cycleRun",
        "x": 295,
        "y": 1695,
        "wires": [
            [
                "2f9978300a1d1790"
            ]
        ]
    },
    {
        "id": "d884204c818a7421",
        "type": "status",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "pressa1_allProdExc",
        "scope": [
            "72b60ffb9a9036c8",
            "c574f48718a26b27"
        ],
        "x": 245,
        "y": 1470,
        "wires": [
            [
                "b1d2f477e488dda8",
                "0da23baee9865b59",
                "412e396b6f49d506"
            ]
        ]
    },
    {
        "id": "b1d2f477e488dda8",
        "type": "change",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "origin",
                "pt": "msg",
                "to": "prodExc",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 465,
        "y": 1470,
        "wires": [
            [
                "e9f7760b211c033c"
            ]
        ]
    },
    {
        "id": "0da23baee9865b59",
        "type": "change",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "origin",
                "pt": "msg",
                "to": "status",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 1440,
        "wires": [
            [
                "e9f7760b211c033c"
            ]
        ]
    },
    {
        "id": "412e396b6f49d506",
        "type": "function",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "send to status globals",
        "func": "\nif(msg.status && msg.status.fill && (typeof msg.status.fill) == \"string\")\n    return [{ payload: msg.status.fill }, { payload: msg.status.fill==\"green\" }]\n\nreturn null;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 395,
        "y": 1530,
        "wires": [
            [
                "7275e36794ea0351"
            ],
            [
                "14e38cde273d26cc"
            ]
        ],
        "l": false
    },
    {
        "id": "e9f7760b211c033c",
        "type": "link call",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "parse Status",
        "links": [
            "bbc0b268ea1e4b05"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 690,
        "y": 1455,
        "wires": [
            [
                "8e8d43ea58023819"
            ]
        ]
    },
    {
        "id": "b45436d6c32aec5b",
        "type": "status",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "pressa1_allStatus",
        "scope": [
            "c574f48718a26b27",
            "72b60ffb9a9036c8"
        ],
        "x": 245,
        "y": 1440,
        "wires": [
            [
                "0da23baee9865b59"
            ]
        ]
    },
    {
        "id": "ec925f9cc97d2a35",
        "type": "status",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "pressa1_allStatus",
        "scope": [
            "c574f48718a26b27",
            "72b60ffb9a9036c8"
        ],
        "x": 245,
        "y": 1530,
        "wires": [
            [
                "412e396b6f49d506"
            ]
        ]
    },
    {
        "id": "7275e36794ea0351",
        "type": "change",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "pressa1ConnStatus",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 570,
        "y": 1515,
        "wires": [
            [
                "b09126e2defac7b3"
            ]
        ]
    },
    {
        "id": "14e38cde273d26cc",
        "type": "change",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "pressa1ConnIsOk",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 1545,
        "wires": [
            [
                "08d4c169c375e425"
            ]
        ]
    },
    {
        "id": "8e8d43ea58023819",
        "type": "trigger",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "merge 300ms",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "payl",
        "duration": "300",
        "extend": true,
        "overrideDelay": false,
        "units": "ms",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 865,
        "y": 1455,
        "wires": [
            [
                "a50d774300049060"
            ]
        ]
    },
    {
        "id": "b09126e2defac7b3",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "pressa1 onConnStatusChange out",
        "mode": "link",
        "links": [],
        "x": 875,
        "y": 1515,
        "wires": [],
        "l": true
    },
    {
        "id": "08d4c169c375e425",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "pressa1 onConnIsOkChange out",
        "mode": "link",
        "links": [
            "5b485b54db9fe1f2"
        ],
        "x": 875,
        "y": 1545,
        "wires": [],
        "l": true
    },
    {
        "id": "a50d774300049060",
        "type": "link out",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "pressa1_alife_dataIn_out",
        "mode": "link",
        "links": [
            "8ef946242380175e",
            "7446c855e9d2de4f"
        ],
        "x": 1085,
        "y": 1455,
        "wires": [],
        "l": true
    },
    {
        "id": "bc3b85c3a5989a53",
        "type": "inject",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "OnStartup0.1 setDefaults",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 1195,
        "y": 1530,
        "wires": [
            [
                "8036e0640623c816",
                "c472dcc87f5170c8"
            ]
        ]
    },
    {
        "id": "8036e0640623c816",
        "type": "change",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "pressa1ConnStatus",
                "pt": "global",
                "to": "red",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1465,
        "y": 1515,
        "wires": [
            []
        ]
    },
    {
        "id": "c472dcc87f5170c8",
        "type": "change",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "pressa1ConnIsOk",
                "pt": "global",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1455,
        "y": 1545,
        "wires": [
            []
        ]
    },
    {
        "id": "2180a1fb7230451e",
        "type": "comment",
        "z": "b9377575097a37a3",
        "d": true,
        "g": "f9ab78df7bf3b33e",
        "name": "track connection status pressa1",
        "info": "",
        "x": 315,
        "y": 1395,
        "wires": []
    },
    {
        "id": "7c6b28299a6f4f68",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "d": true,
        "g": "4a012d8714c195b5",
        "name": "uiAbs_bkp",
        "func": "\nlet tabs=[];\nlet groups=[];\nlet tree=[];\n\nconst json=msg.payload;\n    //estract tabs and groups to sorted arrays\nfor(let item of json){\n    if(item.type==\"ui_tab\")\n        tabs.push(item);\n    else if(item.type==\"ui_group\")\n        groups.push(item);\n}\n\ntabs.sort((a,b)=>{\n    return (!a.order || a.order<b.order) ? -1 : 1\n});\ngroups.sort((a, b) => {\n    if(a.tab == b.tab)\n        return (!a.order || a.order < b.order) ? -1 : 1;\n    else\n        return (!a.tab < b.tab) ? -1 : 1;\n})\n\n\n    //costruisce il nameId che dashboard si aspetta a partire dall'attuale nome del gruppo/tab\nconst commonGetter = function (obj) {\n    if (!obj.currentNameIdBkp){\n        Math.random()>0.8 || node.warn({getterObjIs:obj});\n        obj.currentNameIdBkp = obj.currentName.trim().replaceAll(/\\s/g, '_');\n    }\n    return obj.currentNameIdBkp\n}\nconst dict/*ionary*/ = [\n    {\n        nameId: \"statoPresse\", id: \"533e203349de7f15\", currentName: \"StatoPresse\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter, groups: [\n            { nameId: \"pressa1\", id: \"de425a720011e6e9\", currentName: \"Pressa 1\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"pressa2\", id: \"f139ce507b5170da\", currentName: \"Pressa 2\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"pressa3\", id: \"c7137b451efabbac\", currentName: \"Pressa 3\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"pressa4\", id: \"13ed847e2817179c\", currentName: \"Pressa 4\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"tmpTools\", id: \"dc04b0c0c2689120\", currentName: \"tmpTools\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n        ]\n    },\n    {\n        nameId: \"graficiDiStato\", id: \"2d4a37310a5ce249\", currentName: \"Grafici di Stato\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter, groups: [\n            { nameId: \"pressa1\", id: \"57ea1d8425ab2254\", currentName: \"Pressa 1\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"group2\", id: \"4d2175afadb4dc79\", currentName: \"Group 2\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n        ]\n    },\n    {\n        nameId: \"gestioneOrdini\", id: \"836adb2b4d67f4ce\", currentName: \"Gestione Ordini\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter, groups: [\n            { nameId: \"queueTable\", id: \"77dcdddb4f97461c\", currentName: \"queueTable\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"historyTable\", id: \"b3c076eedf1fd2f8\", currentName: \"historyTable\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"toolBar\", id: \"ee2c7bc51cebda0e\", currentName: \"ToolBar\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"exampleTable\", id: \"6de891276c04fcd6\", currentName: \"exampleTable\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"completedTable\", id: \"b7f5c766a413446a\", currentName: \"completedTable\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n        ]\n    },\n    {\n        nameId: \"impostazioni\", id: \"a5b84c011240052c\", currentName: \"Impostazioni\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter, groups: [\n            { nameId: \"indicatoreDiTemperaturaPianoInferiore\", id: \"db63de8125d253b0\", currentName: \"Indicatore di temperatura piano inferiore\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"indicatoreDiTemperaturaPianoSuperiore\", id: \"a2dc8e5cbc92778b\", currentName: \"Indicatore di Temperatura Piano Superiore\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"indicatorePressioneDiPressata\", id: \"d6dcf6dea0234745\", currentName: \"indicatore pressione di pressata\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n        ]\n    }\n];\n\n    //update dictionary names with current ones\nfor(let dictTab of dict){\n        //retrieve tabs names\n    for (let treeTab of tabs){\n        if(treeTab.id==dictTab.id){\n            dictTab.currentName=treeTab.name;\n            break;\n        }\n    }\n    if(!dictTab.currentName)\n        node.warn(\"id \"+dictTab.id+\" of tab \".dictTab.nId+\" not found\");\n    \n        //retrieve groups names\n    for(let dictGroup of dictTab.groups){\n        for (let treeGroup of groups) {\n            if (treeGroup.id == dictGroup.id) {\n                dictGroup.currentName = treeGroup.name;\n                break;\n            }\n        }\n        if (!dictGroup.currentName)\n            node.warn(\"id \" + dictGroup.id + \" of group \".dictGroup.nId + \" of \"+dictTab.nId+\" not found\");\n    }\n}\n/*\nlet finDict={}\nfor(let dictTab of dict){\n    if(finDict.hasOwnProperty(dictTab.nId))\n        node.warn(dictTab.nId+\" of \"+dictTab.currentName+\" is used twice\");\n    else\n        finDict[dictTab.nId].dictTab;\n}\n*/\n\n//Object.defineProperty(o, 'b', { get() { return this.a + 1; } });\n\nconst uiAbs={\n    //tabs:tabs,\n    //groups:groups\n    //tree:[],\n    dict:dict,\n\n    realNId(tabNId,groupNId){\n        for (let t of this.dict){\n            if (t.nameId == tabNId){\n                if(groupNId){\n                    for(let g of t.groups){\n                        if(g.nameId == groupNId)\n                            return t.currentNameId+'_'+g.currentNameId;\n                    }\n                    node.error(\"missing group \"+groupNId+\" from dictionary\");\n                    return \"\";\n                }\n                else\n                    return t.currentNameId;\n            }\n        }\n        node.error(\"missing tab \" + tabNId + \" from dictionary\");\n        return \"\";\n        //return dict[t].currentNameId+'_'+dict[t].groups[g].currentNameId;\n    }\n}\n\nglobal.set(\"uiAbs\",uiAbs);\nnode.warn(uiAbs);\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 805,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "f3354f86e5974962",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "g": "4a012d8714c195b5",
        "name": "manual uiAbs",
        "func": "//look in on start",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// @ts-nocheck\n\ncallWhenDef(() => {\n    const utils = global.get(\"utils\");\n    var uiAbs = {\n        dictionary: {\n            //tabs:extrapolated below from this.tree \n            //views:extrapolated below from this.views\n        },\n        tree: {\n            \"settingsPage\": {\n                name: \"Impostazioni belle\", nameId: \"\",\n                isVisible: false, isEnabled: true, groups: {\n                }\n            },\n            \"dbg\": {\n                name: \"dbg\", nameId: \"\",\n                isVisible: false, isEnabled: true, groups: {\n                }\n            },\n            \"unauth\": {\n                name: \"unauth\", nameId: \"\",\n                isVisible: true, isEnabled: true, groups: {\n                }\n            },\n            //[Symbol.iterator]: //over all CURRENT tree.keys\n            find(predicate){ let i=0; for(let tk in this) if(predicate(this[tk], tk, this)) return this[tk]; return undefined; },\n            findKey(predicate){ let i=0; for(let tk in this) if(predicate(this[tk], tk, this)) return tk; return false; },\n            tabNamed(name){ return this.find( tab => tab.name==name ) },\n        },\n        //define dashboard views\n        //enbledTabs or disabledTabs will be defined if missing, as the complementary set relatively to uiAbs.tree keys\n        //behavior if ip is associated with more than one view is uncertain\n        views: {\n            \"user\": { enabledTabs: [\"settingsPage\",\"dbg\"], home: \"settingsPage\", ipList: [\"192.168.52.1\"] },\n            \"unauth\": { enabledTabs: [\"unauth\"], home: \"unauth\", ipList: [] },\n            \"superUser\": { disabledTabs: [], home: \"dbg\", ipList: [\"127.0.0.1\"] },\n            get default() { return this.unauth },\n            //[Symbol.iterator]: //over all dictionary.views.keys except default\n\n            //----- functions aliases  -----\n\n            keyForIp(ip) { //not enumerable\n                for (let vk in this)\n                    if (this[vk].ipList.includes(ip))\n                        return vk;\n                return \"default\";\n            },\n            forIp(ip) { return this[this.keyForIp(ip)]; }, //not enumerable\n\n            setViewForIp(viewOrViewKey, ip) {\n                let newView = (typeof viewOrViewKey == \"string\" ? this.views[viewOrViewKey] : viewOrViewKey);\n\n                for (let view of this.views)\n                    if (view === newView)\n                        view.ipList.includes(ip) || view.ipList.push(ip);\n                    else\n                        utils.removeAllOccurences(view.ipList, ip);\n            },\n        },\n        viewKeyForIp(ip) { return this.views.keyForIp(ip) },\n        getViewForIp(ip) { return this.views[this.viewKeyForIp(ip)]; },\n        setViewForIp(viewOrViewKey, ip) { this.views.setViewForIp(viewOrViewKey, ip); },\n\n        prepareMsg_setUiToView(msg, view, redirectToHomeTab = true) {\n            if(arguments.length != 2)   node.error(new Error(\"uiAbs.prepareMsg_setUiToView(): argument count mismatch\"))\n            let tmp;\n            return Object.assign(msg, {\n                payload: {\n                    //switch to the home tab if the view has one\n                    tab: ((redirectToHomeTab && view.home) ? this.tree[view.home].nameId : undefined),\n                    //enable/disable tabs as per the view specifications\n                    tabs: {\n                        disable: tmp = view.disabledTabs.map( tab => this.tree[tab].nameId ),\n                        hide: tmp,\n                        show: tmp = view.enabledTabs.map( tab => this.tree[tab].nameId ),\n                        enable: tmp\n                    }\n                }\n            })\n        },\n\n\n        uiSessions: [],\n        newUiSession(id, ...args) {\n            //delete same id if present\n            let idx = this.uiSessions.findIndex(sess => sess.id == id)\n            if (id == -1) {\n                this.uiSessions[idx] = this.uiSessions.pop();\n                node.warn(new Error(\"uiAbs.newUiSession() another session with the same id already existed and was replaced\"))\n            }\n            //create new UiSession\n            this.uiSessions.push(new UiSession(id, ...args))\n            return this.uiSessions[this.uiSessions.length - 1];\n        },\n        deleteUiSession(session_or_id) {\n            //find index comparing the id or performing a strict === comparison\n            let idx = this.uiSessions.findIndex((typeof(session_or_id) == \"string\" ? (s => s.id == session_or_id) : (s => s === session_or_id)))\n            if (idx < 0)\n                node.error(new Error(\"uiAbs.removeUiSession() the session does't exist\"))\n            else{\n                let removeIdx = (arr, i) => (i == arr.length-1) ?  arr.pop() : arr[i] = arr.pop();\n                removeIdx(this.uiSessions, idx);\n            }\n        },\n        getUiSession(id) {\n            return this.uiSessions.find(sess => sess.id == id);\n        }\n    }\n\n    //set functions to not-enumerable\n    //must do so BEFORE extrapolating iterators\n    {   let funcToNotEnum = ( obj ) => {\n            for(let key in obj)\n                if(typeof(obj[key]) == \"function\")\n                    Object.defineProperty(obj, key, { \"enumerable\": false, \"configurable\": true })\n        }\n        funcToNotEnum(uiAbs.views);\n        funcToNotEnum(uiAbs.tree);\n    }\n    //build dictionary and iterators\n    //for tree tabs\n    //for views\n    uiAbs.dictionary.tabs = Object.keys(uiAbs.tree);\n    uiAbs.tree[Symbol.iterator] = utils.makeKeyIterator(uiAbs.dictionary.tabs);\n    uiAbs.dictionary.views = Object.keys(uiAbs.views);\n    uiAbs.views[Symbol.iterator] = utils.makeKeyIterator(uiAbs.dictionary.views);\n\n    //complete uiAbs tree\n    //extrapolate nameId for all tabs\n    const toNameId = (name) => name.trim().replaceAll(/\\s/g, '_');\n    for (let t in uiAbs.tree) {\n        let tab = uiAbs.tree[t];\n        tab.nameId = toNameId(tab.name);\n        for (let g in tab.groups) {\n            let group = tab.groups[g];\n            group.nameId = tab.nameId + \"_\" + toNameId(group.name);\n        }\n    }\n\n    //complete uiAbs views\n    //for each view define the missing tab list as the complementary set of the other relatively to uiAbs's tabs.\n    //define disabledTabs as the complementary set of enabledTabs in uiAbs's tabs\n    //or define enabledTabs as the complementary set of disabledTabs in uiAbs's tabs\n    for (let view of uiAbs.views) {\n        let [missingPropName, presentPropName] = (view.enabledTabs ? [\"disabledTabs\", \"enabledTabs\"] : [\"enabledTabs\", \"disabledTabs\"])\n        if (!view[missingPropName]) { //makes sure it is indeed missing //needed because default is a reference to another view.\n            //adds an enumerable missingPropName get/set and a writable, not enumerable missingPropName+_cache\n            utils.defineCachedProp(view, missingPropName,\n                thisArg => (uiAbs.dictionary.tabs).filter(v => !thisArg[presentPropName].includes(v))\n            )\n        }\n    }\n\n    //look for typos in views\n        //no multiples of the same ip across views\n        //view.home is falsy or a tab (this.tree key)\n        let allIp = [];\n        for(let view of uiAbs.views)\n            allIp.push(...view.ipList);\n        //allIp.sort((a,b) => a<b ? -1 : 1 );\n        for(let i=0;i<allIp.length;i++){\n            for(let j=i+1;j<allIp.length;j++)\n                if(allIp[i] == allIp[j])\n                    node.warn(new Error(`uiAbs() SyntaxError: the ip ${allIp[i]} is associated to more than one dashboard view.`))\n        }\n        //allIp.every( (ip,i) => allIp.slice(i).every( seqIp => ip != seqIp ))\n        \n        //view.home is falsy or a tab (this.tree key)\n        for(let view of uiAbs.views)\n            if(!uiAbs.tree[view.home])\n                node.error(new SyntaxError(`uiAbs() SyntaxError: the home for the view ${vk} is not a tab. home: ${view.home} AbstractTabs: ${uiAbs.dictionary.tabs}`));\n\n    //check tree's syntax\n        //all\n\n\n    class UiSession {\n        //always present\n        id; //any\n        socketId;\n        clientIp;\n        created;    //number //unixTime\n        //undefined untill a view is explicitly set, or inited through constructor\n        currentView;    //string\n        currentViewKey; //string\n        //undefined until used by expiration-related methods\n        lastActive;     //number\n        expirationTout; //tout id\n\n        constructor(id, {clientIp, socketId}, { view = null, viewKey = null, ip=arguments[1].clientIp }, expireAfterMsFromNow = \"never\") {\n            if (arguments.length < 1 || arguments.length > 4) throw new SyntaxError(\"new UiSession() arguments count mismatch! (\" + arguments.length + \")\")\n            this.id = id;\n            this.clientIp = clientIp;\n            this.socketId = socketId;\n            this.created = Date.now();\n            this.initTree();\n            \n            //'optionaly' set this.currentView and currentViewKey\n            if (view || viewKey || clientIp) {\n                //extrapolate view and viewKey from 2nd argument\n                //at least (and at most) one must be defined //nothing breaks otherwise, but you might forget to enforce a view\n                //precedence as source is view -> viewKey -> ip\n                let uiAbs = global.get(\"uiAbs\");\n                this.currentView = view || (viewKey ? uiAbs.views[viewKey] : uiAbs.views.forIp(ip))\n                this.currentViewKey = viewKey || (ip ? uiAbs.views.keyForIp(ip) : (() => { //parse uiAbs.views looking for ===\n                    for (let vk in uiAbs.views)\n                        if (uiAbs.views[vk] === view)\n                            return vk;\n                    node.error(new Error(\"new UiSession() no uiAbs.views[v] === view\"));\n                })())\n            }\n            else {\n                this.setDefaultState();\n                node.warn(\"UiSession() created a UiSession without a view\");\n            }\n            //'optional' like setting a view\n            //if the server is never closed and you use the socketId as id the connections will pile up\n            if (typeof expireAfterMsFromNow != \"string\")\n                this.setExpiration(expireAfterMsFromNow);\n\n        }\n\n        initTree() {\n            let utils = global.get(\"utils\");\n            let uiAbs = global.get(\"uiAbs\");\n\n            this.tree = utils.mergeRec({}, uiAbs.tree);\n            this.tree[Symbol.iterator] = uiAbs.tree[Symbol.iterator];\n        }\n\n        setDefaultState() {\n            let utils = global.get(\"utils\");\n            let uiAbs = global.get(\"uiAbs\");\n\n            for (let tab of uiAbs.tree) {\n                this.tree.isVisible = tab.isVisible;\n                this.tree.isEnabled = tab.isEnabled;\n            }\n        }\n\n        refreshExpiration() {\n            this.lastActive = Date.now();\n        }\n\n        setExpiration(msFromNow) {\n            this.expirationTout = setTimeout(() => {\n                let diff = (this.lastActive + msFromNow) - Date.now();\n                if (diff > 0)   //set a new timeout to cover the remaining time\n                    this.setExpiration(diff);\n                else    //remove this session from uiAbs\n                    global.get(\"uiAbs\").deleteUiSession(this);\n                node.warn({txt:\"expired\",del:msFromNow,t: this, lA: this.lastActive, lAstr:new Date().toTimeString(),diff:diff })\n            }, msFromNow)\n            this.lastActive = Date.now();\n            //node.warn({txt:\"expiration set\",del:msFromNow, t: this, lA: this.lastActive, lAstr: new Date().toTimeString() })\n        }\n\n\n    }\n\n\n\n    global.set(\"uiAbs\", uiAbs);\n    node.status({ fill: \"green\", text: Object.keys(uiAbs).join(' & ') });\n    return uiAbs;\n}, \"utils\");\n\n//########################################################################\n\n// const commonGetter = function (obj) {\n//     if (!obj.currentNameIdBkp)\n//         obj.currentNameIdBkp = obj.currentName.trim().replaceAll(/\\s/g, '_');\n//     return obj.currentNameIdBkp\n// }\n\n// //a gOod example -> aGOodExample\n// function toCamelCase(str) {\n//     return str.replace(/^(.)/, (m, chr) => chr.toLowerCase()).replace(/[^a-zA-Z0-9]+(.)/g, (m, chr) => chr.toUpperCase()).replace(/\\s+/g, '');\n// }\n\n/** @summary repeatedly tries to fetch all globalNames with global.get(). \n        * @param {function} cb called once ALL globalName are defined\n        * @param {Object} opts object holding optional function params. can be omitted passing the first globalName instead.\n        * @param {number} opts.timeout ms delay after which stop trying and either call opts.errorCb() or log an error. defaults to 15000\n        * @param {number} opts.retryDelay ms between each attempt. defaults to 100\n        * @param {function} opts.errorCb function to call after timeout. defaults to falsy, logging a warning\n        * @param  {...any} globalNames series of strings\n        */\nfunction callWhenDef(cb, opts, ...globalNames) {\n    if (typeof (opts) == \"string\")\n        globalNames.push(opts);\n    let { timeout: timeout = 3000, retryDelay: retryDelay = 100, errorCb: errorCb = null } = (typeof (opts) == \"string\" ? opts : {});\n    var tout, intv;\n    //set timeout unless false or not specified\n    if (timeout) {\n        tout = setTimeout(() => {\n            clearInterval(intv);\n            errorCb ? errorCb() : node.warn({ err: \"callWhenDef_Timeout\", arg: arguments })\n        }, timeout);\n    }\n    //set global-chacking interval\n    intv = setInterval(() => {\n        for (let name of globalNames)\n            if (global.get(name) === undefined || global.get(name) === null)\n                return\n        clearTimeout(tout);\n        clearInterval(intv);\n        cb();\n    }, retryDelay)\n}",
        "finalize": "",
        "libs": [
            {
                "var": "dateFns",
                "module": "date-fns"
            }
        ],
        "x": 265,
        "y": 120,
        "wires": [
            [
                "2d2258b768d5a037"
            ]
        ]
    },
    {
        "id": "2d2258b768d5a037",
        "type": "link out",
        "z": "520bb4ac551bd04e",
        "d": true,
        "g": "4a012d8714c195b5",
        "name": "on uiAbs isDefinedEvent",
        "mode": "link",
        "links": [],
        "x": 520,
        "y": 120,
        "wires": [],
        "l": true
    },
    {
        "id": "fe5e0d82ffdf8e58",
        "type": "ui_ui_control",
        "z": "520bb4ac551bd04e",
        "g": "8524118b94fccc6e",
        "name": "",
        "events": "all",
        "x": 480,
        "y": 330,
        "wires": [
            [
                "5aaa2dbcd2f24179",
                "1f3055ef91b8a652"
            ]
        ]
    },
    {
        "id": "5b77be932011ed23",
        "type": "link in",
        "z": "520bb4ac551bd04e",
        "g": "8524118b94fccc6e",
        "name": "uiControl in",
        "links": [
            "6325de802baa5590",
            "3b4ec22d448988f1",
            "940bc3f210721740",
            "d9297083114d9385",
            "136341cf57feed33",
            "bebcfbb59d1aeebd",
            "76e4d89cdd2354ad",
            "98b496bcef4f63f1",
            "11460a48fab974a6"
        ],
        "x": 325,
        "y": 330,
        "wires": [
            [
                "fe5e0d82ffdf8e58"
            ]
        ],
        "l": true
    },
    {
        "id": "71d5f34651b7c5eb",
        "type": "link out",
        "z": "520bb4ac551bd04e",
        "g": "8524118b94fccc6e",
        "name": "onConnect",
        "mode": "link",
        "links": [
            "8f9d1ffce061a6c7",
            "e707dc39e54df22b",
            "ecf107bcb4f16434",
            "012f89b3faea67c6"
        ],
        "x": 830,
        "y": 255,
        "wires": [],
        "l": true
    },
    {
        "id": "5721a9c783e591cb",
        "type": "link out",
        "z": "520bb4ac551bd04e",
        "g": "8524118b94fccc6e",
        "name": "onLost",
        "mode": "link",
        "links": [
            "8467d9fc419beace"
        ],
        "x": 810,
        "y": 300,
        "wires": [],
        "l": true
    },
    {
        "id": "645df9d428b62902",
        "type": "link out",
        "z": "520bb4ac551bd04e",
        "g": "8524118b94fccc6e",
        "name": "uiControl onChange",
        "mode": "link",
        "links": [
            "4b559763e70b7ce3",
            "9f93f206d5b32a27",
            "8e8abcae2367a41c",
            "550731d80a75539f"
        ],
        "x": 860,
        "y": 345,
        "wires": [],
        "l": true
    },
    {
        "id": "7a80dc2a3270a4cf",
        "type": "link out",
        "z": "520bb4ac551bd04e",
        "g": "8524118b94fccc6e",
        "name": "uiControl onGroup",
        "mode": "link",
        "links": [
            "6cf3234f0cbe8f74"
        ],
        "x": 850,
        "y": 390,
        "wires": [],
        "l": true
    },
    {
        "id": "5aaa2dbcd2f24179",
        "type": "switch",
        "z": "520bb4ac551bd04e",
        "g": "8524118b94fccc6e",
        "name": "payload",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "connect",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "lost",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "change",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "group",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 5,
        "x": 635,
        "y": 330,
        "wires": [
            [
                "71d5f34651b7c5eb"
            ],
            [
                "5721a9c783e591cb"
            ],
            [
                "645df9d428b62902"
            ],
            [
                "7a80dc2a3270a4cf"
            ],
            [
                "45ca194a4ccc5aad"
            ]
        ]
    },
    {
        "id": "45ca194a4ccc5aad",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "g": "8524118b94fccc6e",
        "name": "default: warn",
        "func": "node.warn({txt:\"unknown uiControl payload\",ip:msg.socketip,fullMsg:msg});\n\nglobal.get(\"utils\").errorBlink(node,60000,msg.payload);\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 435,
        "wires": [
            []
        ]
    },
    {
        "id": "8f9d1ffce061a6c7",
        "type": "link in",
        "z": "520bb4ac551bd04e",
        "d": true,
        "g": "8524118b94fccc6e",
        "name": "uiControl onConnect",
        "links": [
            "71d5f34651b7c5eb"
        ],
        "x": 1095,
        "y": 255,
        "wires": [
            []
        ],
        "l": true
    },
    {
        "id": "8467d9fc419beace",
        "type": "link in",
        "z": "520bb4ac551bd04e",
        "d": true,
        "g": "8524118b94fccc6e",
        "name": "uiControl onLost",
        "links": [
            "5721a9c783e591cb"
        ],
        "x": 1085,
        "y": 300,
        "wires": [
            []
        ],
        "l": true
    },
    {
        "id": "4b559763e70b7ce3",
        "type": "link in",
        "z": "520bb4ac551bd04e",
        "d": true,
        "g": "8524118b94fccc6e",
        "name": "uiControl onChange",
        "links": [
            "645df9d428b62902"
        ],
        "x": 1095,
        "y": 345,
        "wires": [
            []
        ],
        "l": true
    },
    {
        "id": "6cf3234f0cbe8f74",
        "type": "link in",
        "z": "520bb4ac551bd04e",
        "d": true,
        "g": "8524118b94fccc6e",
        "name": "uiControl onGroup",
        "links": [
            "7a80dc2a3270a4cf"
        ],
        "x": 1095,
        "y": 390,
        "wires": [
            []
        ],
        "l": true
    },
    {
        "id": "6325de802baa5590",
        "type": "link out",
        "z": "520bb4ac551bd04e",
        "d": true,
        "g": "8524118b94fccc6e",
        "name": "uiControl input",
        "mode": "link",
        "links": [
            "5b77be932011ed23"
        ],
        "x": 260,
        "y": 300,
        "wires": [],
        "l": true
    },
    {
        "id": "0199eec1de4ea718",
        "type": "comment",
        "z": "520bb4ac551bd04e",
        "g": "8524118b94fccc6e",
        "name": "UI CONTROL I/O",
        "info": "",
        "x": 260,
        "y": 255,
        "wires": []
    },
    {
        "id": "ecf107bcb4f16434",
        "type": "link in",
        "z": "520bb4ac551bd04e",
        "g": "2548f65a8c8c4380",
        "name": "uiControl onConnect",
        "links": [
            "71d5f34651b7c5eb"
        ],
        "x": 285,
        "y": 600,
        "wires": [
            [
                "be226db0e7901b38"
            ]
        ],
        "l": true
    },
    {
        "id": "8e8abcae2367a41c",
        "type": "link in",
        "z": "520bb4ac551bd04e",
        "g": "2548f65a8c8c4380",
        "name": "uiControl onChange",
        "links": [
            "645df9d428b62902"
        ],
        "x": 285,
        "y": 645,
        "wires": [
            [
                "be226db0e7901b38"
            ]
        ],
        "l": true
    },
    {
        "id": "be226db0e7901b38",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "g": "2548f65a8c8c4380",
        "name": "ip to viewKey to uiControlMsg",
        "func": "const uiAbs = global.get(\"uiAbs\");\n\n//delay operation until uiAbs is defined\n    //it will send a copy of the original message on the 2nd channel, which loops back to this node\n    //default retryDelay is 100ms\nif(!uiAbs){\n    callWhenDef( () => node.send([null, msg]) , {timeout:15000}, \"uiAbs\");\n    return null\n}\nlet session;\n//if session for this socketid already exist\n    //-> postpone expiration, make sure that the tab is allowed\n    //else create one\nif(session = uiAbs.getUiSession(msg.socketid)){\n    session.refreshExpiration();\n    //check if the tab is forbidden for this session\n        //'if the disabledTabs array includes the tab named msg.name'\n    if(msg.tab && !session.currentView.enabledTabs.includes( uiAbs.tree.findKey( tab => tab.name==msg.name ) ) ){\n        //node.warn(`uiControl node: the page ${msg.tab} is forbidden for the current session, as it enforces the view '${session.currentViewKey}'`);\n        //send a msg to UIControl node to re-enforce the view\n        // uiAbs.prepareMsg_setUiToView(msg, session.currentView);\n        msg.dashboardViewKey = session.currentViewKey; //just for dbg\n        return msg;\n    }\n    else\n        return null;\n}\nelse{\n    //create a new session, with the view set to the one \n    //node.warn({txt:\"view for the ip\",ip:msg.socketip, v:uiAbs.views.keyForIp(msg.socketip)})\n    let newSess = uiAbs.newUiSession(msg.socketid, { clientIp: msg.socketip, socketId:msg.socketid },{ip:msg.socketip}, 2 * 3600 * 1000)\n    \n    //send a msg to UIControl node to apply the view\n    uiAbs.prepareMsg_setUiToView(msg, newSess.currentView);\n    msg.dashboardViewKey = newSess.currentViewKey; //just for dbg\n    return msg;\n}\n\n\n//------------------------------------------------------------------------------------------\n\nfunction callWhenDef(cb, opts, ...globalNames) {\n    if (typeof (opts) == \"string\")\n        globalNames.push(opts);\n    let { timeout: timeout = 3000, retryDelay: retryDelay = 100, errorCb: errorCb = null } = (typeof (opts) == \"string\" ? opts : {});\n    var tout, intv;\n    //set timeout unless false or not specified\n    if (timeout) {\n        tout = setTimeout(() => {\n            clearInterval(intv);\n            errorCb ? errorCb() : node.warn({ err: \"callWhenDef_Timeout\", arg: arguments })\n        }, timeout);\n    }\n    //set global-chacking interval\n    intv = setInterval(() => {\n        for (let name of globalNames)\n            if (global.get(name) === undefined || global.get(name) === null)\n                return\n        clearTimeout(tout);\n        clearInterval(intv);\n        cb();\n    }, retryDelay)\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 630,
        "wires": [
            [
                "940bc3f210721740",
                "13641a24d2ff950e"
            ],
            [
                "5b597e5028501ec6"
            ]
        ],
        "outputLabels": [
            "",
            "loopback"
        ]
    },
    {
        "id": "785397b9bb7857ab",
        "type": "comment",
        "z": "520bb4ac551bd04e",
        "g": "2548f65a8c8c4380",
        "name": "ENABLE/DISABLE TABS BASED ON IP",
        "info": "",
        "x": 355,
        "y": 555,
        "wires": []
    },
    {
        "id": "940bc3f210721740",
        "type": "link out",
        "z": "520bb4ac551bd04e",
        "g": "2548f65a8c8c4380",
        "name": "uiControl input",
        "mode": "link",
        "links": [
            "5b77be932011ed23"
        ],
        "x": 830,
        "y": 630,
        "wires": [],
        "l": true
    },
    {
        "id": "13641a24d2ff950e",
        "type": "debug",
        "z": "520bb4ac551bd04e",
        "g": "2548f65a8c8c4380",
        "name": "SET DASHBOARD VIEW",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "\"for \"&socketip&\" used \"&dashboardViewKey",
        "statusType": "jsonata",
        "x": 865,
        "y": 585,
        "wires": []
    },
    {
        "id": "1f3055ef91b8a652",
        "type": "debug",
        "z": "520bb4ac551bd04e",
        "g": "8524118b94fccc6e",
        "name": "UI CONTROL",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "payload",
        "statusType": "msg",
        "x": 635,
        "y": 255,
        "wires": []
    },
    {
        "id": "8f152f42ef80e8b4",
        "type": "ui_text",
        "z": "520bb4ac551bd04e",
        "g": "c7616b5427bae67d",
        "group": "2977648413bef241",
        "order": 2,
        "width": 6,
        "height": 19,
        "name": "uiSessions",
        "label": "uiSessions",
        "format": "<pre>{{msg.payload}}</pre>",
        "layout": "col-center",
        "className": "",
        "x": 1955,
        "y": 390,
        "wires": []
    },
    {
        "id": "26625a61145b40b8",
        "type": "inject",
        "z": "520bb4ac551bd04e",
        "g": "c7616b5427bae67d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1565,
        "y": 270,
        "wires": [
            [
                "ecaa8e3dcd816b3f"
            ]
        ]
    },
    {
        "id": "87510c9be7e5dd07",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "g": "c7616b5427bae67d",
        "name": "format",
        "func": "\nconst uiAbs = global.get(\"uiAbs\");\n\n// var macs = {}\n// for(let mk of tow.dictionary.macKeys){\n//     macs[mk] = tow[mk];\n// }\n\nconst minifySess = (sess) => {\n    return {\n        id:sess.id,\n        ip:sess.clientIp,\n        viewKey:sess.currentViewKey,\n        since_created: msToScaledString(Date.now() - sess.created),\n        pastCreation: msToScaledString(sess.lastActive - sess.created),\n        since_lastActive: msToScaledString(Date.now() - sess.lastActive)\n    };\n}\n\n//msg.payload = global.get(\"utils\").safeStringify(uiAbs.views).replaceAll('},', '}\\n<br>,')\nmsg.payload = syntaxHighlight(uiAbs.uiSessions.map( sess => minifySess(sess) ))\n//msg.payload = msg.payload.replaceAll('{\"', '{<br>\\n\"');\n\nreturn msg;\n\n// return formatted HTML version of JSON object\nfunction syntaxHighlight(json) {\n    json = global.get(\"utils\").safeStringify(json, 2)\n    json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')\n    json = json.replace(/(\"(\\\\u[a-zA-Z0-9]{4}|\\\\[^u]|[^\\\\\"])*\"(\\s*:)?|\\b(true|false|null)\\b|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?)/g, function (match) {\n        var cls = 'number'\n        if ((/^\"/).test(match)) {\n            if ((/:$/).test(match)) {\n                cls = 'key'\n            } else {\n                cls = 'string'\n            }\n        } else if ((/true|false/).test(match)) {\n            cls = 'boolean'\n        } else if ((/null/).test(match)) {\n            cls = 'null'\n        }\n        return '<span class=\"' + cls + '\">' + match + '</span>'\n    })\n    return json\n}\n\n/**   scales ms down to a more confortable unit returns it as a string with said unit as suffix. \n    *    int -> scaledFloat+'unit'     ex. '2.1h', '3.2gg', '26.3s' etc\n    */\n   function msToScaledString(ms){\n      let units = [\"ms\",\"s\",\"min\",\"h\",\"gg\"];\n      let treshHoldMult = new Array(units.length).fill(2); //in terms of the associated unit // 1 hour == 3600ms -> if treshholdMult==2 then threshHold==3600*2\n      let unitFactors=[1,1000,60,60,24]; //in terms of the preceding unit //ex. min are 1*1000*60\n      //let getUnitFactor = (idx) => { var ret=0; for(let i=0;i<idx;i++) ret*=factor[i]; return ret; }\n      \n      var unitFactor = unitFactors[0];\n      for(let i=1; i<units.length; i++){\n         let lastUF = unitFactor;\n         unitFactor *= unitFactors[i];\n         if(ms < unitFactor * treshHoldMult[i] || i==units.length-1)\n            return (ms/lastUF).toFixed(1) + units[i-1];\n      }\n      return \"shouldNeverGetHere\";\n   }",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1795,
        "y": 390,
        "wires": [
            [
                "8f152f42ef80e8b4"
            ]
        ]
    },
    {
        "id": "ecaa8e3dcd816b3f",
        "type": "switch",
        "z": "520bb4ac551bd04e",
        "g": "c7616b5427bae67d",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1700,
        "y": 375,
        "wires": [
            [
                "87510c9be7e5dd07",
                "3990e756b202cfc7"
            ]
        ],
        "l": false
    },
    {
        "id": "b929fa404b98a047",
        "type": "comment",
        "z": "520bb4ac551bd04e",
        "g": "64d721ee62196532",
        "name": "#dbg toggle",
        "info": "",
        "x": 1485,
        "y": 330,
        "wires": []
    },
    {
        "id": "5c6623b95c8dc130",
        "type": "inject",
        "z": "520bb4ac551bd04e",
        "g": "64d721ee62196532",
        "name": "toggle",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "control",
        "payload": "toggle",
        "payloadType": "str",
        "x": 1505,
        "y": 360,
        "wires": [
            [
                "662ca3515b0917ae"
            ]
        ]
    },
    {
        "id": "662ca3515b0917ae",
        "type": "gate",
        "z": "520bb4ac551bd04e",
        "g": "64d721ee62196532",
        "name": "",
        "controlTopic": "control",
        "defaultState": "open",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 1595,
        "y": 390,
        "wires": [
            [
                "ecaa8e3dcd816b3f"
            ]
        ],
        "l": false
    },
    {
        "id": "be385d1a42c1bcc6",
        "type": "inject",
        "z": "520bb4ac551bd04e",
        "g": "64d721ee62196532",
        "name": "poll 1s",
        "props": [],
        "repeat": "1",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "x": 1495,
        "y": 390,
        "wires": [
            [
                "662ca3515b0917ae"
            ]
        ]
    },
    {
        "id": "9ae691f66676141f",
        "type": "comment",
        "z": "520bb4ac551bd04e",
        "g": "c7616b5427bae67d",
        "name": "dbg_uiAbs",
        "info": "",
        "x": 1475,
        "y": 225,
        "wires": []
    },
    {
        "id": "cbe4ebb5a8cce38a",
        "type": "ui_text",
        "z": "520bb4ac551bd04e",
        "g": "c7616b5427bae67d",
        "group": "2977648413bef241",
        "order": 1,
        "width": 5,
        "height": 19,
        "name": "uiAbs.views",
        "label": "views",
        "format": "<pre>{{msg.payload}}</pre>",
        "layout": "col-center",
        "className": "",
        "x": 1950,
        "y": 345,
        "wires": []
    },
    {
        "id": "3990e756b202cfc7",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "g": "c7616b5427bae67d",
        "name": "format",
        "func": "\nconst uiAbs = global.get(\"uiAbs\");\n\n// var macs = {}\n// for(let mk of tow.dictionary.macKeys){\n//     macs[mk] = tow[mk];\n// }\n\n//msg.payload = global.get(\"utils\").safeStringify(uiAbs.views).replaceAll('},', '}\\n<br>,')\nmsg.payload = syntaxHighlight(uiAbs.views)\n//msg.payload = msg.payload.replaceAll('{\"', '{<br>\\n\"');\n\nreturn msg;\n\n// return formatted HTML version of JSON object\nfunction syntaxHighlight(json) {\n    json = global.get(\"utils\").safeStringify(json, 3)\n    json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')\n    json = json.replace(/(\"(\\\\u[a-zA-Z0-9]{4}|\\\\[^u]|[^\\\\\"])*\"(\\s*:)?|\\b(true|false|null)\\b|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?)/g, function (match) {\n        var cls = 'number'\n        if ((/^\"/).test(match)) {\n            if ((/:$/).test(match)) {\n                cls = 'key'\n            } else {\n                cls = 'string'\n            }\n        } else if ((/true|false/).test(match)) {\n            cls = 'boolean'\n        } else if ((/null/).test(match)) {\n            cls = 'null'\n        }\n        return '<span class=\"' + cls + '\">' + match + '</span>'\n    })\n    return json\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1805,
        "y": 345,
        "wires": [
            [
                "cbe4ebb5a8cce38a"
            ]
        ]
    },
    {
        "id": "e012d8f374dea000",
        "type": "ui_template",
        "z": "520bb4ac551bd04e",
        "g": "c7616b5427bae67d",
        "group": "",
        "name": "common dbg styles",
        "order": 6,
        "width": 0,
        "height": 0,
        "format": "<style>\n    pre {\n        white-space:pre-wrap;\n        font-size:110%;\n    }\n    pre .number{\n        color:gray;\n    }\n    pre .string{\n        color:darkred;\n    }\n    pre .key{\n        color:purple;\n    }\n    pre .bolean{\n        color:yellow;\n    }\n</style>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "global",
        "className": "",
        "x": 1720,
        "y": 225,
        "wires": [
            []
        ]
    },
    {
        "id": "b1b26324a134cc2d",
        "type": "link in",
        "z": "520bb4ac551bd04e",
        "g": "64d721ee62196532",
        "name": "all dbgGates",
        "links": [
            "0156636ac6d0af9f"
        ],
        "x": 1485,
        "y": 420,
        "wires": [
            [
                "662ca3515b0917ae"
            ]
        ],
        "l": true
    },
    {
        "id": "0df67feb574967df",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "g": "2bf8d431d6727776",
        "name": "superUser",
        "func": "let uiAbs = global.get(\"uiAbs\");\nuiAbs.prepareMsg_setUiToView(msg, uiAbs.views[\"superUser\"]);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2515,
        "y": 360,
        "wires": [
            [
                "49dde63fc06e1a4b"
            ]
        ]
    },
    {
        "id": "96f487a9ab18cd70",
        "type": "inject",
        "z": "520bb4ac551bd04e",
        "g": "2bf8d431d6727776",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2340,
        "y": 360,
        "wires": [
            [
                "0df67feb574967df"
            ]
        ]
    },
    {
        "id": "2006eef56d24502d",
        "type": "debug",
        "z": "520bb4ac551bd04e",
        "g": "2bf8d431d6727776",
        "name": "SET DASHBOARD VIEW",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "\"for \"&socketip&\" used \"&dashboardViewKey",
        "statusType": "jsonata",
        "x": 2860,
        "y": 345,
        "wires": []
    },
    {
        "id": "627eefb16b1624c6",
        "type": "inject",
        "z": "520bb4ac551bd04e",
        "g": "2bf8d431d6727776",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2325,
        "y": 330,
        "wires": [
            [
                "2488dfa47387ae95"
            ]
        ]
    },
    {
        "id": "2488dfa47387ae95",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "g": "2bf8d431d6727776",
        "name": "user",
        "func": "let uiAbs = global.get(\"uiAbs\");\nuiAbs.prepareMsg_setUiToView(msg, uiAbs.views[\"user\"]);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2470,
        "y": 330,
        "wires": [
            [
                "49dde63fc06e1a4b"
            ]
        ]
    },
    {
        "id": "fc9805174409a339",
        "type": "inject",
        "z": "520bb4ac551bd04e",
        "g": "2bf8d431d6727776",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2325,
        "y": 300,
        "wires": [
            [
                "805909fc9060a1ab"
            ]
        ]
    },
    {
        "id": "805909fc9060a1ab",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "g": "2bf8d431d6727776",
        "name": "unauth",
        "func": "let uiAbs = global.get(\"uiAbs\");\nuiAbs.prepareMsg_setUiToView(msg, uiAbs.views[\"unauth\"]);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2470,
        "y": 300,
        "wires": [
            [
                "49dde63fc06e1a4b"
            ]
        ]
    },
    {
        "id": "98b496bcef4f63f1",
        "type": "link out",
        "z": "520bb4ac551bd04e",
        "g": "2bf8d431d6727776",
        "name": "uiControl input",
        "mode": "link",
        "links": [
            "5b77be932011ed23"
        ],
        "x": 2825,
        "y": 315,
        "wires": [],
        "l": true
    },
    {
        "id": "49dde63fc06e1a4b",
        "type": "switch",
        "z": "520bb4ac551bd04e",
        "g": "2bf8d431d6727776",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 2685,
        "y": 330,
        "wires": [
            [
                "2006eef56d24502d",
                "98b496bcef4f63f1"
            ]
        ],
        "l": false
    },
    {
        "id": "64deca04685863c4",
        "type": "comment",
        "z": "520bb4ac551bd04e",
        "g": "2bf8d431d6727776",
        "name": "send view to uicontrol dashboard",
        "info": "",
        "x": 2395,
        "y": 255,
        "wires": []
    },
    {
        "id": "3f10cbfdf20a1794",
        "type": "inject",
        "z": "520bb4ac551bd04e",
        "g": "7ee8fe5bcbda8762",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2330,
        "y": 510,
        "wires": [
            [
                "e0358db3d825c603"
            ]
        ]
    },
    {
        "id": "e0358db3d825c603",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "g": "7ee8fe5bcbda8762",
        "name": "0",
        "func": "msg.payload = 0;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2470,
        "y": 510,
        "wires": [
            [
                "f255e9588901cefe"
            ]
        ]
    },
    {
        "id": "11460a48fab974a6",
        "type": "link out",
        "z": "520bb4ac551bd04e",
        "g": "7ee8fe5bcbda8762",
        "name": "uiControl input",
        "mode": "link",
        "links": [
            "5b77be932011ed23"
        ],
        "x": 2745,
        "y": 510,
        "wires": [],
        "l": true
    },
    {
        "id": "2d7c01583d6fa255",
        "type": "debug",
        "z": "520bb4ac551bd04e",
        "g": "7ee8fe5bcbda8762",
        "name": "SET DASHBOARD VIEW",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "\"for \"&socketip&\" used \"&dashboardViewKey",
        "statusType": "jsonata",
        "x": 2820,
        "y": 555,
        "wires": []
    },
    {
        "id": "f255e9588901cefe",
        "type": "switch",
        "z": "520bb4ac551bd04e",
        "g": "7ee8fe5bcbda8762",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 2615,
        "y": 555,
        "wires": [
            [
                "11460a48fab974a6",
                "2d7c01583d6fa255"
            ]
        ],
        "l": false
    },
    {
        "id": "db625e06350958ff",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "g": "7ee8fe5bcbda8762",
        "name": "1",
        "func": "msg.payload = 1;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2470,
        "y": 555,
        "wires": [
            [
                "f255e9588901cefe"
            ]
        ]
    },
    {
        "id": "9471b762753d187e",
        "type": "inject",
        "z": "520bb4ac551bd04e",
        "g": "7ee8fe5bcbda8762",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2330,
        "y": 555,
        "wires": [
            [
                "db625e06350958ff"
            ]
        ]
    },
    {
        "id": "c46761a1734e3b5f",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "g": "7ee8fe5bcbda8762",
        "name": "2",
        "func": "msg.payload = 2;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2480,
        "y": 600,
        "wires": [
            [
                "f255e9588901cefe"
            ]
        ]
    },
    {
        "id": "c938d4304b7bd5b8",
        "type": "inject",
        "z": "520bb4ac551bd04e",
        "g": "7ee8fe5bcbda8762",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2340,
        "y": 600,
        "wires": [
            [
                "c46761a1734e3b5f"
            ]
        ]
    },
    {
        "id": "ba615c1170139b4e",
        "type": "comment",
        "z": "520bb4ac551bd04e",
        "g": "7ee8fe5bcbda8762",
        "name": "switch to tab",
        "info": "",
        "x": 2340,
        "y": 465,
        "wires": []
    },
    {
        "id": "de0c1e967b1fae44",
        "type": "comment",
        "z": "520bb4ac551bd04e",
        "g": "764d2a7a7aa94a50",
        "name": "DASHBOARD MANUAL COMMANDS",
        "info": "",
        "x": 2405,
        "y": 195,
        "wires": []
    },
    {
        "id": "dc253322fa781f08",
        "type": "ui_template",
        "z": "520bb4ac551bd04e",
        "g": "ad0b41692806c8d7",
        "group": "5f2d3184c0c690e6",
        "name": "unauth-overlay",
        "order": 1,
        "width": 0,
        "height": 0,
        "format": "<style>\n    #unauth-overlay{\n        position:absolute;\n        width:100vw;\n        height:100vh;\n        background-color:hsl(0 0% 12.34% / 57%);\n        pointer-events: none;\n        z-index:999;\n    }\n    #unauth-overlay > div{\n        box-sizing:border-box;\n        width:fit-content;\n        padding: 40px;\n        margin:15vh auto;\n        \n        font-size: 20px;\n        border:3px solid red;\n        border-radius:50px;\n        background-color:whitesmoke;\n        color:darkgray;\n    }\n</style>\n\n<script>\n    let el = document.getElementById(\"unauth-overlay\");\n    el ?? document.body.removeChild(el);\n    document.body.appendChild(createFromHtml(`\n        <div id=\"unauth-overlay\">\n            <div>\n                nessuna pagina disponibile da questa postazione\n            </div>\n        </div>\n    `));\n    function createFromHtml(html){\n        var cont = document.createElement(\"div\");\n        cont.innerHTML = html;\n        return cont.children[0];\n    }\n</script>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 260,
        "y": 795,
        "wires": [
            []
        ]
    },
    {
        "id": "c78fc09cddf52fd4",
        "type": "ui_text_input",
        "z": "520bb4ac551bd04e",
        "d": true,
        "name": "",
        "label": "view for ip",
        "tooltip": "",
        "group": "2977648413bef241",
        "order": 4,
        "width": 5,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 1485,
        "y": 540,
        "wires": [
            [
                "49aa9531f4da1578"
            ]
        ]
    },
    {
        "id": "49aa9531f4da1578",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "d": true,
        "name": "format",
        "func": "\nconst uiAbs = global.get(\"uiAbs\");\nlet ip=msg.payload;\nmsg.payload = uiAbs.views.keyForIp(msg.payload);\nnode.warn(\"view for ip \"+ip+\" is \"+msg.payload)",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1645,
        "y": 540,
        "wires": [
            [
                "349d42a6a4aeada2"
            ]
        ]
    },
    {
        "id": "349d42a6a4aeada2",
        "type": "ui_text",
        "z": "520bb4ac551bd04e",
        "d": true,
        "group": "2977648413bef241",
        "order": 3,
        "width": 6,
        "height": 1,
        "name": "",
        "label": "viewKey",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "className": "",
        "x": 1820,
        "y": 540,
        "wires": []
    },
    {
        "id": "b9ae123fd54ad9ac",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "d": true,
        "name": "log view",
        "func": "\nconst uiAbs = global.get(\"uiAbs\");\nlet ip=msg.payload;\nmsg.payload = uiAbs.views.keyForIp(msg.payload);\nnode.warn(\"view for ip \"+ip+\" is \"+msg.payload)",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1610,
        "y": 645,
        "wires": [
            []
        ]
    },
    {
        "id": "3cf56ae36ebcaf5c",
        "type": "inject",
        "z": "520bb4ac551bd04e",
        "d": true,
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1420,
        "y": 645,
        "wires": [
            [
                "b9ae123fd54ad9ac"
            ]
        ]
    },
    {
        "id": "d8f19dc79fd1dc53",
        "type": "inject",
        "z": "520bb4ac551bd04e",
        "g": "7ee8fe5bcbda8762",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2340,
        "y": 645,
        "wires": [
            [
                "1e44c0a3a8a381bb"
            ]
        ]
    },
    {
        "id": "1e44c0a3a8a381bb",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "g": "7ee8fe5bcbda8762",
        "name": "2",
        "func": "msg.payload = \"unauth\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2485,
        "y": 645,
        "wires": [
            [
                "f255e9588901cefe"
            ]
        ]
    },
    {
        "id": "6b0691c7c184f39b",
        "type": "comment",
        "z": "520bb4ac551bd04e",
        "g": "ad0b41692806c8d7",
        "name": "adds a popup to body.",
        "info": "",
        "x": 475,
        "y": 795,
        "wires": []
    },
    {
        "id": "eedaed248ab03314",
        "type": "ui_text_input",
        "z": "520bb4ac551bd04e",
        "name": "",
        "label": "Header",
        "tooltip": "titolo della cella, la dimensione verr adattata alla larghezza della cella",
        "group": "a3ba2e57b1953e7d",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 960,
        "y": 960,
        "wires": [
            []
        ]
    },
    {
        "id": "384827ee05979db3",
        "type": "ui_numeric",
        "z": "520bb4ac551bd04e",
        "d": true,
        "name": "",
        "label": "Timer verso A4",
        "tooltip": "",
        "group": "0824968cb29bbcd0",
        "order": 4,
        "width": 5,
        "height": 1,
        "wrap": false,
        "passthru": true,
        "topic": "topic",
        "topicType": "msg",
        "format": "{{value}}",
        "min": 0,
        "max": 10,
        "step": 1,
        "className": "",
        "x": 595,
        "y": 1050,
        "wires": [
            []
        ]
    },
    {
        "id": "e90ee2d0bf31cae3",
        "type": "ui_numeric",
        "z": "520bb4ac551bd04e",
        "d": true,
        "name": "",
        "label": "Timer verso A3",
        "tooltip": "",
        "group": "0824968cb29bbcd0",
        "order": 2,
        "width": 5,
        "height": 1,
        "wrap": false,
        "passthru": true,
        "topic": "topic",
        "topicType": "msg",
        "format": "{{value}}",
        "min": 0,
        "max": 10,
        "step": 1,
        "className": "",
        "x": 595,
        "y": 1005,
        "wires": [
            []
        ]
    },
    {
        "id": "594ae9d205272677",
        "type": "ui_dropdown",
        "z": "520bb4ac551bd04e",
        "name": "A3 unit",
        "label": "",
        "tooltip": "unit di misura per il timer adiacente.",
        "place": "Seleziona unit di misura",
        "group": "a3ba2e57b1953e7d",
        "order": 3,
        "width": 2,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "s",
                "value": "s",
                "type": "str"
            },
            {
                "label": "min",
                "value": "min",
                "type": "str"
            },
            {
                "label": "ore",
                "value": "h",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 1230,
        "y": 1005,
        "wires": [
            []
        ]
    },
    {
        "id": "3cd2ac1e40fa68d3",
        "type": "ui_dropdown",
        "z": "520bb4ac551bd04e",
        "name": "",
        "label": "stato cella all'avvio",
        "tooltip": "",
        "place": "Select option",
        "group": "a3ba2e57b1953e7d",
        "order": 7,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 945,
        "y": 1095,
        "wires": [
            []
        ]
    },
    {
        "id": "08d1d3a092895d58",
        "type": "ui_colour_picker",
        "z": "520bb4ac551bd04e",
        "name": "",
        "label": "testo",
        "group": "a3ba2e57b1953e7d",
        "format": "hex",
        "outformat": "string",
        "showSwatch": true,
        "showPicker": false,
        "showValue": false,
        "showHue": true,
        "showAlpha": false,
        "showLightness": false,
        "square": "true",
        "dynOutput": "false",
        "order": 9,
        "width": 2,
        "height": 1,
        "passthru": true,
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 920,
        "y": 1140,
        "wires": [
            [
                "3e6b4febe2c78304"
            ]
        ]
    },
    {
        "id": "0495e355300a3000",
        "type": "ui_colour_picker",
        "z": "520bb4ac551bd04e",
        "name": "",
        "label": "sfondo",
        "group": "a3ba2e57b1953e7d",
        "format": "hex",
        "outformat": "object",
        "showSwatch": true,
        "showPicker": false,
        "showValue": false,
        "showHue": true,
        "showAlpha": true,
        "showLightness": true,
        "square": "true",
        "dynOutput": "true",
        "order": 10,
        "width": 2,
        "height": 1,
        "passthru": true,
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 1080,
        "y": 1140,
        "wires": [
            [
                "3e6b4febe2c78304"
            ]
        ]
    },
    {
        "id": "ec8c9f921c9b74a2",
        "type": "ui_template",
        "z": "520bb4ac551bd04e",
        "d": true,
        "group": "0824968cb29bbcd0",
        "name": "stato torri",
        "order": 11,
        "width": 5,
        "height": 3,
        "format": "<form>\n    <fieldset style=\"width:85%\">\n        <legend>stato torre all'avvio </legend>\n        <div ng-repeat=\"x in ['luce rossa','luce verde','sirena']\">\n            <label>{{x}}\n                <input  type=\"checkbox\" style=\"\"\n                        ng-model=\"check\"\n                        ng-change=\"send({name:x, state:check})\">\n            </label>\n        </div>\n    </fieldset>\n</form>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 750,
        "y": 1260,
        "wires": [
            []
        ]
    },
    {
        "id": "178f1efb5dc3f3d0",
        "type": "ui_slider",
        "z": "520bb4ac551bd04e",
        "name": "",
        "label": "periodo",
        "tooltip": "la somma dei tempi di un ciclo di intermittenza.",
        "group": "a3ba2e57b1953e7d",
        "order": 13,
        "width": 4,
        "height": 1,
        "passthru": true,
        "outs": "all",
        "topic": "topic",
        "topicType": "msg",
        "min": "100",
        "max": "5000",
        "step": "100",
        "className": "blinktimes-labeltarget",
        "x": 975,
        "y": 1335,
        "wires": [
            [
                "ca88290979e01855"
            ]
        ]
    },
    {
        "id": "4c85050cb056a1b9",
        "type": "ui_slider",
        "z": "520bb4ac551bd04e",
        "name": "",
        "label": "rapporto",
        "tooltip": "il rapporto fra il tempo che la cella passa con uno sfondo alterato dal lampeggio e il tempo che passa con lo sfondo normale",
        "group": "a3ba2e57b1953e7d",
        "order": 15,
        "width": 4,
        "height": 1,
        "passthru": false,
        "outs": "all",
        "topic": "topic",
        "topicType": "msg",
        "min": "0.05",
        "max": "0.95",
        "step": "0.05",
        "className": "",
        "x": 975,
        "y": 1395,
        "wires": [
            [
                "cedf8847636cc47c"
            ]
        ]
    },
    {
        "id": "62696eb03c3b8773",
        "type": "ui_template",
        "z": "520bb4ac551bd04e",
        "d": true,
        "group": "0824968cb29bbcd0",
        "name": "inject label blinkTimesCfgs",
        "order": 6,
        "width": 0,
        "height": 0,
        "format": "<script id=\"hello\" >\n    let groupClass = \"{{ groupClass }}\" ?? undefined;\n    let groupIndex = {{ msg.groupIndex }} ?? 0;\n    let insertBeforeClass = {{msg.insertBeforeClass}} ?? undefined;\n    let labelClass = \"{{msg.labelClass}}\"\n    let label = {{msg.label}};\n    let extraAttributes = {{msg.extraAttributes}} ?? \"\";\n    \n    //append style to head ONCE\n    window.injectedLabelStyle ?? window.injectedLabelStyle = document.head.inserAdjacentHTML(\"beforeend\",`\n        <style>\n            .injected-label {\n                position:absolute;\n                top:calc(0 - 1em - 3px);\n                width:fit-content;\n            }\n        </style>\n    `)\n\n    const injectLabelElement = target => {\n        //attach class to target\n        target.classList.includes(\"injected-label-target\") || el.classList.add(\"injected-label-target\");\n        //prepend label element to target\n        if(!target.previousElementSibling.classList.includes(labelClass))\n            return target.inserAdjacentHTML(\"beforebegin\",`\n                <div ${extraAttributes} class=\"labelClass injected-label\">${label}</div>\n            `)\n        return target.previousElementSibling;\n    } \n\n    //attach to specific group\n    if( groupClass && insertBeforeClass){\n        //assume group with that class exists\n        let group = document.getElementsByClassName(groupClass)[groupIndex];\n        if(group.getElementsByClassName(labelClass).length > 0){\n            let el = group.getElementsByClassName(insertBeforeClass)[0];\n            injectLabelElement(el);\n        }\n    }\n    //attach to all groups simultaneously\n    elseif(insertBeforeClass){\n        //get all targets\n        let els = document.getElementsByClassName(insertBeforeClass);\n        els.forEach( el => injectLabelElement(el) )\n    }\n    \n</script>\n<!--span style=\"padding-left:20%;margin-bottom:-20px\"> intermittenza </span-->",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 660,
        "y": 1365,
        "wires": [
            []
        ]
    },
    {
        "id": "ca88290979e01855",
        "type": "ui_numeric",
        "z": "520bb4ac551bd04e",
        "name": "val / 1000 toFixed",
        "label": "",
        "tooltip": "",
        "group": "a3ba2e57b1953e7d",
        "order": 14,
        "width": 3,
        "height": 1,
        "wrap": false,
        "passthru": true,
        "topic": "topic",
        "topicType": "msg",
        "format": "{{ (value / 1000).toFixed(1) }} s",
        "min": "100",
        "max": "5000",
        "step": "100",
        "className": "",
        "x": 1230,
        "y": 1335,
        "wires": [
            []
        ]
    },
    {
        "id": "cedf8847636cc47c",
        "type": "ui_numeric",
        "z": "520bb4ac551bd04e",
        "name": "val / 1-val",
        "label": "",
        "tooltip": "",
        "group": "a3ba2e57b1953e7d",
        "order": 16,
        "width": 3,
        "height": 1,
        "wrap": false,
        "passthru": false,
        "topic": "topic",
        "topicType": "msg",
        "format": "{{value.toFixed(1) }}/{{ (1 - value).toFixed(1) }}",
        "min": "0.1",
        "max": "0.9",
        "step": "0.1",
        "className": "",
        "x": 1200,
        "y": 1395,
        "wires": [
            [
                "f0ae4319abc3e158"
            ]
        ]
    },
    {
        "id": "e18b49bdabb3947f",
        "type": "ui_text_input",
        "z": "520bb4ac551bd04e",
        "name": "",
        "label": "Timer verso A3 - avviamento",
        "tooltip": "tempo prima che venga impostato automaticamente lo stato A3 - avviamento",
        "group": "a3ba2e57b1953e7d",
        "order": 4,
        "width": 5,
        "height": 1,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 985,
        "y": 1005,
        "wires": [
            [
                "594ae9d205272677"
            ]
        ]
    },
    {
        "id": "eb82909e2753c865",
        "type": "ui_text_input",
        "z": "520bb4ac551bd04e",
        "name": "",
        "label": "Timer verso A4 - ritardo d'avvio",
        "tooltip": "tempo prima che dallo stato A3 si passi automaticamente allo stato A4 - ritardo d'avvio",
        "group": "a3ba2e57b1953e7d",
        "order": 2,
        "width": 5,
        "height": 1,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 995,
        "y": 1050,
        "wires": [
            [
                "25accaf984af5ca0"
            ]
        ]
    },
    {
        "id": "25accaf984af5ca0",
        "type": "ui_dropdown",
        "z": "520bb4ac551bd04e",
        "name": "A4 unit",
        "label": "",
        "tooltip": "unit di misura per il timer adiacente.",
        "place": "Seleziona unit di misura",
        "group": "a3ba2e57b1953e7d",
        "order": 5,
        "width": 2,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "s",
                "value": "s",
                "type": "str"
            },
            {
                "label": "min",
                "value": "min",
                "type": "str"
            },
            {
                "label": "ore",
                "value": "h",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 1230,
        "y": 1050,
        "wires": [
            []
        ]
    },
    {
        "id": "f0ae4319abc3e158",
        "type": "switch",
        "z": "520bb4ac551bd04e",
        "name": "loopBack",
        "property": "socketip",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 1,
        "x": 1080,
        "y": 1425,
        "wires": [
            [
                "4c85050cb056a1b9",
                "d2f5c4f9374bd29d"
            ]
        ],
        "l": false
    },
    {
        "id": "3e6b4febe2c78304",
        "type": "debug",
        "z": "520bb4ac551bd04e",
        "name": "cellInitState colors",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1305,
        "y": 1155,
        "wires": []
    },
    {
        "id": "3bbe0cc922b04660",
        "type": "ui_multistate_switch",
        "z": "520bb4ac551bd04e",
        "name": "tower lights switch",
        "group": "a3ba2e57b1953e7d",
        "order": 6,
        "width": 0,
        "height": 0,
        "label": "colonna",
        "stateField": "payload",
        "enableField": "enable",
        "passthroughField": "passthrough",
        "inputMsgField": "inputmsg",
        "rounded": false,
        "useThemeColors": false,
        "hideSelectedLabel": false,
        "multilineLabel": true,
        "passThrough": "never",
        "inputMsg": "all",
        "userInput": "enabled_show",
        "options": [
            {
                "label": "spenta",
                "value": "off",
                "valueType": "str",
                "color": "#cccccc"
            },
            {
                "label": "verde",
                "value": "green",
                "valueType": "str",
                "color": "#34a300"
            },
            {
                "label": "rossa",
                "value": "red",
                "valueType": "str",
                "color": "#ff6666"
            },
            {
                "label": "entrambe",
                "value": "both",
                "valueType": "str",
                "color": "#8be2e4"
            }
        ],
        "topic": "",
        "x": 960,
        "y": 1230,
        "wires": [
            []
        ]
    },
    {
        "id": "704fecc427d2e9ec",
        "type": "ui_switch",
        "z": "520bb4ac551bd04e",
        "name": "",
        "label": "greenLight",
        "tooltip": "",
        "group": "0824968cb29bbcd0",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "fa-bug",
        "oncolor": "green",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "lightbulb-slash",
        "offcolor": "gray",
        "animate": true,
        "className": "",
        "x": 975,
        "y": 1185,
        "wires": [
            []
        ]
    },
    {
        "id": "30ee5b1ca72e2ea8",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "name": "initCellState dropdown options",
        "func": "const signalCells = global.get(\"signalCells\");\nlet signalKeys = signalCells.dictionary.signalKeys;\nlet signalNames = signalCells.dictionary.signalNames;\n//result:\n    // custom : custom\n    // A1 : A1 - chiamata\nlet formatName = (sk, name) => sk + global.get(\"utils\").firstCharUp(name);\nmsg.options = [{\"custom\":\"custom\"}].concat( signalKeys.map( (sk,i) => new Object({sk:formatName(sk,signalNames[i])}) ) );\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 555,
        "y": 1095,
        "wires": [
            [
                "7615b18b97d5771c"
            ]
        ]
    },
    {
        "id": "8a7b266f172db654",
        "type": "link in",
        "z": "520bb4ac551bd04e",
        "name": "allMain isDefinedEvent out",
        "links": [
            "230aaa874077cfdc"
        ],
        "x": 295,
        "y": 1095,
        "wires": [
            [
                "30ee5b1ca72e2ea8"
            ]
        ],
        "l": true
    },
    {
        "id": "7615b18b97d5771c",
        "type": "link out",
        "z": "520bb4ac551bd04e",
        "name": "cellInitState dropdown options",
        "mode": "link",
        "links": [
            "840b5bb304ce9d81"
        ],
        "x": 735,
        "y": 1095,
        "wires": []
    },
    {
        "id": "840b5bb304ce9d81",
        "type": "link in",
        "z": "520bb4ac551bd04e",
        "name": "dropdown options",
        "links": [
            "7615b18b97d5771c"
        ],
        "x": 825,
        "y": 1095,
        "wires": [
            [
                "3cd2ac1e40fa68d3"
            ]
        ]
    },
    {
        "id": "b5923145eef76ca4",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "d": true,
        "name": "initCellState dropdown init",
        "func": "const signalCells = global.get(\"signalCells\");\nlet signalKeys = signalCells.dictionary.signalKeys;\nlet signalNames = signalCells.dictionary.signalNames;\n//result:\n    // custom : custom\n    // A1 : A1 - chiamata\nlet formatName = (sk, name) => sk + global.get(\"util\").firstCharUp(name);\nmsg.options = [{\"custom\":\"custom\"}].concat( signalKeys.map( (sk,i) => new Object({sk:formatName(sk,signalNames[i])}) ) );\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 545,
        "y": 1140,
        "wires": [
            []
        ]
    },
    {
        "id": "d2f5c4f9374bd29d",
        "type": "debug",
        "z": "520bb4ac551bd04e",
        "name": "rapporto",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1185,
        "y": 1470,
        "wires": []
    },
    {
        "id": "b24a8b47054377df",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "name": "injectLabel all \"intermittenza\"",
        "func": "\nlet insertBeforeClass = \"blinktimes-labeltarget\";\nlet labelClass = \"blinktimes-label\";\nlet label = \"intermittenza\"\nlet extraAttributes = 'style=\"color:red;\"'\nmsg.labelClass = labelClass;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 355,
        "y": 1365,
        "wires": [
            [
                "62696eb03c3b8773",
                "2207af6d8b5f5262",
                "4f673125b6589d64"
            ]
        ]
    },
    {
        "id": "93355b3ae2d80634",
        "type": "inject",
        "z": "520bb4ac551bd04e",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 195,
        "y": 1305,
        "wires": [
            [
                "b24a8b47054377df"
            ]
        ]
    },
    {
        "id": "2c9f2559f802470e",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "d": true,
        "name": "build labelInjector msg",
        "func": "msg.payload = labelInjectorHtml(msg);\nreturn msg;\n\nfunction labelInjectorHtml(opt){\n    let {\n        groupClass\n        ,groupIndex\n        ,insertBeforeClass = undefined\n        ,labelClass\n        ,label\n        ,extraAttributes = \"\"\n    } = opt;\n    \n    return `\n        <script>\n    \n            //append style to head ONCE\n            window.injectedLabelStyle ?? window.injectedLabelStyle = document.head.inserAdjacentHTML(\"beforeend\",\\`\n                <style>\n                    .injected-label {\n                        position:absolute;\n                        top:calc(0 - 1em - 3px);\n                        width:fit-content;\n                    }\n                </style>\n            \\`)\n\n            const injectLabelElement = target => {\n                //attach class to target\n                target.classList.includes(\"injected-label-target\") || target.classList.add(\"injected-label-target\");\n                //prepend label element to target\n                if(!target.previousElementSibling.classList.includes(${labelClass}))\n                    return target.inserAdjacentHTML(\"beforebegin\",\n                        \"<div \"+${extraAttributes}+'class=\"${labelClass} injected-label\">'+${label}+'</div>'\n                    )\n                return target.previousElementSibling;\n            } \n\n            //attach to specific group\n            if( ${groupClass} && ${insertBeforeClass}){\n                //assume group with that class exists\n                let group = document.getElementsByClassName(${groupClass})[${groupIndex}];\n                if(group.getElementsByClassName(${labelClass}).length > 0){\n                    let el = group.getElementsByClassName(${insertBeforeClass})[0];\n                    injectLabelElement(el);\n                }\n            }\n            //attach to all groups simultaneously\n            else if(${insertBeforeClass}){\n                //get all targets\n                let els = document.getElementsByClassName(${insertBeforeClass});\n                els.forEach( el => injectLabelElement(el) )\n            }\n        </script>\n    `\n\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 335,
        "y": 1485,
        "wires": [
            []
        ]
    },
    {
        "id": "e1fbcf1696a8841f",
        "type": "ui_template",
        "z": "520bb4ac551bd04e",
        "d": true,
        "g": "af76f16f74c94f86",
        "group": "0824968cb29bbcd0",
        "name": "accessing msg withing script tag example (exploit)",
        "order": 9,
        "width": 0,
        "height": 0,
        "format": "<script>\n   //example \n   //from https://flows.nodered.org/flow/2f1aaf0635f9bf23207152682323240a\n   (function(scope) {\n      let i=0;\n      console.log('Position 1',ObjectClone(scope ?? {notDef:true}));\n      console.dir(scope);\n      scope.$watch('msg.payload', function(watchedValue, unkn, b_akaAngularObjectRef_akaScope) {\n         console.log('Position 2 #'+(i++),scope, arguments, ObjectClone(watchedValue ?? {notDef:true}));\n         console.dir(watchedValue);\n         //#1 outputs \"...\", scope === angularObjectRef, [undef, undef, scope], {notDef:true}\n         //#2 outputs \"...\", scope === angularObjectRef,  [ msg.payload, undef, scope ], msg.payload\n      });\n   })(scope);\n\n    function safeStringify(obj, indent){\n      var cache = [];\n      var cacheKeys = [];\n      return JSON.stringify(obj, (key, value) => {\n         if (typeof value === 'object' && value !== null) { //arrays and null are also \"objects\" //functions are too, but typeof returns \"function\" instead\n            //Duplicate reference found -> discard key / store\n            const idx = cache.indexOf(value)\n            //if duplicate found\n               //return twin's key instead\n            if(idx != -1) //-1 means not present\n               return \"dupOf_\"+(cacheKeys[idx].toString() ?? \"root\");\n               //else store it\n            else{\n               cache.push(value);\n               cacheKeys.push(key);\n            }\n         }\n         return value;\n      },indent);\n   }\n   \n   function ObjectClone(obj){\n      return JSON.parse(safeStringify(obj));\n   }\n</script>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 725,
        "y": 1665,
        "wires": [
            []
        ]
    },
    {
        "id": "3502536b287b497d",
        "type": "link in",
        "z": "520bb4ac551bd04e",
        "d": true,
        "g": "af76f16f74c94f86",
        "name": "utils isDefinedEvent",
        "links": [
            "6f8c1f95e51d8102"
        ],
        "x": 255,
        "y": 1710,
        "wires": [
            [
                "8a415c23ba7ae283"
            ]
        ],
        "l": true
    },
    {
        "id": "64ab2f95b6ada28f",
        "type": "ui_template",
        "z": "520bb4ac551bd04e",
        "d": true,
        "g": "af76f16f74c94f86",
        "group": "0824968cb29bbcd0",
        "name": "shareNoderedGlobals utils",
        "order": 8,
        "width": 0,
        "height": 0,
        "format": "\n<script>\n   /* example \n   //from https://flows.nodered.org/flow/2f1aaf0635f9bf23207152682323240a\n   (function(scope) {\n      let i=0;\n      console.log('Position 1',clone(scope ?? {notDef:true}));\n      console.dir(scope);\n      scope.$watch('msg.payload', function(watchedValue, unkn, b_akaAngularObjectRef_akaScope) {\n         console.log('Position 2 #'+(i++),scope, arguments, clone(watchedValue ?? {notDef:true}));\n         console.dir(watchedValue);\n         //#1 outputs \"...\", scope === angularObjectRef, [undef, undef, scope], {notDef:true}\n         //#2 outputs \"...\", scope === angularObjectRef,  [ msg.payload, undef, scope ], msg.payload\n      });\n   })(scope);\n   */\n   console.log(\"context here\",this)\n\n   (function(scope) {\n      let clearWatcher = scope.$watch('msg', function(msg, unk, scope) {\n         //run once with not-empty msg, then clear()\n         if(!msg)\n            return;\n         \n         let globals = msg.payload || {notDef:true};\n         if(!window.shareNoderedGlobals){ //redundant, just to be sure\n            //define globals in window\n            for(let key in globals)\n               if(!window[key])\n                  window[key] = globals[key];\n               else\n                  alert(\"error: window[\"+key+\"] is already defined\") && console.error(\"window[\"+key+\"] is already defined, with val\",window[key])\n         }\n         else\n            console.log(\"nodered globals already defined\")\n\n         //dbg\n         let keys = Object.keys(globals)\n         console.log(\"defined \"+keys+\" from vals \",keys.map(k => globals[k]),\" with vals\", keys.map( k => window[k] ), \" using arguments \",clone(arguments))\n\n         //clear watcher\n         window.shareNoderedGlobals = true;\n         window[\"setThisOne\"] = true;\n         clearWatcher();\n      });\n   });\n   \n   function safeStringify(obj, indent){\n      var cache = [];\n      var cacheKeys = [];\n      return JSON.stringify(obj, (key, value) => {\n         if (typeof value === 'object' && value !== null) { //arrays and null are also \"objects\" //functions are too, but typeof returns \"function\" instead\n            //Duplicate reference found -> discard key / store\n            const idx = cache.indexOf(value)\n            //if duplicate found\n               //return twin's key instead\n            if(idx != -1) //-1 means not present\n               return \"dupOf_\"+(cacheKeys[idx].toString() ?? \"root\");\n               //else store it\n            else{\n               cache.push(value);\n               cacheKeys.push(key);\n            }\n         }\n         return value;\n      },indent);\n   }\n\n   function clone(obj){\n      return JSON.parse(safeStringify(obj));\n   }\n   /**/\n</script>\n\n",
        "storeOutMessages": false,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "global",
        "className": "",
        "x": 675,
        "y": 1710,
        "wires": [
            [
                "65c3acbda3f09214"
            ]
        ]
    },
    {
        "id": "65c3acbda3f09214",
        "type": "debug",
        "z": "520bb4ac551bd04e",
        "d": true,
        "g": "af76f16f74c94f86",
        "name": "shareNoderedGlobals",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 935,
        "y": 1710,
        "wires": []
    },
    {
        "id": "8a415c23ba7ae283",
        "type": "function",
        "z": "520bb4ac551bd04e",
        "d": true,
        "g": "af76f16f74c94f86",
        "name": "set msg.globals",
        "func": "\nlet v = {\n    payload:{\n        \"utils\":global.get(\"utils\")\n    }\n};\nnode.warn(v);\nreturn v;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 455,
        "y": 1710,
        "wires": [
            [
                "64ab2f95b6ada28f"
            ]
        ]
    },
    {
        "id": "b0c67c61c93053a0",
        "type": "inject",
        "z": "520bb4ac551bd04e",
        "d": true,
        "g": "af76f16f74c94f86",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 270,
        "y": 1770,
        "wires": [
            [
                "8a415c23ba7ae283"
            ]
        ]
    },
    {
        "id": "29af8acde7daaa6e",
        "type": "comment",
        "z": "520bb4ac551bd04e",
        "g": "af76f16f74c94f86",
        "name": "exploits attempts",
        "info": "",
        "x": 275,
        "y": 1665,
        "wires": []
    },
    {
        "id": "2207af6d8b5f5262",
        "type": "ui_template",
        "z": "520bb4ac551bd04e",
        "d": true,
        "group": "0824968cb29bbcd0",
        "name": "accessing msg withing script tag example (exploit)",
        "order": 7,
        "width": 0,
        "height": 0,
        "format": "<script>\n   /*\n   //example \n   //from https://flows.nodered.org/flow/2f1aaf0635f9bf23207152682323240a\n   (function(scope) {\n      let i=0;\n      console.log('Position 1',ObjectClone(scope ?? {notDef:true}));\n      console.dir(scope);\n      scope.$watch('msg.payload', function(watchedValue, unkn, b_akaAngularObjectRef_akaScope) {\n         console.log('Position 2 #'+(i++),scope, arguments, ObjectClone(watchedValue ?? {notDef:true}));\n         console.dir(watchedValue);\n         //#1 outputs \"...\", scope === angularObjectRef, [undef, undef, scope], {notDef:true}\n         //#2 outputs \"...\", scope === angularObjectRef,  [ msg.payload, undef, scope ], msg.payload\n      });\n   })(scope);\n   */\n\n   \n\n   /*\n    function safeStringify(obj, indent){\n      var cache = [];\n      var cacheKeys = [];\n      return JSON.stringify(obj, (key, value) => {\n         if (typeof value === 'object' && value !== null) { //arrays and null are also \"objects\" //functions are too, but typeof returns \"function\" instead\n            //Duplicate reference found -> discard key / store\n            const idx = cache.indexOf(value)\n            //if duplicate found\n               //return twin's key instead\n            if(idx != -1) //-1 means not present\n               return \"dupOf_\"+(cacheKeys[idx].toString() ?? \"root\");\n               //else store it\n            else{\n               cache.push(value);\n               cacheKeys.push(key);\n            }\n         }\n         return value;\n      },indent);\n   }\n   \n   function ObjectClone(obj){\n      return JSON.parse(safeStringify(obj));\n   }\n   */\n</script>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 685,
        "y": 1410,
        "wires": [
            []
        ]
    },
    {
        "id": "4f673125b6589d64",
        "type": "ui_template",
        "z": "520bb4ac551bd04e",
        "d": true,
        "group": "0824968cb29bbcd0",
        "name": "injectLabel",
        "order": 10,
        "width": 0,
        "height": 0,
        "format": "\n<script>\n   /* example \n   //from https://flows.nodered.org/flow/2f1aaf0635f9bf23207152682323240a\n   (function(scope) {\n      let i=0;\n      console.log('Position 1',clone(scope ?? {notDef:true}));\n      console.dir(scope);\n      scope.$watch('msg.payload', function(watchedValue, unkn, b_akaAngularObjectRef_akaScope) {\n         console.log('Position 2 #'+(i++),scope, arguments, clone(watchedValue ?? {notDef:true}));\n         console.dir(watchedValue);\n         //#1 outputs \"...\", scope === angularObjectRef, [undef, undef, scope], {notDef:true}\n         //#2 outputs \"...\", scope === angularObjectRef,  [ msg.payload, undef, scope ], msg.payload\n      });\n   })(scope);\n   */\n\n   (function(scope) {\n      let clearWatcher = scope.$watch('msg', function(msg, unk, scope) {\n         //run once with not-empty msg, then clear()\n         if(!msg)\n            return;\n         \n         let {\n            groupClass,\n            groupIndex,\n            insertBeforeClass,\n            labelClass,\n            label,\n            extraAttributes = \"\"\n         } = msg;\n         \n         //append style to head ONCE\n         if(!window.injectedLabelStyle){\n            windown.injectedLabelStyle = true;\n            document.head.inserAdjacentHTML(\"beforeend\",`\n               <style>\n                     .injected-label {\n                        position:absolute;\n                        top:calc(0 - 1em - 3px);\n                        width:fit-content;\n                     }\n               </style>\n            `)\n         }\n\n         const injectLabelElement = target => {\n            //attach class to target\n            target.classList.includes(\"injected-label-target\") || el.classList.add(\"injected-label-target\");\n            //prepend label element to target\n            if(!target.previousElementSibling.classList.includes(labelClass))\n                  return target.inserAdjacentHTML(\"beforebegin\",`\n                     <div ${extraAttributes} class=\"labelClass injected-label\">${label}</div>\n                  `)\n            return target.previousElementSibling;\n         } \n\n         //attach to specific group\n         if( groupClass && insertBeforeClass){\n            //assume group with that class exists\n            let group = document.getElementsByClassName(groupClass)[groupIndex];\n            if(group.getElementsByClassName(labelClass).length > 0){\n                  let el = group.getElementsByClassName(insertBeforeClass)[0];\n                  injectLabelElement(el);\n            }\n         }\n         //attach to all groups simultaneously\n         else if(insertBeforeClass){\n            //get all targets\n            let els = document.getElementsByClassName(insertBeforeClass);\n            els.forEach( el => injectLabelElement(el) )\n         }\n\n         //clear watcher\n         window.injectLabel_blinkTimesCfg = true;\n         //clearWatcher();\n      });\n   })(scope);\n   \n   function safeStringify(obj, indent){\n      var cache = [];\n      var cacheKeys = [];\n      return JSON.stringify(obj, (key, value) => {\n         if (typeof value === 'object' && value !== null) { //arrays and null are also \"objects\" //functions are too, but typeof returns \"function\" instead\n            //Duplicate reference found -> discard key / store\n            const idx = cache.indexOf(value)\n            //if duplicate found\n               //return twin's key instead\n            if(idx != -1) //-1 means not present\n               return \"dupOf_\"+(cacheKeys[idx].toString() ?? \"root\");\n               //else store it\n            else{\n               cache.push(value);\n               cacheKeys.push(key);\n            }\n         }\n         return value;\n      },indent);\n   }\n\n   function clone(obj){\n      return JSON.parse(safeStringify(obj));\n   }\n   /**/\n</script>\n\n",
        "storeOutMessages": false,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 610,
        "y": 1470,
        "wires": [
            []
        ]
    },
    {
        "id": "e9c05dc0d2ad3913",
        "type": "ui_template",
        "z": "520bb4ac551bd04e",
        "group": "a3ba2e57b1953e7d",
        "name": "blinkTimes label",
        "order": 12,
        "width": 0,
        "height": 0,
        "format": "\n<script times=\"0\">\n   (function (){\n      let i=0;\n      {  //dbg\n         let t=document.currentScript.getAttribute(\"times\");\n         t = typeof t == \"string\" ? parseInt(t) : t;\n         console.log(\"processing #\"+(++i)+\"|\"+(t+1),document.currentScript);\n         document.currentScript.setAttribute(\"times\",t+1);\n         \n      }\n\n      // let script = document.currentScript; //script.parent = head???\n      // //get label target\n      //    //if class is not found an exception will be thrown as it will try to access null.nextElementSibling\n      // let target = ( function findClass(className, start){\n      //       console.log(\"parsing\", start)\n      //       return (start.classList.contains(className) ? start : findClass(start.nextElementSibling))\n      //    }\n      // )(\"blinktimes-label\", script);\n\n      let labelClass = \"blinktimes-label\";\n      let appliedPlaceholderClass = \"applied-\"+labelClass;\n      for( let target of document.getElementsByClassName(labelClass)){\n         let parent = target.parentElement;\n         if(!parent.getAttribute(appliedPlaceholderClass)){\n            parent.setAttribute(appliedPlaceholderClass, Date.now())\n            //modify container\n            parent.style.top = `calc(${style.top} + 20px)`;\n         }\n      }\n      \n      \n\n      console.log(\"script\", script, target)\n   })()\n</script>\n<style>\n   body {\n      background-color:black;\n   }\n</style>\n<div class=\"blinktimes-label\"> intermittenza </div>\n\n",
        "storeOutMessages": false,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 1025,
        "y": 1290,
        "wires": [
            []
        ]
    },
    {
        "id": "30236855f60d07d3",
        "type": "exec",
        "z": "520bb4ac551bd04e",
        "command": "shutdown /r",
        "addpay": "",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "reboot",
        "x": 1030,
        "y": 810,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "112fb4b46fedacc0",
        "type": "inject",
        "z": "520bb4ac551bd04e",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 840,
        "y": 810,
        "wires": [
            [
                "30236855f60d07d3"
            ]
        ]
    },
    {
        "id": "5b597e5028501ec6",
        "type": "switch",
        "z": "520bb4ac551bd04e",
        "g": "2548f65a8c8c4380",
        "name": "loopback",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 570,
        "y": 660,
        "wires": [
            [
                "be226db0e7901b38"
            ]
        ]
    },
    {
        "id": "5a1b811d74476de7",
        "type": "comment",
        "z": "520bb4ac551bd04e",
        "g": "2548f65a8c8c4380",
        "name": "early requests are delayed and looped back",
        "info": "",
        "x": 845,
        "y": 675,
        "wires": []
    },
    {
        "id": "f9a072bb99a360be",
        "type": "function",
        "z": "8fee1699ebf4915d",
        "d": true,
        "name": "uiAbs",
        "func": "\nlet tabs=[];\nlet groups=[];\nlet tree=[];\n\nconst json=msg.payload;\n    //estract tabs and groups to sorted arrays\nfor(let item of json){\n    if(item.type==\"ui_tab\")\n        tabs.push(item);\n    else if(item.type==\"ui_group\")\n        groups.push(item);\n}\n\ntabs.sort((a,b)=>{\n    return (!a.order || a.order<b.order) ? -1 : 1\n});\ngroups.sort((a, b) => {\n    if(a.tab == b.tab)\n        return (!a.order || a.order < b.order) ? -1 : 1;\n    else\n        return (!a.tab < b.tab) ? -1 : 1;\n})\n\n\n    //costruisce il nameId che dashboard si aspetta a partire dall'attuale nome del gruppo/tab\nconst commonGetter = function (obj) {\n    if (!obj.currentNameIdBkp){\n        Math.random()>0.8 || node.warn({getterObjIs:obj});\n        obj.currentNameIdBkp = obj.currentName.trim().replaceAll(/\\s/g, '_');\n    }\n    return obj.currentNameIdBkp\n}\nconst dict/*ionary*/ = [\n    {\n        nameId: \"statoPresse\", id: \"533e203349de7f15\", currentName: \"StatoPresse\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter, groups: [\n            { nameId: \"pressa1\", id: \"de425a720011e6e9\", currentName: \"Pressa 1\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"pressa2\", id: \"f139ce507b5170da\", currentName: \"Pressa 2\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"pressa3\", id: \"c7137b451efabbac\", currentName: \"Pressa 3\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"pressa4\", id: \"13ed847e2817179c\", currentName: \"Pressa 4\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"tmpTools\", id: \"dc04b0c0c2689120\", currentName: \"tmpTools\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n        ]\n    },\n    {\n        nameId: \"graficiDiStato\", id: \"2d4a37310a5ce249\", currentName: \"Grafici di Stato\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter, groups: [\n            { nameId: \"pressa1\", id: \"57ea1d8425ab2254\", currentName: \"Pressa 1\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"group2\", id: \"4d2175afadb4dc79\", currentName: \"Group 2\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n        ]\n    },\n    {\n        nameId: \"gestioneOrdini\", id: \"836adb2b4d67f4ce\", currentName: \"Gestione Ordini\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter, groups: [\n            { nameId: \"queueTable\", id: \"77dcdddb4f97461c\", currentName: \"queueTable\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"historyTable\", id: \"b3c076eedf1fd2f8\", currentName: \"historyTable\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"toolBar\", id: \"ee2c7bc51cebda0e\", currentName: \"ToolBar\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"exampleTable\", id: \"6de891276c04fcd6\", currentName: \"exampleTable\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"completedTable\", id: \"b7f5c766a413446a\", currentName: \"completedTable\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n        ]\n    },\n    {\n        nameId: \"impostazioni\", id: \"a5b84c011240052c\", currentName: \"Impostazioni\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter, groups: [\n            { nameId: \"indicatoreDiTemperaturaPianoInferiore\", id: \"db63de8125d253b0\", currentName: \"Indicatore di temperatura piano inferiore\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"indicatoreDiTemperaturaPianoSuperiore\", id: \"a2dc8e5cbc92778b\", currentName: \"Indicatore di Temperatura Piano Superiore\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n            { nameId: \"indicatorePressioneDiPressata\", id: \"d6dcf6dea0234745\", currentName: \"indicatore pressione di pressata\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter },\n        ]\n    }\n];\n\n    //update dictionary names with current ones\nfor(let dictTab of dict){\n        //retrieve tabs names\n    for (let treeTab of tabs){\n        if(treeTab.id==dictTab.id){\n            dictTab.currentName=treeTab.name;\n            break;\n        }\n    }\n    if(!dictTab.currentName)\n        node.warn(\"id \"+dictTab.id+\" of tab \".dictTab.nId+\" not found\");\n    \n        //retrieve groups names\n    for(let dictGroup of dictTab.groups){\n        for (let treeGroup of groups) {\n            if (treeGroup.id == dictGroup.id) {\n                dictGroup.currentName = treeGroup.name;\n                break;\n            }\n        }\n        if (!dictGroup.currentName)\n            node.warn(\"id \" + dictGroup.id + \" of group \".dictGroup.nId + \" of \"+dictTab.nId+\" not found\");\n    }\n}\n/*\nlet finDict={}\nfor(let dictTab of dict){\n    if(finDict.hasOwnProperty(dictTab.nId))\n        node.warn(dictTab.nId+\" of \"+dictTab.currentName+\" is used twice\");\n    else\n        finDict[dictTab.nId].dictTab;\n}\n*/\n\n//Object.defineProperty(o, 'b', { get() { return this.a + 1; } });\n\nconst uiAbs={\n    //tabs:tabs,\n    //groups:groups\n    //tree:[],\n    dict:dict,\n\n    realNId(tabNId,groupNId){\n        for (let t of this.dict){\n            if (t.nameId == tabNId){\n                if(groupNId){\n                    for(let g of t.groups){\n                        if(g.nameId == groupNId)\n                            return t.currentNameId+'_'+g.currentNameId;\n                    }\n                    node.error(\"missing group \"+groupNId+\" from dictionary\");\n                    return \"\";\n                }\n                else\n                    return t.currentNameId;\n            }\n        }\n        node.error(\"missing tab \" + tabNId + \" from dictionary\");\n        return \"\";\n        //return dict[t].currentNameId+'_'+dict[t].groups[g].currentNameId;\n    }\n}\n\nglobal.set(\"uiAbs\",uiAbs);\nnode.warn(uiAbs);\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "9691b2e29062754d",
        "type": "file in",
        "z": "8fee1699ebf4915d",
        "d": true,
        "name": "",
        "filename": "..\\flows.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 485,
        "y": 240,
        "wires": [
            [
                "92945e57f17b73d2"
            ]
        ]
    },
    {
        "id": "92945e57f17b73d2",
        "type": "json",
        "z": "8fee1699ebf4915d",
        "d": true,
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 800,
        "y": 240,
        "wires": [
            [
                "f9a072bb99a360be"
            ]
        ]
    },
    {
        "id": "153839b4ffc03633",
        "type": "function",
        "z": "8fee1699ebf4915d",
        "d": true,
        "name": "utility:generate dictionary from current ui names",
        "func": "\n\nconst commonGetter = function (obj) {\n    if (!obj.currentNameIdBkp)\n        obj.currentNameIdBkp = obj.currentName.trim().replaceAll(/\\s/g, '_');\n    return obj.currentNameIdBkp\n}\n\n    //a gOod example -> aGOodExample\nfunction toCamelCase(str) {\n    return str.replace(/^(.)/, (m, chr) => chr.toLowerCase()).replace(/[^a-zA-Z0-9]+(.)/g, (m, chr) => chr.toUpperCase()).replace(/\\s+/g, '');\n}\n\nfunction newDictEntry(item) {\n    let nId = toCamelCase(item.name.trim());\n    return { nameId: nId, id: item.id, currentName: item.name, get currentNameId() { return this.getter(this) }, currentNameIdBkp: \"\", getter: commonGetter }\n}\n//!! misses the trailing }\nfunction newDictEntry_asString(item) {\n    let nId = toCamelCase(item.name.trim());\n    return \"{ nameId:\\\"\" + nId + \"\\\", id:\\\"\" + item.id + \"\\\" , currentName:\\\"\" + item.name + \"\\\", get currentNameId() { return this.getter(this) }, currentNameIdBkp: \\\"\\\", getter: commonGetter \";\n}\n\n    //extract tabs and groups to sorted arrays\nfunction extractTabsAndGroups(flowJson){\n    let json = flowJson;\n    var tabs = [];\n    var groups = [];\n    var dict = \"\";\n\n    for (let item of json) {\n        if (item.type == \"ui_tab\")\n            tabs.push(item);\n        else if (item.type == \"ui_group\")\n            groups.push(item);\n    }\n\n    tabs.sort((a, b) => {\n        return (!a.order || a.order < b.order) ? -1 : 1\n    });\n    groups.sort((a, b) => {\n        if (a.tab == b.tab)\n            return (!a.order || a.order < b.order) ? -1 : 1;\n        else\n            return (!a.tab < b.tab) ? -1 : 1;\n    });\n\n    return {tabs:tabs,groups:groups};\n}\n\n\nfunction generateDictionaryFromCurrentNames(flowJson) {\n        //extract tabs and groups to sorted arrays\n    const ui=extractTabsAndGroups(flowJson);\n    var tabs=ui.tabs;\n    var groups=ui.groups;\n    var dict=new Array();\n\n    //generate dictionary\n    var tmpTabEntry;\n    for (let tab of tabs) {\n        tmpTabEntry = newDictEntry(tab);\n        tmpTabEntry.groups = new Array();\n        for (let group of groups)\n            if(group.tab == tab.id)\n                tmpTabEntry.groups.push(newDictEntry(group));\n        dict.push(tmpTabEntry);\n    }\n    \n    return dict;\n   \n}\n\nfunction generateDictionaryFromCurrentNames_asString(flowJson) {\n        //extract tabs and groups to sorted arrays\n    const ui = extractTabsAndGroups(flowJson);\n    var tabs = ui.tabs;\n    var groups = ui.groups;\n    var dict = \"\";\n\n    //generate dictionary\n    var tmpTabEntry;\n    var tmpGroupList;\n    dict+=\"[\\n\";\n    for (let tab of tabs) {\n        tmpTabEntry = \"\\t\"+newDictEntry_asString(tab);\n            //create group indented list\n        tmpGroupList = \"\";\n        for (let group of groups)\n            if (group.tab == tab.id)\n                tmpGroupList+=\"\\t\\t\"+newDictEntry_asString(group)+\"},\\n\";\n            //put all togheter\n        dict += tmpTabEntry + \", groups:[\" + (tmpGroupList ? \"\\n\"+tmpGroupList: \"\")+ \"\\t]},\\n\";\n    }\n    //dict = dict.replace(/..$/,'\\n]'); //trailing ,\\n -> \\n]\n    dict+=\"]\";\n    \n    //copy-paste this, editing whatever you need to\n    return dict;\n}\n\nfunction updateDictionaryFromCurrentNames(flowJson,dict) {\n   \n    return dict;\n}\n\n\nif(msg.topic==\"generate\"){\n    node.warn({ generatedSample: generateDictionaryFromCurrentNames(msg.payload) });\n\n    //copy-paste this, editing whatever you need to\n    return {payload: generateDictionaryFromCurrentNames_asString(msg.payload)};\n}else{\n    \n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 935,
        "y": 420,
        "wires": [
            [
                "7b3634c1f9724113"
            ]
        ]
    },
    {
        "id": "8cac78848d6b22b2",
        "type": "file in",
        "z": "8fee1699ebf4915d",
        "d": true,
        "name": "",
        "filename": "..\\flows.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 440,
        "y": 420,
        "wires": [
            [
                "ef08e8b13598f526"
            ]
        ]
    },
    {
        "id": "ef08e8b13598f526",
        "type": "json",
        "z": "8fee1699ebf4915d",
        "d": true,
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 700,
        "y": 420,
        "wires": [
            [
                "153839b4ffc03633"
            ]
        ],
        "l": false
    },
    {
        "id": "2548c414ee1ab994",
        "type": "inject",
        "z": "8fee1699ebf4915d",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "generate",
        "x": 280,
        "y": 405,
        "wires": [
            [
                "8cac78848d6b22b2"
            ]
        ]
    },
    {
        "id": "7b3634c1f9724113",
        "type": "file",
        "z": "8fee1699ebf4915d",
        "d": true,
        "name": "",
        "filename": "..\\generatedDictionary.tmp.js",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1290,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "2b6f94e5ce081fbe",
        "type": "exec",
        "z": "8fee1699ebf4915d",
        "d": true,
        "command": "start notepad++ .\\.node-red\\generatedDictionary.tmp.js",
        "addpay": "",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 630,
        "y": 525,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "84e72c57208999db",
        "type": "complete",
        "z": "8fee1699ebf4915d",
        "d": true,
        "name": "",
        "scope": [
            "7b3634c1f9724113"
        ],
        "uncaught": false,
        "x": 285,
        "y": 525,
        "wires": [
            [
                "2b6f94e5ce081fbe"
            ]
        ]
    },
    {
        "id": "a6002f7e58869b90",
        "type": "comment",
        "z": "8fee1699ebf4915d",
        "d": true,
        "name": "utility to generate a dictionary for uiAbstraction. useful for first time setup",
        "info": "",
        "x": 445,
        "y": 360,
        "wires": []
    },
    {
        "id": "d49dfeb7ae711955",
        "type": "inject",
        "z": "8fee1699ebf4915d",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "update",
        "x": 280,
        "y": 435,
        "wires": [
            [
                "8cac78848d6b22b2"
            ]
        ]
    },
    {
        "id": "ed77f0f509c9f6ee",
        "type": "ui_ui_control",
        "z": "8fee1699ebf4915d",
        "d": true,
        "name": "",
        "events": "all",
        "x": 850,
        "y": 150,
        "wires": [
            []
        ]
    },
    {
        "id": "32b8d545a703c318",
        "type": "function",
        "z": "8fee1699ebf4915d",
        "d": true,
        "name": "toggle smt",
        "func": "const ui=global.get(\"uiAbs\");\n\nlet toggle = context.get(\"toggle\")\ncontext.set(\"toggle\",!toggle);\n\nif(toggle){\n    msg.payload = {\n        \"group\": {\n            \"hide\": [ui.realNId(\"fotovoltaico\", \"tmpEditingBar\")],\n            \"focus\": true\n        }\n    }\n}else{\n    msg.payload = {\n        \"group\": {\n            \"show\": [ui.realNId(\"fotovoltaico\", \"tmpEditingBar\")],\n            \"focus\": true\n        }\n    }\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 150,
        "wires": [
            [
                "ed77f0f509c9f6ee"
            ]
        ]
    },
    {
        "id": "91149cea20d9053a",
        "type": "inject",
        "z": "8fee1699ebf4915d",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 505,
        "y": 150,
        "wires": [
            [
                "32b8d545a703c318"
            ]
        ]
    },
    {
        "id": "e2b029e401d6cf8d",
        "type": "inject",
        "z": "8fee1699ebf4915d",
        "d": true,
        "name": "OnStartup0.1",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.1",
        "topic": "",
        "x": 315,
        "y": 240,
        "wires": [
            [
                "9691b2e29062754d"
            ]
        ]
    },
    {
        "id": "4804b1117cd2500a",
        "type": "ui_template",
        "z": "8fee1699ebf4915d",
        "d": true,
        "group": "de425a720011e6e9",
        "name": "Logo / Clock",
        "order": 13,
        "width": 0,
        "height": 0,
        "format": "<script id=\"clockScript1\" type=\"text/javascript\">\n    var clockInterval;\n    $(function () {\n        if (clockInterval) return;\n\n        \n\n\n        var logoContainer = document.createElement(\"div\");\n        logoContainer.style.margin = \"5px auto\";\n        //logoContainer.style.marginBottom = \"0px\";\n        \n        var imgCont = document.createElement(\"span\");\n        logoContainer.append(imgCont);\n        imgCont.style.position = \"relative\";\n        imgCont.style.top = \"5px\";\n\n        var imgCont2 = document.createElement(\"span\");\n        imgCont2.style.marginLeft=\"30px\";\n        logoContainer.append(imgCont2);\n\n        logoGiga = new Image();\n        logoGiga.src = \"/loghi/giga/logoGiga.png\";\n        logoGiga.height = 30;\n        logoContainer.children[1].append(logoGiga);\n\n        \n        logoItal = new Image();\n        logoItal.src = \"/loghi/italmatic/logoItalmatic.png\";\n        logoItal.height = 30;\n        logoContainer.children[0].append(logoItal);\n\n        //add clock\n        var div2 = $('<div/>');\n        var p = $('<p/>');\n\n        div2.append(p);\n        div2[0].style.margin = '5px';\n\n        function displayTime() {\n            p.text(new Date().toLocaleString());\n        }\n        \n        clockInterval = setInterval(displayTime, 1000);\n\n        //add to toolbar when it's available\n        var addToToolbarTimer;\n        \n        function addToToolbar() {\n            var toolbar = $('.md-toolbar-tools');\n            \n            if(!toolbar.length) return;\n            \n            toolbar.append(logoContainer);\n            toolbar.append(div2);\n            clearInterval(addToToolbarTimer);\n        }\n        addToToolbarTimer = setInterval(addToToolbar, 100);\n    });\n</script>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "global",
        "className": "",
        "x": 1075,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "1a14f59430b6423f",
        "type": "debug",
        "z": "14adf9cd8d883348",
        "g": "6eb58abc9359afb4",
        "name": "exec",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "TOWER BIT ARRAY",
        "statusType": "auto",
        "x": 980,
        "y": 150,
        "wires": []
    },
    {
        "id": "d6ee8d661e15b8b0",
        "type": "exec",
        "z": "14adf9cd8d883348",
        "g": "6eb58abc9359afb4",
        "command": "shutdown /r /d p:4:1 /c \"riavvio giornaliero pianificato da e per server nodered\" /T 0",
        "addpay": "",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 605,
        "y": 150,
        "wires": [
            [
                "1a14f59430b6423f"
            ],
            [
                "1a14f59430b6423f"
            ],
            []
        ]
    },
    {
        "id": "e966eb84efa69b90",
        "type": "inject",
        "z": "14adf9cd8d883348",
        "g": "6eb58abc9359afb4",
        "name": "everyday at 23:59",
        "props": [],
        "repeat": "",
        "crontab": "59 23 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 195,
        "y": 150,
        "wires": [
            [
                "d6ee8d661e15b8b0"
            ]
        ]
    },
    {
        "id": "aabf6291a4464fe1",
        "type": "comment",
        "z": "14adf9cd8d883348",
        "g": "6eb58abc9359afb4",
        "name": "parameters info",
        "info": "https://learn.microsoft.com/it-it/windows-server/administration/windows-commands/shutdown\n\n/r -> restart\n/d -> document shutdown reason -> planned, for app maintenance\n/c -> document shutdown reason -> \"...\"",
        "x": 390,
        "y": 105,
        "wires": []
    },
    {
        "id": "9217c8ece8c8d37f",
        "type": "comment",
        "z": "14adf9cd8d883348",
        "g": "6eb58abc9359afb4",
        "name": "DAILY REBOOT",
        "info": "",
        "x": 170,
        "y": 105,
        "wires": []
    },
    {
        "id": "91867d3820fefb81",
        "type": "file in",
        "z": "14adf9cd8d883348",
        "g": "35aa637688559ad2",
        "name": "",
        "filename": ".\\restoreState.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 450,
        "y": 645,
        "wires": [
            [
                "a7babccaa58fb5cf"
            ]
        ]
    },
    {
        "id": "f43d077dd828410a",
        "type": "catch",
        "z": "14adf9cd8d883348",
        "g": "35aa637688559ad2",
        "name": "",
        "scope": [
            "91867d3820fefb81"
        ],
        "uncaught": false,
        "x": 150,
        "y": 555,
        "wires": [
            [
                "4b2c4976236c2e80"
            ]
        ]
    },
    {
        "id": "4b2c4976236c2e80",
        "type": "function",
        "z": "14adf9cd8d883348",
        "g": "35aa637688559ad2",
        "name": "catch restoreState fileNotFound -> skip",
        "func": "\nif(/ENOENT/.test(msg.error.message) && !context.get(\"triedOnce\")){\n    console.info(\"[info][restoreState] no state file left to restore. step skipped.\");\n}\nelse{\n    return [null,msg]\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\ncontext.set(\"triedOnce\",undefined)",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 555,
        "wires": [
            [
                "7911378bf44fca6b"
            ],
            [
                "85984f62b53a753e"
            ]
        ]
    },
    {
        "id": "85984f62b53a753e",
        "type": "function",
        "z": "14adf9cd8d883348",
        "g": "35aa637688559ad2",
        "name": "catch restoreState all -> error",
        "func": "\n\nif(msg.error){\n    node.error({ \"err\": msg.error.message, \"src\": msg.error.source.id, \"n\": msg.error.source.name, \"full\": msg });\n    //context.set(\"errorCc\", context.get(\"errorCc\")+1);\n    global.get(\"utils\").errorBlink(node, 60000);\n}\nelse{\n    node.error(msg);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\n//node.status({ fill: \"gray\", shape: \"ring\", text: \"\" });\ncontext.set(\"outCc\", 0);\ncontext.set(\"errorCc\", 0);",
        "finalize": "",
        "libs": [],
        "x": 365,
        "y": 585,
        "wires": [
            []
        ]
    },
    {
        "id": "61643a1c4c517885",
        "type": "comment",
        "z": "14adf9cd8d883348",
        "g": "35aa637688559ad2",
        "name": "on missing file -> skip step",
        "info": "",
        "x": 205,
        "y": 525,
        "wires": []
    },
    {
        "id": "a6d4cf300708d97e",
        "type": "comment",
        "z": "14adf9cd8d883348",
        "g": "35aa637688559ad2",
        "name": "AUTOMATIC STATE RESTORE",
        "info": "",
        "x": 220,
        "y": 465,
        "wires": []
    },
    {
        "id": "41052036e4260285",
        "type": "link in",
        "z": "14adf9cd8d883348",
        "g": "35aa637688559ad2",
        "name": "allMain isDefinedEvent out",
        "links": [
            "230aaa874077cfdc"
        ],
        "x": 230,
        "y": 645,
        "wires": [
            [
                "91867d3820fefb81"
            ]
        ],
        "l": true
    },
    {
        "id": "a7babccaa58fb5cf",
        "type": "json",
        "z": "14adf9cd8d883348",
        "g": "35aa637688559ad2",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 570,
        "y": 645,
        "wires": [
            [
                "5784a0cac60a9c02"
            ]
        ],
        "l": false
    },
    {
        "id": "5784a0cac60a9c02",
        "type": "function",
        "z": "14adf9cd8d883348",
        "g": "35aa637688559ad2",
        "name": "restore state",
        "func": "const signalCells = global.get(\"signalCells\");\nconst towersControl = global.get(\"towersControl\");\nconst towerBitArray = global.get(\"towerBitArray\");\nlet state = msg.payload;\n    //initialize the var if it's still undefined, then get it\nconst ctxGet = (key, val) => { context.get(key) ?? context.set(key, val); return context.get(key) }\nlet output = ctxGet(\"output\", toOutputMap([[\"default\", \"done\"], \"send_setSingleCellState\", \"programmedStateChanges\"]))//ctxGet(\"output\",new Map([[\"default\",0],[\"restoreState\",1]]));\n//[a,[b,c,d],e] -> (map)[ (a,0) (b,1) (c,1) (d,1) (e,2) ]\nfunction toOutputMap (arr){\n    let m = new Map();\n    let i=0;\n    for(let item of arr){\n        typeof item == \"string\" ? m.set(item, i) : item.forEach( subItem => m.set(subItem,i) )\n        i++;\n    }\n    return m;\n}\n\n\n// //copy state to global (towersControl)\n// for(let mk of towersControl.dictionary.macKeys)\n//     if(towersControl[mk] && state.towersControl[mk])\n//         for(let dev of towersControl.dictionary.devices)\n//             if(towersControl[mk].hasDevice(dev) && (state.towersControl[mk][dev] ?? false))\n//                 towersControl[mk][dev] = state.towersControl[mk][dev];\ntowersControl.towerBitArray = state.towersBitArray;\n//towersControl.dictionary.macKeys.forEach( mk => { if(towersControl[mk].hasDevice(\"horn\")) towersControl[mk][\"horn\"]=0 })\n\nconst sendOnChannel = (ch, msg) => {\n    let idx = output.get(ch);\n    node.send( new Array(node.outputCount).fill(null).map( (v,i) => i==idx ? msg : null ))\n}\n//copy state to global (signalCells)\n    //copy state //extrapolate new timer's end and start keeping the same progress\n    //restore ui\n    //program expected state changes //may trigger immediately\nfor(let mk of signalCells.dictionary.macKeys){\n    if(signalCells[mk] && state.signalCells[mk]){\n        let cell = signalCells[mk];\n        let cellState = state.signalCells[mk];\n        \n        //restore stateful data\n        cell.signalKey = cellState.signalKey;\n        cell.timerStart = cellState.timerStart;\n        cell.timerEnd = cellState.timerEnd;\n        //node.warn(\"for \"+mk+\" restore a timer diff \"+msToScaledString(cell.timerEnd-cell.timerStart)+\", to go \"+msToScaledString(Date.now() - cell.timerEnd))\n        //node.warn(\"for \" + mk + \" restore a timer diff \" + (cell.timerEnd - cell.timerStart) + \", to go \" + (Date.now() - cell.timerEnd))\n\n        //restore ui\n        sendOnChannel(\"send_setSingleCellState\", { topic: mk, action: \"set\" + cellState.signalKey });\n\n        //restore programmed state changes\n            //note: delay lower than 0 will trigger immediately\n        switch (cellState.signalKey) {\n            case \"A3\": {\n                let toA3LeftTimeout = undefined;\n                let toA4LeftTimeout = cellState.timerEnd - Date.now();\n                //sendOnChannel(\"restoreStateChanges\", { topic: mk, toA3LeftTimeout: toA3LeftTimeout, toA4LeftTimeout: toA4LeftTimeout });\n                sendOnChannel(\"programmedStateChanges\", { topic: mk, action: \"setA4\", delay: toA4LeftTimeout })\n                break;\n            }\n            case \"A2\": { }\n            case \"A1\": {\n                let toA3LeftTimeout = cellState.timerEnd - Date.now();\n                let toA4LeftTimeout = toA3LeftTimeout + cell.cfg.toA4Timeout;\n                //sendOnChannel(\"restoreStateChanges\", { topic: mk, toA3LeftTimeout: toA3LeftTimeout, toA4LeftTimeout: toA4LeftTimeout});\n                sendOnChannel(\"programmedStateChanges\", { topic: mk, action: \"setA3\", delay: toA3LeftTimeout })\n                setTimeout(()=>sendOnChannel(\"programmedStateChanges\", { topic: mk, action: \"setA4\", delay: toA4LeftTimeout }) , 100) //ensure msg order\n                break;\n            }\n            default: {\n                // //set to stored signal key, emulating button action\n                // sendOnChannel(\"buttonActions\", { topic: mk, action: \"set\" + state.signalCells.signalKey })\n            }\n        }\n    }\n}\n\nreturn msg;\n\n\n//---------------------------------------------------------\n\n\n// return formatted HTML version of JSON object\nfunction syntaxHighlight(json) {\n    json = global.get(\"utils\").safeStringify(json, 3)\n    json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')\n    json = json.replace(/(\"(\\\\u[a-zA-Z0-9]{4}|\\\\[^u]|[^\\\\\"])*\"(\\s*:)?|\\b(true|false|null)\\b|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?)/g, function (match) {\n        var cls = 'number'\n        if ((/^\"/).test(match)) {\n            if ((/:$/).test(match)) {\n                cls = 'key'\n            } else {\n                cls = 'string'\n            }\n        } else if ((/true|false/).test(match)) {\n            cls = 'boolean'\n        } else if ((/null/).test(match)) {\n            cls = 'null'\n        }\n        return '<span class=\"' + cls + '\">' + match + '</span>'\n    })\n    return json\n}\n\nfunction msToScaledString(ms) {\n    let units = [\"ms\", \"s\", \"min\", \"h\", \"gg\"];\n    let treshHoldMult = new Array(units.length).fill(2); //in terms of the associated unit // 1 hour == 3600ms -> if treshholdMult==2 then threshHold==3600*2\n    let unitFactors = [1, 1000, 60, 60, 24]; //in terms of the preceding unit //ex. min are 1*1000*60\n    //let getUnitFactor = (idx) => { var ret=0; for(let i=0;i<idx;i++) ret*=factor[i]; return ret; }\n\n    var unitFactor = unitFactors[0];\n    for (let i = 1; i < units.length; i++) {\n        let lastUF = unitFactor;\n        unitFactor *= unitFactors[i];\n        if (Math.abs(ms) < unitFactor * treshHoldMult[i])\n            return (ms / lastUF).toFixed(1) + units[i - 1];\n    }\n    return (ms / unitFactor).toFixed(1) + units[units.length - 1];\n}",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 645,
        "wires": [
            [
                "2dcd2df82068fcce",
                "0e17b1f0443d5737",
                "043971672406f236"
            ],
            [
                "ed79aaef36d18df1"
            ],
            [
                "6e97b2f0a581d55b",
                "0c5f5aeabcfbd0d1"
            ]
        ]
    },
    {
        "id": "2dcd2df82068fcce",
        "type": "debug",
        "z": "14adf9cd8d883348",
        "g": "35aa637688559ad2",
        "name": "done",
        "active": true,
        "tosidebar": false,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "counter",
        "x": 1180,
        "y": 630,
        "wires": []
    },
    {
        "id": "0e17b1f0443d5737",
        "type": "debug",
        "z": "14adf9cd8d883348",
        "g": "35aa637688559ad2",
        "name": "READ STATE FILE",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1350,
        "y": 630,
        "wires": []
    },
    {
        "id": "ed79aaef36d18df1",
        "type": "link call",
        "z": "14adf9cd8d883348",
        "g": "35aa637688559ad2",
        "name": "",
        "links": [
            "10236b7afccb694e"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 970,
        "y": 675,
        "wires": [
            [
                "2a6a1d0cbfeb5f83"
            ]
        ]
    },
    {
        "id": "6e97b2f0a581d55b",
        "type": "link out",
        "z": "14adf9cd8d883348",
        "g": "35aa637688559ad2",
        "name": "programmedStateChange ",
        "mode": "link",
        "links": [
            "fb95b4d0741d8db8"
        ],
        "x": 940,
        "y": 705,
        "wires": [],
        "l": true
    },
    {
        "id": "0c5f5aeabcfbd0d1",
        "type": "debug",
        "z": "14adf9cd8d883348",
        "g": "35aa637688559ad2",
        "name": "PROGRAMMED STATE CHANGE",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 970,
        "y": 735,
        "wires": []
    },
    {
        "id": "2a6a1d0cbfeb5f83",
        "type": "link out",
        "z": "14adf9cd8d883348",
        "g": "35aa637688559ad2",
        "name": "toWebapp",
        "mode": "link",
        "links": [
            "29da4c340c1c0f16"
        ],
        "x": 1175,
        "y": 675,
        "wires": [],
        "l": true
    },
    {
        "id": "043971672406f236",
        "type": "link out",
        "z": "14adf9cd8d883348",
        "g": "35aa637688559ad2",
        "name": "delete state file",
        "mode": "link",
        "links": [
            "d6ab8a21caf8dd3b"
        ],
        "x": 955,
        "y": 630,
        "wires": [],
        "l": true
    },
    {
        "id": "7911378bf44fca6b",
        "type": "debug",
        "z": "14adf9cd8d883348",
        "g": "35aa637688559ad2",
        "name": "SKIPPED",
        "active": true,
        "tosidebar": false,
        "console": false,
        "tostatus": true,
        "complete": "\"[info] no state file to restore. step skipped.\"",
        "targetType": "jsonata",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 645,
        "y": 540,
        "wires": []
    },
    {
        "id": "93abcb4edbd0a1ac",
        "type": "comment",
        "z": "14adf9cd8d883348",
        "g": "35aa637688559ad2",
        "name": "if a state-file exists -> use it to restore -> then delete it",
        "info": "",
        "x": 575,
        "y": 465,
        "wires": []
    },
    {
        "id": "fd4f3ebd7f37cd17",
        "type": "complete",
        "z": "14adf9cd8d883348",
        "d": true,
        "g": "bfb4b00f09dfccfd",
        "name": "",
        "scope": [],
        "uncaught": false,
        "x": 155,
        "y": 990,
        "wires": [
            [
                "cb49098a37b92f18"
            ]
        ]
    },
    {
        "id": "158bed02f04013ce",
        "type": "inject",
        "z": "14adf9cd8d883348",
        "d": true,
        "g": "bfb4b00f09dfccfd",
        "name": "poll 1s global.config",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": true,
        "onceDelay": "2",
        "topic": "",
        "payload": "config",
        "payloadType": "global",
        "x": 230,
        "y": 1020,
        "wires": [
            [
                "070daa6a6ef78f3d"
            ]
        ]
    },
    {
        "id": "070daa6a6ef78f3d",
        "type": "rbe",
        "z": "14adf9cd8d883348",
        "d": true,
        "g": "bfb4b00f09dfccfd",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": false,
        "property": "payload",
        "topi": "topic",
        "x": 370,
        "y": 1020,
        "wires": [
            [
                "1e42ac697672b6b4",
                "fce2ffd7d2b35d6e"
            ]
        ],
        "l": false
    },
    {
        "id": "1e42ac697672b6b4",
        "type": "json",
        "z": "14adf9cd8d883348",
        "d": true,
        "g": "bfb4b00f09dfccfd",
        "name": "",
        "property": "payload",
        "action": "str",
        "pretty": false,
        "x": 460,
        "y": 1005,
        "wires": [
            [
                "bcd7df405295570f"
            ]
        ],
        "l": false
    },
    {
        "id": "bcd7df405295570f",
        "type": "file",
        "z": "14adf9cd8d883348",
        "d": true,
        "g": "bfb4b00f09dfccfd",
        "name": "",
        "filename": ".\\commonConfig.json",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 575,
        "y": 1005,
        "wires": [
            [
                "dc2fd44ea538fda7"
            ]
        ]
    },
    {
        "id": "dc2fd44ea538fda7",
        "type": "debug",
        "z": "14adf9cd8d883348",
        "d": true,
        "g": "bfb4b00f09dfccfd",
        "name": "written settings",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 760,
        "y": 1005,
        "wires": []
    },
    {
        "id": "fce2ffd7d2b35d6e",
        "type": "link out",
        "z": "14adf9cd8d883348",
        "d": true,
        "g": "bfb4b00f09dfccfd",
        "name": "OnConfigUpdate_out",
        "mode": "link",
        "links": [
            "019724bd0407040d",
            "7a56c04c308a37eb",
            "0be9e347c272ebc7",
            "382b9ee86b061715",
            "2829a11cc5455212",
            "c7f4104b21b3f0ed",
            "4f4965017bd78144",
            "79329d19f997f71e",
            "dcfdd404535dc654",
            "23fa7a8de9d4b748",
            "71cdad2935eab809",
            "a3c95a133003aada",
            "736f1d79123164d5"
        ],
        "x": 535,
        "y": 1050,
        "wires": [],
        "l": true
    },
    {
        "id": "cb49098a37b92f18",
        "type": "change",
        "z": "14adf9cd8d883348",
        "d": true,
        "g": "bfb4b00f09dfccfd",
        "name": "get config",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "config",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 315,
        "y": 990,
        "wires": [
            [
                "1e42ac697672b6b4",
                "fce2ffd7d2b35d6e"
            ]
        ]
    },
    {
        "id": "e14bd5a48fcb543b",
        "type": "inject",
        "z": "14adf9cd8d883348",
        "d": true,
        "g": "bfb4b00f09dfccfd",
        "name": "send",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "2",
        "topic": "",
        "payload": "config",
        "payloadType": "global",
        "x": 275,
        "y": 1050,
        "wires": [
            [
                "fce2ffd7d2b35d6e"
            ]
        ]
    },
    {
        "id": "a656f280adc14246",
        "type": "complete",
        "z": "14adf9cd8d883348",
        "d": true,
        "g": "bfb4b00f09dfccfd",
        "name": "OnConfigUpdate",
        "scope": [
            "cb60b597db78bc13",
            "1e42ac697672b6b4"
        ],
        "uncaught": false,
        "x": 325,
        "y": 1095,
        "wires": [
            [
                "493cfc79a184c67c"
            ]
        ]
    },
    {
        "id": "493cfc79a184c67c",
        "type": "link out",
        "z": "14adf9cd8d883348",
        "d": true,
        "g": "bfb4b00f09dfccfd",
        "name": "OnConfigUpdateEvent_out",
        "mode": "link",
        "links": [],
        "x": 555,
        "y": 1095,
        "wires": [],
        "l": true
    },
    {
        "id": "ee4f4e0ee6527625",
        "type": "comment",
        "z": "14adf9cd8d883348",
        "d": true,
        "g": "bfb4b00f09dfccfd",
        "name": "KEEP UPDATED",
        "info": "",
        "x": 165,
        "y": 945,
        "wires": []
    },
    {
        "id": "497ec0fb4b7392b8",
        "type": "link in",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "saveCurrentState",
        "links": [
            "e637604a3c43424e"
        ],
        "x": 1300,
        "y": 150,
        "wires": [
            [
                "1efc46b49a6a59e7"
            ]
        ],
        "l": true
    },
    {
        "id": "1efc46b49a6a59e7",
        "type": "function",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "saveCurrentState",
        "func": "const utils = global.get(\"utils\");\nconst cells = global.get(\"signalCells\");\nconst tow = global.get(\"towersBitArray\")\n\n// //copy all signalCells with their non-excluded properties\n// var excluded = [\"dictionary\", \"config\", \"cfg\"];\n// const isExcluded = key => excluded.includes(key)\n// var signalCellsState = {};\n// for(let mk of cells.dictionary.macKeys){\n//     if(cells[mk] && !isExcluded(mk)){\n//         signalCellsState[mk]={};\n//         for(let prop in cells[mk])\n//             if(!isExcluded(prop))\n//                 signalCellsState[mk][prop] = cells[mk][prop];\n//     }\n// }\n\nmsg.payload = {\n    signalCells:global.get(\"signalCells\"),\n    towersBitArray:global.get(\"towersBitArray\"),\n    towersControl:global.get(\"towersControl\")\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1545,
        "y": 150,
        "wires": [
            [
                "ca300241ca443067"
            ]
        ]
    },
    {
        "id": "ea04186b2067f593",
        "type": "inject",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "2",
        "topic": "",
        "x": 1185,
        "y": 150,
        "wires": [
            [
                "1efc46b49a6a59e7"
            ]
        ],
        "l": false
    },
    {
        "id": "ca300241ca443067",
        "type": "file",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "",
        "filename": ".\\restoreState.json",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1830,
        "y": 150,
        "wires": [
            [
                "08a61faf703ec6cf"
            ]
        ]
    },
    {
        "id": "67b02575612b3226",
        "type": "json",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "",
        "property": "payload",
        "action": "str",
        "pretty": false,
        "x": 1725,
        "y": 150,
        "wires": [
            [
                "ca300241ca443067"
            ]
        ],
        "l": false
    },
    {
        "id": "08a61faf703ec6cf",
        "type": "debug",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "WRITTEN STATE FILE",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2140,
        "y": 150,
        "wires": []
    },
    {
        "id": "935b5fa38d92f20d",
        "type": "link in",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "restoreStateFromFile",
        "links": [],
        "x": 1325,
        "y": 255,
        "wires": [
            [
                "ed1c3d5de195c0e1"
            ]
        ],
        "l": true
    },
    {
        "id": "ed1c3d5de195c0e1",
        "type": "file in",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "",
        "filename": ".\\restoreState.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1545,
        "y": 255,
        "wires": [
            [
                "87d179b8dd6b59f4"
            ]
        ]
    },
    {
        "id": "b9469859fc2ce5d8",
        "type": "inject",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "2",
        "topic": "",
        "x": 1190,
        "y": 255,
        "wires": [
            [
                "ed1c3d5de195c0e1"
            ]
        ],
        "l": false
    },
    {
        "id": "87d179b8dd6b59f4",
        "type": "json",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1665,
        "y": 255,
        "wires": [
            [
                "b949c18f7f5d8c39"
            ]
        ],
        "l": false
    },
    {
        "id": "b949c18f7f5d8c39",
        "type": "function",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "restore state",
        "func": "const signalCells = global.get(\"signalCells\");\nconst towersControl = global.get(\"towersControl\");\nconst towerBitArray = global.get(\"towerBitArray\");\nlet state = msg.payload;\n    //initialize the var if it's still undefined, then get it\nconst ctxGet = (key, val) => { context.get(key) ?? context.set(key, val); return context.get(key) }\nlet output = ctxGet(\"output\", toOutputMap([[\"default\", \"done\"], \"send_setSingleCellState\", \"programmedStateChanges\"]))//ctxGet(\"output\",new Map([[\"default\",0],[\"restoreState\",1]]));\n//[a,[b,c,d],e] -> (map)[ (a,0) (b,1) (c,1) (d,1) (e,2) ]\nfunction toOutputMap (arr){\n    let m = new Map();\n    let i=0;\n    for(let item of arr){\n        typeof item == \"string\" ? m.set(item, i) : item.forEach( subItem => m.set(subItem,i) )\n        i++;\n    }\n    return m;\n}\n\n\n// //copy state to global (towersControl)\n// for(let mk of towersControl.dictionary.macKeys)\n//     if(towersControl[mk] && state.towersControl[mk])\n//         for(let dev of towersControl.dictionary.devices)\n//             if(towersControl[mk].hasDevice(dev) && (state.towersControl[mk][dev] ?? false))\n//                 towersControl[mk][dev] = state.towersControl[mk][dev];\ntowersControl.towerBitArray = state.towersBitArray;\n//towersControl.dictionary.macKeys.forEach( mk => { if(towersControl[mk].hasDevice(\"horn\")) towersControl[mk][\"horn\"]=0 })\n\nconst sendOnChannel = (ch, msg) => {\n    let idx = output.get(ch);\n    node.send( new Array(node.outputCount).fill(null).map( (v,i) => i==idx ? msg : null ))\n}\n//copy state to global (signalCells)\n    //copy state //extrapolate new timer's end and start keeping the same progress\n    //restore ui\n    //program expected state changes //may trigger immediately\nfor(let mk of signalCells.dictionary.macKeys){\n    if(signalCells[mk] && state.signalCells[mk]){\n        let cell = signalCells[mk];\n        let cellState = state.signalCells[mk];\n        \n        //restore stateful data\n        cell.signalKey = cellState.signalKey;\n        cell.timerStart = cellState.timerStart;\n        cell.timerEnd = cellState.timerEnd;\n        //node.warn(\"for \"+mk+\" restore a timer diff \"+msToScaledString(cell.timerEnd-cell.timerStart)+\", to go \"+msToScaledString(Date.now() - cell.timerEnd))\n        //node.warn(\"for \" + mk + \" restore a timer diff \" + (cell.timerEnd - cell.timerStart) + \", to go \" + (Date.now() - cell.timerEnd))\n\n        //restore ui\n        sendOnChannel(\"send_setSingleCellState\", { topic: mk, action: \"set\" + cellState.signalKey });\n\n        //restore programmed state changes\n            //note: delay lower than 0 will trigger immediately\n        switch (cellState.signalKey) {\n            case \"A3\": {\n                let toA3LeftTimeout = undefined;\n                let toA4LeftTimeout = cellState.timerEnd - Date.now();\n                //sendOnChannel(\"restoreStateChanges\", { topic: mk, toA3LeftTimeout: toA3LeftTimeout, toA4LeftTimeout: toA4LeftTimeout });\n                sendOnChannel(\"programmedStateChanges\", { topic: mk, action: \"setA4\", delay: toA4LeftTimeout })\n                break;\n            }\n            case \"A2\": { }\n            case \"A1\": {\n                let toA3LeftTimeout = cellState.timerEnd - Date.now();\n                let toA4LeftTimeout = toA3LeftTimeout + cell.cfg.toA4Timeout;\n                //sendOnChannel(\"restoreStateChanges\", { topic: mk, toA3LeftTimeout: toA3LeftTimeout, toA4LeftTimeout: toA4LeftTimeout});\n                sendOnChannel(\"programmedStateChanges\", { topic: mk, action: \"setA3\", delay: toA3LeftTimeout })\n                setTimeout(()=>sendOnChannel(\"programmedStateChanges\", { topic: mk, action: \"setA4\", delay: toA4LeftTimeout }) , 100) //ensure msg order\n                break;\n            }\n            default: {\n                // //set to stored signal key, emulating button action\n                // sendOnChannel(\"buttonActions\", { topic: mk, action: \"set\" + state.signalCells.signalKey })\n            }\n        }\n    }\n}\n\nreturn msg;\n\n\n//---------------------------------------------------------\n\n\n// return formatted HTML version of JSON object\nfunction syntaxHighlight(json) {\n    json = global.get(\"utils\").safeStringify(json, 3)\n    json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')\n    json = json.replace(/(\"(\\\\u[a-zA-Z0-9]{4}|\\\\[^u]|[^\\\\\"])*\"(\\s*:)?|\\b(true|false|null)\\b|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?)/g, function (match) {\n        var cls = 'number'\n        if ((/^\"/).test(match)) {\n            if ((/:$/).test(match)) {\n                cls = 'key'\n            } else {\n                cls = 'string'\n            }\n        } else if ((/true|false/).test(match)) {\n            cls = 'boolean'\n        } else if ((/null/).test(match)) {\n            cls = 'null'\n        }\n        return '<span class=\"' + cls + '\">' + match + '</span>'\n    })\n    return json\n}\n\nfunction msToScaledString(ms) {\n    let units = [\"ms\", \"s\", \"min\", \"h\", \"gg\"];\n    let treshHoldMult = new Array(units.length).fill(2); //in terms of the associated unit // 1 hour == 3600ms -> if treshholdMult==2 then threshHold==3600*2\n    let unitFactors = [1, 1000, 60, 60, 24]; //in terms of the preceding unit //ex. min are 1*1000*60\n    //let getUnitFactor = (idx) => { var ret=0; for(let i=0;i<idx;i++) ret*=factor[i]; return ret; }\n\n    var unitFactor = unitFactors[0];\n    for (let i = 1; i < units.length; i++) {\n        let lastUF = unitFactor;\n        unitFactor *= unitFactors[i];\n        if (Math.abs(ms) < unitFactor * treshHoldMult[i])\n            return (ms / lastUF).toFixed(1) + units[i - 1];\n    }\n    return (ms / unitFactor).toFixed(1) + units[units.length - 1];\n}",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1825,
        "y": 255,
        "wires": [
            [
                "5e14728c6936fe53",
                "1bbe4a9a6badfd24"
            ],
            [
                "1f7757569a33e748"
            ],
            [
                "d8a6e6c6bc116cfc",
                "029f2d3620fbb110"
            ]
        ]
    },
    {
        "id": "5e14728c6936fe53",
        "type": "debug",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "done",
        "active": true,
        "tosidebar": false,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "counter",
        "x": 2050,
        "y": 210,
        "wires": []
    },
    {
        "id": "1bbe4a9a6badfd24",
        "type": "debug",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "READ STATE FILE",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2210,
        "y": 210,
        "wires": []
    },
    {
        "id": "d8a6e6c6bc116cfc",
        "type": "link out",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "programmedStateChange ",
        "mode": "link",
        "links": [
            "fb95b4d0741d8db8"
        ],
        "x": 2110,
        "y": 285,
        "wires": [],
        "l": true
    },
    {
        "id": "1f7757569a33e748",
        "type": "link call",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "",
        "links": [
            "10236b7afccb694e"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 2095,
        "y": 255,
        "wires": [
            [
                "5730340fa9556086"
            ]
        ]
    },
    {
        "id": "029f2d3620fbb110",
        "type": "debug",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "PROGRAMMED STATE CHANGE",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 2315,
        "y": 315,
        "wires": []
    },
    {
        "id": "5730340fa9556086",
        "type": "link out",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "toWebapp",
        "mode": "link",
        "links": [
            "29da4c340c1c0f16"
        ],
        "x": 2300,
        "y": 255,
        "wires": [],
        "l": true
    },
    {
        "id": "d6ab8a21caf8dd3b",
        "type": "link in",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "delete state file",
        "links": [
            "043971672406f236"
        ],
        "x": 1310,
        "y": 345,
        "wires": [
            [
                "3f93fc19eb97a392"
            ]
        ],
        "l": true
    },
    {
        "id": "3f93fc19eb97a392",
        "type": "change",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": ".\\restoreState.json",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$env(\"noderedDir\")&\"app\\\\restoreState.json\"\t",
                "tot": "jsonata",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1545,
        "y": 345,
        "wires": [
            [
                "5b6d9c4bb7c7210e"
            ]
        ]
    },
    {
        "id": "99d74bbcf54ceafd",
        "type": "inject",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "2",
        "topic": "",
        "x": 1190,
        "y": 345,
        "wires": [
            [
                "3f93fc19eb97a392"
            ]
        ],
        "l": false
    },
    {
        "id": "5b6d9c4bb7c7210e",
        "type": "exec",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "command": "del",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "5",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 1740,
        "y": 345,
        "wires": [
            [
                "203b1837125c2217"
            ],
            [
                "203b1837125c2217"
            ],
            []
        ]
    },
    {
        "id": "203b1837125c2217",
        "type": "debug",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "DELETED STATE FILE",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1960,
        "y": 345,
        "wires": []
    },
    {
        "id": "d1753d386dc75712",
        "type": "comment",
        "z": "14adf9cd8d883348",
        "g": "0d23a37596efc707",
        "name": "MANUAL STATE BACKUP/RESTORE",
        "info": "",
        "x": 1305,
        "y": 105,
        "wires": []
    },
    {
        "id": "e637604a3c43424e",
        "type": "link out",
        "z": "14adf9cd8d883348",
        "g": "700856f51ec39824",
        "name": "saveCurrentState",
        "mode": "link",
        "links": [
            "497ec0fb4b7392b8"
        ],
        "x": 600,
        "y": 360,
        "wires": [],
        "l": true
    },
    {
        "id": "2545eae96edd254a",
        "type": "comment",
        "z": "14adf9cd8d883348",
        "g": "700856f51ec39824",
        "name": "ENABLE AUTOMATIC BACKUP (hot changes tool)",
        "info": "",
        "x": 280,
        "y": 270,
        "wires": []
    },
    {
        "id": "587068d6a5159aed",
        "type": "comment",
        "z": "14adf9cd8d883348",
        "g": "700856f51ec39824",
        "name": "#dbg toggle",
        "info": "",
        "x": 185,
        "y": 300,
        "wires": []
    },
    {
        "id": "69dc5f6d92a33152",
        "type": "inject",
        "z": "14adf9cd8d883348",
        "g": "700856f51ec39824",
        "name": "toggle",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "control",
        "payload": "toggle",
        "payloadType": "str",
        "x": 205,
        "y": 330,
        "wires": [
            [
                "b2c5db789d45f171"
            ]
        ]
    },
    {
        "id": "b2c5db789d45f171",
        "type": "gate",
        "z": "14adf9cd8d883348",
        "g": "700856f51ec39824",
        "name": "",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 295,
        "y": 360,
        "wires": [
            [
                "e637604a3c43424e"
            ]
        ],
        "l": false
    },
    {
        "id": "122b2c1cb1ecdcf0",
        "type": "inject",
        "z": "14adf9cd8d883348",
        "g": "700856f51ec39824",
        "name": "poll 15s",
        "props": [],
        "repeat": "1",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "x": 195,
        "y": 360,
        "wires": [
            [
                "b2c5db789d45f171"
            ]
        ]
    }
]